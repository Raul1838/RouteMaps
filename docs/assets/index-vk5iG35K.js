function wO(t,e){for(var r=0;r<e.length;r++){const l=e[r];if(typeof l!="string"&&!Array.isArray(l)){for(const d in l)if(d!=="default"&&!(d in t)){const g=Object.getOwnPropertyDescriptor(l,d);g&&Object.defineProperty(t,d,g.get?g:{enumerable:!0,get:()=>l[d]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))l(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const w of g.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&l(w)}).observe(document,{childList:!0,subtree:!0});function r(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function l(d){if(d.ep)return;d.ep=!0;const g=r(d);fetch(d.href,g)}})();var bO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function od(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gA={exports:{}},Oy={},_A={exports:{}},an={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var am=Symbol.for("react.element"),EO=Symbol.for("react.portal"),TO=Symbol.for("react.fragment"),SO=Symbol.for("react.strict_mode"),IO=Symbol.for("react.profiler"),CO=Symbol.for("react.provider"),AO=Symbol.for("react.context"),PO=Symbol.for("react.forward_ref"),kO=Symbol.for("react.suspense"),MO=Symbol.for("react.memo"),RO=Symbol.for("react.lazy"),BS=Symbol.iterator;function DO(t){return t===null||typeof t!="object"?null:(t=BS&&t[BS]||t["@@iterator"],typeof t=="function"?t:null)}var yA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},vA=Object.assign,xA={};function sd(t,e,r){this.props=t,this.context=e,this.refs=xA,this.updater=r||yA}sd.prototype.isReactComponent={};sd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};sd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function wA(){}wA.prototype=sd.prototype;function v1(t,e,r){this.props=t,this.context=e,this.refs=xA,this.updater=r||yA}var x1=v1.prototype=new wA;x1.constructor=v1;vA(x1,sd.prototype);x1.isPureReactComponent=!0;var FS=Array.isArray,bA=Object.prototype.hasOwnProperty,w1={current:null},EA={key:!0,ref:!0,__self:!0,__source:!0};function TA(t,e,r){var l,d={},g=null,w=null;if(e!=null)for(l in e.ref!==void 0&&(w=e.ref),e.key!==void 0&&(g=""+e.key),e)bA.call(e,l)&&!EA.hasOwnProperty(l)&&(d[l]=e[l]);var I=arguments.length-2;if(I===1)d.children=r;else if(1<I){for(var a=Array(I),k=0;k<I;k++)a[k]=arguments[k+2];d.children=a}if(t&&t.defaultProps)for(l in I=t.defaultProps,I)d[l]===void 0&&(d[l]=I[l]);return{$$typeof:am,type:t,key:g,ref:w,props:d,_owner:w1.current}}function LO(t,e){return{$$typeof:am,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function b1(t){return typeof t=="object"&&t!==null&&t.$$typeof===am}function zO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var NS=/\/+/g;function Qx(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zO(""+t.key):e.toString(36)}function b_(t,e,r,l,d){var g=typeof t;(g==="undefined"||g==="boolean")&&(t=null);var w=!1;if(t===null)w=!0;else switch(g){case"string":case"number":w=!0;break;case"object":switch(t.$$typeof){case am:case EO:w=!0}}if(w)return w=t,d=d(w),t=l===""?"."+Qx(w,0):l,FS(d)?(r="",t!=null&&(r=t.replace(NS,"$&/")+"/"),b_(d,e,r,"",function(k){return k})):d!=null&&(b1(d)&&(d=LO(d,r+(!d.key||w&&w.key===d.key?"":(""+d.key).replace(NS,"$&/")+"/")+t)),e.push(d)),1;if(w=0,l=l===""?".":l+":",FS(t))for(var I=0;I<t.length;I++){g=t[I];var a=l+Qx(g,I);w+=b_(g,e,r,a,d)}else if(a=DO(t),typeof a=="function")for(t=a.call(t),I=0;!(g=t.next()).done;)g=g.value,a=l+Qx(g,I++),w+=b_(g,e,r,a,d);else if(g==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return w}function Yg(t,e,r){if(t==null)return t;var l=[],d=0;return b_(t,l,"","",function(g){return e.call(r,g,d++)}),l}function OO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var wi={current:null},E_={transition:null},BO={ReactCurrentDispatcher:wi,ReactCurrentBatchConfig:E_,ReactCurrentOwner:w1};an.Children={map:Yg,forEach:function(t,e,r){Yg(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return Yg(t,function(){e++}),e},toArray:function(t){return Yg(t,function(e){return e})||[]},only:function(t){if(!b1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};an.Component=sd;an.Fragment=TO;an.Profiler=IO;an.PureComponent=v1;an.StrictMode=SO;an.Suspense=kO;an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BO;an.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var l=vA({},t.props),d=t.key,g=t.ref,w=t._owner;if(e!=null){if(e.ref!==void 0&&(g=e.ref,w=w1.current),e.key!==void 0&&(d=""+e.key),t.type&&t.type.defaultProps)var I=t.type.defaultProps;for(a in e)bA.call(e,a)&&!EA.hasOwnProperty(a)&&(l[a]=e[a]===void 0&&I!==void 0?I[a]:e[a])}var a=arguments.length-2;if(a===1)l.children=r;else if(1<a){I=Array(a);for(var k=0;k<a;k++)I[k]=arguments[k+2];l.children=I}return{$$typeof:am,type:t.type,key:d,ref:g,props:l,_owner:w}};an.createContext=function(t){return t={$$typeof:AO,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:CO,_context:t},t.Consumer=t};an.createElement=TA;an.createFactory=function(t){var e=TA.bind(null,t);return e.type=t,e};an.createRef=function(){return{current:null}};an.forwardRef=function(t){return{$$typeof:PO,render:t}};an.isValidElement=b1;an.lazy=function(t){return{$$typeof:RO,_payload:{_status:-1,_result:t},_init:OO}};an.memo=function(t,e){return{$$typeof:MO,type:t,compare:e===void 0?null:e}};an.startTransition=function(t){var e=E_.transition;E_.transition={};try{t()}finally{E_.transition=e}};an.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};an.useCallback=function(t,e){return wi.current.useCallback(t,e)};an.useContext=function(t){return wi.current.useContext(t)};an.useDebugValue=function(){};an.useDeferredValue=function(t){return wi.current.useDeferredValue(t)};an.useEffect=function(t,e){return wi.current.useEffect(t,e)};an.useId=function(){return wi.current.useId()};an.useImperativeHandle=function(t,e,r){return wi.current.useImperativeHandle(t,e,r)};an.useInsertionEffect=function(t,e){return wi.current.useInsertionEffect(t,e)};an.useLayoutEffect=function(t,e){return wi.current.useLayoutEffect(t,e)};an.useMemo=function(t,e){return wi.current.useMemo(t,e)};an.useReducer=function(t,e,r){return wi.current.useReducer(t,e,r)};an.useRef=function(t){return wi.current.useRef(t)};an.useState=function(t){return wi.current.useState(t)};an.useSyncExternalStore=function(t,e,r){return wi.current.useSyncExternalStore(t,e,r)};an.useTransition=function(){return wi.current.useTransition()};an.version="18.2.0";_A.exports=an;var re=_A.exports;const ro=od(re),FO=wO({__proto__:null,default:ro},[re]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NO=re,jO=Symbol.for("react.element"),UO=Symbol.for("react.fragment"),VO=Object.prototype.hasOwnProperty,$O=NO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,GO={key:!0,ref:!0,__self:!0,__source:!0};function SA(t,e,r){var l,d={},g=null,w=null;r!==void 0&&(g=""+r),e.key!==void 0&&(g=""+e.key),e.ref!==void 0&&(w=e.ref);for(l in e)VO.call(e,l)&&!GO.hasOwnProperty(l)&&(d[l]=e[l]);if(t&&t.defaultProps)for(l in e=t.defaultProps,e)d[l]===void 0&&(d[l]=e[l]);return{$$typeof:jO,type:t,key:g,ref:w,props:d,_owner:$O.current}}Oy.Fragment=UO;Oy.jsx=SA;Oy.jsxs=SA;gA.exports=Oy;var j=gA.exports,X0={},IA={exports:{}},so={},CA={exports:{}},AA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(_t,ot){var Tt=_t.length;_t.push(ot);e:for(;0<Tt;){var Rt=Tt-1>>>1,Vt=_t[Rt];if(0<d(Vt,ot))_t[Rt]=ot,_t[Tt]=Vt,Tt=Rt;else break e}}function r(_t){return _t.length===0?null:_t[0]}function l(_t){if(_t.length===0)return null;var ot=_t[0],Tt=_t.pop();if(Tt!==ot){_t[0]=Tt;e:for(var Rt=0,Vt=_t.length,yr=Vt>>>1;Rt<yr;){var Yt=2*(Rt+1)-1,Zn=_t[Yt],cr=Yt+1,vr=_t[cr];if(0>d(Zn,Tt))cr<Vt&&0>d(vr,Zn)?(_t[Rt]=vr,_t[cr]=Tt,Rt=cr):(_t[Rt]=Zn,_t[Yt]=Tt,Rt=Yt);else if(cr<Vt&&0>d(vr,Tt))_t[Rt]=vr,_t[cr]=Tt,Rt=cr;else break e}}return ot}function d(_t,ot){var Tt=_t.sortIndex-ot.sortIndex;return Tt!==0?Tt:_t.id-ot.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;t.unstable_now=function(){return g.now()}}else{var w=Date,I=w.now();t.unstable_now=function(){return w.now()-I}}var a=[],k=[],O=1,V=null,G=3,X=!1,oe=!1,le=!1,we=typeof setTimeout=="function"?setTimeout:null,te=typeof clearTimeout=="function"?clearTimeout:null,J=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ce(_t){for(var ot=r(k);ot!==null;){if(ot.callback===null)l(k);else if(ot.startTime<=_t)l(k),ot.sortIndex=ot.expirationTime,e(a,ot);else break;ot=r(k)}}function Te(_t){if(le=!1,ce(_t),!oe)if(r(a)!==null)oe=!0,Dn(Ne);else{var ot=r(k);ot!==null&&Fn(Te,ot.startTime-_t)}}function Ne(_t,ot){oe=!1,le&&(le=!1,te(qe),qe=-1),X=!0;var Tt=G;try{for(ce(ot),V=r(a);V!==null&&(!(V.expirationTime>ot)||_t&&!Ct());){var Rt=V.callback;if(typeof Rt=="function"){V.callback=null,G=V.priorityLevel;var Vt=Rt(V.expirationTime<=ot);ot=t.unstable_now(),typeof Vt=="function"?V.callback=Vt:V===r(a)&&l(a),ce(ot)}else l(a);V=r(a)}if(V!==null)var yr=!0;else{var Yt=r(k);Yt!==null&&Fn(Te,Yt.startTime-ot),yr=!1}return yr}finally{V=null,G=Tt,X=!1}}var Ge=!1,Xe=null,qe=-1,vt=5,ze=-1;function Ct(){return!(t.unstable_now()-ze<vt)}function Ut(){if(Xe!==null){var _t=t.unstable_now();ze=_t;var ot=!0;try{ot=Xe(!0,_t)}finally{ot?pt():(Ge=!1,Xe=null)}}else Ge=!1}var pt;if(typeof J=="function")pt=function(){J(Ut)};else if(typeof MessageChannel<"u"){var Zt=new MessageChannel,Hn=Zt.port2;Zt.port1.onmessage=Ut,pt=function(){Hn.postMessage(null)}}else pt=function(){we(Ut,0)};function Dn(_t){Xe=_t,Ge||(Ge=!0,pt())}function Fn(_t,ot){qe=we(function(){_t(t.unstable_now())},ot)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(_t){_t.callback=null},t.unstable_continueExecution=function(){oe||X||(oe=!0,Dn(Ne))},t.unstable_forceFrameRate=function(_t){0>_t||125<_t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):vt=0<_t?Math.floor(1e3/_t):5},t.unstable_getCurrentPriorityLevel=function(){return G},t.unstable_getFirstCallbackNode=function(){return r(a)},t.unstable_next=function(_t){switch(G){case 1:case 2:case 3:var ot=3;break;default:ot=G}var Tt=G;G=ot;try{return _t()}finally{G=Tt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(_t,ot){switch(_t){case 1:case 2:case 3:case 4:case 5:break;default:_t=3}var Tt=G;G=_t;try{return ot()}finally{G=Tt}},t.unstable_scheduleCallback=function(_t,ot,Tt){var Rt=t.unstable_now();switch(typeof Tt=="object"&&Tt!==null?(Tt=Tt.delay,Tt=typeof Tt=="number"&&0<Tt?Rt+Tt:Rt):Tt=Rt,_t){case 1:var Vt=-1;break;case 2:Vt=250;break;case 5:Vt=1073741823;break;case 4:Vt=1e4;break;default:Vt=5e3}return Vt=Tt+Vt,_t={id:O++,callback:ot,priorityLevel:_t,startTime:Tt,expirationTime:Vt,sortIndex:-1},Tt>Rt?(_t.sortIndex=Tt,e(k,_t),r(a)===null&&_t===r(k)&&(le?(te(qe),qe=-1):le=!0,Fn(Te,Tt-Rt))):(_t.sortIndex=Vt,e(a,_t),oe||X||(oe=!0,Dn(Ne))),_t},t.unstable_shouldYield=Ct,t.unstable_wrapCallback=function(_t){var ot=G;return function(){var Tt=G;G=ot;try{return _t.apply(this,arguments)}finally{G=Tt}}}})(AA);CA.exports=AA;var WO=CA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var PA=re,io=WO;function at(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kA=new Set,Mp={};function hu(t,e){Uh(t,e),Uh(t+"Capture",e)}function Uh(t,e){for(Mp[t]=e,t=0;t<e.length;t++)kA.add(e[t])}var ba=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),K0=Object.prototype.hasOwnProperty,qO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,jS={},US={};function HO(t){return K0.call(US,t)?!0:K0.call(jS,t)?!1:qO.test(t)?US[t]=!0:(jS[t]=!0,!1)}function ZO(t,e,r,l){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return l?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function XO(t,e,r,l){if(e===null||typeof e>"u"||ZO(t,e,r,l))return!0;if(l)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bi(t,e,r,l,d,g,w){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=l,this.attributeNamespace=d,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=g,this.removeEmptyString=w}var Yr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Yr[t]=new bi(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Yr[e]=new bi(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Yr[t]=new bi(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Yr[t]=new bi(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Yr[t]=new bi(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Yr[t]=new bi(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Yr[t]=new bi(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Yr[t]=new bi(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Yr[t]=new bi(t,5,!1,t.toLowerCase(),null,!1,!1)});var E1=/[\-:]([a-z])/g;function T1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(E1,T1);Yr[e]=new bi(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(E1,T1);Yr[e]=new bi(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(E1,T1);Yr[e]=new bi(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Yr[t]=new bi(t,1,!1,t.toLowerCase(),null,!1,!1)});Yr.xlinkHref=new bi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Yr[t]=new bi(t,1,!1,t.toLowerCase(),null,!0,!0)});function S1(t,e,r,l){var d=Yr.hasOwnProperty(e)?Yr[e]:null;(d!==null?d.type!==0:l||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(XO(e,r,d,l)&&(r=null),l||d===null?HO(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):d.mustUseProperty?t[d.propertyName]=r===null?d.type===3?!1:"":r:(e=d.attributeName,l=d.attributeNamespace,r===null?t.removeAttribute(e):(d=d.type,r=d===3||d===4&&r===!0?"":""+r,l?t.setAttributeNS(l,e,r):t.setAttribute(e,r))))}var ka=PA.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Qg=Symbol.for("react.element"),gh=Symbol.for("react.portal"),_h=Symbol.for("react.fragment"),I1=Symbol.for("react.strict_mode"),J0=Symbol.for("react.profiler"),MA=Symbol.for("react.provider"),RA=Symbol.for("react.context"),C1=Symbol.for("react.forward_ref"),Y0=Symbol.for("react.suspense"),Q0=Symbol.for("react.suspense_list"),A1=Symbol.for("react.memo"),vl=Symbol.for("react.lazy"),DA=Symbol.for("react.offscreen"),VS=Symbol.iterator;function Yf(t){return t===null||typeof t!="object"?null:(t=VS&&t[VS]||t["@@iterator"],typeof t=="function"?t:null)}var lr=Object.assign,e0;function lp(t){if(e0===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);e0=e&&e[1]||""}return`
`+e0+t}var t0=!1;function n0(t,e){if(!t||t0)return"";t0=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(k){var l=k}Reflect.construct(t,[],e)}else{try{e.call()}catch(k){l=k}t.call(e.prototype)}else{try{throw Error()}catch(k){l=k}t()}}catch(k){if(k&&l&&typeof k.stack=="string"){for(var d=k.stack.split(`
`),g=l.stack.split(`
`),w=d.length-1,I=g.length-1;1<=w&&0<=I&&d[w]!==g[I];)I--;for(;1<=w&&0<=I;w--,I--)if(d[w]!==g[I]){if(w!==1||I!==1)do if(w--,I--,0>I||d[w]!==g[I]){var a=`
`+d[w].replace(" at new "," at ");return t.displayName&&a.includes("<anonymous>")&&(a=a.replace("<anonymous>",t.displayName)),a}while(1<=w&&0<=I);break}}}finally{t0=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?lp(t):""}function KO(t){switch(t.tag){case 5:return lp(t.type);case 16:return lp("Lazy");case 13:return lp("Suspense");case 19:return lp("SuspenseList");case 0:case 2:case 15:return t=n0(t.type,!1),t;case 11:return t=n0(t.type.render,!1),t;case 1:return t=n0(t.type,!0),t;default:return""}}function ew(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case _h:return"Fragment";case gh:return"Portal";case J0:return"Profiler";case I1:return"StrictMode";case Y0:return"Suspense";case Q0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case RA:return(t.displayName||"Context")+".Consumer";case MA:return(t._context.displayName||"Context")+".Provider";case C1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case A1:return e=t.displayName||null,e!==null?e:ew(t.type)||"Memo";case vl:e=t._payload,t=t._init;try{return ew(t(e))}catch{}}return null}function JO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ew(e);case 8:return e===I1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Wl(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function LA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function YO(t){var e=LA(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),l=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var d=r.get,g=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return d.call(this)},set:function(w){l=""+w,g.call(this,w)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return l},setValue:function(w){l=""+w},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function e_(t){t._valueTracker||(t._valueTracker=YO(t))}function zA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),l="";return t&&(l=LA(t)?t.checked?"true":"false":t.value),t=l,t!==r?(e.setValue(t),!0):!1}function G_(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function tw(t,e){var r=e.checked;return lr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function $S(t,e){var r=e.defaultValue==null?"":e.defaultValue,l=e.checked!=null?e.checked:e.defaultChecked;r=Wl(e.value!=null?e.value:r),t._wrapperState={initialChecked:l,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function OA(t,e){e=e.checked,e!=null&&S1(t,"checked",e,!1)}function nw(t,e){OA(t,e);var r=Wl(e.value),l=e.type;if(r!=null)l==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(l==="submit"||l==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?rw(t,e.type,r):e.hasOwnProperty("defaultValue")&&rw(t,e.type,Wl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function GS(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var l=e.type;if(!(l!=="submit"&&l!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function rw(t,e,r){(e!=="number"||G_(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var cp=Array.isArray;function kh(t,e,r,l){if(t=t.options,e){e={};for(var d=0;d<r.length;d++)e["$"+r[d]]=!0;for(r=0;r<t.length;r++)d=e.hasOwnProperty("$"+t[r].value),t[r].selected!==d&&(t[r].selected=d),d&&l&&(t[r].defaultSelected=!0)}else{for(r=""+Wl(r),e=null,d=0;d<t.length;d++){if(t[d].value===r){t[d].selected=!0,l&&(t[d].defaultSelected=!0);return}e!==null||t[d].disabled||(e=t[d])}e!==null&&(e.selected=!0)}}function iw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(at(91));return lr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function WS(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(at(92));if(cp(r)){if(1<r.length)throw Error(at(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:Wl(r)}}function BA(t,e){var r=Wl(e.value),l=Wl(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),l!=null&&(t.defaultValue=""+l)}function qS(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function FA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ow(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?FA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var t_,NA=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,l,d){MSApp.execUnsafeLocalFunction(function(){return t(e,r,l,d)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(t_=t_||document.createElement("div"),t_.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=t_.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Rp(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var pp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},QO=["Webkit","ms","Moz","O"];Object.keys(pp).forEach(function(t){QO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),pp[e]=pp[t]})});function jA(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||pp.hasOwnProperty(t)&&pp[t]?(""+e).trim():e+"px"}function UA(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var l=r.indexOf("--")===0,d=jA(r,e[r],l);r==="float"&&(r="cssFloat"),l?t.setProperty(r,d):t[r]=d}}var e3=lr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function sw(t,e){if(e){if(e3[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(at(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(at(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(at(61))}if(e.style!=null&&typeof e.style!="object")throw Error(at(62))}}function aw(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lw=null;function P1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var cw=null,Mh=null,Rh=null;function HS(t){if(t=um(t)){if(typeof cw!="function")throw Error(at(280));var e=t.stateNode;e&&(e=Uy(e),cw(t.stateNode,t.type,e))}}function VA(t){Mh?Rh?Rh.push(t):Rh=[t]:Mh=t}function $A(){if(Mh){var t=Mh,e=Rh;if(Rh=Mh=null,HS(t),e)for(t=0;t<e.length;t++)HS(e[t])}}function GA(t,e){return t(e)}function WA(){}var r0=!1;function qA(t,e,r){if(r0)return t(e,r);r0=!0;try{return GA(t,e,r)}finally{r0=!1,(Mh!==null||Rh!==null)&&(WA(),$A())}}function Dp(t,e){var r=t.stateNode;if(r===null)return null;var l=Uy(r);if(l===null)return null;r=l[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(t=t.type,l=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!l;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(at(231,e,typeof r));return r}var uw=!1;if(ba)try{var Qf={};Object.defineProperty(Qf,"passive",{get:function(){uw=!0}}),window.addEventListener("test",Qf,Qf),window.removeEventListener("test",Qf,Qf)}catch{uw=!1}function t3(t,e,r,l,d,g,w,I,a){var k=Array.prototype.slice.call(arguments,3);try{e.apply(r,k)}catch(O){this.onError(O)}}var mp=!1,W_=null,q_=!1,hw=null,n3={onError:function(t){mp=!0,W_=t}};function r3(t,e,r,l,d,g,w,I,a){mp=!1,W_=null,t3.apply(n3,arguments)}function i3(t,e,r,l,d,g,w,I,a){if(r3.apply(this,arguments),mp){if(mp){var k=W_;mp=!1,W_=null}else throw Error(at(198));q_||(q_=!0,hw=k)}}function du(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function HA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function ZS(t){if(du(t)!==t)throw Error(at(188))}function o3(t){var e=t.alternate;if(!e){if(e=du(t),e===null)throw Error(at(188));return e!==t?null:t}for(var r=t,l=e;;){var d=r.return;if(d===null)break;var g=d.alternate;if(g===null){if(l=d.return,l!==null){r=l;continue}break}if(d.child===g.child){for(g=d.child;g;){if(g===r)return ZS(d),t;if(g===l)return ZS(d),e;g=g.sibling}throw Error(at(188))}if(r.return!==l.return)r=d,l=g;else{for(var w=!1,I=d.child;I;){if(I===r){w=!0,r=d,l=g;break}if(I===l){w=!0,l=d,r=g;break}I=I.sibling}if(!w){for(I=g.child;I;){if(I===r){w=!0,r=g,l=d;break}if(I===l){w=!0,l=g,r=d;break}I=I.sibling}if(!w)throw Error(at(189))}}if(r.alternate!==l)throw Error(at(190))}if(r.tag!==3)throw Error(at(188));return r.stateNode.current===r?t:e}function ZA(t){return t=o3(t),t!==null?XA(t):null}function XA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=XA(t);if(e!==null)return e;t=t.sibling}return null}var KA=io.unstable_scheduleCallback,XS=io.unstable_cancelCallback,s3=io.unstable_shouldYield,a3=io.unstable_requestPaint,_r=io.unstable_now,l3=io.unstable_getCurrentPriorityLevel,k1=io.unstable_ImmediatePriority,JA=io.unstable_UserBlockingPriority,H_=io.unstable_NormalPriority,c3=io.unstable_LowPriority,YA=io.unstable_IdlePriority,By=null,Rs=null;function u3(t){if(Rs&&typeof Rs.onCommitFiberRoot=="function")try{Rs.onCommitFiberRoot(By,t,void 0,(t.current.flags&128)===128)}catch{}}var ls=Math.clz32?Math.clz32:f3,h3=Math.log,d3=Math.LN2;function f3(t){return t>>>=0,t===0?32:31-(h3(t)/d3|0)|0}var n_=64,r_=4194304;function up(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Z_(t,e){var r=t.pendingLanes;if(r===0)return 0;var l=0,d=t.suspendedLanes,g=t.pingedLanes,w=r&268435455;if(w!==0){var I=w&~d;I!==0?l=up(I):(g&=w,g!==0&&(l=up(g)))}else w=r&~d,w!==0?l=up(w):g!==0&&(l=up(g));if(l===0)return 0;if(e!==0&&e!==l&&!(e&d)&&(d=l&-l,g=e&-e,d>=g||d===16&&(g&4194240)!==0))return e;if(l&4&&(l|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=l;0<e;)r=31-ls(e),d=1<<r,l|=t[r],e&=~d;return l}function p3(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function m3(t,e){for(var r=t.suspendedLanes,l=t.pingedLanes,d=t.expirationTimes,g=t.pendingLanes;0<g;){var w=31-ls(g),I=1<<w,a=d[w];a===-1?(!(I&r)||I&l)&&(d[w]=p3(I,e)):a<=e&&(t.expiredLanes|=I),g&=~I}}function dw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function QA(){var t=n_;return n_<<=1,!(n_&4194240)&&(n_=64),t}function i0(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function lm(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ls(e),t[e]=r}function g3(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var l=t.eventTimes;for(t=t.expirationTimes;0<r;){var d=31-ls(r),g=1<<d;e[d]=0,l[d]=-1,t[d]=-1,r&=~g}}function M1(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var l=31-ls(r),d=1<<l;d&e|t[l]&e&&(t[l]|=e),r&=~d}}var kn=0;function eP(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var tP,R1,nP,rP,iP,fw=!1,i_=[],Rl=null,Dl=null,Ll=null,Lp=new Map,zp=new Map,bl=[],_3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function KS(t,e){switch(t){case"focusin":case"focusout":Rl=null;break;case"dragenter":case"dragleave":Dl=null;break;case"mouseover":case"mouseout":Ll=null;break;case"pointerover":case"pointerout":Lp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zp.delete(e.pointerId)}}function ep(t,e,r,l,d,g){return t===null||t.nativeEvent!==g?(t={blockedOn:e,domEventName:r,eventSystemFlags:l,nativeEvent:g,targetContainers:[d]},e!==null&&(e=um(e),e!==null&&R1(e)),t):(t.eventSystemFlags|=l,e=t.targetContainers,d!==null&&e.indexOf(d)===-1&&e.push(d),t)}function y3(t,e,r,l,d){switch(e){case"focusin":return Rl=ep(Rl,t,e,r,l,d),!0;case"dragenter":return Dl=ep(Dl,t,e,r,l,d),!0;case"mouseover":return Ll=ep(Ll,t,e,r,l,d),!0;case"pointerover":var g=d.pointerId;return Lp.set(g,ep(Lp.get(g)||null,t,e,r,l,d)),!0;case"gotpointercapture":return g=d.pointerId,zp.set(g,ep(zp.get(g)||null,t,e,r,l,d)),!0}return!1}function oP(t){var e=qc(t.target);if(e!==null){var r=du(e);if(r!==null){if(e=r.tag,e===13){if(e=HA(r),e!==null){t.blockedOn=e,iP(t.priority,function(){nP(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function T_(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=pw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var l=new r.constructor(r.type,r);lw=l,r.target.dispatchEvent(l),lw=null}else return e=um(r),e!==null&&R1(e),t.blockedOn=r,!1;e.shift()}return!0}function JS(t,e,r){T_(t)&&r.delete(e)}function v3(){fw=!1,Rl!==null&&T_(Rl)&&(Rl=null),Dl!==null&&T_(Dl)&&(Dl=null),Ll!==null&&T_(Ll)&&(Ll=null),Lp.forEach(JS),zp.forEach(JS)}function tp(t,e){t.blockedOn===e&&(t.blockedOn=null,fw||(fw=!0,io.unstable_scheduleCallback(io.unstable_NormalPriority,v3)))}function Op(t){function e(d){return tp(d,t)}if(0<i_.length){tp(i_[0],t);for(var r=1;r<i_.length;r++){var l=i_[r];l.blockedOn===t&&(l.blockedOn=null)}}for(Rl!==null&&tp(Rl,t),Dl!==null&&tp(Dl,t),Ll!==null&&tp(Ll,t),Lp.forEach(e),zp.forEach(e),r=0;r<bl.length;r++)l=bl[r],l.blockedOn===t&&(l.blockedOn=null);for(;0<bl.length&&(r=bl[0],r.blockedOn===null);)oP(r),r.blockedOn===null&&bl.shift()}var Dh=ka.ReactCurrentBatchConfig,X_=!0;function x3(t,e,r,l){var d=kn,g=Dh.transition;Dh.transition=null;try{kn=1,D1(t,e,r,l)}finally{kn=d,Dh.transition=g}}function w3(t,e,r,l){var d=kn,g=Dh.transition;Dh.transition=null;try{kn=4,D1(t,e,r,l)}finally{kn=d,Dh.transition=g}}function D1(t,e,r,l){if(X_){var d=pw(t,e,r,l);if(d===null)p0(t,e,l,K_,r),KS(t,l);else if(y3(d,t,e,r,l))l.stopPropagation();else if(KS(t,l),e&4&&-1<_3.indexOf(t)){for(;d!==null;){var g=um(d);if(g!==null&&tP(g),g=pw(t,e,r,l),g===null&&p0(t,e,l,K_,r),g===d)break;d=g}d!==null&&l.stopPropagation()}else p0(t,e,l,null,r)}}var K_=null;function pw(t,e,r,l){if(K_=null,t=P1(l),t=qc(t),t!==null)if(e=du(t),e===null)t=null;else if(r=e.tag,r===13){if(t=HA(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return K_=t,null}function sP(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(l3()){case k1:return 1;case JA:return 4;case H_:case c3:return 16;case YA:return 536870912;default:return 16}default:return 16}}var Al=null,L1=null,S_=null;function aP(){if(S_)return S_;var t,e=L1,r=e.length,l,d="value"in Al?Al.value:Al.textContent,g=d.length;for(t=0;t<r&&e[t]===d[t];t++);var w=r-t;for(l=1;l<=w&&e[r-l]===d[g-l];l++);return S_=d.slice(t,1<l?1-l:void 0)}function I_(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function o_(){return!0}function YS(){return!1}function ao(t){function e(r,l,d,g,w){this._reactName=r,this._targetInst=d,this.type=l,this.nativeEvent=g,this.target=w,this.currentTarget=null;for(var I in t)t.hasOwnProperty(I)&&(r=t[I],this[I]=r?r(g):g[I]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?o_:YS,this.isPropagationStopped=YS,this}return lr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=o_)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=o_)},persist:function(){},isPersistent:o_}),e}var ad={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},z1=ao(ad),cm=lr({},ad,{view:0,detail:0}),b3=ao(cm),o0,s0,np,Fy=lr({},cm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:O1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==np&&(np&&t.type==="mousemove"?(o0=t.screenX-np.screenX,s0=t.screenY-np.screenY):s0=o0=0,np=t),o0)},movementY:function(t){return"movementY"in t?t.movementY:s0}}),QS=ao(Fy),E3=lr({},Fy,{dataTransfer:0}),T3=ao(E3),S3=lr({},cm,{relatedTarget:0}),a0=ao(S3),I3=lr({},ad,{animationName:0,elapsedTime:0,pseudoElement:0}),C3=ao(I3),A3=lr({},ad,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),P3=ao(A3),k3=lr({},ad,{data:0}),eI=ao(k3),M3={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},R3={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},D3={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function L3(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=D3[t])?!!e[t]:!1}function O1(){return L3}var z3=lr({},cm,{key:function(t){if(t.key){var e=M3[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=I_(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?R3[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:O1,charCode:function(t){return t.type==="keypress"?I_(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?I_(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),O3=ao(z3),B3=lr({},Fy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),tI=ao(B3),F3=lr({},cm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:O1}),N3=ao(F3),j3=lr({},ad,{propertyName:0,elapsedTime:0,pseudoElement:0}),U3=ao(j3),V3=lr({},Fy,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),$3=ao(V3),G3=[9,13,27,32],B1=ba&&"CompositionEvent"in window,gp=null;ba&&"documentMode"in document&&(gp=document.documentMode);var W3=ba&&"TextEvent"in window&&!gp,lP=ba&&(!B1||gp&&8<gp&&11>=gp),nI=" ",rI=!1;function cP(t,e){switch(t){case"keyup":return G3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function uP(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var yh=!1;function q3(t,e){switch(t){case"compositionend":return uP(e);case"keypress":return e.which!==32?null:(rI=!0,nI);case"textInput":return t=e.data,t===nI&&rI?null:t;default:return null}}function H3(t,e){if(yh)return t==="compositionend"||!B1&&cP(t,e)?(t=aP(),S_=L1=Al=null,yh=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return lP&&e.locale!=="ko"?null:e.data;default:return null}}var Z3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function iI(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Z3[t.type]:e==="textarea"}function hP(t,e,r,l){VA(l),e=J_(e,"onChange"),0<e.length&&(r=new z1("onChange","change",null,r,l),t.push({event:r,listeners:e}))}var _p=null,Bp=null;function X3(t){bP(t,0)}function Ny(t){var e=wh(t);if(zA(e))return t}function K3(t,e){if(t==="change")return e}var dP=!1;if(ba){var l0;if(ba){var c0="oninput"in document;if(!c0){var oI=document.createElement("div");oI.setAttribute("oninput","return;"),c0=typeof oI.oninput=="function"}l0=c0}else l0=!1;dP=l0&&(!document.documentMode||9<document.documentMode)}function sI(){_p&&(_p.detachEvent("onpropertychange",fP),Bp=_p=null)}function fP(t){if(t.propertyName==="value"&&Ny(Bp)){var e=[];hP(e,Bp,t,P1(t)),qA(X3,e)}}function J3(t,e,r){t==="focusin"?(sI(),_p=e,Bp=r,_p.attachEvent("onpropertychange",fP)):t==="focusout"&&sI()}function Y3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Ny(Bp)}function Q3(t,e){if(t==="click")return Ny(e)}function eB(t,e){if(t==="input"||t==="change")return Ny(e)}function tB(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var us=typeof Object.is=="function"?Object.is:tB;function Fp(t,e){if(us(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),l=Object.keys(e);if(r.length!==l.length)return!1;for(l=0;l<r.length;l++){var d=r[l];if(!K0.call(e,d)||!us(t[d],e[d]))return!1}return!0}function aI(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function lI(t,e){var r=aI(t);t=0;for(var l;r;){if(r.nodeType===3){if(l=t+r.textContent.length,t<=e&&l>=e)return{node:r,offset:e-t};t=l}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=aI(r)}}function pP(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?pP(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mP(){for(var t=window,e=G_();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=G_(t.document)}return e}function F1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nB(t){var e=mP(),r=t.focusedElem,l=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&pP(r.ownerDocument.documentElement,r)){if(l!==null&&F1(r)){if(e=l.start,t=l.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var d=r.textContent.length,g=Math.min(l.start,d);l=l.end===void 0?g:Math.min(l.end,d),!t.extend&&g>l&&(d=l,l=g,g=d),d=lI(r,g);var w=lI(r,l);d&&w&&(t.rangeCount!==1||t.anchorNode!==d.node||t.anchorOffset!==d.offset||t.focusNode!==w.node||t.focusOffset!==w.offset)&&(e=e.createRange(),e.setStart(d.node,d.offset),t.removeAllRanges(),g>l?(t.addRange(e),t.extend(w.node,w.offset)):(e.setEnd(w.node,w.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var rB=ba&&"documentMode"in document&&11>=document.documentMode,vh=null,mw=null,yp=null,gw=!1;function cI(t,e,r){var l=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;gw||vh==null||vh!==G_(l)||(l=vh,"selectionStart"in l&&F1(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),yp&&Fp(yp,l)||(yp=l,l=J_(mw,"onSelect"),0<l.length&&(e=new z1("onSelect","select",null,e,r),t.push({event:e,listeners:l}),e.target=vh)))}function s_(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var xh={animationend:s_("Animation","AnimationEnd"),animationiteration:s_("Animation","AnimationIteration"),animationstart:s_("Animation","AnimationStart"),transitionend:s_("Transition","TransitionEnd")},u0={},gP={};ba&&(gP=document.createElement("div").style,"AnimationEvent"in window||(delete xh.animationend.animation,delete xh.animationiteration.animation,delete xh.animationstart.animation),"TransitionEvent"in window||delete xh.transitionend.transition);function jy(t){if(u0[t])return u0[t];if(!xh[t])return t;var e=xh[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in gP)return u0[t]=e[r];return t}var _P=jy("animationend"),yP=jy("animationiteration"),vP=jy("animationstart"),xP=jy("transitionend"),wP=new Map,uI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zl(t,e){wP.set(t,e),hu(e,[t])}for(var h0=0;h0<uI.length;h0++){var d0=uI[h0],iB=d0.toLowerCase(),oB=d0[0].toUpperCase()+d0.slice(1);Zl(iB,"on"+oB)}Zl(_P,"onAnimationEnd");Zl(yP,"onAnimationIteration");Zl(vP,"onAnimationStart");Zl("dblclick","onDoubleClick");Zl("focusin","onFocus");Zl("focusout","onBlur");Zl(xP,"onTransitionEnd");Uh("onMouseEnter",["mouseout","mouseover"]);Uh("onMouseLeave",["mouseout","mouseover"]);Uh("onPointerEnter",["pointerout","pointerover"]);Uh("onPointerLeave",["pointerout","pointerover"]);hu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hu("onBeforeInput",["compositionend","keypress","textInput","paste"]);hu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sB=new Set("cancel close invalid load scroll toggle".split(" ").concat(hp));function hI(t,e,r){var l=t.type||"unknown-event";t.currentTarget=r,i3(l,e,void 0,t),t.currentTarget=null}function bP(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var l=t[r],d=l.event;l=l.listeners;e:{var g=void 0;if(e)for(var w=l.length-1;0<=w;w--){var I=l[w],a=I.instance,k=I.currentTarget;if(I=I.listener,a!==g&&d.isPropagationStopped())break e;hI(d,I,k),g=a}else for(w=0;w<l.length;w++){if(I=l[w],a=I.instance,k=I.currentTarget,I=I.listener,a!==g&&d.isPropagationStopped())break e;hI(d,I,k),g=a}}}if(q_)throw t=hw,q_=!1,hw=null,t}function Un(t,e){var r=e[ww];r===void 0&&(r=e[ww]=new Set);var l=t+"__bubble";r.has(l)||(EP(e,t,2,!1),r.add(l))}function f0(t,e,r){var l=0;e&&(l|=4),EP(r,t,l,e)}var a_="_reactListening"+Math.random().toString(36).slice(2);function Np(t){if(!t[a_]){t[a_]=!0,kA.forEach(function(r){r!=="selectionchange"&&(sB.has(r)||f0(r,!1,t),f0(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[a_]||(e[a_]=!0,f0("selectionchange",!1,e))}}function EP(t,e,r,l){switch(sP(e)){case 1:var d=x3;break;case 4:d=w3;break;default:d=D1}r=d.bind(null,e,r,t),d=void 0,!uw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(d=!0),l?d!==void 0?t.addEventListener(e,r,{capture:!0,passive:d}):t.addEventListener(e,r,!0):d!==void 0?t.addEventListener(e,r,{passive:d}):t.addEventListener(e,r,!1)}function p0(t,e,r,l,d){var g=l;if(!(e&1)&&!(e&2)&&l!==null)e:for(;;){if(l===null)return;var w=l.tag;if(w===3||w===4){var I=l.stateNode.containerInfo;if(I===d||I.nodeType===8&&I.parentNode===d)break;if(w===4)for(w=l.return;w!==null;){var a=w.tag;if((a===3||a===4)&&(a=w.stateNode.containerInfo,a===d||a.nodeType===8&&a.parentNode===d))return;w=w.return}for(;I!==null;){if(w=qc(I),w===null)return;if(a=w.tag,a===5||a===6){l=g=w;continue e}I=I.parentNode}}l=l.return}qA(function(){var k=g,O=P1(r),V=[];e:{var G=wP.get(t);if(G!==void 0){var X=z1,oe=t;switch(t){case"keypress":if(I_(r)===0)break e;case"keydown":case"keyup":X=O3;break;case"focusin":oe="focus",X=a0;break;case"focusout":oe="blur",X=a0;break;case"beforeblur":case"afterblur":X=a0;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":X=QS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":X=T3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":X=N3;break;case _P:case yP:case vP:X=C3;break;case xP:X=U3;break;case"scroll":X=b3;break;case"wheel":X=$3;break;case"copy":case"cut":case"paste":X=P3;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":X=tI}var le=(e&4)!==0,we=!le&&t==="scroll",te=le?G!==null?G+"Capture":null:G;le=[];for(var J=k,ce;J!==null;){ce=J;var Te=ce.stateNode;if(ce.tag===5&&Te!==null&&(ce=Te,te!==null&&(Te=Dp(J,te),Te!=null&&le.push(jp(J,Te,ce)))),we)break;J=J.return}0<le.length&&(G=new X(G,oe,null,r,O),V.push({event:G,listeners:le}))}}if(!(e&7)){e:{if(G=t==="mouseover"||t==="pointerover",X=t==="mouseout"||t==="pointerout",G&&r!==lw&&(oe=r.relatedTarget||r.fromElement)&&(qc(oe)||oe[Ea]))break e;if((X||G)&&(G=O.window===O?O:(G=O.ownerDocument)?G.defaultView||G.parentWindow:window,X?(oe=r.relatedTarget||r.toElement,X=k,oe=oe?qc(oe):null,oe!==null&&(we=du(oe),oe!==we||oe.tag!==5&&oe.tag!==6)&&(oe=null)):(X=null,oe=k),X!==oe)){if(le=QS,Te="onMouseLeave",te="onMouseEnter",J="mouse",(t==="pointerout"||t==="pointerover")&&(le=tI,Te="onPointerLeave",te="onPointerEnter",J="pointer"),we=X==null?G:wh(X),ce=oe==null?G:wh(oe),G=new le(Te,J+"leave",X,r,O),G.target=we,G.relatedTarget=ce,Te=null,qc(O)===k&&(le=new le(te,J+"enter",oe,r,O),le.target=ce,le.relatedTarget=we,Te=le),we=Te,X&&oe)t:{for(le=X,te=oe,J=0,ce=le;ce;ce=mh(ce))J++;for(ce=0,Te=te;Te;Te=mh(Te))ce++;for(;0<J-ce;)le=mh(le),J--;for(;0<ce-J;)te=mh(te),ce--;for(;J--;){if(le===te||te!==null&&le===te.alternate)break t;le=mh(le),te=mh(te)}le=null}else le=null;X!==null&&dI(V,G,X,le,!1),oe!==null&&we!==null&&dI(V,we,oe,le,!0)}}e:{if(G=k?wh(k):window,X=G.nodeName&&G.nodeName.toLowerCase(),X==="select"||X==="input"&&G.type==="file")var Ne=K3;else if(iI(G))if(dP)Ne=eB;else{Ne=Y3;var Ge=J3}else(X=G.nodeName)&&X.toLowerCase()==="input"&&(G.type==="checkbox"||G.type==="radio")&&(Ne=Q3);if(Ne&&(Ne=Ne(t,k))){hP(V,Ne,r,O);break e}Ge&&Ge(t,G,k),t==="focusout"&&(Ge=G._wrapperState)&&Ge.controlled&&G.type==="number"&&rw(G,"number",G.value)}switch(Ge=k?wh(k):window,t){case"focusin":(iI(Ge)||Ge.contentEditable==="true")&&(vh=Ge,mw=k,yp=null);break;case"focusout":yp=mw=vh=null;break;case"mousedown":gw=!0;break;case"contextmenu":case"mouseup":case"dragend":gw=!1,cI(V,r,O);break;case"selectionchange":if(rB)break;case"keydown":case"keyup":cI(V,r,O)}var Xe;if(B1)e:{switch(t){case"compositionstart":var qe="onCompositionStart";break e;case"compositionend":qe="onCompositionEnd";break e;case"compositionupdate":qe="onCompositionUpdate";break e}qe=void 0}else yh?cP(t,r)&&(qe="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(qe="onCompositionStart");qe&&(lP&&r.locale!=="ko"&&(yh||qe!=="onCompositionStart"?qe==="onCompositionEnd"&&yh&&(Xe=aP()):(Al=O,L1="value"in Al?Al.value:Al.textContent,yh=!0)),Ge=J_(k,qe),0<Ge.length&&(qe=new eI(qe,t,null,r,O),V.push({event:qe,listeners:Ge}),Xe?qe.data=Xe:(Xe=uP(r),Xe!==null&&(qe.data=Xe)))),(Xe=W3?q3(t,r):H3(t,r))&&(k=J_(k,"onBeforeInput"),0<k.length&&(O=new eI("onBeforeInput","beforeinput",null,r,O),V.push({event:O,listeners:k}),O.data=Xe))}bP(V,e)})}function jp(t,e,r){return{instance:t,listener:e,currentTarget:r}}function J_(t,e){for(var r=e+"Capture",l=[];t!==null;){var d=t,g=d.stateNode;d.tag===5&&g!==null&&(d=g,g=Dp(t,r),g!=null&&l.unshift(jp(t,g,d)),g=Dp(t,e),g!=null&&l.push(jp(t,g,d))),t=t.return}return l}function mh(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function dI(t,e,r,l,d){for(var g=e._reactName,w=[];r!==null&&r!==l;){var I=r,a=I.alternate,k=I.stateNode;if(a!==null&&a===l)break;I.tag===5&&k!==null&&(I=k,d?(a=Dp(r,g),a!=null&&w.unshift(jp(r,a,I))):d||(a=Dp(r,g),a!=null&&w.push(jp(r,a,I)))),r=r.return}w.length!==0&&t.push({event:e,listeners:w})}var aB=/\r\n?/g,lB=/\u0000|\uFFFD/g;function fI(t){return(typeof t=="string"?t:""+t).replace(aB,`
`).replace(lB,"")}function l_(t,e,r){if(e=fI(e),fI(t)!==e&&r)throw Error(at(425))}function Y_(){}var _w=null,yw=null;function vw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var xw=typeof setTimeout=="function"?setTimeout:void 0,cB=typeof clearTimeout=="function"?clearTimeout:void 0,pI=typeof Promise=="function"?Promise:void 0,uB=typeof queueMicrotask=="function"?queueMicrotask:typeof pI<"u"?function(t){return pI.resolve(null).then(t).catch(hB)}:xw;function hB(t){setTimeout(function(){throw t})}function m0(t,e){var r=e,l=0;do{var d=r.nextSibling;if(t.removeChild(r),d&&d.nodeType===8)if(r=d.data,r==="/$"){if(l===0){t.removeChild(d),Op(e);return}l--}else r!=="$"&&r!=="$?"&&r!=="$!"||l++;r=d}while(r);Op(e)}function zl(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function mI(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var ld=Math.random().toString(36).slice(2),ks="__reactFiber$"+ld,Up="__reactProps$"+ld,Ea="__reactContainer$"+ld,ww="__reactEvents$"+ld,dB="__reactListeners$"+ld,fB="__reactHandles$"+ld;function qc(t){var e=t[ks];if(e)return e;for(var r=t.parentNode;r;){if(e=r[Ea]||r[ks]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=mI(t);t!==null;){if(r=t[ks])return r;t=mI(t)}return e}t=r,r=t.parentNode}return null}function um(t){return t=t[ks]||t[Ea],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function wh(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(at(33))}function Uy(t){return t[Up]||null}var bw=[],bh=-1;function Xl(t){return{current:t}}function Vn(t){0>bh||(t.current=bw[bh],bw[bh]=null,bh--)}function Bn(t,e){bh++,bw[bh]=t.current,t.current=e}var ql={},di=Xl(ql),Bi=Xl(!1),eu=ql;function Vh(t,e){var r=t.type.contextTypes;if(!r)return ql;var l=t.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===e)return l.__reactInternalMemoizedMaskedChildContext;var d={},g;for(g in r)d[g]=e[g];return l&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=d),d}function Fi(t){return t=t.childContextTypes,t!=null}function Q_(){Vn(Bi),Vn(di)}function gI(t,e,r){if(di.current!==ql)throw Error(at(168));Bn(di,e),Bn(Bi,r)}function TP(t,e,r){var l=t.stateNode;if(e=e.childContextTypes,typeof l.getChildContext!="function")return r;l=l.getChildContext();for(var d in l)if(!(d in e))throw Error(at(108,JO(t)||"Unknown",d));return lr({},r,l)}function ey(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ql,eu=di.current,Bn(di,t),Bn(Bi,Bi.current),!0}function _I(t,e,r){var l=t.stateNode;if(!l)throw Error(at(169));r?(t=TP(t,e,eu),l.__reactInternalMemoizedMergedChildContext=t,Vn(Bi),Vn(di),Bn(di,t)):Vn(Bi),Bn(Bi,r)}var da=null,Vy=!1,g0=!1;function SP(t){da===null?da=[t]:da.push(t)}function pB(t){Vy=!0,SP(t)}function Kl(){if(!g0&&da!==null){g0=!0;var t=0,e=kn;try{var r=da;for(kn=1;t<r.length;t++){var l=r[t];do l=l(!0);while(l!==null)}da=null,Vy=!1}catch(d){throw da!==null&&(da=da.slice(t+1)),KA(k1,Kl),d}finally{kn=e,g0=!1}}return null}var Eh=[],Th=0,ty=null,ny=0,bo=[],Eo=0,tu=null,ma=1,ga="";function $c(t,e){Eh[Th++]=ny,Eh[Th++]=ty,ty=t,ny=e}function IP(t,e,r){bo[Eo++]=ma,bo[Eo++]=ga,bo[Eo++]=tu,tu=t;var l=ma;t=ga;var d=32-ls(l)-1;l&=~(1<<d),r+=1;var g=32-ls(e)+d;if(30<g){var w=d-d%5;g=(l&(1<<w)-1).toString(32),l>>=w,d-=w,ma=1<<32-ls(e)+d|r<<d|l,ga=g+t}else ma=1<<g|r<<d|l,ga=t}function N1(t){t.return!==null&&($c(t,1),IP(t,1,0))}function j1(t){for(;t===ty;)ty=Eh[--Th],Eh[Th]=null,ny=Eh[--Th],Eh[Th]=null;for(;t===tu;)tu=bo[--Eo],bo[Eo]=null,ga=bo[--Eo],bo[Eo]=null,ma=bo[--Eo],bo[Eo]=null}var Yi=null,Ji=null,Wn=!1,os=null;function CP(t,e){var r=So(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function yI(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Yi=t,Ji=zl(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Yi=t,Ji=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=tu!==null?{id:ma,overflow:ga}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=So(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,Yi=t,Ji=null,!0):!1;default:return!1}}function Ew(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tw(t){if(Wn){var e=Ji;if(e){var r=e;if(!yI(t,e)){if(Ew(t))throw Error(at(418));e=zl(r.nextSibling);var l=Yi;e&&yI(t,e)?CP(l,r):(t.flags=t.flags&-4097|2,Wn=!1,Yi=t)}}else{if(Ew(t))throw Error(at(418));t.flags=t.flags&-4097|2,Wn=!1,Yi=t}}}function vI(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Yi=t}function c_(t){if(t!==Yi)return!1;if(!Wn)return vI(t),Wn=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vw(t.type,t.memoizedProps)),e&&(e=Ji)){if(Ew(t))throw AP(),Error(at(418));for(;e;)CP(t,e),e=zl(e.nextSibling)}if(vI(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(at(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){Ji=zl(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}Ji=null}}else Ji=Yi?zl(t.stateNode.nextSibling):null;return!0}function AP(){for(var t=Ji;t;)t=zl(t.nextSibling)}function $h(){Ji=Yi=null,Wn=!1}function U1(t){os===null?os=[t]:os.push(t)}var mB=ka.ReactCurrentBatchConfig;function rs(t,e){if(t&&t.defaultProps){e=lr({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var ry=Xl(null),iy=null,Sh=null,V1=null;function $1(){V1=Sh=iy=null}function G1(t){var e=ry.current;Vn(ry),t._currentValue=e}function Sw(t,e,r){for(;t!==null;){var l=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,l!==null&&(l.childLanes|=e)):l!==null&&(l.childLanes&e)!==e&&(l.childLanes|=e),t===r)break;t=t.return}}function Lh(t,e){iy=t,V1=Sh=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Oi=!0),t.firstContext=null)}function Ao(t){var e=t._currentValue;if(V1!==t)if(t={context:t,memoizedValue:e,next:null},Sh===null){if(iy===null)throw Error(at(308));Sh=t,iy.dependencies={lanes:0,firstContext:t}}else Sh=Sh.next=t;return e}var Hc=null;function W1(t){Hc===null?Hc=[t]:Hc.push(t)}function PP(t,e,r,l){var d=e.interleaved;return d===null?(r.next=r,W1(e)):(r.next=d.next,d.next=r),e.interleaved=r,Ta(t,l)}function Ta(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var xl=!1;function q1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kP(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function va(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ol(t,e,r){var l=t.updateQueue;if(l===null)return null;if(l=l.shared,dn&2){var d=l.pending;return d===null?e.next=e:(e.next=d.next,d.next=e),l.pending=e,Ta(t,r)}return d=l.interleaved,d===null?(e.next=e,W1(l)):(e.next=d.next,d.next=e),l.interleaved=e,Ta(t,r)}function C_(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var l=e.lanes;l&=t.pendingLanes,r|=l,e.lanes=r,M1(t,r)}}function xI(t,e){var r=t.updateQueue,l=t.alternate;if(l!==null&&(l=l.updateQueue,r===l)){var d=null,g=null;if(r=r.firstBaseUpdate,r!==null){do{var w={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};g===null?d=g=w:g=g.next=w,r=r.next}while(r!==null);g===null?d=g=e:g=g.next=e}else d=g=e;r={baseState:l.baseState,firstBaseUpdate:d,lastBaseUpdate:g,shared:l.shared,effects:l.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function oy(t,e,r,l){var d=t.updateQueue;xl=!1;var g=d.firstBaseUpdate,w=d.lastBaseUpdate,I=d.shared.pending;if(I!==null){d.shared.pending=null;var a=I,k=a.next;a.next=null,w===null?g=k:w.next=k,w=a;var O=t.alternate;O!==null&&(O=O.updateQueue,I=O.lastBaseUpdate,I!==w&&(I===null?O.firstBaseUpdate=k:I.next=k,O.lastBaseUpdate=a))}if(g!==null){var V=d.baseState;w=0,O=k=a=null,I=g;do{var G=I.lane,X=I.eventTime;if((l&G)===G){O!==null&&(O=O.next={eventTime:X,lane:0,tag:I.tag,payload:I.payload,callback:I.callback,next:null});e:{var oe=t,le=I;switch(G=e,X=r,le.tag){case 1:if(oe=le.payload,typeof oe=="function"){V=oe.call(X,V,G);break e}V=oe;break e;case 3:oe.flags=oe.flags&-65537|128;case 0:if(oe=le.payload,G=typeof oe=="function"?oe.call(X,V,G):oe,G==null)break e;V=lr({},V,G);break e;case 2:xl=!0}}I.callback!==null&&I.lane!==0&&(t.flags|=64,G=d.effects,G===null?d.effects=[I]:G.push(I))}else X={eventTime:X,lane:G,tag:I.tag,payload:I.payload,callback:I.callback,next:null},O===null?(k=O=X,a=V):O=O.next=X,w|=G;if(I=I.next,I===null){if(I=d.shared.pending,I===null)break;G=I,I=G.next,G.next=null,d.lastBaseUpdate=G,d.shared.pending=null}}while(!0);if(O===null&&(a=V),d.baseState=a,d.firstBaseUpdate=k,d.lastBaseUpdate=O,e=d.shared.interleaved,e!==null){d=e;do w|=d.lane,d=d.next;while(d!==e)}else g===null&&(d.shared.lanes=0);ru|=w,t.lanes=w,t.memoizedState=V}}function wI(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var l=t[e],d=l.callback;if(d!==null){if(l.callback=null,l=r,typeof d!="function")throw Error(at(191,d));d.call(l)}}}var MP=new PA.Component().refs;function Iw(t,e,r,l){e=t.memoizedState,r=r(l,e),r=r==null?e:lr({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var $y={isMounted:function(t){return(t=t._reactInternals)?du(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var l=xi(),d=Fl(t),g=va(l,d);g.payload=e,r!=null&&(g.callback=r),e=Ol(t,g,d),e!==null&&(cs(e,t,d,l),C_(e,t,d))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var l=xi(),d=Fl(t),g=va(l,d);g.tag=1,g.payload=e,r!=null&&(g.callback=r),e=Ol(t,g,d),e!==null&&(cs(e,t,d,l),C_(e,t,d))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=xi(),l=Fl(t),d=va(r,l);d.tag=2,e!=null&&(d.callback=e),e=Ol(t,d,l),e!==null&&(cs(e,t,l,r),C_(e,t,l))}};function bI(t,e,r,l,d,g,w){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(l,g,w):e.prototype&&e.prototype.isPureReactComponent?!Fp(r,l)||!Fp(d,g):!0}function RP(t,e,r){var l=!1,d=ql,g=e.contextType;return typeof g=="object"&&g!==null?g=Ao(g):(d=Fi(e)?eu:di.current,l=e.contextTypes,g=(l=l!=null)?Vh(t,d):ql),e=new e(r,g),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=$y,t.stateNode=e,e._reactInternals=t,l&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=d,t.__reactInternalMemoizedMaskedChildContext=g),e}function EI(t,e,r,l){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,l),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,l),e.state!==t&&$y.enqueueReplaceState(e,e.state,null)}function Cw(t,e,r,l){var d=t.stateNode;d.props=r,d.state=t.memoizedState,d.refs=MP,q1(t);var g=e.contextType;typeof g=="object"&&g!==null?d.context=Ao(g):(g=Fi(e)?eu:di.current,d.context=Vh(t,g)),d.state=t.memoizedState,g=e.getDerivedStateFromProps,typeof g=="function"&&(Iw(t,e,g,r),d.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(e=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),e!==d.state&&$y.enqueueReplaceState(d,d.state,null),oy(t,r,d,l),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308)}function rp(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(at(309));var l=r.stateNode}if(!l)throw Error(at(147,t));var d=l,g=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===g?e.ref:(e=function(w){var I=d.refs;I===MP&&(I=d.refs={}),w===null?delete I[g]:I[g]=w},e._stringRef=g,e)}if(typeof t!="string")throw Error(at(284));if(!r._owner)throw Error(at(290,t))}return t}function u_(t,e){throw t=Object.prototype.toString.call(e),Error(at(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function TI(t){var e=t._init;return e(t._payload)}function DP(t){function e(te,J){if(t){var ce=te.deletions;ce===null?(te.deletions=[J],te.flags|=16):ce.push(J)}}function r(te,J){if(!t)return null;for(;J!==null;)e(te,J),J=J.sibling;return null}function l(te,J){for(te=new Map;J!==null;)J.key!==null?te.set(J.key,J):te.set(J.index,J),J=J.sibling;return te}function d(te,J){return te=Nl(te,J),te.index=0,te.sibling=null,te}function g(te,J,ce){return te.index=ce,t?(ce=te.alternate,ce!==null?(ce=ce.index,ce<J?(te.flags|=2,J):ce):(te.flags|=2,J)):(te.flags|=1048576,J)}function w(te){return t&&te.alternate===null&&(te.flags|=2),te}function I(te,J,ce,Te){return J===null||J.tag!==6?(J=E0(ce,te.mode,Te),J.return=te,J):(J=d(J,ce),J.return=te,J)}function a(te,J,ce,Te){var Ne=ce.type;return Ne===_h?O(te,J,ce.props.children,Te,ce.key):J!==null&&(J.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===vl&&TI(Ne)===J.type)?(Te=d(J,ce.props),Te.ref=rp(te,J,ce),Te.return=te,Te):(Te=D_(ce.type,ce.key,ce.props,null,te.mode,Te),Te.ref=rp(te,J,ce),Te.return=te,Te)}function k(te,J,ce,Te){return J===null||J.tag!==4||J.stateNode.containerInfo!==ce.containerInfo||J.stateNode.implementation!==ce.implementation?(J=T0(ce,te.mode,Te),J.return=te,J):(J=d(J,ce.children||[]),J.return=te,J)}function O(te,J,ce,Te,Ne){return J===null||J.tag!==7?(J=Jc(ce,te.mode,Te,Ne),J.return=te,J):(J=d(J,ce),J.return=te,J)}function V(te,J,ce){if(typeof J=="string"&&J!==""||typeof J=="number")return J=E0(""+J,te.mode,ce),J.return=te,J;if(typeof J=="object"&&J!==null){switch(J.$$typeof){case Qg:return ce=D_(J.type,J.key,J.props,null,te.mode,ce),ce.ref=rp(te,null,J),ce.return=te,ce;case gh:return J=T0(J,te.mode,ce),J.return=te,J;case vl:var Te=J._init;return V(te,Te(J._payload),ce)}if(cp(J)||Yf(J))return J=Jc(J,te.mode,ce,null),J.return=te,J;u_(te,J)}return null}function G(te,J,ce,Te){var Ne=J!==null?J.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return Ne!==null?null:I(te,J,""+ce,Te);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Qg:return ce.key===Ne?a(te,J,ce,Te):null;case gh:return ce.key===Ne?k(te,J,ce,Te):null;case vl:return Ne=ce._init,G(te,J,Ne(ce._payload),Te)}if(cp(ce)||Yf(ce))return Ne!==null?null:O(te,J,ce,Te,null);u_(te,ce)}return null}function X(te,J,ce,Te,Ne){if(typeof Te=="string"&&Te!==""||typeof Te=="number")return te=te.get(ce)||null,I(J,te,""+Te,Ne);if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case Qg:return te=te.get(Te.key===null?ce:Te.key)||null,a(J,te,Te,Ne);case gh:return te=te.get(Te.key===null?ce:Te.key)||null,k(J,te,Te,Ne);case vl:var Ge=Te._init;return X(te,J,ce,Ge(Te._payload),Ne)}if(cp(Te)||Yf(Te))return te=te.get(ce)||null,O(J,te,Te,Ne,null);u_(J,Te)}return null}function oe(te,J,ce,Te){for(var Ne=null,Ge=null,Xe=J,qe=J=0,vt=null;Xe!==null&&qe<ce.length;qe++){Xe.index>qe?(vt=Xe,Xe=null):vt=Xe.sibling;var ze=G(te,Xe,ce[qe],Te);if(ze===null){Xe===null&&(Xe=vt);break}t&&Xe&&ze.alternate===null&&e(te,Xe),J=g(ze,J,qe),Ge===null?Ne=ze:Ge.sibling=ze,Ge=ze,Xe=vt}if(qe===ce.length)return r(te,Xe),Wn&&$c(te,qe),Ne;if(Xe===null){for(;qe<ce.length;qe++)Xe=V(te,ce[qe],Te),Xe!==null&&(J=g(Xe,J,qe),Ge===null?Ne=Xe:Ge.sibling=Xe,Ge=Xe);return Wn&&$c(te,qe),Ne}for(Xe=l(te,Xe);qe<ce.length;qe++)vt=X(Xe,te,qe,ce[qe],Te),vt!==null&&(t&&vt.alternate!==null&&Xe.delete(vt.key===null?qe:vt.key),J=g(vt,J,qe),Ge===null?Ne=vt:Ge.sibling=vt,Ge=vt);return t&&Xe.forEach(function(Ct){return e(te,Ct)}),Wn&&$c(te,qe),Ne}function le(te,J,ce,Te){var Ne=Yf(ce);if(typeof Ne!="function")throw Error(at(150));if(ce=Ne.call(ce),ce==null)throw Error(at(151));for(var Ge=Ne=null,Xe=J,qe=J=0,vt=null,ze=ce.next();Xe!==null&&!ze.done;qe++,ze=ce.next()){Xe.index>qe?(vt=Xe,Xe=null):vt=Xe.sibling;var Ct=G(te,Xe,ze.value,Te);if(Ct===null){Xe===null&&(Xe=vt);break}t&&Xe&&Ct.alternate===null&&e(te,Xe),J=g(Ct,J,qe),Ge===null?Ne=Ct:Ge.sibling=Ct,Ge=Ct,Xe=vt}if(ze.done)return r(te,Xe),Wn&&$c(te,qe),Ne;if(Xe===null){for(;!ze.done;qe++,ze=ce.next())ze=V(te,ze.value,Te),ze!==null&&(J=g(ze,J,qe),Ge===null?Ne=ze:Ge.sibling=ze,Ge=ze);return Wn&&$c(te,qe),Ne}for(Xe=l(te,Xe);!ze.done;qe++,ze=ce.next())ze=X(Xe,te,qe,ze.value,Te),ze!==null&&(t&&ze.alternate!==null&&Xe.delete(ze.key===null?qe:ze.key),J=g(ze,J,qe),Ge===null?Ne=ze:Ge.sibling=ze,Ge=ze);return t&&Xe.forEach(function(Ut){return e(te,Ut)}),Wn&&$c(te,qe),Ne}function we(te,J,ce,Te){if(typeof ce=="object"&&ce!==null&&ce.type===_h&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case Qg:e:{for(var Ne=ce.key,Ge=J;Ge!==null;){if(Ge.key===Ne){if(Ne=ce.type,Ne===_h){if(Ge.tag===7){r(te,Ge.sibling),J=d(Ge,ce.props.children),J.return=te,te=J;break e}}else if(Ge.elementType===Ne||typeof Ne=="object"&&Ne!==null&&Ne.$$typeof===vl&&TI(Ne)===Ge.type){r(te,Ge.sibling),J=d(Ge,ce.props),J.ref=rp(te,Ge,ce),J.return=te,te=J;break e}r(te,Ge);break}else e(te,Ge);Ge=Ge.sibling}ce.type===_h?(J=Jc(ce.props.children,te.mode,Te,ce.key),J.return=te,te=J):(Te=D_(ce.type,ce.key,ce.props,null,te.mode,Te),Te.ref=rp(te,J,ce),Te.return=te,te=Te)}return w(te);case gh:e:{for(Ge=ce.key;J!==null;){if(J.key===Ge)if(J.tag===4&&J.stateNode.containerInfo===ce.containerInfo&&J.stateNode.implementation===ce.implementation){r(te,J.sibling),J=d(J,ce.children||[]),J.return=te,te=J;break e}else{r(te,J);break}else e(te,J);J=J.sibling}J=T0(ce,te.mode,Te),J.return=te,te=J}return w(te);case vl:return Ge=ce._init,we(te,J,Ge(ce._payload),Te)}if(cp(ce))return oe(te,J,ce,Te);if(Yf(ce))return le(te,J,ce,Te);u_(te,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,J!==null&&J.tag===6?(r(te,J.sibling),J=d(J,ce),J.return=te,te=J):(r(te,J),J=E0(ce,te.mode,Te),J.return=te,te=J),w(te)):r(te,J)}return we}var Gh=DP(!0),LP=DP(!1),hm={},Ds=Xl(hm),Vp=Xl(hm),$p=Xl(hm);function Zc(t){if(t===hm)throw Error(at(174));return t}function H1(t,e){switch(Bn($p,e),Bn(Vp,t),Bn(Ds,hm),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ow(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ow(e,t)}Vn(Ds),Bn(Ds,e)}function Wh(){Vn(Ds),Vn(Vp),Vn($p)}function zP(t){Zc($p.current);var e=Zc(Ds.current),r=ow(e,t.type);e!==r&&(Bn(Vp,t),Bn(Ds,r))}function Z1(t){Vp.current===t&&(Vn(Ds),Vn(Vp))}var or=Xl(0);function sy(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _0=[];function X1(){for(var t=0;t<_0.length;t++)_0[t]._workInProgressVersionPrimary=null;_0.length=0}var A_=ka.ReactCurrentDispatcher,y0=ka.ReactCurrentBatchConfig,nu=0,sr=null,Rr=null,Vr=null,ay=!1,vp=!1,Gp=0,gB=0;function ai(){throw Error(at(321))}function K1(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!us(t[r],e[r]))return!1;return!0}function J1(t,e,r,l,d,g){if(nu=g,sr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,A_.current=t===null||t.memoizedState===null?xB:wB,t=r(l,d),vp){g=0;do{if(vp=!1,Gp=0,25<=g)throw Error(at(301));g+=1,Vr=Rr=null,e.updateQueue=null,A_.current=bB,t=r(l,d)}while(vp)}if(A_.current=ly,e=Rr!==null&&Rr.next!==null,nu=0,Vr=Rr=sr=null,ay=!1,e)throw Error(at(300));return t}function Y1(){var t=Gp!==0;return Gp=0,t}function Ps(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vr===null?sr.memoizedState=Vr=t:Vr=Vr.next=t,Vr}function Po(){if(Rr===null){var t=sr.alternate;t=t!==null?t.memoizedState:null}else t=Rr.next;var e=Vr===null?sr.memoizedState:Vr.next;if(e!==null)Vr=e,Rr=t;else{if(t===null)throw Error(at(310));Rr=t,t={memoizedState:Rr.memoizedState,baseState:Rr.baseState,baseQueue:Rr.baseQueue,queue:Rr.queue,next:null},Vr===null?sr.memoizedState=Vr=t:Vr=Vr.next=t}return Vr}function Wp(t,e){return typeof e=="function"?e(t):e}function v0(t){var e=Po(),r=e.queue;if(r===null)throw Error(at(311));r.lastRenderedReducer=t;var l=Rr,d=l.baseQueue,g=r.pending;if(g!==null){if(d!==null){var w=d.next;d.next=g.next,g.next=w}l.baseQueue=d=g,r.pending=null}if(d!==null){g=d.next,l=l.baseState;var I=w=null,a=null,k=g;do{var O=k.lane;if((nu&O)===O)a!==null&&(a=a.next={lane:0,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null}),l=k.hasEagerState?k.eagerState:t(l,k.action);else{var V={lane:O,action:k.action,hasEagerState:k.hasEagerState,eagerState:k.eagerState,next:null};a===null?(I=a=V,w=l):a=a.next=V,sr.lanes|=O,ru|=O}k=k.next}while(k!==null&&k!==g);a===null?w=l:a.next=I,us(l,e.memoizedState)||(Oi=!0),e.memoizedState=l,e.baseState=w,e.baseQueue=a,r.lastRenderedState=l}if(t=r.interleaved,t!==null){d=t;do g=d.lane,sr.lanes|=g,ru|=g,d=d.next;while(d!==t)}else d===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function x0(t){var e=Po(),r=e.queue;if(r===null)throw Error(at(311));r.lastRenderedReducer=t;var l=r.dispatch,d=r.pending,g=e.memoizedState;if(d!==null){r.pending=null;var w=d=d.next;do g=t(g,w.action),w=w.next;while(w!==d);us(g,e.memoizedState)||(Oi=!0),e.memoizedState=g,e.baseQueue===null&&(e.baseState=g),r.lastRenderedState=g}return[g,l]}function OP(){}function BP(t,e){var r=sr,l=Po(),d=e(),g=!us(l.memoizedState,d);if(g&&(l.memoizedState=d,Oi=!0),l=l.queue,Q1(jP.bind(null,r,l,t),[t]),l.getSnapshot!==e||g||Vr!==null&&Vr.memoizedState.tag&1){if(r.flags|=2048,qp(9,NP.bind(null,r,l,d,e),void 0,null),$r===null)throw Error(at(349));nu&30||FP(r,e,d)}return d}function FP(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=sr.updateQueue,e===null?(e={lastEffect:null,stores:null},sr.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function NP(t,e,r,l){e.value=r,e.getSnapshot=l,UP(e)&&VP(t)}function jP(t,e,r){return r(function(){UP(e)&&VP(t)})}function UP(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!us(t,r)}catch{return!0}}function VP(t){var e=Ta(t,1);e!==null&&cs(e,t,1,-1)}function SI(t){var e=Ps();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Wp,lastRenderedState:t},e.queue=t,t=t.dispatch=vB.bind(null,sr,t),[e.memoizedState,t]}function qp(t,e,r,l){return t={tag:t,create:e,destroy:r,deps:l,next:null},e=sr.updateQueue,e===null?(e={lastEffect:null,stores:null},sr.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(l=r.next,r.next=t,t.next=l,e.lastEffect=t)),t}function $P(){return Po().memoizedState}function P_(t,e,r,l){var d=Ps();sr.flags|=t,d.memoizedState=qp(1|e,r,void 0,l===void 0?null:l)}function Gy(t,e,r,l){var d=Po();l=l===void 0?null:l;var g=void 0;if(Rr!==null){var w=Rr.memoizedState;if(g=w.destroy,l!==null&&K1(l,w.deps)){d.memoizedState=qp(e,r,g,l);return}}sr.flags|=t,d.memoizedState=qp(1|e,r,g,l)}function II(t,e){return P_(8390656,8,t,e)}function Q1(t,e){return Gy(2048,8,t,e)}function GP(t,e){return Gy(4,2,t,e)}function WP(t,e){return Gy(4,4,t,e)}function qP(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function HP(t,e,r){return r=r!=null?r.concat([t]):null,Gy(4,4,qP.bind(null,e,t),r)}function eb(){}function ZP(t,e){var r=Po();e=e===void 0?null:e;var l=r.memoizedState;return l!==null&&e!==null&&K1(e,l[1])?l[0]:(r.memoizedState=[t,e],t)}function XP(t,e){var r=Po();e=e===void 0?null:e;var l=r.memoizedState;return l!==null&&e!==null&&K1(e,l[1])?l[0]:(t=t(),r.memoizedState=[t,e],t)}function KP(t,e,r){return nu&21?(us(r,e)||(r=QA(),sr.lanes|=r,ru|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Oi=!0),t.memoizedState=r)}function _B(t,e){var r=kn;kn=r!==0&&4>r?r:4,t(!0);var l=y0.transition;y0.transition={};try{t(!1),e()}finally{kn=r,y0.transition=l}}function JP(){return Po().memoizedState}function yB(t,e,r){var l=Fl(t);if(r={lane:l,action:r,hasEagerState:!1,eagerState:null,next:null},YP(t))QP(e,r);else if(r=PP(t,e,r,l),r!==null){var d=xi();cs(r,t,l,d),ek(r,e,l)}}function vB(t,e,r){var l=Fl(t),d={lane:l,action:r,hasEagerState:!1,eagerState:null,next:null};if(YP(t))QP(e,d);else{var g=t.alternate;if(t.lanes===0&&(g===null||g.lanes===0)&&(g=e.lastRenderedReducer,g!==null))try{var w=e.lastRenderedState,I=g(w,r);if(d.hasEagerState=!0,d.eagerState=I,us(I,w)){var a=e.interleaved;a===null?(d.next=d,W1(e)):(d.next=a.next,a.next=d),e.interleaved=d;return}}catch{}finally{}r=PP(t,e,d,l),r!==null&&(d=xi(),cs(r,t,l,d),ek(r,e,l))}}function YP(t){var e=t.alternate;return t===sr||e!==null&&e===sr}function QP(t,e){vp=ay=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function ek(t,e,r){if(r&4194240){var l=e.lanes;l&=t.pendingLanes,r|=l,e.lanes=r,M1(t,r)}}var ly={readContext:Ao,useCallback:ai,useContext:ai,useEffect:ai,useImperativeHandle:ai,useInsertionEffect:ai,useLayoutEffect:ai,useMemo:ai,useReducer:ai,useRef:ai,useState:ai,useDebugValue:ai,useDeferredValue:ai,useTransition:ai,useMutableSource:ai,useSyncExternalStore:ai,useId:ai,unstable_isNewReconciler:!1},xB={readContext:Ao,useCallback:function(t,e){return Ps().memoizedState=[t,e===void 0?null:e],t},useContext:Ao,useEffect:II,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,P_(4194308,4,qP.bind(null,e,t),r)},useLayoutEffect:function(t,e){return P_(4194308,4,t,e)},useInsertionEffect:function(t,e){return P_(4,2,t,e)},useMemo:function(t,e){var r=Ps();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var l=Ps();return e=r!==void 0?r(e):e,l.memoizedState=l.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},l.queue=t,t=t.dispatch=yB.bind(null,sr,t),[l.memoizedState,t]},useRef:function(t){var e=Ps();return t={current:t},e.memoizedState=t},useState:SI,useDebugValue:eb,useDeferredValue:function(t){return Ps().memoizedState=t},useTransition:function(){var t=SI(!1),e=t[0];return t=_B.bind(null,t[1]),Ps().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var l=sr,d=Ps();if(Wn){if(r===void 0)throw Error(at(407));r=r()}else{if(r=e(),$r===null)throw Error(at(349));nu&30||FP(l,e,r)}d.memoizedState=r;var g={value:r,getSnapshot:e};return d.queue=g,II(jP.bind(null,l,g,t),[t]),l.flags|=2048,qp(9,NP.bind(null,l,g,r,e),void 0,null),r},useId:function(){var t=Ps(),e=$r.identifierPrefix;if(Wn){var r=ga,l=ma;r=(l&~(1<<32-ls(l)-1)).toString(32)+r,e=":"+e+"R"+r,r=Gp++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=gB++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},wB={readContext:Ao,useCallback:ZP,useContext:Ao,useEffect:Q1,useImperativeHandle:HP,useInsertionEffect:GP,useLayoutEffect:WP,useMemo:XP,useReducer:v0,useRef:$P,useState:function(){return v0(Wp)},useDebugValue:eb,useDeferredValue:function(t){var e=Po();return KP(e,Rr.memoizedState,t)},useTransition:function(){var t=v0(Wp)[0],e=Po().memoizedState;return[t,e]},useMutableSource:OP,useSyncExternalStore:BP,useId:JP,unstable_isNewReconciler:!1},bB={readContext:Ao,useCallback:ZP,useContext:Ao,useEffect:Q1,useImperativeHandle:HP,useInsertionEffect:GP,useLayoutEffect:WP,useMemo:XP,useReducer:x0,useRef:$P,useState:function(){return x0(Wp)},useDebugValue:eb,useDeferredValue:function(t){var e=Po();return Rr===null?e.memoizedState=t:KP(e,Rr.memoizedState,t)},useTransition:function(){var t=x0(Wp)[0],e=Po().memoizedState;return[t,e]},useMutableSource:OP,useSyncExternalStore:BP,useId:JP,unstable_isNewReconciler:!1};function qh(t,e){try{var r="",l=e;do r+=KO(l),l=l.return;while(l);var d=r}catch(g){d=`
Error generating stack: `+g.message+`
`+g.stack}return{value:t,source:e,stack:d,digest:null}}function w0(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function Aw(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var EB=typeof WeakMap=="function"?WeakMap:Map;function tk(t,e,r){r=va(-1,r),r.tag=3,r.payload={element:null};var l=e.value;return r.callback=function(){uy||(uy=!0,Fw=l),Aw(t,e)},r}function nk(t,e,r){r=va(-1,r),r.tag=3;var l=t.type.getDerivedStateFromError;if(typeof l=="function"){var d=e.value;r.payload=function(){return l(d)},r.callback=function(){Aw(t,e)}}var g=t.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(r.callback=function(){Aw(t,e),typeof l!="function"&&(Bl===null?Bl=new Set([this]):Bl.add(this));var w=e.stack;this.componentDidCatch(e.value,{componentStack:w!==null?w:""})}),r}function CI(t,e,r){var l=t.pingCache;if(l===null){l=t.pingCache=new EB;var d=new Set;l.set(e,d)}else d=l.get(e),d===void 0&&(d=new Set,l.set(e,d));d.has(r)||(d.add(r),t=BB.bind(null,t,e,r),e.then(t,t))}function AI(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function PI(t,e,r,l,d){return t.mode&1?(t.flags|=65536,t.lanes=d,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=va(-1,1),e.tag=2,Ol(r,e,1))),r.lanes|=1),t)}var TB=ka.ReactCurrentOwner,Oi=!1;function yi(t,e,r,l){e.child=t===null?LP(e,null,r,l):Gh(e,t.child,r,l)}function kI(t,e,r,l,d){r=r.render;var g=e.ref;return Lh(e,d),l=J1(t,e,r,l,g,d),r=Y1(),t!==null&&!Oi?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~d,Sa(t,e,d)):(Wn&&r&&N1(e),e.flags|=1,yi(t,e,l,d),e.child)}function MI(t,e,r,l,d){if(t===null){var g=r.type;return typeof g=="function"&&!lb(g)&&g.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=g,rk(t,e,g,l,d)):(t=D_(r.type,null,l,e,e.mode,d),t.ref=e.ref,t.return=e,e.child=t)}if(g=t.child,!(t.lanes&d)){var w=g.memoizedProps;if(r=r.compare,r=r!==null?r:Fp,r(w,l)&&t.ref===e.ref)return Sa(t,e,d)}return e.flags|=1,t=Nl(g,l),t.ref=e.ref,t.return=e,e.child=t}function rk(t,e,r,l,d){if(t!==null){var g=t.memoizedProps;if(Fp(g,l)&&t.ref===e.ref)if(Oi=!1,e.pendingProps=l=g,(t.lanes&d)!==0)t.flags&131072&&(Oi=!0);else return e.lanes=t.lanes,Sa(t,e,d)}return Pw(t,e,r,l,d)}function ik(t,e,r){var l=e.pendingProps,d=l.children,g=t!==null?t.memoizedState:null;if(l.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Bn(Ch,Xi),Xi|=r;else{if(!(r&1073741824))return t=g!==null?g.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Bn(Ch,Xi),Xi|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=g!==null?g.baseLanes:r,Bn(Ch,Xi),Xi|=l}else g!==null?(l=g.baseLanes|r,e.memoizedState=null):l=r,Bn(Ch,Xi),Xi|=l;return yi(t,e,d,r),e.child}function ok(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function Pw(t,e,r,l,d){var g=Fi(r)?eu:di.current;return g=Vh(e,g),Lh(e,d),r=J1(t,e,r,l,g,d),l=Y1(),t!==null&&!Oi?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~d,Sa(t,e,d)):(Wn&&l&&N1(e),e.flags|=1,yi(t,e,r,d),e.child)}function RI(t,e,r,l,d){if(Fi(r)){var g=!0;ey(e)}else g=!1;if(Lh(e,d),e.stateNode===null)k_(t,e),RP(e,r,l),Cw(e,r,l,d),l=!0;else if(t===null){var w=e.stateNode,I=e.memoizedProps;w.props=I;var a=w.context,k=r.contextType;typeof k=="object"&&k!==null?k=Ao(k):(k=Fi(r)?eu:di.current,k=Vh(e,k));var O=r.getDerivedStateFromProps,V=typeof O=="function"||typeof w.getSnapshotBeforeUpdate=="function";V||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(I!==l||a!==k)&&EI(e,w,l,k),xl=!1;var G=e.memoizedState;w.state=G,oy(e,l,w,d),a=e.memoizedState,I!==l||G!==a||Bi.current||xl?(typeof O=="function"&&(Iw(e,r,O,l),a=e.memoizedState),(I=xl||bI(e,r,I,l,G,a,k))?(V||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(e.flags|=4194308)):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=l,e.memoizedState=a),w.props=l,w.state=a,w.context=k,l=I):(typeof w.componentDidMount=="function"&&(e.flags|=4194308),l=!1)}else{w=e.stateNode,kP(t,e),I=e.memoizedProps,k=e.type===e.elementType?I:rs(e.type,I),w.props=k,V=e.pendingProps,G=w.context,a=r.contextType,typeof a=="object"&&a!==null?a=Ao(a):(a=Fi(r)?eu:di.current,a=Vh(e,a));var X=r.getDerivedStateFromProps;(O=typeof X=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(I!==V||G!==a)&&EI(e,w,l,a),xl=!1,G=e.memoizedState,w.state=G,oy(e,l,w,d);var oe=e.memoizedState;I!==V||G!==oe||Bi.current||xl?(typeof X=="function"&&(Iw(e,r,X,l),oe=e.memoizedState),(k=xl||bI(e,r,k,l,G,oe,a)||!1)?(O||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(l,oe,a),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(l,oe,a)),typeof w.componentDidUpdate=="function"&&(e.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof w.componentDidUpdate!="function"||I===t.memoizedProps&&G===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||I===t.memoizedProps&&G===t.memoizedState||(e.flags|=1024),e.memoizedProps=l,e.memoizedState=oe),w.props=l,w.state=oe,w.context=a,l=k):(typeof w.componentDidUpdate!="function"||I===t.memoizedProps&&G===t.memoizedState||(e.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||I===t.memoizedProps&&G===t.memoizedState||(e.flags|=1024),l=!1)}return kw(t,e,r,l,g,d)}function kw(t,e,r,l,d,g){ok(t,e);var w=(e.flags&128)!==0;if(!l&&!w)return d&&_I(e,r,!1),Sa(t,e,g);l=e.stateNode,TB.current=e;var I=w&&typeof r.getDerivedStateFromError!="function"?null:l.render();return e.flags|=1,t!==null&&w?(e.child=Gh(e,t.child,null,g),e.child=Gh(e,null,I,g)):yi(t,e,I,g),e.memoizedState=l.state,d&&_I(e,r,!0),e.child}function sk(t){var e=t.stateNode;e.pendingContext?gI(t,e.pendingContext,e.pendingContext!==e.context):e.context&&gI(t,e.context,!1),H1(t,e.containerInfo)}function DI(t,e,r,l,d){return $h(),U1(d),e.flags|=256,yi(t,e,r,l),e.child}var Mw={dehydrated:null,treeContext:null,retryLane:0};function Rw(t){return{baseLanes:t,cachePool:null,transitions:null}}function ak(t,e,r){var l=e.pendingProps,d=or.current,g=!1,w=(e.flags&128)!==0,I;if((I=w)||(I=t!==null&&t.memoizedState===null?!1:(d&2)!==0),I?(g=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(d|=1),Bn(or,d&1),t===null)return Tw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(w=l.children,t=l.fallback,g?(l=e.mode,g=e.child,w={mode:"hidden",children:w},!(l&1)&&g!==null?(g.childLanes=0,g.pendingProps=w):g=Hy(w,l,0,null),t=Jc(t,l,r,null),g.return=e,t.return=e,g.sibling=t,e.child=g,e.child.memoizedState=Rw(r),e.memoizedState=Mw,t):tb(e,w));if(d=t.memoizedState,d!==null&&(I=d.dehydrated,I!==null))return SB(t,e,w,l,I,d,r);if(g){g=l.fallback,w=e.mode,d=t.child,I=d.sibling;var a={mode:"hidden",children:l.children};return!(w&1)&&e.child!==d?(l=e.child,l.childLanes=0,l.pendingProps=a,e.deletions=null):(l=Nl(d,a),l.subtreeFlags=d.subtreeFlags&14680064),I!==null?g=Nl(I,g):(g=Jc(g,w,r,null),g.flags|=2),g.return=e,l.return=e,l.sibling=g,e.child=l,l=g,g=e.child,w=t.child.memoizedState,w=w===null?Rw(r):{baseLanes:w.baseLanes|r,cachePool:null,transitions:w.transitions},g.memoizedState=w,g.childLanes=t.childLanes&~r,e.memoizedState=Mw,l}return g=t.child,t=g.sibling,l=Nl(g,{mode:"visible",children:l.children}),!(e.mode&1)&&(l.lanes=r),l.return=e,l.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=l,e.memoizedState=null,l}function tb(t,e){return e=Hy({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function h_(t,e,r,l){return l!==null&&U1(l),Gh(e,t.child,null,r),t=tb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function SB(t,e,r,l,d,g,w){if(r)return e.flags&256?(e.flags&=-257,l=w0(Error(at(422))),h_(t,e,w,l)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(g=l.fallback,d=e.mode,l=Hy({mode:"visible",children:l.children},d,0,null),g=Jc(g,d,w,null),g.flags|=2,l.return=e,g.return=e,l.sibling=g,e.child=l,e.mode&1&&Gh(e,t.child,null,w),e.child.memoizedState=Rw(w),e.memoizedState=Mw,g);if(!(e.mode&1))return h_(t,e,w,null);if(d.data==="$!"){if(l=d.nextSibling&&d.nextSibling.dataset,l)var I=l.dgst;return l=I,g=Error(at(419)),l=w0(g,l,void 0),h_(t,e,w,l)}if(I=(w&t.childLanes)!==0,Oi||I){if(l=$r,l!==null){switch(w&-w){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(l.suspendedLanes|w)?0:d,d!==0&&d!==g.retryLane&&(g.retryLane=d,Ta(t,d),cs(l,t,d,-1))}return ab(),l=w0(Error(at(421))),h_(t,e,w,l)}return d.data==="$?"?(e.flags|=128,e.child=t.child,e=FB.bind(null,t),d._reactRetry=e,null):(t=g.treeContext,Ji=zl(d.nextSibling),Yi=e,Wn=!0,os=null,t!==null&&(bo[Eo++]=ma,bo[Eo++]=ga,bo[Eo++]=tu,ma=t.id,ga=t.overflow,tu=e),e=tb(e,l.children),e.flags|=4096,e)}function LI(t,e,r){t.lanes|=e;var l=t.alternate;l!==null&&(l.lanes|=e),Sw(t.return,e,r)}function b0(t,e,r,l,d){var g=t.memoizedState;g===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:l,tail:r,tailMode:d}:(g.isBackwards=e,g.rendering=null,g.renderingStartTime=0,g.last=l,g.tail=r,g.tailMode=d)}function lk(t,e,r){var l=e.pendingProps,d=l.revealOrder,g=l.tail;if(yi(t,e,l.children,r),l=or.current,l&2)l=l&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&LI(t,r,e);else if(t.tag===19)LI(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}l&=1}if(Bn(or,l),!(e.mode&1))e.memoizedState=null;else switch(d){case"forwards":for(r=e.child,d=null;r!==null;)t=r.alternate,t!==null&&sy(t)===null&&(d=r),r=r.sibling;r=d,r===null?(d=e.child,e.child=null):(d=r.sibling,r.sibling=null),b0(e,!1,d,r,g);break;case"backwards":for(r=null,d=e.child,e.child=null;d!==null;){if(t=d.alternate,t!==null&&sy(t)===null){e.child=d;break}t=d.sibling,d.sibling=r,r=d,d=t}b0(e,!0,r,null,g);break;case"together":b0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function k_(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Sa(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),ru|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(at(153));if(e.child!==null){for(t=e.child,r=Nl(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Nl(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function IB(t,e,r){switch(e.tag){case 3:sk(e),$h();break;case 5:zP(e);break;case 1:Fi(e.type)&&ey(e);break;case 4:H1(e,e.stateNode.containerInfo);break;case 10:var l=e.type._context,d=e.memoizedProps.value;Bn(ry,l._currentValue),l._currentValue=d;break;case 13:if(l=e.memoizedState,l!==null)return l.dehydrated!==null?(Bn(or,or.current&1),e.flags|=128,null):r&e.child.childLanes?ak(t,e,r):(Bn(or,or.current&1),t=Sa(t,e,r),t!==null?t.sibling:null);Bn(or,or.current&1);break;case 19:if(l=(r&e.childLanes)!==0,t.flags&128){if(l)return lk(t,e,r);e.flags|=128}if(d=e.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Bn(or,or.current),l)break;return null;case 22:case 23:return e.lanes=0,ik(t,e,r)}return Sa(t,e,r)}var ck,Dw,uk,hk;ck=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Dw=function(){};uk=function(t,e,r,l){var d=t.memoizedProps;if(d!==l){t=e.stateNode,Zc(Ds.current);var g=null;switch(r){case"input":d=tw(t,d),l=tw(t,l),g=[];break;case"select":d=lr({},d,{value:void 0}),l=lr({},l,{value:void 0}),g=[];break;case"textarea":d=iw(t,d),l=iw(t,l),g=[];break;default:typeof d.onClick!="function"&&typeof l.onClick=="function"&&(t.onclick=Y_)}sw(r,l);var w;r=null;for(k in d)if(!l.hasOwnProperty(k)&&d.hasOwnProperty(k)&&d[k]!=null)if(k==="style"){var I=d[k];for(w in I)I.hasOwnProperty(w)&&(r||(r={}),r[w]="")}else k!=="dangerouslySetInnerHTML"&&k!=="children"&&k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(Mp.hasOwnProperty(k)?g||(g=[]):(g=g||[]).push(k,null));for(k in l){var a=l[k];if(I=d!=null?d[k]:void 0,l.hasOwnProperty(k)&&a!==I&&(a!=null||I!=null))if(k==="style")if(I){for(w in I)!I.hasOwnProperty(w)||a&&a.hasOwnProperty(w)||(r||(r={}),r[w]="");for(w in a)a.hasOwnProperty(w)&&I[w]!==a[w]&&(r||(r={}),r[w]=a[w])}else r||(g||(g=[]),g.push(k,r)),r=a;else k==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,I=I?I.__html:void 0,a!=null&&I!==a&&(g=g||[]).push(k,a)):k==="children"?typeof a!="string"&&typeof a!="number"||(g=g||[]).push(k,""+a):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&(Mp.hasOwnProperty(k)?(a!=null&&k==="onScroll"&&Un("scroll",t),g||I===a||(g=[])):(g=g||[]).push(k,a))}r&&(g=g||[]).push("style",r);var k=g;(e.updateQueue=k)&&(e.flags|=4)}};hk=function(t,e,r,l){r!==l&&(e.flags|=4)};function ip(t,e){if(!Wn)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:l.sibling=null}}function li(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,l=0;if(e)for(var d=t.child;d!==null;)r|=d.lanes|d.childLanes,l|=d.subtreeFlags&14680064,l|=d.flags&14680064,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)r|=d.lanes|d.childLanes,l|=d.subtreeFlags,l|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=l,t.childLanes=r,e}function CB(t,e,r){var l=e.pendingProps;switch(j1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return li(e),null;case 1:return Fi(e.type)&&Q_(),li(e),null;case 3:return l=e.stateNode,Wh(),Vn(Bi),Vn(di),X1(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(t===null||t.child===null)&&(c_(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,os!==null&&(Uw(os),os=null))),Dw(t,e),li(e),null;case 5:Z1(e);var d=Zc($p.current);if(r=e.type,t!==null&&e.stateNode!=null)uk(t,e,r,l,d),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!l){if(e.stateNode===null)throw Error(at(166));return li(e),null}if(t=Zc(Ds.current),c_(e)){l=e.stateNode,r=e.type;var g=e.memoizedProps;switch(l[ks]=e,l[Up]=g,t=(e.mode&1)!==0,r){case"dialog":Un("cancel",l),Un("close",l);break;case"iframe":case"object":case"embed":Un("load",l);break;case"video":case"audio":for(d=0;d<hp.length;d++)Un(hp[d],l);break;case"source":Un("error",l);break;case"img":case"image":case"link":Un("error",l),Un("load",l);break;case"details":Un("toggle",l);break;case"input":$S(l,g),Un("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!g.multiple},Un("invalid",l);break;case"textarea":WS(l,g),Un("invalid",l)}sw(r,g),d=null;for(var w in g)if(g.hasOwnProperty(w)){var I=g[w];w==="children"?typeof I=="string"?l.textContent!==I&&(g.suppressHydrationWarning!==!0&&l_(l.textContent,I,t),d=["children",I]):typeof I=="number"&&l.textContent!==""+I&&(g.suppressHydrationWarning!==!0&&l_(l.textContent,I,t),d=["children",""+I]):Mp.hasOwnProperty(w)&&I!=null&&w==="onScroll"&&Un("scroll",l)}switch(r){case"input":e_(l),GS(l,g,!0);break;case"textarea":e_(l),qS(l);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(l.onclick=Y_)}l=d,e.updateQueue=l,l!==null&&(e.flags|=4)}else{w=d.nodeType===9?d:d.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=FA(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=w.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof l.is=="string"?t=w.createElement(r,{is:l.is}):(t=w.createElement(r),r==="select"&&(w=t,l.multiple?w.multiple=!0:l.size&&(w.size=l.size))):t=w.createElementNS(t,r),t[ks]=e,t[Up]=l,ck(t,e,!1,!1),e.stateNode=t;e:{switch(w=aw(r,l),r){case"dialog":Un("cancel",t),Un("close",t),d=l;break;case"iframe":case"object":case"embed":Un("load",t),d=l;break;case"video":case"audio":for(d=0;d<hp.length;d++)Un(hp[d],t);d=l;break;case"source":Un("error",t),d=l;break;case"img":case"image":case"link":Un("error",t),Un("load",t),d=l;break;case"details":Un("toggle",t),d=l;break;case"input":$S(t,l),d=tw(t,l),Un("invalid",t);break;case"option":d=l;break;case"select":t._wrapperState={wasMultiple:!!l.multiple},d=lr({},l,{value:void 0}),Un("invalid",t);break;case"textarea":WS(t,l),d=iw(t,l),Un("invalid",t);break;default:d=l}sw(r,d),I=d;for(g in I)if(I.hasOwnProperty(g)){var a=I[g];g==="style"?UA(t,a):g==="dangerouslySetInnerHTML"?(a=a?a.__html:void 0,a!=null&&NA(t,a)):g==="children"?typeof a=="string"?(r!=="textarea"||a!=="")&&Rp(t,a):typeof a=="number"&&Rp(t,""+a):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(Mp.hasOwnProperty(g)?a!=null&&g==="onScroll"&&Un("scroll",t):a!=null&&S1(t,g,a,w))}switch(r){case"input":e_(t),GS(t,l,!1);break;case"textarea":e_(t),qS(t);break;case"option":l.value!=null&&t.setAttribute("value",""+Wl(l.value));break;case"select":t.multiple=!!l.multiple,g=l.value,g!=null?kh(t,!!l.multiple,g,!1):l.defaultValue!=null&&kh(t,!!l.multiple,l.defaultValue,!0);break;default:typeof d.onClick=="function"&&(t.onclick=Y_)}switch(r){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return li(e),null;case 6:if(t&&e.stateNode!=null)hk(t,e,t.memoizedProps,l);else{if(typeof l!="string"&&e.stateNode===null)throw Error(at(166));if(r=Zc($p.current),Zc(Ds.current),c_(e)){if(l=e.stateNode,r=e.memoizedProps,l[ks]=e,(g=l.nodeValue!==r)&&(t=Yi,t!==null))switch(t.tag){case 3:l_(l.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&l_(l.nodeValue,r,(t.mode&1)!==0)}g&&(e.flags|=4)}else l=(r.nodeType===9?r:r.ownerDocument).createTextNode(l),l[ks]=e,e.stateNode=l}return li(e),null;case 13:if(Vn(or),l=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Wn&&Ji!==null&&e.mode&1&&!(e.flags&128))AP(),$h(),e.flags|=98560,g=!1;else if(g=c_(e),l!==null&&l.dehydrated!==null){if(t===null){if(!g)throw Error(at(318));if(g=e.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(at(317));g[ks]=e}else $h(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;li(e),g=!1}else os!==null&&(Uw(os),os=null),g=!0;if(!g)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(l=l!==null,l!==(t!==null&&t.memoizedState!==null)&&l&&(e.child.flags|=8192,e.mode&1&&(t===null||or.current&1?Dr===0&&(Dr=3):ab())),e.updateQueue!==null&&(e.flags|=4),li(e),null);case 4:return Wh(),Dw(t,e),t===null&&Np(e.stateNode.containerInfo),li(e),null;case 10:return G1(e.type._context),li(e),null;case 17:return Fi(e.type)&&Q_(),li(e),null;case 19:if(Vn(or),g=e.memoizedState,g===null)return li(e),null;if(l=(e.flags&128)!==0,w=g.rendering,w===null)if(l)ip(g,!1);else{if(Dr!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(w=sy(t),w!==null){for(e.flags|=128,ip(g,!1),l=w.updateQueue,l!==null&&(e.updateQueue=l,e.flags|=4),e.subtreeFlags=0,l=r,r=e.child;r!==null;)g=r,t=l,g.flags&=14680066,w=g.alternate,w===null?(g.childLanes=0,g.lanes=t,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=w.childLanes,g.lanes=w.lanes,g.child=w.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=w.memoizedProps,g.memoizedState=w.memoizedState,g.updateQueue=w.updateQueue,g.type=w.type,t=w.dependencies,g.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return Bn(or,or.current&1|2),e.child}t=t.sibling}g.tail!==null&&_r()>Hh&&(e.flags|=128,l=!0,ip(g,!1),e.lanes=4194304)}else{if(!l)if(t=sy(w),t!==null){if(e.flags|=128,l=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),ip(g,!0),g.tail===null&&g.tailMode==="hidden"&&!w.alternate&&!Wn)return li(e),null}else 2*_r()-g.renderingStartTime>Hh&&r!==1073741824&&(e.flags|=128,l=!0,ip(g,!1),e.lanes=4194304);g.isBackwards?(w.sibling=e.child,e.child=w):(r=g.last,r!==null?r.sibling=w:e.child=w,g.last=w)}return g.tail!==null?(e=g.tail,g.rendering=e,g.tail=e.sibling,g.renderingStartTime=_r(),e.sibling=null,r=or.current,Bn(or,l?r&1|2:r&1),e):(li(e),null);case 22:case 23:return sb(),l=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==l&&(e.flags|=8192),l&&e.mode&1?Xi&1073741824&&(li(e),e.subtreeFlags&6&&(e.flags|=8192)):li(e),null;case 24:return null;case 25:return null}throw Error(at(156,e.tag))}function AB(t,e){switch(j1(e),e.tag){case 1:return Fi(e.type)&&Q_(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Wh(),Vn(Bi),Vn(di),X1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Z1(e),null;case 13:if(Vn(or),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(at(340));$h()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Vn(or),null;case 4:return Wh(),null;case 10:return G1(e.type._context),null;case 22:case 23:return sb(),null;case 24:return null;default:return null}}var d_=!1,ui=!1,PB=typeof WeakSet=="function"?WeakSet:Set,bt=null;function Ih(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(l){pr(t,e,l)}else r.current=null}function Lw(t,e,r){try{r()}catch(l){pr(t,e,l)}}var zI=!1;function kB(t,e){if(_w=X_,t=mP(),F1(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var l=r.getSelection&&r.getSelection();if(l&&l.rangeCount!==0){r=l.anchorNode;var d=l.anchorOffset,g=l.focusNode;l=l.focusOffset;try{r.nodeType,g.nodeType}catch{r=null;break e}var w=0,I=-1,a=-1,k=0,O=0,V=t,G=null;t:for(;;){for(var X;V!==r||d!==0&&V.nodeType!==3||(I=w+d),V!==g||l!==0&&V.nodeType!==3||(a=w+l),V.nodeType===3&&(w+=V.nodeValue.length),(X=V.firstChild)!==null;)G=V,V=X;for(;;){if(V===t)break t;if(G===r&&++k===d&&(I=w),G===g&&++O===l&&(a=w),(X=V.nextSibling)!==null)break;V=G,G=V.parentNode}V=X}r=I===-1||a===-1?null:{start:I,end:a}}else r=null}r=r||{start:0,end:0}}else r=null;for(yw={focusedElem:t,selectionRange:r},X_=!1,bt=e;bt!==null;)if(e=bt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,bt=t;else for(;bt!==null;){e=bt;try{var oe=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(oe!==null){var le=oe.memoizedProps,we=oe.memoizedState,te=e.stateNode,J=te.getSnapshotBeforeUpdate(e.elementType===e.type?le:rs(e.type,le),we);te.__reactInternalSnapshotBeforeUpdate=J}break;case 3:var ce=e.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(at(163))}}catch(Te){pr(e,e.return,Te)}if(t=e.sibling,t!==null){t.return=e.return,bt=t;break}bt=e.return}return oe=zI,zI=!1,oe}function xp(t,e,r){var l=e.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var d=l=l.next;do{if((d.tag&t)===t){var g=d.destroy;d.destroy=void 0,g!==void 0&&Lw(e,r,g)}d=d.next}while(d!==l)}}function Wy(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var l=r.create;r.destroy=l()}r=r.next}while(r!==e)}}function zw(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function dk(t){var e=t.alternate;e!==null&&(t.alternate=null,dk(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ks],delete e[Up],delete e[ww],delete e[dB],delete e[fB])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function fk(t){return t.tag===5||t.tag===3||t.tag===4}function OI(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||fk(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ow(t,e,r){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=Y_));else if(l!==4&&(t=t.child,t!==null))for(Ow(t,e,r),t=t.sibling;t!==null;)Ow(t,e,r),t=t.sibling}function Bw(t,e,r){var l=t.tag;if(l===5||l===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(l!==4&&(t=t.child,t!==null))for(Bw(t,e,r),t=t.sibling;t!==null;)Bw(t,e,r),t=t.sibling}var Xr=null,is=!1;function ml(t,e,r){for(r=r.child;r!==null;)pk(t,e,r),r=r.sibling}function pk(t,e,r){if(Rs&&typeof Rs.onCommitFiberUnmount=="function")try{Rs.onCommitFiberUnmount(By,r)}catch{}switch(r.tag){case 5:ui||Ih(r,e);case 6:var l=Xr,d=is;Xr=null,ml(t,e,r),Xr=l,is=d,Xr!==null&&(is?(t=Xr,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Xr.removeChild(r.stateNode));break;case 18:Xr!==null&&(is?(t=Xr,r=r.stateNode,t.nodeType===8?m0(t.parentNode,r):t.nodeType===1&&m0(t,r),Op(t)):m0(Xr,r.stateNode));break;case 4:l=Xr,d=is,Xr=r.stateNode.containerInfo,is=!0,ml(t,e,r),Xr=l,is=d;break;case 0:case 11:case 14:case 15:if(!ui&&(l=r.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){d=l=l.next;do{var g=d,w=g.destroy;g=g.tag,w!==void 0&&(g&2||g&4)&&Lw(r,e,w),d=d.next}while(d!==l)}ml(t,e,r);break;case 1:if(!ui&&(Ih(r,e),l=r.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=r.memoizedProps,l.state=r.memoizedState,l.componentWillUnmount()}catch(I){pr(r,e,I)}ml(t,e,r);break;case 21:ml(t,e,r);break;case 22:r.mode&1?(ui=(l=ui)||r.memoizedState!==null,ml(t,e,r),ui=l):ml(t,e,r);break;default:ml(t,e,r)}}function BI(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new PB),e.forEach(function(l){var d=NB.bind(null,t,l);r.has(l)||(r.add(l),l.then(d,d))})}}function ns(t,e){var r=e.deletions;if(r!==null)for(var l=0;l<r.length;l++){var d=r[l];try{var g=t,w=e,I=w;e:for(;I!==null;){switch(I.tag){case 5:Xr=I.stateNode,is=!1;break e;case 3:Xr=I.stateNode.containerInfo,is=!0;break e;case 4:Xr=I.stateNode.containerInfo,is=!0;break e}I=I.return}if(Xr===null)throw Error(at(160));pk(g,w,d),Xr=null,is=!1;var a=d.alternate;a!==null&&(a.return=null),d.return=null}catch(k){pr(d,e,k)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mk(e,t),e=e.sibling}function mk(t,e){var r=t.alternate,l=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ns(e,t),Cs(t),l&4){try{xp(3,t,t.return),Wy(3,t)}catch(le){pr(t,t.return,le)}try{xp(5,t,t.return)}catch(le){pr(t,t.return,le)}}break;case 1:ns(e,t),Cs(t),l&512&&r!==null&&Ih(r,r.return);break;case 5:if(ns(e,t),Cs(t),l&512&&r!==null&&Ih(r,r.return),t.flags&32){var d=t.stateNode;try{Rp(d,"")}catch(le){pr(t,t.return,le)}}if(l&4&&(d=t.stateNode,d!=null)){var g=t.memoizedProps,w=r!==null?r.memoizedProps:g,I=t.type,a=t.updateQueue;if(t.updateQueue=null,a!==null)try{I==="input"&&g.type==="radio"&&g.name!=null&&OA(d,g),aw(I,w);var k=aw(I,g);for(w=0;w<a.length;w+=2){var O=a[w],V=a[w+1];O==="style"?UA(d,V):O==="dangerouslySetInnerHTML"?NA(d,V):O==="children"?Rp(d,V):S1(d,O,V,k)}switch(I){case"input":nw(d,g);break;case"textarea":BA(d,g);break;case"select":var G=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!g.multiple;var X=g.value;X!=null?kh(d,!!g.multiple,X,!1):G!==!!g.multiple&&(g.defaultValue!=null?kh(d,!!g.multiple,g.defaultValue,!0):kh(d,!!g.multiple,g.multiple?[]:"",!1))}d[Up]=g}catch(le){pr(t,t.return,le)}}break;case 6:if(ns(e,t),Cs(t),l&4){if(t.stateNode===null)throw Error(at(162));d=t.stateNode,g=t.memoizedProps;try{d.nodeValue=g}catch(le){pr(t,t.return,le)}}break;case 3:if(ns(e,t),Cs(t),l&4&&r!==null&&r.memoizedState.isDehydrated)try{Op(e.containerInfo)}catch(le){pr(t,t.return,le)}break;case 4:ns(e,t),Cs(t);break;case 13:ns(e,t),Cs(t),d=t.child,d.flags&8192&&(g=d.memoizedState!==null,d.stateNode.isHidden=g,!g||d.alternate!==null&&d.alternate.memoizedState!==null||(ib=_r())),l&4&&BI(t);break;case 22:if(O=r!==null&&r.memoizedState!==null,t.mode&1?(ui=(k=ui)||O,ns(e,t),ui=k):ns(e,t),Cs(t),l&8192){if(k=t.memoizedState!==null,(t.stateNode.isHidden=k)&&!O&&t.mode&1)for(bt=t,O=t.child;O!==null;){for(V=bt=O;bt!==null;){switch(G=bt,X=G.child,G.tag){case 0:case 11:case 14:case 15:xp(4,G,G.return);break;case 1:Ih(G,G.return);var oe=G.stateNode;if(typeof oe.componentWillUnmount=="function"){l=G,r=G.return;try{e=l,oe.props=e.memoizedProps,oe.state=e.memoizedState,oe.componentWillUnmount()}catch(le){pr(l,r,le)}}break;case 5:Ih(G,G.return);break;case 22:if(G.memoizedState!==null){NI(V);continue}}X!==null?(X.return=G,bt=X):NI(V)}O=O.sibling}e:for(O=null,V=t;;){if(V.tag===5){if(O===null){O=V;try{d=V.stateNode,k?(g=d.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(I=V.stateNode,a=V.memoizedProps.style,w=a!=null&&a.hasOwnProperty("display")?a.display:null,I.style.display=jA("display",w))}catch(le){pr(t,t.return,le)}}}else if(V.tag===6){if(O===null)try{V.stateNode.nodeValue=k?"":V.memoizedProps}catch(le){pr(t,t.return,le)}}else if((V.tag!==22&&V.tag!==23||V.memoizedState===null||V===t)&&V.child!==null){V.child.return=V,V=V.child;continue}if(V===t)break e;for(;V.sibling===null;){if(V.return===null||V.return===t)break e;O===V&&(O=null),V=V.return}O===V&&(O=null),V.sibling.return=V.return,V=V.sibling}}break;case 19:ns(e,t),Cs(t),l&4&&BI(t);break;case 21:break;default:ns(e,t),Cs(t)}}function Cs(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(fk(r)){var l=r;break e}r=r.return}throw Error(at(160))}switch(l.tag){case 5:var d=l.stateNode;l.flags&32&&(Rp(d,""),l.flags&=-33);var g=OI(t);Bw(t,g,d);break;case 3:case 4:var w=l.stateNode.containerInfo,I=OI(t);Ow(t,I,w);break;default:throw Error(at(161))}}catch(a){pr(t,t.return,a)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function MB(t,e,r){bt=t,gk(t)}function gk(t,e,r){for(var l=(t.mode&1)!==0;bt!==null;){var d=bt,g=d.child;if(d.tag===22&&l){var w=d.memoizedState!==null||d_;if(!w){var I=d.alternate,a=I!==null&&I.memoizedState!==null||ui;I=d_;var k=ui;if(d_=w,(ui=a)&&!k)for(bt=d;bt!==null;)w=bt,a=w.child,w.tag===22&&w.memoizedState!==null?jI(d):a!==null?(a.return=w,bt=a):jI(d);for(;g!==null;)bt=g,gk(g),g=g.sibling;bt=d,d_=I,ui=k}FI(t)}else d.subtreeFlags&8772&&g!==null?(g.return=d,bt=g):FI(t)}}function FI(t){for(;bt!==null;){var e=bt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ui||Wy(5,e);break;case 1:var l=e.stateNode;if(e.flags&4&&!ui)if(r===null)l.componentDidMount();else{var d=e.elementType===e.type?r.memoizedProps:rs(e.type,r.memoizedProps);l.componentDidUpdate(d,r.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var g=e.updateQueue;g!==null&&wI(e,g,l);break;case 3:var w=e.updateQueue;if(w!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}wI(e,w,r)}break;case 5:var I=e.stateNode;if(r===null&&e.flags&4){r=I;var a=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":a.autoFocus&&r.focus();break;case"img":a.src&&(r.src=a.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var k=e.alternate;if(k!==null){var O=k.memoizedState;if(O!==null){var V=O.dehydrated;V!==null&&Op(V)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(at(163))}ui||e.flags&512&&zw(e)}catch(G){pr(e,e.return,G)}}if(e===t){bt=null;break}if(r=e.sibling,r!==null){r.return=e.return,bt=r;break}bt=e.return}}function NI(t){for(;bt!==null;){var e=bt;if(e===t){bt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,bt=r;break}bt=e.return}}function jI(t){for(;bt!==null;){var e=bt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{Wy(4,e)}catch(a){pr(e,r,a)}break;case 1:var l=e.stateNode;if(typeof l.componentDidMount=="function"){var d=e.return;try{l.componentDidMount()}catch(a){pr(e,d,a)}}var g=e.return;try{zw(e)}catch(a){pr(e,g,a)}break;case 5:var w=e.return;try{zw(e)}catch(a){pr(e,w,a)}}}catch(a){pr(e,e.return,a)}if(e===t){bt=null;break}var I=e.sibling;if(I!==null){I.return=e.return,bt=I;break}bt=e.return}}var RB=Math.ceil,cy=ka.ReactCurrentDispatcher,nb=ka.ReactCurrentOwner,Io=ka.ReactCurrentBatchConfig,dn=0,$r=null,Ir=null,Jr=0,Xi=0,Ch=Xl(0),Dr=0,Hp=null,ru=0,qy=0,rb=0,wp=null,Li=null,ib=0,Hh=1/0,ha=null,uy=!1,Fw=null,Bl=null,f_=!1,Pl=null,hy=0,bp=0,Nw=null,M_=-1,R_=0;function xi(){return dn&6?_r():M_!==-1?M_:M_=_r()}function Fl(t){return t.mode&1?dn&2&&Jr!==0?Jr&-Jr:mB.transition!==null?(R_===0&&(R_=QA()),R_):(t=kn,t!==0||(t=window.event,t=t===void 0?16:sP(t.type)),t):1}function cs(t,e,r,l){if(50<bp)throw bp=0,Nw=null,Error(at(185));lm(t,r,l),(!(dn&2)||t!==$r)&&(t===$r&&(!(dn&2)&&(qy|=r),Dr===4&&El(t,Jr)),Ni(t,l),r===1&&dn===0&&!(e.mode&1)&&(Hh=_r()+500,Vy&&Kl()))}function Ni(t,e){var r=t.callbackNode;m3(t,e);var l=Z_(t,t===$r?Jr:0);if(l===0)r!==null&&XS(r),t.callbackNode=null,t.callbackPriority=0;else if(e=l&-l,t.callbackPriority!==e){if(r!=null&&XS(r),e===1)t.tag===0?pB(UI.bind(null,t)):SP(UI.bind(null,t)),uB(function(){!(dn&6)&&Kl()}),r=null;else{switch(eP(l)){case 1:r=k1;break;case 4:r=JA;break;case 16:r=H_;break;case 536870912:r=YA;break;default:r=H_}r=Tk(r,_k.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function _k(t,e){if(M_=-1,R_=0,dn&6)throw Error(at(327));var r=t.callbackNode;if(zh()&&t.callbackNode!==r)return null;var l=Z_(t,t===$r?Jr:0);if(l===0)return null;if(l&30||l&t.expiredLanes||e)e=dy(t,l);else{e=l;var d=dn;dn|=2;var g=vk();($r!==t||Jr!==e)&&(ha=null,Hh=_r()+500,Kc(t,e));do try{zB();break}catch(I){yk(t,I)}while(!0);$1(),cy.current=g,dn=d,Ir!==null?e=0:($r=null,Jr=0,e=Dr)}if(e!==0){if(e===2&&(d=dw(t),d!==0&&(l=d,e=jw(t,d))),e===1)throw r=Hp,Kc(t,0),El(t,l),Ni(t,_r()),r;if(e===6)El(t,l);else{if(d=t.current.alternate,!(l&30)&&!DB(d)&&(e=dy(t,l),e===2&&(g=dw(t),g!==0&&(l=g,e=jw(t,g))),e===1))throw r=Hp,Kc(t,0),El(t,l),Ni(t,_r()),r;switch(t.finishedWork=d,t.finishedLanes=l,e){case 0:case 1:throw Error(at(345));case 2:Gc(t,Li,ha);break;case 3:if(El(t,l),(l&130023424)===l&&(e=ib+500-_r(),10<e)){if(Z_(t,0)!==0)break;if(d=t.suspendedLanes,(d&l)!==l){xi(),t.pingedLanes|=t.suspendedLanes&d;break}t.timeoutHandle=xw(Gc.bind(null,t,Li,ha),e);break}Gc(t,Li,ha);break;case 4:if(El(t,l),(l&4194240)===l)break;for(e=t.eventTimes,d=-1;0<l;){var w=31-ls(l);g=1<<w,w=e[w],w>d&&(d=w),l&=~g}if(l=d,l=_r()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*RB(l/1960))-l,10<l){t.timeoutHandle=xw(Gc.bind(null,t,Li,ha),l);break}Gc(t,Li,ha);break;case 5:Gc(t,Li,ha);break;default:throw Error(at(329))}}}return Ni(t,_r()),t.callbackNode===r?_k.bind(null,t):null}function jw(t,e){var r=wp;return t.current.memoizedState.isDehydrated&&(Kc(t,e).flags|=256),t=dy(t,e),t!==2&&(e=Li,Li=r,e!==null&&Uw(e)),t}function Uw(t){Li===null?Li=t:Li.push.apply(Li,t)}function DB(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var l=0;l<r.length;l++){var d=r[l],g=d.getSnapshot;d=d.value;try{if(!us(g(),d))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function El(t,e){for(e&=~rb,e&=~qy,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-ls(e),l=1<<r;t[r]=-1,e&=~l}}function UI(t){if(dn&6)throw Error(at(327));zh();var e=Z_(t,0);if(!(e&1))return Ni(t,_r()),null;var r=dy(t,e);if(t.tag!==0&&r===2){var l=dw(t);l!==0&&(e=l,r=jw(t,l))}if(r===1)throw r=Hp,Kc(t,0),El(t,e),Ni(t,_r()),r;if(r===6)throw Error(at(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Gc(t,Li,ha),Ni(t,_r()),null}function ob(t,e){var r=dn;dn|=1;try{return t(e)}finally{dn=r,dn===0&&(Hh=_r()+500,Vy&&Kl())}}function iu(t){Pl!==null&&Pl.tag===0&&!(dn&6)&&zh();var e=dn;dn|=1;var r=Io.transition,l=kn;try{if(Io.transition=null,kn=1,t)return t()}finally{kn=l,Io.transition=r,dn=e,!(dn&6)&&Kl()}}function sb(){Xi=Ch.current,Vn(Ch)}function Kc(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,cB(r)),Ir!==null)for(r=Ir.return;r!==null;){var l=r;switch(j1(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&Q_();break;case 3:Wh(),Vn(Bi),Vn(di),X1();break;case 5:Z1(l);break;case 4:Wh();break;case 13:Vn(or);break;case 19:Vn(or);break;case 10:G1(l.type._context);break;case 22:case 23:sb()}r=r.return}if($r=t,Ir=t=Nl(t.current,null),Jr=Xi=e,Dr=0,Hp=null,rb=qy=ru=0,Li=wp=null,Hc!==null){for(e=0;e<Hc.length;e++)if(r=Hc[e],l=r.interleaved,l!==null){r.interleaved=null;var d=l.next,g=r.pending;if(g!==null){var w=g.next;g.next=d,l.next=w}r.pending=l}Hc=null}return t}function yk(t,e){do{var r=Ir;try{if($1(),A_.current=ly,ay){for(var l=sr.memoizedState;l!==null;){var d=l.queue;d!==null&&(d.pending=null),l=l.next}ay=!1}if(nu=0,Vr=Rr=sr=null,vp=!1,Gp=0,nb.current=null,r===null||r.return===null){Dr=1,Hp=e,Ir=null;break}e:{var g=t,w=r.return,I=r,a=e;if(e=Jr,I.flags|=32768,a!==null&&typeof a=="object"&&typeof a.then=="function"){var k=a,O=I,V=O.tag;if(!(O.mode&1)&&(V===0||V===11||V===15)){var G=O.alternate;G?(O.updateQueue=G.updateQueue,O.memoizedState=G.memoizedState,O.lanes=G.lanes):(O.updateQueue=null,O.memoizedState=null)}var X=AI(w);if(X!==null){X.flags&=-257,PI(X,w,I,g,e),X.mode&1&&CI(g,k,e),e=X,a=k;var oe=e.updateQueue;if(oe===null){var le=new Set;le.add(a),e.updateQueue=le}else oe.add(a);break e}else{if(!(e&1)){CI(g,k,e),ab();break e}a=Error(at(426))}}else if(Wn&&I.mode&1){var we=AI(w);if(we!==null){!(we.flags&65536)&&(we.flags|=256),PI(we,w,I,g,e),U1(qh(a,I));break e}}g=a=qh(a,I),Dr!==4&&(Dr=2),wp===null?wp=[g]:wp.push(g),g=w;do{switch(g.tag){case 3:g.flags|=65536,e&=-e,g.lanes|=e;var te=tk(g,a,e);xI(g,te);break e;case 1:I=a;var J=g.type,ce=g.stateNode;if(!(g.flags&128)&&(typeof J.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(Bl===null||!Bl.has(ce)))){g.flags|=65536,e&=-e,g.lanes|=e;var Te=nk(g,I,e);xI(g,Te);break e}}g=g.return}while(g!==null)}wk(r)}catch(Ne){e=Ne,Ir===r&&r!==null&&(Ir=r=r.return);continue}break}while(!0)}function vk(){var t=cy.current;return cy.current=ly,t===null?ly:t}function ab(){(Dr===0||Dr===3||Dr===2)&&(Dr=4),$r===null||!(ru&268435455)&&!(qy&268435455)||El($r,Jr)}function dy(t,e){var r=dn;dn|=2;var l=vk();($r!==t||Jr!==e)&&(ha=null,Kc(t,e));do try{LB();break}catch(d){yk(t,d)}while(!0);if($1(),dn=r,cy.current=l,Ir!==null)throw Error(at(261));return $r=null,Jr=0,Dr}function LB(){for(;Ir!==null;)xk(Ir)}function zB(){for(;Ir!==null&&!s3();)xk(Ir)}function xk(t){var e=Ek(t.alternate,t,Xi);t.memoizedProps=t.pendingProps,e===null?wk(t):Ir=e,nb.current=null}function wk(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=AB(r,e),r!==null){r.flags&=32767,Ir=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Dr=6,Ir=null;return}}else if(r=CB(r,e,Xi),r!==null){Ir=r;return}if(e=e.sibling,e!==null){Ir=e;return}Ir=e=t}while(e!==null);Dr===0&&(Dr=5)}function Gc(t,e,r){var l=kn,d=Io.transition;try{Io.transition=null,kn=1,OB(t,e,r,l)}finally{Io.transition=d,kn=l}return null}function OB(t,e,r,l){do zh();while(Pl!==null);if(dn&6)throw Error(at(327));r=t.finishedWork;var d=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(at(177));t.callbackNode=null,t.callbackPriority=0;var g=r.lanes|r.childLanes;if(g3(t,g),t===$r&&(Ir=$r=null,Jr=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||f_||(f_=!0,Tk(H_,function(){return zh(),null})),g=(r.flags&15990)!==0,r.subtreeFlags&15990||g){g=Io.transition,Io.transition=null;var w=kn;kn=1;var I=dn;dn|=4,nb.current=null,kB(t,r),mk(r,t),nB(yw),X_=!!_w,yw=_w=null,t.current=r,MB(r),a3(),dn=I,kn=w,Io.transition=g}else t.current=r;if(f_&&(f_=!1,Pl=t,hy=d),g=t.pendingLanes,g===0&&(Bl=null),u3(r.stateNode),Ni(t,_r()),e!==null)for(l=t.onRecoverableError,r=0;r<e.length;r++)d=e[r],l(d.value,{componentStack:d.stack,digest:d.digest});if(uy)throw uy=!1,t=Fw,Fw=null,t;return hy&1&&t.tag!==0&&zh(),g=t.pendingLanes,g&1?t===Nw?bp++:(bp=0,Nw=t):bp=0,Kl(),null}function zh(){if(Pl!==null){var t=eP(hy),e=Io.transition,r=kn;try{if(Io.transition=null,kn=16>t?16:t,Pl===null)var l=!1;else{if(t=Pl,Pl=null,hy=0,dn&6)throw Error(at(331));var d=dn;for(dn|=4,bt=t.current;bt!==null;){var g=bt,w=g.child;if(bt.flags&16){var I=g.deletions;if(I!==null){for(var a=0;a<I.length;a++){var k=I[a];for(bt=k;bt!==null;){var O=bt;switch(O.tag){case 0:case 11:case 15:xp(8,O,g)}var V=O.child;if(V!==null)V.return=O,bt=V;else for(;bt!==null;){O=bt;var G=O.sibling,X=O.return;if(dk(O),O===k){bt=null;break}if(G!==null){G.return=X,bt=G;break}bt=X}}}var oe=g.alternate;if(oe!==null){var le=oe.child;if(le!==null){oe.child=null;do{var we=le.sibling;le.sibling=null,le=we}while(le!==null)}}bt=g}}if(g.subtreeFlags&2064&&w!==null)w.return=g,bt=w;else e:for(;bt!==null;){if(g=bt,g.flags&2048)switch(g.tag){case 0:case 11:case 15:xp(9,g,g.return)}var te=g.sibling;if(te!==null){te.return=g.return,bt=te;break e}bt=g.return}}var J=t.current;for(bt=J;bt!==null;){w=bt;var ce=w.child;if(w.subtreeFlags&2064&&ce!==null)ce.return=w,bt=ce;else e:for(w=J;bt!==null;){if(I=bt,I.flags&2048)try{switch(I.tag){case 0:case 11:case 15:Wy(9,I)}}catch(Ne){pr(I,I.return,Ne)}if(I===w){bt=null;break e}var Te=I.sibling;if(Te!==null){Te.return=I.return,bt=Te;break e}bt=I.return}}if(dn=d,Kl(),Rs&&typeof Rs.onPostCommitFiberRoot=="function")try{Rs.onPostCommitFiberRoot(By,t)}catch{}l=!0}return l}finally{kn=r,Io.transition=e}}return!1}function VI(t,e,r){e=qh(r,e),e=tk(t,e,1),t=Ol(t,e,1),e=xi(),t!==null&&(lm(t,1,e),Ni(t,e))}function pr(t,e,r){if(t.tag===3)VI(t,t,r);else for(;e!==null;){if(e.tag===3){VI(e,t,r);break}else if(e.tag===1){var l=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(Bl===null||!Bl.has(l))){t=qh(r,t),t=nk(e,t,1),e=Ol(e,t,1),t=xi(),e!==null&&(lm(e,1,t),Ni(e,t));break}}e=e.return}}function BB(t,e,r){var l=t.pingCache;l!==null&&l.delete(e),e=xi(),t.pingedLanes|=t.suspendedLanes&r,$r===t&&(Jr&r)===r&&(Dr===4||Dr===3&&(Jr&130023424)===Jr&&500>_r()-ib?Kc(t,0):rb|=r),Ni(t,e)}function bk(t,e){e===0&&(t.mode&1?(e=r_,r_<<=1,!(r_&130023424)&&(r_=4194304)):e=1);var r=xi();t=Ta(t,e),t!==null&&(lm(t,e,r),Ni(t,r))}function FB(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),bk(t,r)}function NB(t,e){var r=0;switch(t.tag){case 13:var l=t.stateNode,d=t.memoizedState;d!==null&&(r=d.retryLane);break;case 19:l=t.stateNode;break;default:throw Error(at(314))}l!==null&&l.delete(e),bk(t,r)}var Ek;Ek=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Bi.current)Oi=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return Oi=!1,IB(t,e,r);Oi=!!(t.flags&131072)}else Oi=!1,Wn&&e.flags&1048576&&IP(e,ny,e.index);switch(e.lanes=0,e.tag){case 2:var l=e.type;k_(t,e),t=e.pendingProps;var d=Vh(e,di.current);Lh(e,r),d=J1(null,e,l,t,d,r);var g=Y1();return e.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Fi(l)?(g=!0,ey(e)):g=!1,e.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,q1(e),d.updater=$y,e.stateNode=d,d._reactInternals=e,Cw(e,l,t,r),e=kw(null,e,l,!0,g,r)):(e.tag=0,Wn&&g&&N1(e),yi(null,e,d,r),e=e.child),e;case 16:l=e.elementType;e:{switch(k_(t,e),t=e.pendingProps,d=l._init,l=d(l._payload),e.type=l,d=e.tag=UB(l),t=rs(l,t),d){case 0:e=Pw(null,e,l,t,r);break e;case 1:e=RI(null,e,l,t,r);break e;case 11:e=kI(null,e,l,t,r);break e;case 14:e=MI(null,e,l,rs(l.type,t),r);break e}throw Error(at(306,l,""))}return e;case 0:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:rs(l,d),Pw(t,e,l,d,r);case 1:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:rs(l,d),RI(t,e,l,d,r);case 3:e:{if(sk(e),t===null)throw Error(at(387));l=e.pendingProps,g=e.memoizedState,d=g.element,kP(t,e),oy(e,l,null,r);var w=e.memoizedState;if(l=w.element,g.isDehydrated)if(g={element:l,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},e.updateQueue.baseState=g,e.memoizedState=g,e.flags&256){d=qh(Error(at(423)),e),e=DI(t,e,l,r,d);break e}else if(l!==d){d=qh(Error(at(424)),e),e=DI(t,e,l,r,d);break e}else for(Ji=zl(e.stateNode.containerInfo.firstChild),Yi=e,Wn=!0,os=null,r=LP(e,null,l,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if($h(),l===d){e=Sa(t,e,r);break e}yi(t,e,l,r)}e=e.child}return e;case 5:return zP(e),t===null&&Tw(e),l=e.type,d=e.pendingProps,g=t!==null?t.memoizedProps:null,w=d.children,vw(l,d)?w=null:g!==null&&vw(l,g)&&(e.flags|=32),ok(t,e),yi(t,e,w,r),e.child;case 6:return t===null&&Tw(e),null;case 13:return ak(t,e,r);case 4:return H1(e,e.stateNode.containerInfo),l=e.pendingProps,t===null?e.child=Gh(e,null,l,r):yi(t,e,l,r),e.child;case 11:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:rs(l,d),kI(t,e,l,d,r);case 7:return yi(t,e,e.pendingProps,r),e.child;case 8:return yi(t,e,e.pendingProps.children,r),e.child;case 12:return yi(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(l=e.type._context,d=e.pendingProps,g=e.memoizedProps,w=d.value,Bn(ry,l._currentValue),l._currentValue=w,g!==null)if(us(g.value,w)){if(g.children===d.children&&!Bi.current){e=Sa(t,e,r);break e}}else for(g=e.child,g!==null&&(g.return=e);g!==null;){var I=g.dependencies;if(I!==null){w=g.child;for(var a=I.firstContext;a!==null;){if(a.context===l){if(g.tag===1){a=va(-1,r&-r),a.tag=2;var k=g.updateQueue;if(k!==null){k=k.shared;var O=k.pending;O===null?a.next=a:(a.next=O.next,O.next=a),k.pending=a}}g.lanes|=r,a=g.alternate,a!==null&&(a.lanes|=r),Sw(g.return,r,e),I.lanes|=r;break}a=a.next}}else if(g.tag===10)w=g.type===e.type?null:g.child;else if(g.tag===18){if(w=g.return,w===null)throw Error(at(341));w.lanes|=r,I=w.alternate,I!==null&&(I.lanes|=r),Sw(w,r,e),w=g.sibling}else w=g.child;if(w!==null)w.return=g;else for(w=g;w!==null;){if(w===e){w=null;break}if(g=w.sibling,g!==null){g.return=w.return,w=g;break}w=w.return}g=w}yi(t,e,d.children,r),e=e.child}return e;case 9:return d=e.type,l=e.pendingProps.children,Lh(e,r),d=Ao(d),l=l(d),e.flags|=1,yi(t,e,l,r),e.child;case 14:return l=e.type,d=rs(l,e.pendingProps),d=rs(l.type,d),MI(t,e,l,d,r);case 15:return rk(t,e,e.type,e.pendingProps,r);case 17:return l=e.type,d=e.pendingProps,d=e.elementType===l?d:rs(l,d),k_(t,e),e.tag=1,Fi(l)?(t=!0,ey(e)):t=!1,Lh(e,r),RP(e,l,d),Cw(e,l,d,r),kw(null,e,l,!0,t,r);case 19:return lk(t,e,r);case 22:return ik(t,e,r)}throw Error(at(156,e.tag))};function Tk(t,e){return KA(t,e)}function jB(t,e,r,l){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function So(t,e,r,l){return new jB(t,e,r,l)}function lb(t){return t=t.prototype,!(!t||!t.isReactComponent)}function UB(t){if(typeof t=="function")return lb(t)?1:0;if(t!=null){if(t=t.$$typeof,t===C1)return 11;if(t===A1)return 14}return 2}function Nl(t,e){var r=t.alternate;return r===null?(r=So(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function D_(t,e,r,l,d,g){var w=2;if(l=t,typeof t=="function")lb(t)&&(w=1);else if(typeof t=="string")w=5;else e:switch(t){case _h:return Jc(r.children,d,g,e);case I1:w=8,d|=8;break;case J0:return t=So(12,r,e,d|2),t.elementType=J0,t.lanes=g,t;case Y0:return t=So(13,r,e,d),t.elementType=Y0,t.lanes=g,t;case Q0:return t=So(19,r,e,d),t.elementType=Q0,t.lanes=g,t;case DA:return Hy(r,d,g,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case MA:w=10;break e;case RA:w=9;break e;case C1:w=11;break e;case A1:w=14;break e;case vl:w=16,l=null;break e}throw Error(at(130,t==null?t:typeof t,""))}return e=So(w,r,e,d),e.elementType=t,e.type=l,e.lanes=g,e}function Jc(t,e,r,l){return t=So(7,t,l,e),t.lanes=r,t}function Hy(t,e,r,l){return t=So(22,t,l,e),t.elementType=DA,t.lanes=r,t.stateNode={isHidden:!1},t}function E0(t,e,r){return t=So(6,t,null,e),t.lanes=r,t}function T0(t,e,r){return e=So(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function VB(t,e,r,l,d){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=i0(0),this.expirationTimes=i0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=i0(0),this.identifierPrefix=l,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function cb(t,e,r,l,d,g,w,I,a){return t=new VB(t,e,r,I,a),e===1?(e=1,g===!0&&(e|=8)):e=0,g=So(3,null,null,e),t.current=g,g.stateNode=t,g.memoizedState={element:l,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},q1(g),t}function $B(t,e,r){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:gh,key:l==null?null:""+l,children:t,containerInfo:e,implementation:r}}function Sk(t){if(!t)return ql;t=t._reactInternals;e:{if(du(t)!==t||t.tag!==1)throw Error(at(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Fi(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(at(171))}if(t.tag===1){var r=t.type;if(Fi(r))return TP(t,r,e)}return e}function Ik(t,e,r,l,d,g,w,I,a){return t=cb(r,l,!0,t,d,g,w,I,a),t.context=Sk(null),r=t.current,l=xi(),d=Fl(r),g=va(l,d),g.callback=e??null,Ol(r,g,d),t.current.lanes=d,lm(t,d,l),Ni(t,l),t}function Zy(t,e,r,l){var d=e.current,g=xi(),w=Fl(d);return r=Sk(r),e.context===null?e.context=r:e.pendingContext=r,e=va(g,w),e.payload={element:t},l=l===void 0?null:l,l!==null&&(e.callback=l),t=Ol(d,e,w),t!==null&&(cs(t,d,w,g),C_(t,d,w)),w}function fy(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function $I(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function ub(t,e){$I(t,e),(t=t.alternate)&&$I(t,e)}function GB(){return null}var Ck=typeof reportError=="function"?reportError:function(t){console.error(t)};function hb(t){this._internalRoot=t}Xy.prototype.render=hb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(at(409));Zy(t,e,null,null)};Xy.prototype.unmount=hb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;iu(function(){Zy(null,t,null,null)}),e[Ea]=null}};function Xy(t){this._internalRoot=t}Xy.prototype.unstable_scheduleHydration=function(t){if(t){var e=rP();t={blockedOn:null,target:t,priority:e};for(var r=0;r<bl.length&&e!==0&&e<bl[r].priority;r++);bl.splice(r,0,t),r===0&&oP(t)}};function db(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Ky(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function GI(){}function WB(t,e,r,l,d){if(d){if(typeof l=="function"){var g=l;l=function(){var k=fy(w);g.call(k)}}var w=Ik(e,l,t,0,null,!1,!1,"",GI);return t._reactRootContainer=w,t[Ea]=w.current,Np(t.nodeType===8?t.parentNode:t),iu(),w}for(;d=t.lastChild;)t.removeChild(d);if(typeof l=="function"){var I=l;l=function(){var k=fy(a);I.call(k)}}var a=cb(t,0,!1,null,null,!1,!1,"",GI);return t._reactRootContainer=a,t[Ea]=a.current,Np(t.nodeType===8?t.parentNode:t),iu(function(){Zy(e,a,r,l)}),a}function Jy(t,e,r,l,d){var g=r._reactRootContainer;if(g){var w=g;if(typeof d=="function"){var I=d;d=function(){var a=fy(w);I.call(a)}}Zy(e,w,t,d)}else w=WB(r,e,t,d,l);return fy(w)}tP=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=up(e.pendingLanes);r!==0&&(M1(e,r|1),Ni(e,_r()),!(dn&6)&&(Hh=_r()+500,Kl()))}break;case 13:iu(function(){var l=Ta(t,1);if(l!==null){var d=xi();cs(l,t,1,d)}}),ub(t,1)}};R1=function(t){if(t.tag===13){var e=Ta(t,134217728);if(e!==null){var r=xi();cs(e,t,134217728,r)}ub(t,134217728)}};nP=function(t){if(t.tag===13){var e=Fl(t),r=Ta(t,e);if(r!==null){var l=xi();cs(r,t,e,l)}ub(t,e)}};rP=function(){return kn};iP=function(t,e){var r=kn;try{return kn=t,e()}finally{kn=r}};cw=function(t,e,r){switch(e){case"input":if(nw(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var l=r[e];if(l!==t&&l.form===t.form){var d=Uy(l);if(!d)throw Error(at(90));zA(l),nw(l,d)}}}break;case"textarea":BA(t,r);break;case"select":e=r.value,e!=null&&kh(t,!!r.multiple,e,!1)}};GA=ob;WA=iu;var qB={usingClientEntryPoint:!1,Events:[um,wh,Uy,VA,$A,ob]},op={findFiberByHostInstance:qc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},HB={bundleType:op.bundleType,version:op.version,rendererPackageName:op.rendererPackageName,rendererConfig:op.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ka.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=ZA(t),t===null?null:t.stateNode},findFiberByHostInstance:op.findFiberByHostInstance||GB,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var p_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!p_.isDisabled&&p_.supportsFiber)try{By=p_.inject(HB),Rs=p_}catch{}}so.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qB;so.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!db(e))throw Error(at(200));return $B(t,e,null,r)};so.createRoot=function(t,e){if(!db(t))throw Error(at(299));var r=!1,l="",d=Ck;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(l=e.identifierPrefix),e.onRecoverableError!==void 0&&(d=e.onRecoverableError)),e=cb(t,1,!1,null,null,r,!1,l,d),t[Ea]=e.current,Np(t.nodeType===8?t.parentNode:t),new hb(e)};so.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(at(188)):(t=Object.keys(t).join(","),Error(at(268,t)));return t=ZA(e),t=t===null?null:t.stateNode,t};so.flushSync=function(t){return iu(t)};so.hydrate=function(t,e,r){if(!Ky(e))throw Error(at(200));return Jy(null,t,e,!0,r)};so.hydrateRoot=function(t,e,r){if(!db(t))throw Error(at(405));var l=r!=null&&r.hydratedSources||null,d=!1,g="",w=Ck;if(r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(g=r.identifierPrefix),r.onRecoverableError!==void 0&&(w=r.onRecoverableError)),e=Ik(e,null,t,1,r??null,d,!1,g,w),t[Ea]=e.current,Np(t),l)for(t=0;t<l.length;t++)r=l[t],d=r._getVersion,d=d(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,d]:e.mutableSourceEagerHydrationData.push(r,d);return new Xy(e)};so.render=function(t,e,r){if(!Ky(e))throw Error(at(200));return Jy(null,t,e,!1,r)};so.unmountComponentAtNode=function(t){if(!Ky(t))throw Error(at(40));return t._reactRootContainer?(iu(function(){Jy(null,null,t,!1,function(){t._reactRootContainer=null,t[Ea]=null})}),!0):!1};so.unstable_batchedUpdates=ob;so.unstable_renderSubtreeIntoContainer=function(t,e,r,l){if(!Ky(r))throw Error(at(200));if(t==null||t._reactInternals===void 0)throw Error(at(38));return Jy(t,e,r,!1,l)};so.version="18.2.0-next-9e3b772b8-20220608";function Ak(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Ak)}catch(t){console.error(t)}}Ak(),IA.exports=so;var ZB=IA.exports,WI=ZB;X0.createRoot=WI.createRoot,X0.hydrateRoot=WI.hydrateRoot;/**
 * @remix-run/router v1.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Zp(){return Zp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},Zp.apply(this,arguments)}var kl;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(kl||(kl={}));const qI="popstate";function XB(t){t===void 0&&(t={});function e(l,d){let{pathname:g,search:w,hash:I}=l.location;return Vw("",{pathname:g,search:w,hash:I},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function r(l,d){return typeof d=="string"?d:py(d)}return JB(e,r,null,t)}function ar(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function fb(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function KB(){return Math.random().toString(36).substr(2,8)}function HI(t,e){return{usr:t.state,key:t.key,idx:e}}function Vw(t,e,r,l){return r===void 0&&(r=null),Zp({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?cd(e):e,{state:r,key:e&&e.key||l||KB()})}function py(t){let{pathname:e="/",search:r="",hash:l=""}=t;return r&&r!=="?"&&(e+=r.charAt(0)==="?"?r:"?"+r),l&&l!=="#"&&(e+=l.charAt(0)==="#"?l:"#"+l),e}function cd(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substr(r),t=t.substr(0,r));let l=t.indexOf("?");l>=0&&(e.search=t.substr(l),t=t.substr(0,l)),t&&(e.pathname=t)}return e}function JB(t,e,r,l){l===void 0&&(l={});let{window:d=document.defaultView,v5Compat:g=!1}=l,w=d.history,I=kl.Pop,a=null,k=O();k==null&&(k=0,w.replaceState(Zp({},w.state,{idx:k}),""));function O(){return(w.state||{idx:null}).idx}function V(){I=kl.Pop;let we=O(),te=we==null?null:we-k;k=we,a&&a({action:I,location:le.location,delta:te})}function G(we,te){I=kl.Push;let J=Vw(le.location,we,te);r&&r(J,we),k=O()+1;let ce=HI(J,k),Te=le.createHref(J);try{w.pushState(ce,"",Te)}catch(Ne){if(Ne instanceof DOMException&&Ne.name==="DataCloneError")throw Ne;d.location.assign(Te)}g&&a&&a({action:I,location:le.location,delta:1})}function X(we,te){I=kl.Replace;let J=Vw(le.location,we,te);r&&r(J,we),k=O();let ce=HI(J,k),Te=le.createHref(J);w.replaceState(ce,"",Te),g&&a&&a({action:I,location:le.location,delta:0})}function oe(we){let te=d.location.origin!=="null"?d.location.origin:d.location.href,J=typeof we=="string"?we:py(we);return ar(te,"No window.location.(origin|href) available to create URL for href: "+J),new URL(J,te)}let le={get action(){return I},get location(){return t(d,w)},listen(we){if(a)throw new Error("A history only accepts one active listener");return d.addEventListener(qI,V),a=we,()=>{d.removeEventListener(qI,V),a=null}},createHref(we){return e(d,we)},createURL:oe,encodeLocation(we){let te=oe(we);return{pathname:te.pathname,search:te.search,hash:te.hash}},push:G,replace:X,go(we){return w.go(we)}};return le}var ZI;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(ZI||(ZI={}));function YB(t,e,r){r===void 0&&(r="/");let l=typeof e=="string"?cd(e):e,d=Xp(l.pathname||"/",r);if(d==null)return null;let g=Pk(t);QB(g);let w=null;for(let I=0;w==null&&I<g.length;++I)w=lF(g[I],uF(d));return w}function Pk(t,e,r,l){e===void 0&&(e=[]),r===void 0&&(r=[]),l===void 0&&(l="");let d=(g,w,I)=>{let a={relativePath:I===void 0?g.path||"":I,caseSensitive:g.caseSensitive===!0,childrenIndex:w,route:g};a.relativePath.startsWith("/")&&(ar(a.relativePath.startsWith(l),'Absolute route path "'+a.relativePath+'" nested under path '+('"'+l+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),a.relativePath=a.relativePath.slice(l.length));let k=jl([l,a.relativePath]),O=r.concat(a);g.children&&g.children.length>0&&(ar(g.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+k+'".')),Pk(g.children,e,O,k)),!(g.path==null&&!g.index)&&e.push({path:k,score:sF(k,g.index),routesMeta:O})};return t.forEach((g,w)=>{var I;if(g.path===""||!((I=g.path)!=null&&I.includes("?")))d(g,w);else for(let a of kk(g.path))d(g,w,a)}),e}function kk(t){let e=t.split("/");if(e.length===0)return[];let[r,...l]=e,d=r.endsWith("?"),g=r.replace(/\?$/,"");if(l.length===0)return d?[g,""]:[g];let w=kk(l.join("/")),I=[];return I.push(...w.map(a=>a===""?g:[g,a].join("/"))),d&&I.push(...w),I.map(a=>t.startsWith("/")&&a===""?"/":a)}function QB(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:aF(e.routesMeta.map(l=>l.childrenIndex),r.routesMeta.map(l=>l.childrenIndex)))}const eF=/^:\w+$/,tF=3,nF=2,rF=1,iF=10,oF=-2,XI=t=>t==="*";function sF(t,e){let r=t.split("/"),l=r.length;return r.some(XI)&&(l+=oF),e&&(l+=nF),r.filter(d=>!XI(d)).reduce((d,g)=>d+(eF.test(g)?tF:g===""?rF:iF),l)}function aF(t,e){return t.length===e.length&&t.slice(0,-1).every((l,d)=>l===e[d])?t[t.length-1]-e[e.length-1]:0}function lF(t,e){let{routesMeta:r}=t,l={},d="/",g=[];for(let w=0;w<r.length;++w){let I=r[w],a=w===r.length-1,k=d==="/"?e:e.slice(d.length)||"/",O=$w({path:I.relativePath,caseSensitive:I.caseSensitive,end:a},k);if(!O)return null;Object.assign(l,O.params);let V=I.route;g.push({params:l,pathname:jl([d,O.pathname]),pathnameBase:pF(jl([d,O.pathnameBase])),route:V}),O.pathnameBase!=="/"&&(d=jl([d,O.pathnameBase]))}return g}function $w(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,l]=cF(t.path,t.caseSensitive,t.end),d=e.match(r);if(!d)return null;let g=d[0],w=g.replace(/(.)\/+$/,"$1"),I=d.slice(1);return{params:l.reduce((k,O,V)=>{if(O==="*"){let G=I[V]||"";w=g.slice(0,g.length-G.length).replace(/(.)\/+$/,"$1")}return k[O]=hF(I[V]||"",O),k},{}),pathname:g,pathnameBase:w,pattern:t}}function cF(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!0),fb(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let l=[],d="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(w,I)=>(l.push(I),"/([^\\/]+)"));return t.endsWith("*")?(l.push("*"),d+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?d+="\\/*$":t!==""&&t!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,e?void 0:"i"),l]}function uF(t){try{return decodeURI(t)}catch(e){return fb(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function hF(t,e){try{return decodeURIComponent(t)}catch(r){return fb(!1,'The value for the URL param "'+e+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+r+").")),t}}function Xp(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,l=t.charAt(r);return l&&l!=="/"?null:t.slice(r)||"/"}function dF(t,e){e===void 0&&(e="/");let{pathname:r,search:l="",hash:d=""}=typeof t=="string"?cd(t):t;return{pathname:r?r.startsWith("/")?r:fF(r,e):e,search:mF(l),hash:gF(d)}}function fF(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(d=>{d===".."?r.length>1&&r.pop():d!=="."&&r.push(d)}),r.length>1?r.join("/"):"/"}function S0(t,e,r,l){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(l)+"].  Please separate it out to the ")+("`to."+r+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function pb(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function mb(t,e,r,l){l===void 0&&(l=!1);let d;typeof t=="string"?d=cd(t):(d=Zp({},t),ar(!d.pathname||!d.pathname.includes("?"),S0("?","pathname","search",d)),ar(!d.pathname||!d.pathname.includes("#"),S0("#","pathname","hash",d)),ar(!d.search||!d.search.includes("#"),S0("#","search","hash",d)));let g=t===""||d.pathname==="",w=g?"/":d.pathname,I;if(l||w==null)I=r;else{let V=e.length-1;if(w.startsWith("..")){let G=w.split("/");for(;G[0]==="..";)G.shift(),V-=1;d.pathname=G.join("/")}I=V>=0?e[V]:"/"}let a=dF(d,I),k=w&&w!=="/"&&w.endsWith("/"),O=(g||w===".")&&r.endsWith("/");return!a.pathname.endsWith("/")&&(k||O)&&(a.pathname+="/"),a}const jl=t=>t.join("/").replace(/\/\/+/g,"/"),pF=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),mF=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,gF=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function _F(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const Mk=["post","put","patch","delete"];new Set(Mk);const yF=["get",...Mk];new Set(yF);/**
 * React Router v6.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function my(){return my=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},my.apply(this,arguments)}const Yy=re.createContext(null),Rk=re.createContext(null),fu=re.createContext(null),Qy=re.createContext(null),Ma=re.createContext({outlet:null,matches:[],isDataRoute:!1}),Dk=re.createContext(null);function vF(t,e){let{relative:r}=e===void 0?{}:e;ud()||ar(!1);let{basename:l,navigator:d}=re.useContext(fu),{hash:g,pathname:w,search:I}=ev(t,{relative:r}),a=w;return l!=="/"&&(a=w==="/"?l:jl([l,w])),d.createHref({pathname:a,search:I,hash:g})}function ud(){return re.useContext(Qy)!=null}function pu(){return ud()||ar(!1),re.useContext(Qy).location}function Lk(t){re.useContext(fu).static||re.useLayoutEffect(t)}function Ra(){let{isDataRoute:t}=re.useContext(Ma);return t?RF():xF()}function xF(){ud()||ar(!1);let t=re.useContext(Yy),{basename:e,navigator:r}=re.useContext(fu),{matches:l}=re.useContext(Ma),{pathname:d}=pu(),g=JSON.stringify(pb(l).map(a=>a.pathnameBase)),w=re.useRef(!1);return Lk(()=>{w.current=!0}),re.useCallback(function(a,k){if(k===void 0&&(k={}),!w.current)return;if(typeof a=="number"){r.go(a);return}let O=mb(a,JSON.parse(g),d,k.relative==="path");t==null&&e!=="/"&&(O.pathname=O.pathname==="/"?e:jl([e,O.pathname])),(k.replace?r.replace:r.push)(O,k.state,k)},[e,r,g,d,t])}function zk(){let{matches:t}=re.useContext(Ma),e=t[t.length-1];return e?e.params:{}}function ev(t,e){let{relative:r}=e===void 0?{}:e,{matches:l}=re.useContext(Ma),{pathname:d}=pu(),g=JSON.stringify(pb(l).map(w=>w.pathnameBase));return re.useMemo(()=>mb(t,JSON.parse(g),d,r==="path"),[t,g,d,r])}function wF(t,e){return bF(t,e)}function bF(t,e,r){ud()||ar(!1);let{navigator:l}=re.useContext(fu),{matches:d}=re.useContext(Ma),g=d[d.length-1],w=g?g.params:{};g&&g.pathname;let I=g?g.pathnameBase:"/";g&&g.route;let a=pu(),k;if(e){var O;let le=typeof e=="string"?cd(e):e;I==="/"||(O=le.pathname)!=null&&O.startsWith(I)||ar(!1),k=le}else k=a;let V=k.pathname||"/",G=I==="/"?V:V.slice(I.length)||"/",X=YB(t,{pathname:G}),oe=CF(X&&X.map(le=>Object.assign({},le,{params:Object.assign({},w,le.params),pathname:jl([I,l.encodeLocation?l.encodeLocation(le.pathname).pathname:le.pathname]),pathnameBase:le.pathnameBase==="/"?I:jl([I,l.encodeLocation?l.encodeLocation(le.pathnameBase).pathname:le.pathnameBase])})),d,r);return e&&oe?re.createElement(Qy.Provider,{value:{location:my({pathname:"/",search:"",hash:"",state:null,key:"default"},k),navigationType:kl.Pop}},oe):oe}function EF(){let t=MF(),e=_F(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return re.createElement(re.Fragment,null,re.createElement("h2",null,"Unexpected Application Error!"),re.createElement("h3",{style:{fontStyle:"italic"}},e),r?re.createElement("pre",{style:d},r):null,null)}const TF=re.createElement(EF,null);class SF extends re.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,r){return r.location!==e.location||r.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error||r.error,location:r.location,revalidation:e.revalidation||r.revalidation}}componentDidCatch(e,r){console.error("React Router caught the following error during render",e,r)}render(){return this.state.error?re.createElement(Ma.Provider,{value:this.props.routeContext},re.createElement(Dk.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function IF(t){let{routeContext:e,match:r,children:l}=t,d=re.useContext(Yy);return d&&d.static&&d.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=r.route.id),re.createElement(Ma.Provider,{value:e},l)}function CF(t,e,r){var l;if(e===void 0&&(e=[]),r===void 0&&(r=null),t==null){var d;if((d=r)!=null&&d.errors)t=r.matches;else return null}let g=t,w=(l=r)==null?void 0:l.errors;if(w!=null){let I=g.findIndex(a=>a.route.id&&(w==null?void 0:w[a.route.id]));I>=0||ar(!1),g=g.slice(0,Math.min(g.length,I+1))}return g.reduceRight((I,a,k)=>{let O=a.route.id?w==null?void 0:w[a.route.id]:null,V=null;r&&(V=a.route.errorElement||TF);let G=e.concat(g.slice(0,k+1)),X=()=>{let oe;return O?oe=V:a.route.Component?oe=re.createElement(a.route.Component,null):a.route.element?oe=a.route.element:oe=I,re.createElement(IF,{match:a,routeContext:{outlet:I,matches:G,isDataRoute:r!=null},children:oe})};return r&&(a.route.ErrorBoundary||a.route.errorElement||k===0)?re.createElement(SF,{location:r.location,revalidation:r.revalidation,component:V,error:O,children:X(),routeContext:{outlet:null,matches:G,isDataRoute:!0}}):X()},null)}var Ok=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(Ok||{}),gy=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(gy||{});function AF(t){let e=re.useContext(Yy);return e||ar(!1),e}function PF(t){let e=re.useContext(Rk);return e||ar(!1),e}function kF(t){let e=re.useContext(Ma);return e||ar(!1),e}function Bk(t){let e=kF(),r=e.matches[e.matches.length-1];return r.route.id||ar(!1),r.route.id}function MF(){var t;let e=re.useContext(Dk),r=PF(gy.UseRouteError),l=Bk(gy.UseRouteError);return e||((t=r.errors)==null?void 0:t[l])}function RF(){let{router:t}=AF(Ok.UseNavigateStable),e=Bk(gy.UseNavigateStable),r=re.useRef(!1);return Lk(()=>{r.current=!0}),re.useCallback(function(d,g){g===void 0&&(g={}),r.current&&(typeof d=="number"?t.navigate(d):t.navigate(d,my({fromRouteId:e},g)))},[t,e])}function hd(t){let{to:e,replace:r,state:l,relative:d}=t;ud()||ar(!1);let{matches:g}=re.useContext(Ma),{pathname:w}=pu(),I=Ra(),a=mb(e,pb(g).map(O=>O.pathnameBase),w,d==="path"),k=JSON.stringify(a);return re.useEffect(()=>I(JSON.parse(k),{replace:r,state:l,relative:d}),[I,k,d,r,l]),null}function qn(t){ar(!1)}function DF(t){let{basename:e="/",children:r=null,location:l,navigationType:d=kl.Pop,navigator:g,static:w=!1}=t;ud()&&ar(!1);let I=e.replace(/^\/*/,"/"),a=re.useMemo(()=>({basename:I,navigator:g,static:w}),[I,g,w]);typeof l=="string"&&(l=cd(l));let{pathname:k="/",search:O="",hash:V="",state:G=null,key:X="default"}=l,oe=re.useMemo(()=>{let le=Xp(k,I);return le==null?null:{location:{pathname:le,search:O,hash:V,state:G,key:X},navigationType:d}},[I,k,O,V,G,X,d]);return oe==null?null:re.createElement(fu.Provider,{value:a},re.createElement(Qy.Provider,{children:r,value:oe}))}function dd(t){let{children:e,location:r}=t;return wF(Gw(e),r)}new Promise(()=>{});function Gw(t,e){e===void 0&&(e=[]);let r=[];return re.Children.forEach(t,(l,d)=>{if(!re.isValidElement(l))return;let g=[...e,d];if(l.type===re.Fragment){r.push.apply(r,Gw(l.props.children,g));return}l.type!==qn&&ar(!1),!l.props.index||!l.props.children||ar(!1);let w={id:l.props.id||g.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,loader:l.props.loader,action:l.props.action,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(w.children=Gw(l.props.children,g)),r.push(w)}),r}/**
 * React Router DOM v6.17.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _y(){return _y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},_y.apply(this,arguments)}function Fk(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}function LF(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function zF(t,e){return t.button===0&&(!e||e==="_self")&&!LF(t)}const OF=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],BF=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],FF=re.createContext({isTransitioning:!1}),NF="startTransition",KI=FO[NF];function jF(t){let{basename:e,children:r,future:l,window:d}=t,g=re.useRef();g.current==null&&(g.current=XB({window:d,v5Compat:!0}));let w=g.current,[I,a]=re.useState({action:w.action,location:w.location}),{v7_startTransition:k}=l||{},O=re.useCallback(V=>{k&&KI?KI(()=>a(V)):a(V)},[a,k]);return re.useLayoutEffect(()=>w.listen(O),[w,O]),re.createElement(DF,{basename:e,children:r,location:I.location,navigationType:I.action,navigator:w})}const UF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Fs=re.forwardRef(function(e,r){let{onClick:l,relative:d,reloadDocument:g,replace:w,state:I,target:a,to:k,preventScrollReset:O,unstable_viewTransition:V}=e,G=Fk(e,OF),{basename:X}=re.useContext(fu),oe,le=!1;if(typeof k=="string"&&VF.test(k)&&(oe=k,UF))try{let ce=new URL(window.location.href),Te=k.startsWith("//")?new URL(ce.protocol+k):new URL(k),Ne=Xp(Te.pathname,X);Te.origin===ce.origin&&Ne!=null?k=Ne+Te.search+Te.hash:le=!0}catch{}let we=vF(k,{relative:d}),te=GF(k,{replace:w,state:I,target:a,preventScrollReset:O,relative:d,unstable_viewTransition:V});function J(ce){l&&l(ce),ce.defaultPrevented||te(ce)}return re.createElement("a",_y({},G,{href:oe||we,onClick:le||g?l:J,ref:r,target:a}))}),m_=re.forwardRef(function(e,r){let{"aria-current":l="page",caseSensitive:d=!1,className:g="",end:w=!1,style:I,to:a,unstable_viewTransition:k,children:O}=e,V=Fk(e,BF),G=ev(a,{relative:V.relative}),X=pu(),oe=re.useContext(Rk),{navigator:le}=re.useContext(fu),we=oe!=null&&WF(G)&&k===!0,te=le.encodeLocation?le.encodeLocation(G).pathname:G.pathname,J=X.pathname,ce=oe&&oe.navigation&&oe.navigation.location?oe.navigation.location.pathname:null;d||(J=J.toLowerCase(),ce=ce?ce.toLowerCase():null,te=te.toLowerCase());let Te=J===te||!w&&J.startsWith(te)&&J.charAt(te.length)==="/",Ne=ce!=null&&(ce===te||!w&&ce.startsWith(te)&&ce.charAt(te.length)==="/"),Ge={isActive:Te,isPending:Ne,isTransitioning:we},Xe=Te?l:void 0,qe;typeof g=="function"?qe=g(Ge):qe=[g,Te?"active":null,Ne?"pending":null,we?"transitioning":null].filter(Boolean).join(" ");let vt=typeof I=="function"?I(Ge):I;return re.createElement(Fs,_y({},V,{"aria-current":Xe,className:qe,ref:r,style:vt,to:a,unstable_viewTransition:k}),typeof O=="function"?O(Ge):O)});var Ww;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Ww||(Ww={}));var JI;(function(t){t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(JI||(JI={}));function $F(t){let e=re.useContext(Yy);return e||ar(!1),e}function GF(t,e){let{target:r,replace:l,state:d,preventScrollReset:g,relative:w,unstable_viewTransition:I}=e===void 0?{}:e,a=Ra(),k=pu(),O=ev(t,{relative:w});return re.useCallback(V=>{if(zF(V,r)){V.preventDefault();let G=l!==void 0?l:py(k)===py(O);a(t,{replace:G,state:d,preventScrollReset:g,relative:w,unstable_viewTransition:I})}},[k,a,O,l,d,r,t,g,w,I])}function WF(t,e){e===void 0&&(e={});let r=re.useContext(FF);r==null&&ar(!1);let{basename:l}=$F(Ww.useViewTransitionState),d=ev(t,{relative:e.relative});if(!r.isTransitioning)return!1;let g=Xp(r.currentLocation.pathname,l)||r.currentLocation.pathname,w=Xp(r.nextLocation.pathname,l)||r.nextLocation.pathname;return $w(d.pathname,w)!=null||$w(d.pathname,g)!=null}var Lr=(t=>(t.SHORTEST="shortest",t.RECOMMENDED="recommended",t.UNDEFINED="undefined",t))(Lr||{});const zr=re.createContext({user:{uid:"",email:"",displayName:""},setUser:()=>{},isLogged:!1,setIsLogged:()=>{},wantDetails:!1,setWantDetails:()=>{},defaultVehiclePlate:"",setDefaultVehiclePlate:()=>{},defaultPathwayType:Lr.UNDEFINED,setDefaultPathwayType:()=>{},wantPreferences:!1,setWantPreferences:()=>{}}),qF=({children:t})=>{const[e,r]=re.useState({uid:"",email:"",displayName:""}),[l,d]=re.useState(!1),[g,w]=re.useState(!1),[I,a]=re.useState(""),[k,O]=re.useState(Lr.UNDEFINED),[V,G]=re.useState(!1),X={user:e,setUser:r,isLogged:l,setIsLogged:d,wantDetails:g,setWantDetails:w,defaultVehiclePlate:I,setDefaultVehiclePlate:a,defaultPathwayType:k,setDefaultPathwayType:O,wantPreferences:V,setWantPreferences:G};return j.jsx(j.Fragment,{children:j.jsx(zr.Provider,{value:X,children:t})})},HF=(t={})=>{const[e,r]=re.useState(t);return re.useEffect(()=>{r(t)},[t]),{...e,formState:e,onInputChange:({target:g})=>{const{value:w,name:I}=g;r(a=>({...a,[I]:w}))},onResetForm:()=>{r(t)}}},mu=({formData:t,formFields:e,additionalFormLink:r,onSubmit:l,submitButtonLabel:d,validations:g,inputButtonsSpecification:w})=>{const{formState:I,onInputChange:a}=HF(t),[k,O]=re.useState(!1),[V,G]=re.useState({});re.useEffect(()=>{let le={};for(let we in g){const te=g[we],J=te(I[we]);J&&(le={...le,[we]:J})}G(le)},[I]);const X=le=>{le.preventDefault(),O(!0),!(Object.keys(V).length>0)&&l(I)},oe=le=>{a(le)};return j.jsx(j.Fragment,{children:j.jsxs("form",{onSubmit:X,children:[e.map(le=>j.jsxs("div",{className:"form-group",style:{marginBottom:"20px"},children:[j.jsx("label",{htmlFor:le.id,children:le.label}),le.type==="select"?j.jsx("select",{className:"form-control",id:le.id,name:le.id,value:I[le.id],onChange:oe,disabled:le.disabled||!1,children:le.options&&le.options.map(we=>j.jsx("option",{value:we,children:we},we))}):j.jsxs("div",{className:"input-group",children:[j.jsx("input",{className:"form-control",id:le.id,type:le.type,name:le.id,value:I[le.id],onChange:a,placeholder:le.placeholder||"",required:!0,disabled:le.disabled||!1}),w&&j.jsx("div",{className:"input-group-append",children:j.jsx("button",{className:"btn btn-outline-info",onClick:()=>w.onClick(le.id),children:j.jsx("i",{className:w.icon})})})]}),k&&V[le.id]?j.jsx("small",{className:"text-danger",children:V[le.id]}):null]},le.id)),j.jsxs("div",{className:"row d-flex align-items-center",style:{margin:"40px 2px"},children:[j.jsx("button",{type:"submit",className:"btn btn-primary col-6",children:d}),r&&j.jsxs("p",{className:"col-6 m-0",children:[r.name,j.jsx(Fs,{to:r.url,className:"text-nowrap",style:{marginLeft:"10px"},children:r.clickable})]})]})]})})};var YI={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nk=function(t){const e=[];let r=0;for(let l=0;l<t.length;l++){let d=t.charCodeAt(l);d<128?e[r++]=d:d<2048?(e[r++]=d>>6|192,e[r++]=d&63|128):(d&64512)===55296&&l+1<t.length&&(t.charCodeAt(l+1)&64512)===56320?(d=65536+((d&1023)<<10)+(t.charCodeAt(++l)&1023),e[r++]=d>>18|240,e[r++]=d>>12&63|128,e[r++]=d>>6&63|128,e[r++]=d&63|128):(e[r++]=d>>12|224,e[r++]=d>>6&63|128,e[r++]=d&63|128)}return e},ZF=function(t){const e=[];let r=0,l=0;for(;r<t.length;){const d=t[r++];if(d<128)e[l++]=String.fromCharCode(d);else if(d>191&&d<224){const g=t[r++];e[l++]=String.fromCharCode((d&31)<<6|g&63)}else if(d>239&&d<365){const g=t[r++],w=t[r++],I=t[r++],a=((d&7)<<18|(g&63)<<12|(w&63)<<6|I&63)-65536;e[l++]=String.fromCharCode(55296+(a>>10)),e[l++]=String.fromCharCode(56320+(a&1023))}else{const g=t[r++],w=t[r++];e[l++]=String.fromCharCode((d&15)<<12|(g&63)<<6|w&63)}}return e.join("")},jk={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,l=[];for(let d=0;d<t.length;d+=3){const g=t[d],w=d+1<t.length,I=w?t[d+1]:0,a=d+2<t.length,k=a?t[d+2]:0,O=g>>2,V=(g&3)<<4|I>>4;let G=(I&15)<<2|k>>6,X=k&63;a||(X=64,w||(G=64)),l.push(r[O],r[V],r[G],r[X])}return l.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(Nk(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):ZF(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const r=e?this.charToByteMapWebSafe_:this.charToByteMap_,l=[];for(let d=0;d<t.length;){const g=r[t.charAt(d++)],I=d<t.length?r[t.charAt(d)]:0;++d;const k=d<t.length?r[t.charAt(d)]:64;++d;const V=d<t.length?r[t.charAt(d)]:64;if(++d,g==null||I==null||k==null||V==null)throw new XF;const G=g<<2|I>>4;if(l.push(G),k!==64){const X=I<<4&240|k>>2;if(l.push(X),V!==64){const oe=k<<6&192|V;l.push(oe)}}}return l},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class XF extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const KF=function(t){const e=Nk(t);return jk.encodeByteArray(e,!0)},yy=function(t){return KF(t).replace(/\./g,"")},Uk=function(t){try{return jk.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JF(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YF=()=>JF().__FIREBASE_DEFAULTS__,QF=()=>{if(typeof process>"u"||typeof YI>"u")return;const t=YI.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},eN=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Uk(t[1]);return e&&JSON.parse(e)},gb=()=>{try{return YF()||QF()||eN()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},Vk=t=>{var e,r;return(r=(e=gb())===null||e===void 0?void 0:e.emulatorHosts)===null||r===void 0?void 0:r[t]},tN=t=>{const e=Vk(t);if(!e)return;const r=e.lastIndexOf(":");if(r<=0||r+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const l=parseInt(e.substring(r+1),10);return e[0]==="["?[e.substring(1,r-1),l]:[e.substring(0,r),l]},$k=()=>{var t;return(t=gb())===null||t===void 0?void 0:t.config},Gk=t=>{var e;return(e=gb())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,r)=>{this.resolve=e,this.reject=r})}wrapCallback(e){return(r,l)=>{r?this.reject(r):this.resolve(l),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(r):e(r,l))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rN(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r={alg:"none",type:"JWT"},l=e||"demo-project",d=t.iat||0,g=t.sub||t.user_id;if(!g)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const w=Object.assign({iss:`https://securetoken.google.com/${l}`,aud:l,iat:d,exp:d+3600,auth_time:d,sub:g,user_id:g,firebase:{sign_in_provider:"custom",identities:{}}},t);return[yy(JSON.stringify(r)),yy(JSON.stringify(w)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fi(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function iN(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fi())}function oN(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function sN(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function aN(){const t=fi();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function lN(){try{return typeof indexedDB=="object"}catch{return!1}}function cN(){return new Promise((t,e)=>{try{let r=!0;const l="validate-browser-context-for-indexeddb-analytics-module",d=self.indexedDB.open(l);d.onsuccess=()=>{d.result.close(),r||self.indexedDB.deleteDatabase(l),t(!0)},d.onupgradeneeded=()=>{r=!1},d.onerror=()=>{var g;e(((g=d.error)===null||g===void 0?void 0:g.message)||"")}}catch(r){e(r)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uN="FirebaseError";class Da extends Error{constructor(e,r,l){super(r),this.code=e,this.customData=l,this.name=uN,Object.setPrototypeOf(this,Da.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,dm.prototype.create)}}class dm{constructor(e,r,l){this.service=e,this.serviceName=r,this.errors=l}create(e,...r){const l=r[0]||{},d=`${this.service}/${e}`,g=this.errors[e],w=g?hN(g,l):"Error",I=`${this.serviceName}: ${w} (${d}).`;return new Da(d,I,l)}}function hN(t,e){return t.replace(dN,(r,l)=>{const d=e[l];return d!=null?String(d):`<${l}?>`})}const dN=/\{\$([^}]+)}/g;function fN(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function vy(t,e){if(t===e)return!0;const r=Object.keys(t),l=Object.keys(e);for(const d of r){if(!l.includes(d))return!1;const g=t[d],w=e[d];if(QI(g)&&QI(w)){if(!vy(g,w))return!1}else if(g!==w)return!1}for(const d of l)if(!r.includes(d))return!1;return!0}function QI(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fm(t){const e=[];for(const[r,l]of Object.entries(t))Array.isArray(l)?l.forEach(d=>{e.push(encodeURIComponent(r)+"="+encodeURIComponent(d))}):e.push(encodeURIComponent(r)+"="+encodeURIComponent(l));return e.length?"&"+e.join("&"):""}function dp(t){const e={};return t.replace(/^\?/,"").split("&").forEach(l=>{if(l){const[d,g]=l.split("=");e[decodeURIComponent(d)]=decodeURIComponent(g)}}),e}function fp(t){const e=t.indexOf("?");if(!e)return"";const r=t.indexOf("#",e);return t.substring(e,r>0?r:void 0)}function pN(t,e){const r=new mN(t,e);return r.subscribe.bind(r)}class mN{constructor(e,r){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=r,this.task.then(()=>{e(this)}).catch(l=>{this.error(l)})}next(e){this.forEachObserver(r=>{r.next(e)})}error(e){this.forEachObserver(r=>{r.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,r,l){let d;if(e===void 0&&r===void 0&&l===void 0)throw new Error("Missing Observer.");gN(e,["next","error","complete"])?d=e:d={next:e,error:r,complete:l},d.next===void 0&&(d.next=I0),d.error===void 0&&(d.error=I0),d.complete===void 0&&(d.complete=I0);const g=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?d.error(this.finalError):d.complete()}catch{}}),this.observers.push(d),g}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let r=0;r<this.observers.length;r++)this.sendOne(r,e)}sendOne(e,r){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{r(this.observers[e])}catch(l){typeof console<"u"&&console.error&&console.error(l)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gN(t,e){if(typeof t!="object"||t===null)return!1;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}function I0(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pi(t){return t&&t._delegate?t._delegate:t}class ou{constructor(e,r,l){this.name=e,this.instanceFactory=r,this.type=l,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wc="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _N{constructor(e,r){this.name=e,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const r=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(r)){const l=new nN;if(this.instancesDeferred.set(r,l),this.isInitialized(r)||this.shouldAutoInitialize())try{const d=this.getOrInitializeService({instanceIdentifier:r});d&&l.resolve(d)}catch{}}return this.instancesDeferred.get(r).promise}getImmediate(e){var r;const l=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),d=(r=e==null?void 0:e.optional)!==null&&r!==void 0?r:!1;if(this.isInitialized(l)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:l})}catch(g){if(d)return null;throw g}else{if(d)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(vN(e))try{this.getOrInitializeService({instanceIdentifier:Wc})}catch{}for(const[r,l]of this.instancesDeferred.entries()){const d=this.normalizeInstanceIdentifier(r);try{const g=this.getOrInitializeService({instanceIdentifier:d});l.resolve(g)}catch{}}}}clearInstance(e=Wc){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(r=>"INTERNAL"in r).map(r=>r.INTERNAL.delete()),...e.filter(r=>"_delete"in r).map(r=>r._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Wc){return this.instances.has(e)}getOptions(e=Wc){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:r={}}=e,l=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(l))throw Error(`${this.name}(${l}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const d=this.getOrInitializeService({instanceIdentifier:l,options:r});for(const[g,w]of this.instancesDeferred.entries()){const I=this.normalizeInstanceIdentifier(g);l===I&&w.resolve(d)}return d}onInit(e,r){var l;const d=this.normalizeInstanceIdentifier(r),g=(l=this.onInitCallbacks.get(d))!==null&&l!==void 0?l:new Set;g.add(e),this.onInitCallbacks.set(d,g);const w=this.instances.get(d);return w&&e(w,d),()=>{g.delete(e)}}invokeOnInitCallbacks(e,r){const l=this.onInitCallbacks.get(r);if(l)for(const d of l)try{d(e,r)}catch{}}getOrInitializeService({instanceIdentifier:e,options:r={}}){let l=this.instances.get(e);if(!l&&this.component&&(l=this.component.instanceFactory(this.container,{instanceIdentifier:yN(e),options:r}),this.instances.set(e,l),this.instancesOptions.set(e,r),this.invokeOnInitCallbacks(l,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,l)}catch{}return l||null}normalizeInstanceIdentifier(e=Wc){return this.component?this.component.multipleInstances?e:Wc:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function yN(t){return t===Wc?void 0:t}function vN(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xN{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const r=this.getProvider(e.name);if(r.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);r.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const r=new _N(e,this);return this.providers.set(e,r),r}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var An;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(An||(An={}));const wN={debug:An.DEBUG,verbose:An.VERBOSE,info:An.INFO,warn:An.WARN,error:An.ERROR,silent:An.SILENT},bN=An.INFO,EN={[An.DEBUG]:"log",[An.VERBOSE]:"log",[An.INFO]:"info",[An.WARN]:"warn",[An.ERROR]:"error"},TN=(t,e,...r)=>{if(e<t.logLevel)return;const l=new Date().toISOString(),d=EN[e];if(d)console[d](`[${l}]  ${t.name}:`,...r);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class _b{constructor(e){this.name=e,this._logLevel=bN,this._logHandler=TN,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in An))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?wN[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,An.DEBUG,...e),this._logHandler(this,An.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,An.VERBOSE,...e),this._logHandler(this,An.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,An.INFO,...e),this._logHandler(this,An.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,An.WARN,...e),this._logHandler(this,An.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,An.ERROR,...e),this._logHandler(this,An.ERROR,...e)}}const SN=(t,e)=>e.some(r=>t instanceof r);let eC,tC;function IN(){return eC||(eC=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function CN(){return tC||(tC=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Wk=new WeakMap,qw=new WeakMap,qk=new WeakMap,C0=new WeakMap,yb=new WeakMap;function AN(t){const e=new Promise((r,l)=>{const d=()=>{t.removeEventListener("success",g),t.removeEventListener("error",w)},g=()=>{r(Ul(t.result)),d()},w=()=>{l(t.error),d()};t.addEventListener("success",g),t.addEventListener("error",w)});return e.then(r=>{r instanceof IDBCursor&&Wk.set(r,t)}).catch(()=>{}),yb.set(e,t),e}function PN(t){if(qw.has(t))return;const e=new Promise((r,l)=>{const d=()=>{t.removeEventListener("complete",g),t.removeEventListener("error",w),t.removeEventListener("abort",w)},g=()=>{r(),d()},w=()=>{l(t.error||new DOMException("AbortError","AbortError")),d()};t.addEventListener("complete",g),t.addEventListener("error",w),t.addEventListener("abort",w)});qw.set(t,e)}let Hw={get(t,e,r){if(t instanceof IDBTransaction){if(e==="done")return qw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||qk.get(t);if(e==="store")return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return Ul(t[e])},set(t,e,r){return t[e]=r,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function kN(t){Hw=t(Hw)}function MN(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...r){const l=t.call(A0(this),e,...r);return qk.set(l,e.sort?e.sort():[e]),Ul(l)}:CN().includes(t)?function(...e){return t.apply(A0(this),e),Ul(Wk.get(this))}:function(...e){return Ul(t.apply(A0(this),e))}}function RN(t){return typeof t=="function"?MN(t):(t instanceof IDBTransaction&&PN(t),SN(t,IN())?new Proxy(t,Hw):t)}function Ul(t){if(t instanceof IDBRequest)return AN(t);if(C0.has(t))return C0.get(t);const e=RN(t);return e!==t&&(C0.set(t,e),yb.set(e,t)),e}const A0=t=>yb.get(t);function DN(t,e,{blocked:r,upgrade:l,blocking:d,terminated:g}={}){const w=indexedDB.open(t,e),I=Ul(w);return l&&w.addEventListener("upgradeneeded",a=>{l(Ul(w.result),a.oldVersion,a.newVersion,Ul(w.transaction),a)}),r&&w.addEventListener("blocked",a=>r(a.oldVersion,a.newVersion,a)),I.then(a=>{g&&a.addEventListener("close",()=>g()),d&&a.addEventListener("versionchange",k=>d(k.oldVersion,k.newVersion,k))}).catch(()=>{}),I}const LN=["get","getKey","getAll","getAllKeys","count"],zN=["put","add","delete","clear"],P0=new Map;function nC(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(P0.get(e))return P0.get(e);const r=e.replace(/FromIndex$/,""),l=e!==r,d=zN.includes(r);if(!(r in(l?IDBIndex:IDBObjectStore).prototype)||!(d||LN.includes(r)))return;const g=async function(w,...I){const a=this.transaction(w,d?"readwrite":"readonly");let k=a.store;return l&&(k=k.index(I.shift())),(await Promise.all([k[r](...I),d&&a.done]))[0]};return P0.set(e,g),g}kN(t=>({...t,get:(e,r,l)=>nC(e,r)||t.get(e,r,l),has:(e,r)=>!!nC(e,r)||t.has(e,r)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ON{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(r=>{if(BN(r)){const l=r.getImmediate();return`${l.library}/${l.version}`}else return null}).filter(r=>r).join(" ")}}function BN(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Zw="@firebase/app",rC="0.9.23";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const su=new _b("@firebase/app"),FN="@firebase/app-compat",NN="@firebase/analytics-compat",jN="@firebase/analytics",UN="@firebase/app-check-compat",VN="@firebase/app-check",$N="@firebase/auth",GN="@firebase/auth-compat",WN="@firebase/database",qN="@firebase/database-compat",HN="@firebase/functions",ZN="@firebase/functions-compat",XN="@firebase/installations",KN="@firebase/installations-compat",JN="@firebase/messaging",YN="@firebase/messaging-compat",QN="@firebase/performance",e4="@firebase/performance-compat",t4="@firebase/remote-config",n4="@firebase/remote-config-compat",r4="@firebase/storage",i4="@firebase/storage-compat",o4="@firebase/firestore",s4="@firebase/firestore-compat",a4="firebase",l4="10.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw="[DEFAULT]",c4={[Zw]:"fire-core",[FN]:"fire-core-compat",[jN]:"fire-analytics",[NN]:"fire-analytics-compat",[VN]:"fire-app-check",[UN]:"fire-app-check-compat",[$N]:"fire-auth",[GN]:"fire-auth-compat",[WN]:"fire-rtdb",[qN]:"fire-rtdb-compat",[HN]:"fire-fn",[ZN]:"fire-fn-compat",[XN]:"fire-iid",[KN]:"fire-iid-compat",[JN]:"fire-fcm",[YN]:"fire-fcm-compat",[QN]:"fire-perf",[e4]:"fire-perf-compat",[t4]:"fire-rc",[n4]:"fire-rc-compat",[r4]:"fire-gcs",[i4]:"fire-gcs-compat",[o4]:"fire-fst",[s4]:"fire-fst-compat","fire-js":"fire-js",[a4]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xy=new Map,Kw=new Map;function u4(t,e){try{t.container.addComponent(e)}catch(r){su.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,r)}}function Zh(t){const e=t.name;if(Kw.has(e))return su.debug(`There were multiple attempts to register component ${e}.`),!1;Kw.set(e,t);for(const r of xy.values())u4(r,t);return!0}function vb(t,e){const r=t.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),t.container.getProvider(e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h4={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},Vl=new dm("app","Firebase",h4);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d4{constructor(e,r,l){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=l,this.container.addComponent(new ou("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Vl.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fd=l4;function Hk(t,e={}){let r=t;typeof e!="object"&&(e={name:e});const l=Object.assign({name:Xw,automaticDataCollectionEnabled:!1},e),d=l.name;if(typeof d!="string"||!d)throw Vl.create("bad-app-name",{appName:String(d)});if(r||(r=$k()),!r)throw Vl.create("no-options");const g=xy.get(d);if(g){if(vy(r,g.options)&&vy(l,g.config))return g;throw Vl.create("duplicate-app",{appName:d})}const w=new xN(d);for(const a of Kw.values())w.addComponent(a);const I=new d4(r,l,w);return xy.set(d,I),I}function Zk(t=Xw){const e=xy.get(t);if(!e&&t===Xw&&$k())return Hk();if(!e)throw Vl.create("no-app",{appName:t});return e}function $l(t,e,r){var l;let d=(l=c4[t])!==null&&l!==void 0?l:t;r&&(d+=`-${r}`);const g=d.match(/\s|\//),w=e.match(/\s|\//);if(g||w){const I=[`Unable to register library "${d}" with version "${e}":`];g&&I.push(`library name "${d}" contains illegal characters (whitespace or "/")`),g&&w&&I.push("and"),w&&I.push(`version name "${e}" contains illegal characters (whitespace or "/")`),su.warn(I.join(" "));return}Zh(new ou(`${d}-version`,()=>({library:d,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f4="firebase-heartbeat-database",p4=1,Kp="firebase-heartbeat-store";let k0=null;function Xk(){return k0||(k0=DN(f4,p4,{upgrade:(t,e)=>{switch(e){case 0:t.createObjectStore(Kp)}}}).catch(t=>{throw Vl.create("idb-open",{originalErrorMessage:t.message})})),k0}async function m4(t){try{return await(await Xk()).transaction(Kp).objectStore(Kp).get(Kk(t))}catch(e){if(e instanceof Da)su.warn(e.message);else{const r=Vl.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});su.warn(r.message)}}}async function iC(t,e){try{const l=(await Xk()).transaction(Kp,"readwrite");await l.objectStore(Kp).put(e,Kk(t)),await l.done}catch(r){if(r instanceof Da)su.warn(r.message);else{const l=Vl.create("idb-set",{originalErrorMessage:r==null?void 0:r.message});su.warn(l.message)}}}function Kk(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g4=1024,_4=30*24*60*60*1e3;class y4{constructor(e){this.container=e,this._heartbeatsCache=null;const r=this.container.getProvider("app").getImmediate();this._storage=new x4(r),this._heartbeatsCachePromise=this._storage.read().then(l=>(this._heartbeatsCache=l,l))}async triggerHeartbeat(){var e;const l=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),d=oC();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!(this._heartbeatsCache.lastSentHeartbeatDate===d||this._heartbeatsCache.heartbeats.some(g=>g.date===d)))return this._heartbeatsCache.heartbeats.push({date:d,agent:l}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(g=>{const w=new Date(g.date).valueOf();return Date.now()-w<=_4}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const r=oC(),{heartbeatsToSend:l,unsentEntries:d}=v4(this._heartbeatsCache.heartbeats),g=yy(JSON.stringify({version:2,heartbeats:l}));return this._heartbeatsCache.lastSentHeartbeatDate=r,d.length>0?(this._heartbeatsCache.heartbeats=d,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),g}}function oC(){return new Date().toISOString().substring(0,10)}function v4(t,e=g4){const r=[];let l=t.slice();for(const d of t){const g=r.find(w=>w.agent===d.agent);if(g){if(g.dates.push(d.date),sC(r)>e){g.dates.pop();break}}else if(r.push({agent:d.agent,dates:[d.date]}),sC(r)>e){r.pop();break}l=l.slice(1)}return{heartbeatsToSend:r,unsentEntries:l}}class x4{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return lN()?cN().then(()=>!0).catch(()=>!1):!1}async read(){return await this._canUseIndexedDBPromise?await m4(this.app)||{heartbeats:[]}:{heartbeats:[]}}async overwrite(e){var r;if(await this._canUseIndexedDBPromise){const d=await this.read();return iC(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:d.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var r;if(await this._canUseIndexedDBPromise){const d=await this.read();return iC(this.app,{lastSentHeartbeatDate:(r=e.lastSentHeartbeatDate)!==null&&r!==void 0?r:d.lastSentHeartbeatDate,heartbeats:[...d.heartbeats,...e.heartbeats]})}else return}}function sC(t){return yy(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function w4(t){Zh(new ou("platform-logger",e=>new ON(e),"PRIVATE")),Zh(new ou("heartbeat",e=>new y4(e),"PRIVATE")),$l(Zw,rC,t),$l(Zw,rC,"esm2017"),$l("fire-js","")}w4("");function xb(t,e){var r={};for(var l in t)Object.prototype.hasOwnProperty.call(t,l)&&e.indexOf(l)<0&&(r[l]=t[l]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,l=Object.getOwnPropertySymbols(t);d<l.length;d++)e.indexOf(l[d])<0&&Object.prototype.propertyIsEnumerable.call(t,l[d])&&(r[l[d]]=t[l[d]]);return r}function Jk(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const b4=Jk,Yk=new dm("auth","Firebase",Jk());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wy=new _b("@firebase/auth");function E4(t,...e){wy.logLevel<=An.WARN&&wy.warn(`Auth (${fd}): ${t}`,...e)}function L_(t,...e){wy.logLevel<=An.ERROR&&wy.error(`Auth (${fd}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hs(t,...e){throw wb(t,...e)}function Ls(t,...e){return wb(t,...e)}function T4(t,e,r){const l=Object.assign(Object.assign({},b4()),{[e]:r});return new dm("auth","Firebase",l).create(e,{appName:t.name})}function wb(t,...e){if(typeof t!="string"){const r=e[0],l=[...e.slice(1)];return l[0]&&(l[0].appName=t.name),t._errorFactory.create(r,...l)}return Yk.create(t,...e)}function jt(t,e,...r){if(!t)throw wb(e,...r)}function _a(t){const e="INTERNAL ASSERTION FAILED: "+t;throw L_(e),new Error(e)}function Ia(t,e){t||_a(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function S4(){return aC()==="http:"||aC()==="https:"}function aC(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I4(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(S4()||oN()||"connection"in navigator)?navigator.onLine:!0}function C4(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(e,r){this.shortDelay=e,this.longDelay=r,Ia(r>e,"Short delay should be less than long delay!"),this.isMobile=iN()||sN()}get(){return I4()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(t,e){Ia(t.emulator,"Emulator should always be set here");const{url:r}=t.emulator;return e?`${r}${e.startsWith("/")?e.slice(1):e}`:r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qk{static initialize(e,r,l){this.fetchImpl=e,r&&(this.headersImpl=r),l&&(this.responseImpl=l)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;_a("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;_a("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;_a("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A4={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P4=new pm(3e4,6e4);function Jl(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function La(t,e,r,l,d={}){return eM(t,d,async()=>{let g={},w={};l&&(e==="GET"?w=l:g={body:JSON.stringify(l)});const I=fm(Object.assign({key:t.config.apiKey},w)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),Qk.fetch()(tM(t,t.config.apiHost,r,I),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},g))})}async function eM(t,e,r){t._canInitEmulator=!1;const l=Object.assign(Object.assign({},A4),e);try{const d=new M4(t),g=await Promise.race([r(),d.promise]);d.clearNetworkTimeout();const w=await g.json();if("needConfirmation"in w)throw g_(t,"account-exists-with-different-credential",w);if(g.ok&&!("errorMessage"in w))return w;{const I=g.ok?w.errorMessage:w.error.message,[a,k]=I.split(" : ");if(a==="FEDERATED_USER_ID_ALREADY_LINKED")throw g_(t,"credential-already-in-use",w);if(a==="EMAIL_EXISTS")throw g_(t,"email-already-in-use",w);if(a==="USER_DISABLED")throw g_(t,"user-disabled",w);const O=l[a]||a.toLowerCase().replace(/[_\s]+/g,"-");if(k)throw T4(t,O,k);hs(t,O)}}catch(d){if(d instanceof Da)throw d;hs(t,"network-request-failed",{message:String(d)})}}async function mm(t,e,r,l,d={}){const g=await La(t,e,r,l,d);return"mfaPendingCredential"in g&&hs(t,"multi-factor-auth-required",{_serverResponse:g}),g}function tM(t,e,r,l){const d=`${e}${r}?${l}`;return t.config.emulator?bb(t.config,d):`${t.config.apiScheme}://${d}`}function k4(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class M4{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((r,l)=>{this.timer=setTimeout(()=>l(Ls(this.auth,"network-request-failed")),P4.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function g_(t,e,r){const l={appName:t.name};r.email&&(l.email=r.email),r.phoneNumber&&(l.phoneNumber=r.phoneNumber);const d=Ls(t,e,l);return d.customData._tokenResponse=r,d}function lC(t){return t!==void 0&&t.enterprise!==void 0}class R4{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const r of this.recaptchaEnforcementState)if(r.provider&&r.provider===e)return k4(r.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function D4(t,e){return La(t,"GET","/v2/recaptchaConfig",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function L4(t,e){return La(t,"POST","/v1/accounts:delete",e)}async function z4(t,e){return La(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ep(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function O4(t,e=!1){const r=pi(t),l=await r.getIdToken(e),d=Eb(l);jt(d&&d.exp&&d.auth_time&&d.iat,r.auth,"internal-error");const g=typeof d.firebase=="object"?d.firebase:void 0,w=g==null?void 0:g.sign_in_provider;return{claims:d,token:l,authTime:Ep(M0(d.auth_time)),issuedAtTime:Ep(M0(d.iat)),expirationTime:Ep(M0(d.exp)),signInProvider:w||null,signInSecondFactor:(g==null?void 0:g.sign_in_second_factor)||null}}function M0(t){return Number(t)*1e3}function Eb(t){const[e,r,l]=t.split(".");if(e===void 0||r===void 0||l===void 0)return L_("JWT malformed, contained fewer than 3 sections"),null;try{const d=Uk(r);return d?JSON.parse(d):(L_("Failed to decode base64 JWT payload"),null)}catch(d){return L_("Caught error parsing JWT payload as JSON",d==null?void 0:d.toString()),null}}function B4(t){const e=Eb(t);return jt(e,"internal-error"),jt(typeof e.exp<"u","internal-error"),jt(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xh(t,e,r=!1){if(r)return e;try{return await e}catch(l){throw l instanceof Da&&F4(l)&&t.auth.currentUser===t&&await t.auth.signOut(),l}}function F4({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N4{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var r;if(e){const l=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),l}else{this.errorBackoff=3e4;const d=((r=this.user.stsTokenManager.expirationTime)!==null&&r!==void 0?r:0)-Date.now()-3e5;return Math.max(0,d)}}schedule(e=!1){if(!this.isRunning)return;const r=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},r)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nM{constructor(e,r){this.createdAt=e,this.lastLoginAt=r,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ep(this.lastLoginAt),this.creationTime=Ep(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function by(t){var e;const r=t.auth,l=await t.getIdToken(),d=await Xh(t,z4(r,{idToken:l}));jt(d==null?void 0:d.users.length,r,"internal-error");const g=d.users[0];t._notifyReloadListener(g);const w=!((e=g.providerUserInfo)===null||e===void 0)&&e.length?V4(g.providerUserInfo):[],I=U4(t.providerData,w),a=t.isAnonymous,k=!(t.email&&g.passwordHash)&&!(I!=null&&I.length),O=a?k:!1,V={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:I,metadata:new nM(g.createdAt,g.lastLoginAt),isAnonymous:O};Object.assign(t,V)}async function j4(t){const e=pi(t);await by(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function U4(t,e){return[...t.filter(l=>!e.some(d=>d.providerId===l.providerId)),...e]}function V4(t){return t.map(e=>{var{providerId:r}=e,l=xb(e,["providerId"]);return{providerId:r,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $4(t,e){const r=await eM(t,{},async()=>{const l=fm({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:d,apiKey:g}=t.config,w=tM(t,d,"/v1/token",`key=${g}`),I=await t._getAdditionalHeaders();return I["Content-Type"]="application/x-www-form-urlencoded",Qk.fetch()(w,{method:"POST",headers:I,body:l})});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function G4(t,e){return La(t,"POST","/v2/accounts:revokeToken",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){jt(e.idToken,"internal-error"),jt(typeof e.idToken<"u","internal-error"),jt(typeof e.refreshToken<"u","internal-error");const r="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):B4(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,r)}async getToken(e,r=!1){return jt(!this.accessToken||this.refreshToken,e,"user-token-expired"),!r&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,r){const{accessToken:l,refreshToken:d,expiresIn:g}=await $4(e,r);this.updateTokensAndExpiration(l,d,Number(g))}updateTokensAndExpiration(e,r,l){this.refreshToken=r||null,this.accessToken=e||null,this.expirationTime=Date.now()+l*1e3}static fromJSON(e,r){const{refreshToken:l,accessToken:d,expirationTime:g}=r,w=new Jp;return l&&(jt(typeof l=="string","internal-error",{appName:e}),w.refreshToken=l),d&&(jt(typeof d=="string","internal-error",{appName:e}),w.accessToken=d),g&&(jt(typeof g=="number","internal-error",{appName:e}),w.expirationTime=g),w}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Jp,this.toJSON())}_performRefresh(){return _a("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gl(t,e){jt(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Yc{constructor(e){var{uid:r,auth:l,stsTokenManager:d}=e,g=xb(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new N4(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=r,this.auth=l,this.stsTokenManager=d,this.accessToken=d.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new nM(g.createdAt||void 0,g.lastLoginAt||void 0)}async getIdToken(e){const r=await Xh(this,this.stsTokenManager.getToken(this.auth,e));return jt(r,this.auth,"internal-error"),this.accessToken!==r&&(this.accessToken=r,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),r}getIdTokenResult(e){return O4(this,e)}reload(){return j4(this)}_assign(e){this!==e&&(jt(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(r=>Object.assign({},r)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const r=new Yc(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return r.metadata._copy(this.metadata),r}_onReload(e){jt(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,r=!1){let l=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),l=!0),r&&await by(this),await this.auth._persistUserIfCurrent(this),l&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Xh(this,L4(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,r){var l,d,g,w,I,a,k,O;const V=(l=r.displayName)!==null&&l!==void 0?l:void 0,G=(d=r.email)!==null&&d!==void 0?d:void 0,X=(g=r.phoneNumber)!==null&&g!==void 0?g:void 0,oe=(w=r.photoURL)!==null&&w!==void 0?w:void 0,le=(I=r.tenantId)!==null&&I!==void 0?I:void 0,we=(a=r._redirectEventId)!==null&&a!==void 0?a:void 0,te=(k=r.createdAt)!==null&&k!==void 0?k:void 0,J=(O=r.lastLoginAt)!==null&&O!==void 0?O:void 0,{uid:ce,emailVerified:Te,isAnonymous:Ne,providerData:Ge,stsTokenManager:Xe}=r;jt(ce&&Xe,e,"internal-error");const qe=Jp.fromJSON(this.name,Xe);jt(typeof ce=="string",e,"internal-error"),gl(V,e.name),gl(G,e.name),jt(typeof Te=="boolean",e,"internal-error"),jt(typeof Ne=="boolean",e,"internal-error"),gl(X,e.name),gl(oe,e.name),gl(le,e.name),gl(we,e.name),gl(te,e.name),gl(J,e.name);const vt=new Yc({uid:ce,auth:e,email:G,emailVerified:Te,displayName:V,isAnonymous:Ne,photoURL:oe,phoneNumber:X,tenantId:le,stsTokenManager:qe,createdAt:te,lastLoginAt:J});return Ge&&Array.isArray(Ge)&&(vt.providerData=Ge.map(ze=>Object.assign({},ze))),we&&(vt._redirectEventId=we),vt}static async _fromIdTokenResponse(e,r,l=!1){const d=new Jp;d.updateFromServerResponse(r);const g=new Yc({uid:r.localId,auth:e,stsTokenManager:d,isAnonymous:l});return await by(g),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC=new Map;function ya(t){Ia(t instanceof Function,"Expected a class definition");let e=cC.get(t);return e?(Ia(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,cC.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,r){this.storage[e]=r}async _get(e){const r=this.storage[e];return r===void 0?null:r}async _remove(e){delete this.storage[e]}_addListener(e,r){}_removeListener(e,r){}}rM.type="NONE";const uC=rM;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z_(t,e,r){return`firebase:${t}:${e}:${r}`}class Oh{constructor(e,r,l){this.persistence=e,this.auth=r,this.userKey=l;const{config:d,name:g}=this.auth;this.fullUserKey=z_(this.userKey,d.apiKey,g),this.fullPersistenceKey=z_("persistence",d.apiKey,g),this.boundEventHandler=r._onStorageEvent.bind(r),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Yc._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const r=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,r)return this.setCurrentUser(r)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,r,l="authUser"){if(!r.length)return new Oh(ya(uC),e,l);const d=(await Promise.all(r.map(async k=>{if(await k._isAvailable())return k}))).filter(k=>k);let g=d[0]||ya(uC);const w=z_(l,e.config.apiKey,e.name);let I=null;for(const k of r)try{const O=await k._get(w);if(O){const V=Yc._fromJSON(e,O);k!==g&&(I=V),g=k;break}}catch{}const a=d.filter(k=>k._shouldAllowMigration);return!g._shouldAllowMigration||!a.length?new Oh(g,e,l):(g=a[0],I&&await g._set(w,I.toJSON()),await Promise.all(r.map(async k=>{if(k!==g)try{await k._remove(w)}catch{}})),new Oh(g,e,l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(sM(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(iM(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(lM(e))return"Blackberry";if(cM(e))return"Webos";if(Tb(e))return"Safari";if((e.includes("chrome/")||oM(e))&&!e.includes("edge/"))return"Chrome";if(aM(e))return"Android";{const r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,l=t.match(r);if((l==null?void 0:l.length)===2)return l[1]}return"Other"}function iM(t=fi()){return/firefox\//i.test(t)}function Tb(t=fi()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function oM(t=fi()){return/crios\//i.test(t)}function sM(t=fi()){return/iemobile/i.test(t)}function aM(t=fi()){return/android/i.test(t)}function lM(t=fi()){return/blackberry/i.test(t)}function cM(t=fi()){return/webos/i.test(t)}function tv(t=fi()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function W4(t=fi()){var e;return tv(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function q4(){return aN()&&document.documentMode===10}function uM(t=fi()){return tv(t)||aM(t)||cM(t)||lM(t)||/windows phone/i.test(t)||sM(t)}function H4(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hM(t,e=[]){let r;switch(t){case"Browser":r=hC(fi());break;case"Worker":r=`${hC(fi())}-${t}`;break;default:r=t}const l=e.length?e.join(","):"FirebaseCore-web";return`${r}/JsCore/${fd}/${l}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z4{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,r){const l=g=>new Promise((w,I)=>{try{const a=e(g);w(a)}catch(a){I(a)}});l.onAbort=r,this.queue.push(l);const d=this.queue.length-1;return()=>{this.queue[d]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const r=[];try{for(const l of this.queue)await l(e),l.onAbort&&r.push(l.onAbort)}catch(l){r.reverse();for(const d of r)try{d()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:l==null?void 0:l.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function X4(t,e={}){return La(t,"GET","/v2/passwordPolicy",Jl(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K4=6;class J4{constructor(e){var r,l,d,g;const w=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(r=w.minPasswordLength)!==null&&r!==void 0?r:K4,w.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=w.maxPasswordLength),w.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=w.containsLowercaseCharacter),w.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=w.containsUppercaseCharacter),w.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=w.containsNumericCharacter),w.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=w.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(d=(l=e.allowedNonAlphanumericCharacters)===null||l===void 0?void 0:l.join(""))!==null&&d!==void 0?d:"",this.forceUpgradeOnSignin=(g=e.forceUpgradeOnSignin)!==null&&g!==void 0?g:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var r,l,d,g,w,I;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=(r=a.meetsMinPasswordLength)!==null&&r!==void 0?r:!0),a.isValid&&(a.isValid=(l=a.meetsMaxPasswordLength)!==null&&l!==void 0?l:!0),a.isValid&&(a.isValid=(d=a.containsLowercaseLetter)!==null&&d!==void 0?d:!0),a.isValid&&(a.isValid=(g=a.containsUppercaseLetter)!==null&&g!==void 0?g:!0),a.isValid&&(a.isValid=(w=a.containsNumericCharacter)!==null&&w!==void 0?w:!0),a.isValid&&(a.isValid=(I=a.containsNonAlphanumericCharacter)!==null&&I!==void 0?I:!0),a}validatePasswordLengthOptions(e,r){const l=this.customStrengthOptions.minPasswordLength,d=this.customStrengthOptions.maxPasswordLength;l&&(r.meetsMinPasswordLength=e.length>=l),d&&(r.meetsMaxPasswordLength=e.length<=d)}validatePasswordCharacterOptions(e,r){this.updatePasswordCharacterOptionsStatuses(r,!1,!1,!1,!1);let l;for(let d=0;d<e.length;d++)l=e.charAt(d),this.updatePasswordCharacterOptionsStatuses(r,l>="a"&&l<="z",l>="A"&&l<="Z",l>="0"&&l<="9",this.allowedNonAlphanumericCharacters.includes(l))}updatePasswordCharacterOptionsStatuses(e,r,l,d,g){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=r)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=l)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=d)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=g))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y4{constructor(e,r,l,d){this.app=e,this.heartbeatServiceProvider=r,this.appCheckServiceProvider=l,this.config=d,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dC(this),this.idTokenSubscription=new dC(this),this.beforeStateQueue=new Z4(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Yk,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=d.sdkClientVersion}_initializeWithPersistence(e,r){return r&&(this._popupRedirectResolver=ya(r)),this._initializationPromise=this.queue(async()=>{var l,d;if(!this._deleted&&(this.persistenceManager=await Oh.create(this,e),!this._deleted)){if(!((l=this._popupRedirectResolver)===null||l===void 0)&&l._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(r),this.lastNotifiedUid=((d=this.currentUser)===null||d===void 0?void 0:d.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var r;const l=await this.assertedPersistence.getCurrentUser();let d=l,g=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const w=(r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId,I=d==null?void 0:d._redirectEventId,a=await this.tryRedirectSignIn(e);(!w||w===I)&&(a!=null&&a.user)&&(d=a.user,g=!0)}if(!d)return this.directlySetCurrentUser(null);if(!d._redirectEventId){if(g)try{await this.beforeStateQueue.runMiddleware(d)}catch(w){d=l,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(w))}return d?this.reloadAndSetCurrentUserOrClear(d):this.directlySetCurrentUser(null)}return jt(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===d._redirectEventId?this.directlySetCurrentUser(d):this.reloadAndSetCurrentUserOrClear(d)}async tryRedirectSignIn(e){let r=null;try{r=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return r}async reloadAndSetCurrentUserOrClear(e){try{await by(e)}catch(r){if((r==null?void 0:r.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=C4()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const r=e?pi(e):null;return r&&jt(r.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(r&&r._clone(this))}async _updateCurrentUser(e,r=!1){if(!this._deleted)return e&&jt(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),r||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(ya(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const r=this._getPasswordPolicyInternal();return r.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):r.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await X4(this),r=new J4(e);this.tenantId===null?this._projectPasswordPolicy=r:this._tenantPasswordPolicies[this.tenantId]=r}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new dm("auth","Firebase",e())}onAuthStateChanged(e,r,l){return this.registerStateListener(this.authStateSubscription,e,r,l)}beforeAuthStateChanged(e,r){return this.beforeStateQueue.pushCallback(e,r)}onIdTokenChanged(e,r,l){return this.registerStateListener(this.idTokenSubscription,e,r,l)}authStateReady(){return new Promise((e,r)=>{if(this.currentUser)e();else{const l=this.onAuthStateChanged(()=>{l(),e()},r)}})}async revokeAccessToken(e){if(this.currentUser){const r=await this.currentUser.getIdToken(),l={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:r};this.tenantId!=null&&(l.tenantId=this.tenantId),await G4(this,l)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,r){const l=await this.getOrInitRedirectPersistenceManager(r);return e===null?l.removeCurrentUser():l.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const r=e&&ya(e)||this._popupRedirectResolver;jt(r,this,"argument-error"),this.redirectPersistenceManager=await Oh.create(this,[ya(r._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var r,l;return this._isInitialized&&await this.queue(async()=>{}),((r=this._currentUser)===null||r===void 0?void 0:r._redirectEventId)===e?this._currentUser:((l=this.redirectUser)===null||l===void 0?void 0:l._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,r;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=(r=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&r!==void 0?r:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,r,l,d){if(this._deleted)return()=>{};const g=typeof r=="function"?r:r.next.bind(r);let w=!1;const I=this._isInitialized?Promise.resolve():this._initializationPromise;if(jt(I,this,"internal-error"),I.then(()=>{w||g(this.currentUser)}),typeof r=="function"){const a=e.addObserver(r,l,d);return()=>{w=!0,a()}}else{const a=e.addObserver(r);return()=>{w=!0,a()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return jt(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=hM(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const r={"X-Client-Version":this.clientVersion};this.app.options.appId&&(r["X-Firebase-gmpid"]=this.app.options.appId);const l=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());l&&(r["X-Firebase-Client"]=l);const d=await this._getAppCheckToken();return d&&(r["X-Firebase-AppCheck"]=d),r}async _getAppCheckToken(){var e;const r=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return r!=null&&r.error&&E4(`Error while retrieving App Check token: ${r.error}`),r==null?void 0:r.token}}function gu(t){return pi(t)}class dC{constructor(e){this.auth=e,this.observer=null,this.addObserver=pN(r=>this.observer=r)}get next(){return jt(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q4(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}function dM(t){return new Promise((e,r)=>{const l=document.createElement("script");l.setAttribute("src",t),l.onload=e,l.onerror=d=>{const g=Ls("internal-error");g.customData=d,r(g)},l.type="text/javascript",l.charset="UTF-8",Q4().appendChild(l)})}function ej(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const tj="https://www.google.com/recaptcha/enterprise.js?render=",nj="recaptcha-enterprise",rj="NO_RECAPTCHA";class ij{constructor(e){this.type=nj,this.auth=gu(e)}async verify(e="verify",r=!1){async function l(g){if(!r){if(g.tenantId==null&&g._agentRecaptchaConfig!=null)return g._agentRecaptchaConfig.siteKey;if(g.tenantId!=null&&g._tenantRecaptchaConfigs[g.tenantId]!==void 0)return g._tenantRecaptchaConfigs[g.tenantId].siteKey}return new Promise(async(w,I)=>{D4(g,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(a=>{if(a.recaptchaKey===void 0)I(new Error("recaptcha Enterprise site key undefined"));else{const k=new R4(a);return g.tenantId==null?g._agentRecaptchaConfig=k:g._tenantRecaptchaConfigs[g.tenantId]=k,w(k.siteKey)}}).catch(a=>{I(a)})})}function d(g,w,I){const a=window.grecaptcha;lC(a)?a.enterprise.ready(()=>{a.enterprise.execute(g,{action:e}).then(k=>{w(k)}).catch(()=>{w(rj)})}):I(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((g,w)=>{l(this.auth).then(I=>{if(!r&&lC(window.grecaptcha))d(I,g,w);else{if(typeof window>"u"){w(new Error("RecaptchaVerifier is only supported in browser"));return}dM(tj+I).then(()=>{d(I,g,w)}).catch(a=>{w(a)})}}).catch(I=>{w(I)})})}}async function fC(t,e,r,l=!1){const d=new ij(t);let g;try{g=await d.verify(r)}catch{g=await d.verify(r,!0)}const w=Object.assign({},e);return l?Object.assign(w,{captchaResp:g}):Object.assign(w,{captchaResponse:g}),Object.assign(w,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(w,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),w}async function Yw(t,e,r,l){var d;if(!((d=t._getRecaptchaConfig())===null||d===void 0)&&d.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const g=await fC(t,e,r,r==="getOobCode");return l(t,g)}else return l(t,e).catch(async g=>{if(g.code==="auth/missing-recaptcha-token"){console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const w=await fC(t,e,r,r==="getOobCode");return l(t,w)}else return Promise.reject(g)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oj(t,e){const r=vb(t,"auth");if(r.isInitialized()){const d=r.getImmediate(),g=r.getOptions();if(vy(g,e??{}))return d;hs(d,"already-initialized")}return r.initialize({options:e})}function sj(t,e){const r=(e==null?void 0:e.persistence)||[],l=(Array.isArray(r)?r:[r]).map(ya);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(l,e==null?void 0:e.popupRedirectResolver)}function aj(t,e,r){const l=gu(t);jt(l._canInitEmulator,l,"emulator-config-failed"),jt(/^https?:\/\//.test(e),l,"invalid-emulator-scheme");const d=!!(r!=null&&r.disableWarnings),g=fM(e),{host:w,port:I}=lj(e),a=I===null?"":`:${I}`;l.config.emulator={url:`${g}//${w}${a}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:w,port:I,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:d})}),d||cj()}function fM(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function lj(t){const e=fM(t),r=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!r)return{host:"",port:null};const l=r[2].split("@").pop()||"",d=/^(\[[^\]]+\])(:|$)/.exec(l);if(d){const g=d[1];return{host:g,port:pC(l.substr(g.length+1))}}else{const[g,w]=l.split(":");return{host:g,port:pC(w)}}}function pC(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function cj(){function t(){const e=document.createElement("p"),r=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",r.position="fixed",r.width="100%",r.backgroundColor="#ffffff",r.border=".1em solid #000000",r.color="#b50000",r.bottom="0px",r.left="0px",r.margin="0px",r.zIndex="10000",r.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(e,r){this.providerId=e,this.signInMethod=r}toJSON(){return _a("not implemented")}_getIdTokenResponse(e){return _a("not implemented")}_linkToIdToken(e,r){return _a("not implemented")}_getReauthenticationResolver(e){return _a("not implemented")}}async function uj(t,e){return La(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hj(t,e){return mm(t,"POST","/v1/accounts:signInWithPassword",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dj(t,e){return mm(t,"POST","/v1/accounts:signInWithEmailLink",Jl(t,e))}async function fj(t,e){return mm(t,"POST","/v1/accounts:signInWithEmailLink",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yp extends Sb{constructor(e,r,l,d=null){super("password",l),this._email=e,this._password=r,this._tenantId=d}static _fromEmailAndPassword(e,r){return new Yp(e,r,"password")}static _fromEmailAndCode(e,r,l=null){return new Yp(e,r,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e;if(r!=null&&r.email&&(r!=null&&r.password)){if(r.signInMethod==="password")return this._fromEmailAndPassword(r.email,r.password);if(r.signInMethod==="emailLink")return this._fromEmailAndCode(r.email,r.password,r.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const r={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yw(e,r,"signInWithPassword",hj);case"emailLink":return dj(e,{email:this._email,oobCode:this._password});default:hs(e,"internal-error")}}async _linkToIdToken(e,r){switch(this.signInMethod){case"password":const l={idToken:r,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Yw(e,l,"signUpPassword",uj);case"emailLink":return fj(e,{idToken:r,email:this._email,oobCode:this._password});default:hs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bh(t,e){return mm(t,"POST","/v1/accounts:signInWithIdp",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pj="http://localhost";class au extends Sb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const r=new au(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(r.idToken=e.idToken),e.accessToken&&(r.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(r.nonce=e.nonce),e.pendingToken&&(r.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(r.accessToken=e.oauthToken,r.secret=e.oauthTokenSecret):hs("argument-error"),r}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const r=typeof e=="string"?JSON.parse(e):e,{providerId:l,signInMethod:d}=r,g=xb(r,["providerId","signInMethod"]);if(!l||!d)return null;const w=new au(l,d);return w.idToken=g.idToken||void 0,w.accessToken=g.accessToken||void 0,w.secret=g.secret,w.nonce=g.nonce,w.pendingToken=g.pendingToken||null,w}_getIdTokenResponse(e){const r=this.buildRequest();return Bh(e,r)}_linkToIdToken(e,r){const l=this.buildRequest();return l.idToken=r,Bh(e,l)}_getReauthenticationResolver(e){const r=this.buildRequest();return r.autoCreate=!1,Bh(e,r)}buildRequest(){const e={requestUri:pj,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const r={};this.idToken&&(r.id_token=this.idToken),this.accessToken&&(r.access_token=this.accessToken),this.secret&&(r.oauth_token_secret=this.secret),r.providerId=this.providerId,this.nonce&&!this.pendingToken&&(r.nonce=this.nonce),e.postBody=fm(r)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mj(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function gj(t){const e=dp(fp(t)).link,r=e?dp(fp(e)).deep_link_id:null,l=dp(fp(t)).deep_link_id;return(l?dp(fp(l)).link:null)||l||r||e||t}class Ib{constructor(e){var r,l,d,g,w,I;const a=dp(fp(e)),k=(r=a.apiKey)!==null&&r!==void 0?r:null,O=(l=a.oobCode)!==null&&l!==void 0?l:null,V=mj((d=a.mode)!==null&&d!==void 0?d:null);jt(k&&O&&V,"argument-error"),this.apiKey=k,this.operation=V,this.code=O,this.continueUrl=(g=a.continueUrl)!==null&&g!==void 0?g:null,this.languageCode=(w=a.languageCode)!==null&&w!==void 0?w:null,this.tenantId=(I=a.tenantId)!==null&&I!==void 0?I:null}static parseLink(e){const r=gj(e);try{return new Ib(r)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pd{constructor(){this.providerId=pd.PROVIDER_ID}static credential(e,r){return Yp._fromEmailAndPassword(e,r)}static credentialWithLink(e,r){const l=Ib.parseLink(r);return jt(l,"argument-error"),Yp._fromEmailAndCode(e,l.code,l.tenantId)}}pd.PROVIDER_ID="password";pd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";pd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gm extends pM{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tl extends gm{constructor(){super("facebook.com")}static credential(e){return au._fromParams({providerId:Tl.PROVIDER_ID,signInMethod:Tl.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Tl.credentialFromTaggedObject(e)}static credentialFromError(e){return Tl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Tl.credential(e.oauthAccessToken)}catch{return null}}}Tl.FACEBOOK_SIGN_IN_METHOD="facebook.com";Tl.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl extends gm{constructor(){super("google.com"),this.addScope("profile")}static credential(e,r){return au._fromParams({providerId:Sl.PROVIDER_ID,signInMethod:Sl.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:r})}static credentialFromResult(e){return Sl.credentialFromTaggedObject(e)}static credentialFromError(e){return Sl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:r,oauthAccessToken:l}=e;if(!r&&!l)return null;try{return Sl.credential(r,l)}catch{return null}}}Sl.GOOGLE_SIGN_IN_METHOD="google.com";Sl.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Il extends gm{constructor(){super("github.com")}static credential(e){return au._fromParams({providerId:Il.PROVIDER_ID,signInMethod:Il.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Il.credentialFromTaggedObject(e)}static credentialFromError(e){return Il.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Il.credential(e.oauthAccessToken)}catch{return null}}}Il.GITHUB_SIGN_IN_METHOD="github.com";Il.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl extends gm{constructor(){super("twitter.com")}static credential(e,r){return au._fromParams({providerId:Cl.PROVIDER_ID,signInMethod:Cl.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:r})}static credentialFromResult(e){return Cl.credentialFromTaggedObject(e)}static credentialFromError(e){return Cl.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:r,oauthTokenSecret:l}=e;if(!r||!l)return null;try{return Cl.credential(r,l)}catch{return null}}}Cl.TWITTER_SIGN_IN_METHOD="twitter.com";Cl.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _j(t,e){return mm(t,"POST","/v1/accounts:signUp",Jl(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,r,l,d=!1){const g=await Yc._fromIdTokenResponse(e,l,d),w=mC(l);return new lu({user:g,providerId:w,_tokenResponse:l,operationType:r})}static async _forOperation(e,r,l){await e._updateTokensIfNecessary(l,!0);const d=mC(l);return new lu({user:e,providerId:d,_tokenResponse:l,operationType:r})}}function mC(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ey extends Da{constructor(e,r,l,d){var g;super(r.code,r.message),this.operationType=l,this.user=d,Object.setPrototypeOf(this,Ey.prototype),this.customData={appName:e.name,tenantId:(g=e.tenantId)!==null&&g!==void 0?g:void 0,_serverResponse:r.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(e,r,l,d){return new Ey(e,r,l,d)}}function mM(t,e,r,l){return(e==="reauthenticate"?r._getReauthenticationResolver(t):r._getIdTokenResponse(t)).catch(g=>{throw g.code==="auth/multi-factor-auth-required"?Ey._fromErrorAndOperation(t,g,e,l):g})}async function yj(t,e,r=!1){const l=await Xh(t,e._linkToIdToken(t.auth,await t.getIdToken()),r);return lu._forOperation(t,"link",l)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vj(t,e,r=!1){const{auth:l}=t,d="reauthenticate";try{const g=await Xh(t,mM(l,d,e,t),r);jt(g.idToken,l,"internal-error");const w=Eb(g.idToken);jt(w,l,"internal-error");const{sub:I}=w;return jt(t.uid===I,l,"user-mismatch"),lu._forOperation(t,d,g)}catch(g){throw(g==null?void 0:g.code)==="auth/user-not-found"&&hs(l,"user-mismatch"),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gM(t,e,r=!1){const l="signIn",d=await mM(t,l,e),g=await lu._fromIdTokenResponse(t,l,d);return r||await t._updateCurrentUser(g.user),g}async function xj(t,e){return gM(gu(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _M(t){const e=gu(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function wj(t,e,r){const l=gu(t),w=await Yw(l,{returnSecureToken:!0,email:e,password:r,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",_j).catch(a=>{throw a.code==="auth/password-does-not-meet-requirements"&&_M(t),a}),I=await lu._fromIdTokenResponse(l,"signIn",w);return await l._updateCurrentUser(I.user),I}function bj(t,e,r){return xj(pi(t),pd.credential(e,r)).catch(async l=>{throw l.code==="auth/password-does-not-meet-requirements"&&_M(t),l})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ej(t,e){return La(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tj(t,{displayName:e,photoURL:r}){if(e===void 0&&r===void 0)return;const l=pi(t),g={idToken:await l.getIdToken(),displayName:e,photoUrl:r,returnSecureToken:!0},w=await Xh(l,Ej(l.auth,g));l.displayName=w.displayName||null,l.photoURL=w.photoUrl||null;const I=l.providerData.find(({providerId:a})=>a==="password");I&&(I.displayName=l.displayName,I.photoURL=l.photoURL),await l._updateTokensIfNecessary(w)}function Sj(t,e,r,l){return pi(t).onIdTokenChanged(e,r,l)}function Ij(t,e,r){return pi(t).beforeAuthStateChanged(e,r)}async function Cj(t){return pi(t).delete()}const Ty="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(e,r){this.storageRetriever=e,this.type=r}_isAvailable(){try{return this.storage?(this.storage.setItem(Ty,"1"),this.storage.removeItem(Ty),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,r){return this.storage.setItem(e,JSON.stringify(r)),Promise.resolve()}_get(e){const r=this.storage.getItem(e);return Promise.resolve(r?JSON.parse(r):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Aj(){const t=fi();return Tb(t)||tv(t)}const Pj=1e3,kj=10;class vM extends yM{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,r)=>this.onStorageEvent(e,r),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=Aj()&&H4(),this.fallbackToPolling=uM(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const r of Object.keys(this.listeners)){const l=this.storage.getItem(r),d=this.localCache[r];l!==d&&e(r,d,l)}}onStorageEvent(e,r=!1){if(!e.key){this.forAllChangedKeys((w,I,a)=>{this.notifyListeners(w,a)});return}const l=e.key;if(r?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const w=this.storage.getItem(l);if(e.newValue!==w)e.newValue!==null?this.storage.setItem(l,e.newValue):this.storage.removeItem(l);else if(this.localCache[l]===e.newValue&&!r)return}const d=()=>{const w=this.storage.getItem(l);!r&&this.localCache[l]===w||this.notifyListeners(l,w)},g=this.storage.getItem(l);q4()&&g!==e.newValue&&e.newValue!==e.oldValue?setTimeout(d,kj):d()}notifyListeners(e,r){this.localCache[e]=r;const l=this.listeners[e];if(l)for(const d of Array.from(l))d(r&&JSON.parse(r))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,r,l)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:r,newValue:l}),!0)})},Pj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,r){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,r){await super._set(e,r),this.localCache[e]=JSON.stringify(r)}async _get(e){const r=await super._get(e);return this.localCache[e]=JSON.stringify(r),r}async _remove(e){await super._remove(e),delete this.localCache[e]}}vM.type="LOCAL";const Mj=vM;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xM extends yM{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,r){}_removeListener(e,r){}}xM.type="SESSION";const wM=xM;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rj(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(r){return{fulfilled:!1,reason:r}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nv{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const r=this.receivers.find(d=>d.isListeningto(e));if(r)return r;const l=new nv(e);return this.receivers.push(l),l}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const r=e,{eventId:l,eventType:d,data:g}=r.data,w=this.handlersMap[d];if(!(w!=null&&w.size))return;r.ports[0].postMessage({status:"ack",eventId:l,eventType:d});const I=Array.from(w).map(async k=>k(r.origin,g)),a=await Rj(I);r.ports[0].postMessage({status:"done",eventId:l,eventType:d,response:a})}_subscribe(e,r){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(r)}_unsubscribe(e,r){this.handlersMap[e]&&r&&this.handlersMap[e].delete(r),(!r||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}nv.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(t="",e=10){let r="";for(let l=0;l<e;l++)r+=Math.floor(Math.random()*10);return t+r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dj{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,r,l=50){const d=typeof MessageChannel<"u"?new MessageChannel:null;if(!d)throw new Error("connection_unavailable");let g,w;return new Promise((I,a)=>{const k=Cb("",20);d.port1.start();const O=setTimeout(()=>{a(new Error("unsupported_event"))},l);w={messageChannel:d,onMessage(V){const G=V;if(G.data.eventId===k)switch(G.data.status){case"ack":clearTimeout(O),g=setTimeout(()=>{a(new Error("timeout"))},3e3);break;case"done":clearTimeout(g),I(G.data.response);break;default:clearTimeout(O),clearTimeout(g),a(new Error("invalid_response"));break}}},this.handlers.add(w),d.port1.addEventListener("message",w.onMessage),this.target.postMessage({eventType:e,eventId:k,data:r},[d.port2])}).finally(()=>{w&&this.removeMessageHandler(w)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zs(){return window}function Lj(t){zs().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bM(){return typeof zs().WorkerGlobalScope<"u"&&typeof zs().importScripts=="function"}async function zj(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Oj(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function Bj(){return bM()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EM="firebaseLocalStorageDb",Fj=1,Sy="firebaseLocalStorage",TM="fbase_key";class _m{constructor(e){this.request=e}toPromise(){return new Promise((e,r)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{r(this.request.error)})})}}function rv(t,e){return t.transaction([Sy],e?"readwrite":"readonly").objectStore(Sy)}function Nj(){const t=indexedDB.deleteDatabase(EM);return new _m(t).toPromise()}function Qw(){const t=indexedDB.open(EM,Fj);return new Promise((e,r)=>{t.addEventListener("error",()=>{r(t.error)}),t.addEventListener("upgradeneeded",()=>{const l=t.result;try{l.createObjectStore(Sy,{keyPath:TM})}catch(d){r(d)}}),t.addEventListener("success",async()=>{const l=t.result;l.objectStoreNames.contains(Sy)?e(l):(l.close(),await Nj(),e(await Qw()))})})}async function gC(t,e,r){const l=rv(t,!0).put({[TM]:e,value:r});return new _m(l).toPromise()}async function jj(t,e){const r=rv(t,!1).get(e),l=await new _m(r).toPromise();return l===void 0?null:l.value}function _C(t,e){const r=rv(t,!0).delete(e);return new _m(r).toPromise()}const Uj=800,Vj=3;class SM{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Qw(),this.db)}async _withRetries(e){let r=0;for(;;)try{const l=await this._openDb();return await e(l)}catch(l){if(r++>Vj)throw l;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bM()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=nv._getInstance(Bj()),this.receiver._subscribe("keyChanged",async(e,r)=>({keyProcessed:(await this._poll()).includes(r.key)})),this.receiver._subscribe("ping",async(e,r)=>["keyChanged"])}async initializeSender(){var e,r;if(this.activeServiceWorker=await zj(),!this.activeServiceWorker)return;this.sender=new Dj(this.activeServiceWorker);const l=await this.sender._send("ping",{},800);l&&!((e=l[0])===null||e===void 0)&&e.fulfilled&&!((r=l[0])===null||r===void 0)&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Oj()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Qw();return await gC(e,Ty,"1"),await _C(e,Ty),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,r){return this._withPendingWrite(async()=>(await this._withRetries(l=>gC(l,e,r)),this.localCache[e]=r,this.notifyServiceWorker(e)))}async _get(e){const r=await this._withRetries(l=>jj(l,e));return this.localCache[e]=r,r}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(r=>_C(r,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(d=>{const g=rv(d,!1).getAll();return new _m(g).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const r=[],l=new Set;for(const{fbase_key:d,value:g}of e)l.add(d),JSON.stringify(this.localCache[d])!==JSON.stringify(g)&&(this.notifyListeners(d,g),r.push(d));for(const d of Object.keys(this.localCache))this.localCache[d]&&!l.has(d)&&(this.notifyListeners(d,null),r.push(d));return r}notifyListeners(e,r){this.localCache[e]=r;const l=this.listeners[e];if(l)for(const d of Array.from(l))d(r)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Uj)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,r){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(r)}_removeListener(e,r){this.listeners[e]&&(this.listeners[e].delete(r),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}SM.type="LOCAL";const $j=SM;new pm(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gj(t,e){return e?ya(e):(jt(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ab extends Sb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Bh(e,this._buildIdpRequest())}_linkToIdToken(e,r){return Bh(e,this._buildIdpRequest(r))}_getReauthenticationResolver(e){return Bh(e,this._buildIdpRequest())}_buildIdpRequest(e){const r={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(r.idToken=e),r}}function Wj(t){return gM(t.auth,new Ab(t),t.bypassAuthState)}function qj(t){const{auth:e,user:r}=t;return jt(r,e,"internal-error"),vj(r,new Ab(t),t.bypassAuthState)}async function Hj(t){const{auth:e,user:r}=t;return jt(r,e,"internal-error"),yj(r,new Ab(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IM{constructor(e,r,l,d,g=!1){this.auth=e,this.resolver=l,this.user=d,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(r)?r:[r]}execute(){return new Promise(async(e,r)=>{this.pendingPromise={resolve:e,reject:r};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(l){this.reject(l)}})}async onAuthEvent(e){const{urlResponse:r,sessionId:l,postBody:d,tenantId:g,error:w,type:I}=e;if(w){this.reject(w);return}const a={auth:this.auth,requestUri:r,sessionId:l,tenantId:g||void 0,postBody:d||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(I)(a))}catch(k){this.reject(k)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Wj;case"linkViaPopup":case"linkViaRedirect":return Hj;case"reauthViaPopup":case"reauthViaRedirect":return qj;default:hs(this.auth,"internal-error")}}resolve(e){Ia(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Ia(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zj=new pm(2e3,1e4);class Ah extends IM{constructor(e,r,l,d,g){super(e,r,d,g),this.provider=l,this.authWindow=null,this.pollId=null,Ah.currentPopupAction&&Ah.currentPopupAction.cancel(),Ah.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return jt(e,this.auth,"internal-error"),e}async onExecution(){Ia(this.filter.length===1,"Popup operations only handle one event");const e=Cb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(r=>{this.reject(r)}),this.resolver._isIframeWebStorageSupported(this.auth,r=>{r||this.reject(Ls(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ls(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Ah.currentPopupAction=null}pollUserCancellation(){const e=()=>{var r,l;if(!((l=(r=this.authWindow)===null||r===void 0?void 0:r.window)===null||l===void 0)&&l.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ls(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Zj.get())};e()}}Ah.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xj="pendingRedirect",O_=new Map;class Kj extends IM{constructor(e,r,l=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],r,void 0,l),this.eventId=null}async execute(){let e=O_.get(this.auth._key());if(!e){try{const l=await Jj(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(l)}catch(r){e=()=>Promise.reject(r)}O_.set(this.auth._key(),e)}return this.bypassAuthState||O_.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const r=await this.auth._redirectUserForId(e.eventId);if(r)return this.user=r,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function Jj(t,e){const r=e5(e),l=Qj(t);if(!await l._isAvailable())return!1;const d=await l._get(r)==="true";return await l._remove(r),d}function Yj(t,e){O_.set(t._key(),e)}function Qj(t){return ya(t._redirectPersistence)}function e5(t){return z_(Xj,t.config.apiKey,t.name)}async function t5(t,e,r=!1){const l=gu(t),d=Gj(l,e),w=await new Kj(l,d,r).execute();return w&&!r&&(delete w.user._redirectEventId,await l._persistUserIfCurrent(w.user),await l._setRedirectUser(null,e)),w}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n5=10*60*1e3;class r5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let r=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(e,l)&&(r=!0,this.sendToConsumer(e,l),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!i5(e)||(this.hasHandledPotentialRedirect=!0,r||(this.queuedRedirectEvent=e,r=!0)),r}sendToConsumer(e,r){var l;if(e.error&&!CM(e)){const d=((l=e.error.code)===null||l===void 0?void 0:l.split("auth/")[1])||"internal-error";r.onError(Ls(this.auth,d))}else r.onAuthEvent(e)}isEventForConsumer(e,r){const l=r.eventId===null||!!e.eventId&&e.eventId===r.eventId;return r.filter.includes(e.type)&&l}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=n5&&this.cachedEventUids.clear(),this.cachedEventUids.has(yC(e))}saveEventToCache(e){this.cachedEventUids.add(yC(e)),this.lastProcessedEventTime=Date.now()}}function yC(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function CM({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function i5(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return CM(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o5(t,e={}){return La(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s5=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,a5=/^https?/;async function l5(t){if(t.config.emulator)return;const{authorizedDomains:e}=await o5(t);for(const r of e)try{if(c5(r))return}catch{}hs(t,"unauthorized-domain")}function c5(t){const e=Jw(),{protocol:r,hostname:l}=new URL(e);if(t.startsWith("chrome-extension://")){const w=new URL(t);return w.hostname===""&&l===""?r==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):r==="chrome-extension:"&&w.hostname===l}if(!a5.test(r))return!1;if(s5.test(t))return l===t;const d=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+d+"|"+d+")$","i").test(l)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u5=new pm(3e4,6e4);function vC(){const t=zs().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let r=0;r<t.CP.length;r++)t.CP[r]=null}}function h5(t){return new Promise((e,r)=>{var l,d,g;function w(){vC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{vC(),r(Ls(t,"network-request-failed"))},timeout:u5.get()})}if(!((d=(l=zs().gapi)===null||l===void 0?void 0:l.iframes)===null||d===void 0)&&d.Iframe)e(gapi.iframes.getContext());else if(!((g=zs().gapi)===null||g===void 0)&&g.load)w();else{const I=ej("iframefcb");return zs()[I]=()=>{gapi.load?w():r(Ls(t,"network-request-failed"))},dM(`https://apis.google.com/js/api.js?onload=${I}`).catch(a=>r(a))}}).catch(e=>{throw B_=null,e})}let B_=null;function d5(t){return B_=B_||h5(t),B_}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const f5=new pm(5e3,15e3),p5="__/auth/iframe",m5="emulator/auth/iframe",g5={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_5=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function y5(t){const e=t.config;jt(e.authDomain,t,"auth-domain-config-required");const r=e.emulator?bb(e,m5):`https://${t.config.authDomain}/${p5}`,l={apiKey:e.apiKey,appName:t.name,v:fd},d=_5.get(t.config.apiHost);d&&(l.eid=d);const g=t._getFrameworks();return g.length&&(l.fw=g.join(",")),`${r}?${fm(l).slice(1)}`}async function v5(t){const e=await d5(t),r=zs().gapi;return jt(r,t,"internal-error"),e.open({where:document.body,url:y5(t),messageHandlersFilter:r.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:g5,dontclear:!0},l=>new Promise(async(d,g)=>{await l.restyle({setHideOnLeave:!1});const w=Ls(t,"network-request-failed"),I=zs().setTimeout(()=>{g(w)},f5.get());function a(){zs().clearTimeout(I),d(l)}l.ping(a).then(a,()=>{g(w)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x5={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},w5=500,b5=600,E5="_blank",T5="http://localhost";class xC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function S5(t,e,r,l=w5,d=b5){const g=Math.max((window.screen.availHeight-d)/2,0).toString(),w=Math.max((window.screen.availWidth-l)/2,0).toString();let I="";const a=Object.assign(Object.assign({},x5),{width:l.toString(),height:d.toString(),top:g,left:w}),k=fi().toLowerCase();r&&(I=oM(k)?E5:r),iM(k)&&(e=e||T5,a.scrollbars="yes");const O=Object.entries(a).reduce((G,[X,oe])=>`${G}${X}=${oe},`,"");if(W4(k)&&I!=="_self")return I5(e||"",I),new xC(null);const V=window.open(e||"",I,O);jt(V,t,"popup-blocked");try{V.focus()}catch{}return new xC(V)}function I5(t,e){const r=document.createElement("a");r.href=t,r.target=e;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),r.dispatchEvent(l)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C5="__/auth/handler",A5="emulator/auth/handler",P5=encodeURIComponent("fac");async function wC(t,e,r,l,d,g){jt(t.config.authDomain,t,"auth-domain-config-required"),jt(t.config.apiKey,t,"invalid-api-key");const w={apiKey:t.config.apiKey,appName:t.name,authType:r,redirectUrl:l,v:fd,eventId:d};if(e instanceof pM){e.setDefaultLanguage(t.languageCode),w.providerId=e.providerId||"",fN(e.getCustomParameters())||(w.customParameters=JSON.stringify(e.getCustomParameters()));for(const[O,V]of Object.entries(g||{}))w[O]=V}if(e instanceof gm){const O=e.getScopes().filter(V=>V!=="");O.length>0&&(w.scopes=O.join(","))}t.tenantId&&(w.tid=t.tenantId);const I=w;for(const O of Object.keys(I))I[O]===void 0&&delete I[O];const a=await t._getAppCheckToken(),k=a?`#${P5}=${encodeURIComponent(a)}`:"";return`${k5(t)}?${fm(I).slice(1)}${k}`}function k5({config:t}){return t.emulator?bb(t,A5):`https://${t.authDomain}/${C5}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R0="webStorageSupport";class M5{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=wM,this._completeRedirectFn=t5,this._overrideRedirectResult=Yj}async _openPopup(e,r,l,d){var g;Ia((g=this.eventManagers[e._key()])===null||g===void 0?void 0:g.manager,"_initialize() not called before _openPopup()");const w=await wC(e,r,l,Jw(),d);return S5(e,w,Cb())}async _openRedirect(e,r,l,d){await this._originValidation(e);const g=await wC(e,r,l,Jw(),d);return Lj(g),new Promise(()=>{})}_initialize(e){const r=e._key();if(this.eventManagers[r]){const{manager:d,promise:g}=this.eventManagers[r];return d?Promise.resolve(d):(Ia(g,"If manager is not set, promise should be"),g)}const l=this.initAndGetManager(e);return this.eventManagers[r]={promise:l},l.catch(()=>{delete this.eventManagers[r]}),l}async initAndGetManager(e){const r=await v5(e),l=new r5(e);return r.register("authEvent",d=>(jt(d==null?void 0:d.authEvent,e,"invalid-auth-event"),{status:l.onEvent(d.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:l},this.iframes[e._key()]=r,l}_isIframeWebStorageSupported(e,r){this.iframes[e._key()].send(R0,{type:R0},d=>{var g;const w=(g=d==null?void 0:d[0])===null||g===void 0?void 0:g[R0];w!==void 0&&r(!!w),hs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const r=e._key();return this.originValidationPromises[r]||(this.originValidationPromises[r]=l5(e)),this.originValidationPromises[r]}get _shouldInitProactively(){return uM()||Tb()||tv()}}const R5=M5;var bC="@firebase/auth",EC="1.4.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D5{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const r=this.auth.onIdTokenChanged(l=>{e((l==null?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,r),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const r=this.internalListeners.get(e);r&&(this.internalListeners.delete(e),r(),this.updateProactiveRefresh())}assertAuthConfigured(){jt(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L5(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function z5(t){Zh(new ou("auth",(e,{options:r})=>{const l=e.getProvider("app").getImmediate(),d=e.getProvider("heartbeat"),g=e.getProvider("app-check-internal"),{apiKey:w,authDomain:I}=l.options;jt(w&&!w.includes(":"),"invalid-api-key",{appName:l.name});const a={apiKey:w,authDomain:I,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:hM(t)},k=new Y4(l,d,g,a);return sj(k,r),k},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,r,l)=>{e.getProvider("auth-internal").initialize()})),Zh(new ou("auth-internal",e=>{const r=gu(e.getProvider("auth").getImmediate());return(l=>new D5(l))(r)},"PRIVATE").setInstantiationMode("EXPLICIT")),$l(bC,EC,L5(t)),$l(bC,EC,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O5=5*60,B5=Gk("authIdTokenMaxAge")||O5;let TC=null;const F5=t=>async e=>{const r=e&&await e.getIdTokenResult(),l=r&&(new Date().getTime()-Date.parse(r.issuedAtTime))/1e3;if(l&&l>B5)return;const d=r==null?void 0:r.token;TC!==d&&(TC=d,await fetch(t,{method:d?"POST":"DELETE",headers:d?{Authorization:`Bearer ${d}`}:{}}))};function N5(t=Zk()){const e=vb(t,"auth");if(e.isInitialized())return e.getImmediate();const r=oj(t,{popupRedirectResolver:R5,persistence:[$j,Mj,wM]}),l=Gk("authTokenSyncURL");if(l){const g=F5(l);Ij(r,g,()=>g(r.currentUser)),Sj(r,w=>g(w))}const d=Vk("auth");return d&&aj(r,`http://${d}`),r}z5("Browser");var j5="firebase",U5="10.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */$l(j5,U5,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Di{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Di.UNAUTHENTICATED=new Di(null),Di.GOOGLE_CREDENTIALS=new Di("google-credentials-uid"),Di.FIRST_PARTY=new Di("first-party-uid"),Di.MOCK_USER=new Di("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let md="10.5.2";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh=new _b("@firebase/firestore");function Iy(t,...e){if(Kh.logLevel<=An.DEBUG){const r=e.map(kb);Kh.debug(`Firestore (${md}): ${t}`,...r)}}function Pb(t,...e){if(Kh.logLevel<=An.ERROR){const r=e.map(kb);Kh.error(`Firestore (${md}): ${t}`,...r)}}function AM(t,...e){if(Kh.logLevel<=An.WARN){const r=e.map(kb);Kh.warn(`Firestore (${md}): ${t}`,...r)}}function kb(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(r){return JSON.stringify(r)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cr(t="Unexpected state"){const e=`FIRESTORE (${md}) INTERNAL ASSERTION FAILED: `+t;throw Pb(e),new Error(e)}function Qi(t,e){t||Cr()}function PM(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SC="ok",V5="cancelled",Tp="unknown",wn="invalid-argument",$5="deadline-exceeded",G5="not-found",W5="permission-denied",e1="unauthenticated",q5="resource-exhausted",Jh="failed-precondition",H5="aborted",Z5="out-of-range",X5="unimplemented",K5="internal",J5="unavailable";class Kt extends Da{constructor(e,r){super(e,r),this.code=e,this.message=r,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kM{constructor(e,r){this.user=r,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Y5{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,r){e.enqueueRetryable(()=>r(Di.UNAUTHENTICATED))}shutdown(){}}class Q5{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,r){this.changeListener=r,e.enqueueRetryable(()=>r(this.token.user))}shutdown(){this.changeListener=null}}class eU{constructor(e){this.auth=null,e.onInit(r=>{this.auth=r})}getToken(){return this.auth?this.auth.getToken().then(e=>e?(Qi(typeof e.accessToken=="string"),new kM(e.accessToken,new Di(this.auth.getUid()))):null):Promise.resolve(null)}invalidateToken(){}start(e,r){}shutdown(){}}class tU{constructor(e,r,l){this.t=e,this.i=r,this.o=l,this.type="FirstParty",this.user=Di.FIRST_PARTY,this.u=new Map}l(){return this.o?this.o():null}get headers(){this.u.set("X-Goog-AuthUser",this.t);const e=this.l();return e&&this.u.set("Authorization",e),this.i&&this.u.set("X-Goog-Iam-Authorization-Token",this.i),this.u}}class nU{constructor(e,r,l){this.t=e,this.i=r,this.o=l}getToken(){return Promise.resolve(new tU(this.t,this.i,this.o))}start(e,r){e.enqueueRetryable(()=>r(Di.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class rU{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iU{constructor(e){this.h=e,this.appCheck=null,e.onInit(r=>{this.appCheck=r})}getToken(){return this.appCheck?this.appCheck.getToken().then(e=>e?(Qi(typeof e.token=="string"),new rU(e.token)):null):Promise.resolve(null)}invalidateToken(){}start(e,r){}shutdown(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,r,l,d,g,w,I,a,k){this.databaseId=e,this.appId=r,this.persistenceKey=l,this.host=d,this.ssl=g,this.forceLongPolling=w,this.autoDetectLongPolling=I,this.longPollingOptions=a,this.useFetchStreams=k}}class Qp{constructor(e,r){this.projectId=e,this.database=r||"(default)"}static empty(){return new Qp("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Qp&&e.projectId===this.projectId&&e.database===this.database}}class em{constructor(e,r,l){r===void 0?r=0:r>e.length&&Cr(),l===void 0?l=e.length-r:l>e.length-r&&Cr(),this.segments=e,this.offset=r,this.len=l}get length(){return this.len}isEqual(e){return em.comparator(this,e)===0}child(e){const r=this.segments.slice(this.offset,this.limit());return e instanceof em?e.forEach(l=>{r.push(l)}):r.push(e),this.construct(r)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let r=0;r<this.length;r++)if(this.get(r)!==e.get(r))return!1;return!0}forEach(e){for(let r=this.offset,l=this.limit();r<l;r++)e(this.segments[r])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,r){const l=Math.min(e.length,r.length);for(let d=0;d<l;d++){const g=e.get(d),w=r.get(d);if(g<w)return-1;if(g>w)return 1}return e.length<r.length?-1:e.length>r.length?1:0}}class hi extends em{construct(e,r,l){return new hi(e,r,l)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const r=[];for(const l of e){if(l.indexOf("//")>=0)throw new Kt(wn,`Invalid segment (${l}). Paths must not contain // in them.`);r.push(...l.split("/").filter(d=>d.length>0))}return new hi(r)}static emptyPath(){return new hi([])}}const sU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ss extends em{construct(e,r,l){return new ss(e,r,l)}static isValidIdentifier(e){return sU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ss.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ss(["__name__"])}static fromServerFormat(e){const r=[];let l="",d=0;const g=()=>{if(l.length===0)throw new Kt(wn,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);r.push(l),l=""};let w=!1;for(;d<e.length;){const I=e[d];if(I==="\\"){if(d+1===e.length)throw new Kt(wn,"Path has trailing escape character: "+e);const a=e[d+1];if(a!=="\\"&&a!=="."&&a!=="`")throw new Kt(wn,"Path has invalid escape sequence: "+e);l+=a,d+=2}else I==="`"?(w=!w,d++):I!=="."||w?(l+=I,d++):(g(),d++)}if(g(),w)throw new Kt(wn,"Unterminated ` in path: "+e);return new ss(r)}static emptyPath(){return new ss([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class as{constructor(e){this.path=e}static fromPath(e){return new as(hi.fromString(e))}static fromName(e){return new as(hi.fromString(e).popFirst(5))}static empty(){return new as(hi.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&hi.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,r){return hi.comparator(e.path,r.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new as(new hi(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aU(t,e,r){if(!r)throw new Kt(wn,`Function ${t}() cannot be called with an empty ${e}.`)}function IC(t){if(!as.isDocumentKey(t))throw new Kt(wn,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Mb(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(l){return l.constructor?l.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Cr()}function iv(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Kt(wn,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=Mb(t);throw new Kt(wn,`Expected type '${e.name}', but it was: ${r}`)}}return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MM(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let __=null;function lU(){return __===null?__=function(){return 268435456+Math.round(2147483648*Math.random())}():__++,"0x"+__.toString(16)}function Cy(t){return t===0&&1/t==-1/0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var CC,cn;function AC(t){if(t===void 0)return Pb("RPC_ERROR","HTTP error has no status"),Tp;switch(t){case 200:return SC;case 400:return Jh;case 401:return e1;case 403:return W5;case 404:return G5;case 409:return H5;case 416:return Z5;case 429:return q5;case 499:return V5;case 500:return Tp;case 501:return X5;case 503:return J5;case 504:return $5;default:return t>=200&&t<300?SC:t>=400&&t<500?Jh:t>=500&&t<600?K5:Tp}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(cn=CC||(CC={}))[cn.OK=0]="OK",cn[cn.CANCELLED=1]="CANCELLED",cn[cn.UNKNOWN=2]="UNKNOWN",cn[cn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",cn[cn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",cn[cn.NOT_FOUND=5]="NOT_FOUND",cn[cn.ALREADY_EXISTS=6]="ALREADY_EXISTS",cn[cn.PERMISSION_DENIED=7]="PERMISSION_DENIED",cn[cn.UNAUTHENTICATED=16]="UNAUTHENTICATED",cn[cn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",cn[cn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",cn[cn.ABORTED=10]="ABORTED",cn[cn.OUT_OF_RANGE=11]="OUT_OF_RANGE",cn[cn.UNIMPLEMENTED=12]="UNIMPLEMENTED",cn[cn.INTERNAL=13]="INTERNAL",cn[cn.UNAVAILABLE=14]="UNAVAILABLE",cn[cn.DATA_LOSS=15]="DATA_LOSS";class uU extends class{constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const l=r.ssl?"https":"http",d=encodeURIComponent(this.databaseId.projectId),g=encodeURIComponent(this.databaseId.database);this.m=l+"://"+r.host,this.A=`projects/${d}/databases/${g}`,this.T=this.databaseId.database==="(default)"?`project_id=${d}`:`project_id=${d}&database_id=${g}`}get P(){return!1}R(r,l,d,g,w){const I=lU(),a=this.I(r,l);Iy("RestConnection",`Sending RPC '${r}' ${I}:`,a,d);const k={"google-cloud-resource-prefix":this.A,"x-goog-request-params":this.T};return this.V(k,g,w),this.p(r,a,k,d).then(O=>(Iy("RestConnection",`Received RPC '${r}' ${I}: `,O),O),O=>{throw AM("RestConnection",`RPC '${r}' ${I} failed with error: `,O,"url: ",a,"request:",d),O})}g(r,l,d,g,w,I){return this.R(r,l,d,g,w)}V(r,l,d){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+md}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),l&&l.headers.forEach((g,w)=>r[w]=g),d&&d.headers.forEach((g,w)=>r[w]=g)}I(r,l){const d=cU[r];return`${this.m}/v1/${l}:${d}`}}{constructor(e,r){super(e),this.F=r}v(e,r){throw new Error("Not supported by FetchConnection")}async p(e,r,l,d){var g;const w=JSON.stringify(d);let I;try{I=await this.F(r,{method:"POST",headers:l,body:w})}catch(a){const k=a;throw new Kt(AC(k.status),"Request failed with error: "+k.statusText)}if(!I.ok){let a=await I.json();Array.isArray(a)&&(a=a[0]);const k=(g=a==null?void 0:a.error)===null||g===void 0?void 0:g.message;throw new Kt(AC(I.status),`Request failed with error: ${k??I.statusText}`)}return I.json()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),r=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(r);else for(let l=0;l<t;l++)r[l]=Math.floor(256*Math.random());return r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dU{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=Math.floor(256/e.length)*e.length;let l="";for(;l.length<20;){const d=hU(40);for(let g=0;g<d.length;++g)l.length<20&&d[g]<r&&(l+=e.charAt(d[g]%e.length))}return l}}function tm(t,e){return t<e?-1:t>e?1:0}function RM(t,e,r){return t.length===e.length&&t.every((l,d)=>r(l,e[d]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PC(t){let e=0;for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e++;return e}function ym(t,e){for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&e(r,t[r])}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ca{constructor(e){this.binaryString=e}static fromBase64String(e){const r=function(d){try{return atob(d)}catch(g){throw typeof DOMException<"u"&&g instanceof DOMException?new fU("Invalid base64 string: "+g):g}}(e);return new Ca(r)}static fromUint8Array(e){const r=function(d){let g="";for(let w=0;w<d.length;++w)g+=String.fromCharCode(d[w]);return g}(e);return new Ca(r)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(r){return btoa(r)}(this.binaryString)}toUint8Array(){return function(r){const l=new Uint8Array(r.length);for(let d=0;d<r.length;d++)l[d]=r.charCodeAt(d);return l}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return tm(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ca.EMPTY_BYTE_STRING=new Ca("");const pU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function nm(t){if(Qi(!!t),typeof t=="string"){let e=0;const r=pU.exec(t);if(Qi(!!r),r[1]){let d=r[1];d=(d+"000000000").substr(0,9),e=Number(d)}const l=new Date(t);return{seconds:Math.floor(l.getTime()/1e3),nanos:e}}return{seconds:Ki(t.seconds),nanos:Ki(t.nanos)}}function Ki(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function t1(t){return typeof t=="string"?Ca.fromBase64String(t):Ca.fromUint8Array(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eo{constructor(e,r){if(this.seconds=e,this.nanoseconds=r,r<0)throw new Kt(wn,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new Kt(wn,"Timestamp nanoseconds out of range: "+r);if(e<-62135596800)throw new Kt(wn,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Kt(wn,"Timestamp seconds out of range: "+e)}static now(){return eo.fromMillis(Date.now())}static fromDate(e){return eo.fromMillis(e.getTime())}static fromMillis(e){const r=Math.floor(e/1e3),l=Math.floor(1e6*(e-1e3*r));return new eo(r,l)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?tm(this.nanoseconds,e.nanoseconds):tm(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(t){var e,r;return((r=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||r===void 0?void 0:r.stringValue)==="server_timestamp"}function LM(t){const e=t.mapValue.fields.__previous_value__;return DM(e)?LM(e):e}function n1(t){const e=nm(t.mapValue.fields.__local_write_time__.timestampValue);return new eo(e.seconds,e.nanos)}function r1(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?DM(t)?4:function(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}(t)?9007199254740991:10:Cr()}function i1(t,e){if(t===e)return!0;const r=r1(t);if(r!==r1(e))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return n1(t).isEqual(n1(e));case 3:return function(d,g){if(typeof d.timestampValue=="string"&&typeof g.timestampValue=="string"&&d.timestampValue.length===g.timestampValue.length)return d.timestampValue===g.timestampValue;const w=nm(d.timestampValue),I=nm(g.timestampValue);return w.seconds===I.seconds&&w.nanos===I.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(d,g){return t1(d.bytesValue).isEqual(t1(g.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(d,g){return Ki(d.geoPointValue.latitude)===Ki(g.geoPointValue.latitude)&&Ki(d.geoPointValue.longitude)===Ki(g.geoPointValue.longitude)}(t,e);case 2:return function(d,g){if("integerValue"in d&&"integerValue"in g)return Ki(d.integerValue)===Ki(g.integerValue);if("doubleValue"in d&&"doubleValue"in g){const w=Ki(d.doubleValue),I=Ki(g.doubleValue);return w===I?Cy(w)===Cy(I):isNaN(w)&&isNaN(I)}return!1}(t,e);case 9:return RM(t.arrayValue.values||[],e.arrayValue.values||[],i1);case 10:return function(d,g){const w=d.mapValue.fields||{},I=g.mapValue.fields||{};if(PC(w)!==PC(I))return!1;for(const a in w)if(w.hasOwnProperty(a)&&(I[a]===void 0||!i1(w[a],I[a])))return!1;return!0}(t,e);default:return Cr()}}function D0(t){return!!t&&"mapValue"in t}function Sp(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return ym(t.mapValue.fields,(r,l)=>e.mapValue.fields[r]=Sp(l)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let r=0;r<(t.arrayValue.values||[]).length;++r)e.arrayValue.values[r]=Sp(t.arrayValue.values[r]);return e}return Object.assign({},t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ci{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ci(e)}static min(){return new ci(new eo(0,0))}static max(){return new ci(new eo(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e,r){this.comparator=e,this.root=r||Kr.EMPTY}insert(e,r){return new Ay(this.comparator,this.root.insert(e,r,this.comparator).copy(null,null,Kr.BLACK,null,null))}remove(e){return new Ay(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Kr.BLACK,null,null))}get(e){let r=this.root;for(;!r.isEmpty();){const l=this.comparator(e,r.key);if(l===0)return r.value;l<0?r=r.left:l>0&&(r=r.right)}return null}indexOf(e){let r=0,l=this.root;for(;!l.isEmpty();){const d=this.comparator(e,l.key);if(d===0)return r+l.left.size;d<0?l=l.left:(r+=l.left.size+1,l=l.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((r,l)=>(e(r,l),!1))}toString(){const e=[];return this.inorderTraversal((r,l)=>(e.push(`${r}:${l}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new y_(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new y_(this.root,e,this.comparator,!1)}getReverseIterator(){return new y_(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new y_(this.root,e,this.comparator,!0)}}class y_{constructor(e,r,l,d){this.isReverse=d,this.nodeStack=[];let g=1;for(;!e.isEmpty();)if(g=r?l(e.key,r):1,r&&d&&(g*=-1),g<0)e=this.isReverse?e.left:e.right;else{if(g===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const r={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return r}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Kr{constructor(e,r,l,d,g){this.key=e,this.value=r,this.color=l??Kr.RED,this.left=d??Kr.EMPTY,this.right=g??Kr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,r,l,d,g){return new Kr(e??this.key,r??this.value,l??this.color,d??this.left,g??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,r,l){let d=this;const g=l(e,d.key);return d=g<0?d.copy(null,null,null,d.left.insert(e,r,l),null):g===0?d.copy(null,r,null,null,null):d.copy(null,null,null,null,d.right.insert(e,r,l)),d.fixUp()}removeMin(){if(this.left.isEmpty())return Kr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,r){let l,d=this;if(r(e,d.key)<0)d.left.isEmpty()||d.left.isRed()||d.left.left.isRed()||(d=d.moveRedLeft()),d=d.copy(null,null,null,d.left.remove(e,r),null);else{if(d.left.isRed()&&(d=d.rotateRight()),d.right.isEmpty()||d.right.isRed()||d.right.left.isRed()||(d=d.moveRedRight()),r(e,d.key)===0){if(d.right.isEmpty())return Kr.EMPTY;l=d.right.min(),d=d.copy(l.key,l.value,null,null,d.right.removeMin())}d=d.copy(null,null,null,null,d.right.remove(e,r))}return d.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Kr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Kr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,r)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Cr();const e=this.left.check();if(e!==this.right.check())throw Cr();return e+(this.isRed()?0:1)}}Kr.EMPTY=null,Kr.RED=!0,Kr.BLACK=!1;Kr.EMPTY=new class{constructor(){this.size=0}get key(){throw Cr()}get value(){throw Cr()}get color(){throw Cr()}get left(){throw Cr()}get right(){throw Cr()}copy(e,r,l,d,g){return this}insert(e,r,l){return new Kr(e,r)}remove(e,r){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Py{constructor(e){this.comparator=e,this.data=new Ay(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((r,l)=>(e(r),!1))}forEachInRange(e,r){const l=this.data.getIteratorFrom(e[0]);for(;l.hasNext();){const d=l.getNext();if(this.comparator(d.key,e[1])>=0)return;r(d.key)}}forEachWhile(e,r){let l;for(l=r!==void 0?this.data.getIteratorFrom(r):this.data.getIterator();l.hasNext();)if(!e(l.getNext().key))return}firstAfterOrEqual(e){const r=this.data.getIteratorFrom(e);return r.hasNext()?r.getNext().key:null}getIterator(){return new kC(this.data.getIterator())}getIteratorFrom(e){return new kC(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let r=this;return r.size<e.size&&(r=e,e=this),e.forEach(l=>{r=r.add(l)}),r}isEqual(e){if(!(e instanceof Py)||this.size!==e.size)return!1;const r=this.data.getIterator(),l=e.data.getIterator();for(;r.hasNext();){const d=r.getNext().key,g=l.getNext().key;if(this.comparator(d,g)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(r=>{e.push(r)}),e}toString(){const e=[];return this.forEach(r=>e.push(r)),"SortedSet("+e.toString()+")"}copy(e){const r=new Py(this.comparator);return r.data=e,r}}class kC{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(e){this.fields=e,e.sort(ss.comparator)}static empty(){return new cu([])}unionWith(e){let r=new Py(ss.comparator);for(const l of this.fields)r=r.add(l);for(const l of e)r=r.add(l);return new cu(r.toArray())}covers(e){for(const r of this.fields)if(r.isPrefixOf(e))return!0;return!1}isEqual(e){return RM(this.fields,e.fields,(r,l)=>r.isEqual(l))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this.value=e}static empty(){return new To({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let r=this.value;for(let l=0;l<e.length-1;++l)if(r=(r.mapValue.fields||{})[e.get(l)],!D0(r))return null;return r=(r.mapValue.fields||{})[e.lastSegment()],r||null}}set(e,r){this.getFieldsMap(e.popLast())[e.lastSegment()]=Sp(r)}setAll(e){let r=ss.emptyPath(),l={},d=[];e.forEach((w,I)=>{if(!r.isImmediateParentOf(I)){const a=this.getFieldsMap(r);this.applyChanges(a,l,d),l={},d=[],r=I.popLast()}w?l[I.lastSegment()]=Sp(w):d.push(I.lastSegment())});const g=this.getFieldsMap(r);this.applyChanges(g,l,d)}delete(e){const r=this.field(e.popLast());D0(r)&&r.mapValue.fields&&delete r.mapValue.fields[e.lastSegment()]}isEqual(e){return i1(this.value,e.value)}getFieldsMap(e){let r=this.value;r.mapValue.fields||(r.mapValue={fields:{}});for(let l=0;l<e.length;++l){let d=r.mapValue.fields[e.get(l)];D0(d)&&d.mapValue.fields||(d={mapValue:{fields:{}}},r.mapValue.fields[e.get(l)]=d),r=d}return r.mapValue.fields}applyChanges(e,r,l){ym(r,(d,g)=>e[d]=g);for(const d of l)delete e[d]}clone(){return new To(Sp(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa{constructor(e,r,l,d,g,w,I){this.key=e,this.documentType=r,this.version=l,this.readTime=d,this.createTime=g,this.data=w,this.documentState=I}static newInvalidDocument(e){return new fa(e,0,ci.min(),ci.min(),ci.min(),To.empty(),0)}static newFoundDocument(e,r,l,d){return new fa(e,1,r,ci.min(),l,d,0)}static newNoDocument(e,r){return new fa(e,2,r,ci.min(),ci.min(),To.empty(),0)}static newUnknownDocument(e,r){return new fa(e,3,r,ci.min(),ci.min(),To.empty(),2)}convertToFoundDocument(e,r){return!this.createTime.isEqual(ci.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=r,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=To.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=To.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ci.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof fa&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new fa(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(e,r=null,l=[],d=[],g=null,w="F",I=null,a=null){this.path=e,this.collectionGroup=r,this.explicitOrderBy=l,this.filters=d,this.limit=g,this.limitType=w,this.startAt=I,this.endAt=a,this.S=null,this.N=null,this.O=null,this.startAt,this.endAt}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gU(t,e){return function(l){return typeof l=="number"&&Number.isInteger(l)&&!Cy(l)&&l<=Number.MAX_SAFE_INTEGER&&l>=Number.MIN_SAFE_INTEGER}(e)?function(l){return{integerValue:""+l}}(e):function(l,d){if(l.useProto3Json){if(isNaN(d))return{doubleValue:"NaN"};if(d===1/0)return{doubleValue:"Infinity"};if(d===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cy(d)?"-0":d}}(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ov{constructor(){this._=void 0}}class _U extends ov{}class yU extends ov{constructor(e){super(),this.elements=e}}class vU extends ov{constructor(e){super(),this.elements=e}}class xU extends ov{constructor(e,r){super(),this.serializer=e,this.q=r}}class Fh{constructor(e,r){this.updateTime=e,this.exists=r}static none(){return new Fh}static exists(e){return new Fh(void 0,e)}static updateTime(e){return new Fh(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}class sv{}class zM extends sv{constructor(e,r,l,d=[]){super(),this.key=e,this.value=r,this.precondition=l,this.fieldTransforms=d,this.type=0}getFieldMask(){return null}}class Rb extends sv{constructor(e,r,l,d,g=[]){super(),this.key=e,this.data=r,this.fieldMask=l,this.precondition=d,this.fieldTransforms=g,this.type=1}getFieldMask(){return this.fieldMask}}class wU extends sv{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class bU extends sv{constructor(e,r){super(),this.key=e,this.precondition=r,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class EU{constructor(e,r){this.databaseId=e,this.useProto3Json=r}}function o1(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function TU(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function SU(t,e){return o1(t,e.toTimestamp())}function L0(t){return Qi(!!t),ci.fromTimestamp(function(r){const l=nm(r);return new eo(l.seconds,l.nanos)}(t))}function OM(t,e){return function(l){return new hi(["projects",l.projectId,"databases",l.database])}(t).child("documents").child(e).canonicalString()}function ky(t,e){return OM(t.databaseId,e.path)}function MC(t,e){const r=function(d){const g=hi.fromString(d);return Qi(FM(g)),g}(e);if(r.get(1)!==t.databaseId.projectId)throw new Kt(wn,"Tried to deserialize key from different project: "+r.get(1)+" vs "+t.databaseId.projectId);if(r.get(3)!==t.databaseId.database)throw new Kt(wn,"Tried to deserialize key from different database: "+r.get(3)+" vs "+t.databaseId.database);return new as(function(d){return Qi(d.length>4&&d.get(4)==="documents"),d.popFirst(5)}(r))}function BM(t){return new hi(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function RC(t,e,r){return{name:ky(t,e),fields:r.value.mapValue.fields}}function IU(t,e){return"found"in e?function(l,d){Qi(!!d.found),d.found.name,d.found.updateTime;const g=MC(l,d.found.name),w=L0(d.found.updateTime),I=d.found.createTime?L0(d.found.createTime):ci.min(),a=new To({mapValue:{fields:d.found.fields}});return fa.newFoundDocument(g,w,I,a)}(t,e):"missing"in e?function(l,d){Qi(!!d.missing),Qi(!!d.readTime);const g=MC(l,d.missing),w=L0(d.readTime);return fa.newNoDocument(g,w)}(t,e):Cr()}function CU(t,e){let r;if(e instanceof zM)r={update:RC(t,e.key,e.value)};else if(e instanceof wU)r={delete:ky(t,e.key)};else if(e instanceof Rb)r={update:RC(t,e.key,e.data),updateMask:AU(e.fieldMask)};else{if(!(e instanceof bU))return Cr();r={verify:ky(t,e.key)}}return e.fieldTransforms.length>0&&(r.updateTransforms=e.fieldTransforms.map(l=>function(g,w){const I=w.transform;if(I instanceof _U)return{fieldPath:w.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(I instanceof yU)return{fieldPath:w.field.canonicalString(),appendMissingElements:{values:I.elements}};if(I instanceof vU)return{fieldPath:w.field.canonicalString(),removeAllFromArray:{values:I.elements}};if(I instanceof xU)return{fieldPath:w.field.canonicalString(),increment:I.q};throw Cr()}(0,l))),e.precondition.isNone||(r.currentDocument=function(d,g){return g.updateTime!==void 0?{updateTime:SU(d,g.updateTime)}:g.exists!==void 0?{exists:g.exists}:Cr()}(t,e.precondition)),r}function AU(t){const e=[];return t.fields.forEach(r=>e.push(r.canonicalString())),{fieldPaths:e}}function FM(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Db(t){return new EU(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PU extends class{}{constructor(e,r,l,d){super(),this.authCredentials=e,this.appCheckCredentials=r,this.connection=l,this.serializer=d,this.J=!1}Y(){if(this.J)throw new Kt(Jh,"The client has already been terminated.")}R(e,r,l){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([d,g])=>this.connection.R(e,r,l,d,g)).catch(d=>{throw d.name==="FirebaseError"?(d.code===e1&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),d):new Kt(Tp,d.toString())})}g(e,r,l,d){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([g,w])=>this.connection.g(e,r,l,g,w,d)).catch(g=>{throw g.name==="FirebaseError"?(g.code===e1&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),g):new Kt(Tp,g.toString())})}terminate(){this.J=!0}}async function NM(t,e){const r=PM(t),l=BM(r.serializer)+"/documents",d={writes:e.map(g=>CU(r.serializer,g))};await r.R("Commit",l,d)}async function kU(t,e){const r=PM(t),l=BM(r.serializer)+"/documents",d={documents:e.map(a=>ky(r.serializer,a))},g=await r.g("BatchGetDocuments",l,d,e.length),w=new Map;g.forEach(a=>{const k=IU(r.serializer,a);w.set(k.key.toString(),k)});const I=[];return e.forEach(a=>{const k=w.get(a.toString());Qi(!!k),I.push(k)}),I}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ip=new Map;function Lb(t){if(t._terminated)throw new Kt(Jh,"The client has already been terminated.");if(!Ip.has(t)){Iy("ComponentProvider","Initializing Datastore");const e=function(g){return new uU(g,fetch.bind(null))}(function(g,w,I,a){return new oU(g,w,I,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,MM(a.experimentalLongPollingOptions),a.useFetchStreams)}(t._databaseId,t.app.options.appId||"",t._persistenceKey,t._freezeSettings())),r=Db(t._databaseId),l=function(g,w,I,a){return new PU(g,w,I,a)}(t._authCredentials,t._appCheckCredentials,e,r);Ip.set(t,l)}return Ip.get(t)}class DC{constructor(e){var r,l;if(e.host===void 0){if(e.ssl!==void 0)throw new Kt(wn,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(r=e.ssl)===null||r===void 0||r;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new Kt(wn,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(g,w,I,a){if(w===!0&&a===!0)throw new Kt(wn,`${g} and ${I} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=MM((l=e.experimentalLongPollingOptions)!==null&&l!==void 0?l:{}),function(g){if(g.timeoutSeconds!==void 0){if(isNaN(g.timeoutSeconds))throw new Kt(wn,`invalid long polling timeout: ${g.timeoutSeconds} (must not be NaN)`);if(g.timeoutSeconds<5)throw new Kt(wn,`invalid long polling timeout: ${g.timeoutSeconds} (minimum allowed value is 5)`);if(g.timeoutSeconds>30)throw new Kt(wn,`invalid long polling timeout: ${g.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(l,d){return l.timeoutSeconds===d.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class zb{constructor(e,r,l,d){this._authCredentials=e,this._appCheckCredentials=r,this._databaseId=l,this._app=d,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new DC({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Kt(Jh,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new Kt(Jh,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new DC(e),e.credentials!==void 0&&(this._authCredentials=function(l){if(!l)return new Y5;switch(l.type){case"firstParty":return new nU(l.sessionIndex||"0",l.iamToken||null,l.authTokenFactory||null);case"provider":return l.client;default:throw new Kt(wn,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(r){const l=Ip.get(r);l&&(Iy("ComponentProvider","Removing Datastore"),Ip.delete(r),l.terminate())}(this),Promise.resolve()}}function MU(t,e){const r=typeof t=="object"?t:Zk(),l=typeof t=="string"?t:e||"(default)",d=vb(r,"firestore/lite").getImmediate({identifier:l});if(!d._initialized){const g=tN("firestore");g&&RU(d,...g)}return d}function RU(t,e,r,l={}){var d;const g=(t=iv(t,zb))._getSettings(),w=`${e}:${r}`;if(g.host!=="firestore.googleapis.com"&&g.host!==w&&AM("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},g),{host:w,ssl:!1})),l.mockUserToken){let I,a;if(typeof l.mockUserToken=="string")I=l.mockUserToken,a=Di.MOCK_USER;else{I=rN(l.mockUserToken,(d=t._app)===null||d===void 0?void 0:d.options.projectId);const k=l.mockUserToken.sub||l.mockUserToken.user_id;if(!k)throw new Kt(wn,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Di(k)}t._authCredentials=new Q5(new kM(I,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ob{constructor(e,r,l){this.converter=r,this._query=l,this.type="query",this.firestore=e}withConverter(e){return new Ob(this.firestore,e,this._query)}}class to{constructor(e,r,l){this.converter=r,this._key=l,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new rm(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new to(this.firestore,e,this._key)}}class rm extends Ob{constructor(e,r,l){super(e,r,function(g){return new mU(g)}(l)),this._path=l,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new to(this.firestore,null,new as(e))}withConverter(e){return new rm(this.firestore,e,this._path)}}function dr(t,e,...r){if(t=pi(t),arguments.length===1&&(e=dU.newId()),aU("doc","path",e),t instanceof zb){const l=hi.fromString(e,...r);return IC(l),new to(t,null,new as(l))}{if(!(t instanceof to||t instanceof rm))throw new Kt(wn,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const l=t._path.child(hi.fromString(e,...r));return IC(l),new to(t.firestore,t instanceof rm?t.converter:null,new as(l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yh{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Yh(Ca.fromBase64String(e))}catch(r){throw new Kt(wn,"Failed to construct data from Base64 string: "+r)}}static fromUint8Array(e){return new Yh(Ca.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av{constructor(...e){for(let r=0;r<e.length;++r)if(e[r].length===0)throw new Kt(wn,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ss(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bb{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,r){if(!isFinite(e)||e<-90||e>90)throw new Kt(wn,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(r)||r<-180||r>180)throw new Kt(wn,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=e,this._long=r}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return tm(this._lat,e._lat)||tm(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DU=/^__.*__$/;class LU{constructor(e,r,l){this.data=e,this.fieldMask=r,this.fieldTransforms=l}toMutation(e,r){return this.fieldMask!==null?new Rb(e,this.data,this.fieldMask,r,this.fieldTransforms):new zM(e,this.data,r,this.fieldTransforms)}}class jM{constructor(e,r,l){this.data=e,this.fieldMask=r,this.fieldTransforms=l}toMutation(e,r){return new Rb(e,this.data,this.fieldMask,r,this.fieldTransforms)}}function UM(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Cr()}}class Nb{constructor(e,r,l,d,g,w){this.settings=e,this.databaseId=r,this.serializer=l,this.ignoreUndefinedProperties=d,g===void 0&&this.X(),this.fieldTransforms=g||[],this.fieldMask=w||[]}get path(){return this.settings.path}get tt(){return this.settings.tt}et(e){return new Nb(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}rt(e){var r;const l=(r=this.path)===null||r===void 0?void 0:r.child(e),d=this.et({path:l,nt:!1});return d.it(e),d}st(e){var r;const l=(r=this.path)===null||r===void 0?void 0:r.child(e),d=this.et({path:l,nt:!1});return d.X(),d}ot(e){return this.et({path:void 0,nt:!0})}ut(e){return My(e,this.settings.methodName,this.settings._t||!1,this.path,this.settings.ct)}contains(e){return this.fieldMask.find(r=>e.isPrefixOf(r))!==void 0||this.fieldTransforms.find(r=>e.isPrefixOf(r.field))!==void 0}X(){if(this.path)for(let e=0;e<this.path.length;e++)this.it(this.path.get(e))}it(e){if(e.length===0)throw this.ut("Document fields must not be empty");if(UM(this.tt)&&DU.test(e))throw this.ut('Document fields cannot begin and end with "__"')}}class zU{constructor(e,r,l){this.databaseId=e,this.ignoreUndefinedProperties=r,this.serializer=l||Db(e)}lt(e,r,l,d=!1){return new Nb({tt:e,methodName:r,ct:l,path:ss.emptyPath(),nt:!1,_t:d},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function VM(t){const e=t._freezeSettings(),r=Db(t._databaseId);return new zU(t._databaseId,!!e.ignoreUndefinedProperties,r)}function OU(t,e,r,l,d,g={}){const w=t.lt(g.merge||g.mergeFields?2:0,e,r,d);jb("Data must be an object, but it was:",w,l);const I=$M(l,w);let a,k;if(g.merge)a=new cu(w.fieldMask),k=w.fieldTransforms;else if(g.mergeFields){const O=[];for(const V of g.mergeFields){const G=s1(e,V,r);if(!w.contains(G))throw new Kt(wn,`Field '${G}' is specified in your field mask but missing from your input data.`);WM(O,G)||O.push(G)}a=new cu(O),k=w.fieldTransforms.filter(V=>a.covers(V.field))}else a=null,k=w.fieldTransforms;return new LU(new To(I),a,k)}class lv extends Bb{_toFieldTransform(e){if(e.tt!==2)throw e.tt===1?e.ut(`${this._methodName}() can only appear at the top level of your update data`):e.ut(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof lv}}function BU(t,e,r,l){const d=t.lt(1,e,r);jb("Data must be an object, but it was:",d,l);const g=[],w=To.empty();ym(l,(a,k)=>{const O=Ub(e,a,r);k=pi(k);const V=d.st(O);if(k instanceof lv)g.push(O);else{const G=cv(k,V);G!=null&&(g.push(O),w.set(O,G))}});const I=new cu(g);return new jM(w,I,d.fieldTransforms)}function FU(t,e,r,l,d,g){const w=t.lt(1,e,r),I=[s1(e,l,r)],a=[d];if(g.length%2!=0)throw new Kt(wn,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let G=0;G<g.length;G+=2)I.push(s1(e,g[G])),a.push(g[G+1]);const k=[],O=To.empty();for(let G=I.length-1;G>=0;--G)if(!WM(k,I[G])){const X=I[G];let oe=a[G];oe=pi(oe);const le=w.st(X);if(oe instanceof lv)k.push(X);else{const we=cv(oe,le);we!=null&&(k.push(X),O.set(X,we))}}const V=new cu(k);return new jM(O,V,w.fieldTransforms)}function cv(t,e){if(GM(t=pi(t)))return jb("Unsupported field value:",e,t),$M(t,e);if(t instanceof Bb)return function(l,d){if(!UM(d.tt))throw d.ut(`${l._methodName}() can only be used with update() and set()`);if(!d.path)throw d.ut(`${l._methodName}() is not currently supported inside arrays`);const g=l._toFieldTransform(d);g&&d.fieldTransforms.push(g)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.nt&&e.tt!==4)throw e.ut("Nested arrays are not supported");return function(l,d){const g=[];let w=0;for(const I of l){let a=cv(I,d.ot(w));a==null&&(a={nullValue:"NULL_VALUE"}),g.push(a),w++}return{arrayValue:{values:g}}}(t,e)}return function(l,d){if((l=pi(l))===null)return{nullValue:"NULL_VALUE"};if(typeof l=="number")return gU(d.serializer,l);if(typeof l=="boolean")return{booleanValue:l};if(typeof l=="string")return{stringValue:l};if(l instanceof Date){const g=eo.fromDate(l);return{timestampValue:o1(d.serializer,g)}}if(l instanceof eo){const g=new eo(l.seconds,1e3*Math.floor(l.nanoseconds/1e3));return{timestampValue:o1(d.serializer,g)}}if(l instanceof Fb)return{geoPointValue:{latitude:l.latitude,longitude:l.longitude}};if(l instanceof Yh)return{bytesValue:TU(d.serializer,l._byteString)};if(l instanceof to){const g=d.databaseId,w=l.firestore._databaseId;if(!w.isEqual(g))throw d.ut(`Document reference is for database ${w.projectId}/${w.database} but should be for database ${g.projectId}/${g.database}`);return{referenceValue:OM(l.firestore._databaseId||d.databaseId,l._key.path)}}throw d.ut(`Unsupported field value: ${Mb(l)}`)}(t,e)}function $M(t,e){const r={};return function(d){for(const g in d)if(Object.prototype.hasOwnProperty.call(d,g))return!1;return!0}(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ym(t,(l,d)=>{const g=cv(d,e.rt(l));g!=null&&(r[l]=g)}),{mapValue:{fields:r}}}function GM(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof eo||t instanceof Fb||t instanceof Yh||t instanceof to||t instanceof Bb)}function jb(t,e,r){if(!GM(r)||!function(d){return typeof d=="object"&&d!==null&&(Object.getPrototypeOf(d)===Object.prototype||Object.getPrototypeOf(d)===null)}(r)){const l=Mb(r);throw l==="an object"?e.ut(t+" a custom object"):e.ut(t+" "+l)}}function s1(t,e,r){if((e=pi(e))instanceof av)return e._internalPath;if(typeof e=="string")return Ub(t,e);throw My("Field path arguments must be of type string or ",t,!1,void 0,r)}const NU=new RegExp("[~\\*/\\[\\]]");function Ub(t,e,r){if(e.search(NU)>=0)throw My(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,r);try{return new av(...e.split("."))._internalPath}catch{throw My(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,r)}}function My(t,e,r,l,d){const g=l&&!l.isEmpty(),w=d!==void 0;let I=`Function ${e}() called with invalid data`;r&&(I+=" (via `toFirestore()`)"),I+=". ";let a="";return(g||w)&&(a+=" (found",g&&(a+=` in field ${l}`),w&&(a+=` in document ${d}`),a+=")"),new Kt(wn,I+t+a)}function WM(t,e){return t.some(r=>r.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{constructor(e,r,l,d,g){this._firestore=e,this._userDataWriter=r,this._key=l,this._document=d,this._converter=g}get id(){return this._key.path.lastSegment()}get ref(){return new to(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new jU(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const r=this._document.data.field(UU("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r)}}}class jU extends qM{data(){return super.data()}}function UU(t,e){return typeof e=="string"?Ub(t,e):e instanceof av?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VU(t,e,r){let l;return l=t?r&&(r.merge||r.mergeFields)?t.toFirestore(e,r):t.toFirestore(e):e,l}class $U extends class{convertValue(r,l="none"){switch(r1(r)){case 0:return null;case 1:return r.booleanValue;case 2:return Ki(r.integerValue||r.doubleValue);case 3:return this.convertTimestamp(r.timestampValue);case 4:return this.convertServerTimestamp(r,l);case 5:return r.stringValue;case 6:return this.convertBytes(t1(r.bytesValue));case 7:return this.convertReference(r.referenceValue);case 8:return this.convertGeoPoint(r.geoPointValue);case 9:return this.convertArray(r.arrayValue,l);case 10:return this.convertObject(r.mapValue,l);default:throw Cr()}}convertObject(r,l){return this.convertObjectMap(r.fields,l)}convertObjectMap(r,l="none"){const d={};return ym(r,(g,w)=>{d[g]=this.convertValue(w,l)}),d}convertGeoPoint(r){return new Fb(Ki(r.latitude),Ki(r.longitude))}convertArray(r,l){return(r.values||[]).map(d=>this.convertValue(d,l))}convertServerTimestamp(r,l){switch(l){case"previous":const d=LM(r);return d==null?null:this.convertValue(d,l);case"estimate":return this.convertTimestamp(n1(r));default:return null}}convertTimestamp(r){const l=nm(r);return new eo(l.seconds,l.nanos)}convertDocumentKey(r,l){const d=hi.fromString(r);Qi(FM(d));const g=new Qp(d.get(1),d.get(3)),w=new as(d.popFirst(5));return g.isEqual(l)||Pb(`Document ${w} contains a document reference within a different database (${g.projectId}/${g.database}) which is not supported. It will be treated as a reference in the current database (${l.projectId}/${l.database}) instead.`),w}}{constructor(e){super(),this.firestore=e}convertBytes(e){return new Yh(e)}convertReference(e){const r=this.convertDocumentKey(e,this.firestore._databaseId);return new to(this.firestore,null,r)}}function As(t){const e=Lb((t=iv(t,to)).firestore),r=new $U(t.firestore);return kU(e,[t._key]).then(l=>{Qi(l.length===1);const d=l[0];return new qM(t.firestore,r,t._key,d.isFoundDocument()?d:null,t.converter)})}function Ur(t,e,r){const l=VU((t=iv(t,to)).converter,e,r),d=OU(VM(t.firestore),"setDoc",t._key,l,t.converter!==null,r);return NM(Lb(t.firestore),[d.toMutation(t._key,Fh.none())])}function z0(t,e,r,...l){const d=VM((t=iv(t,to)).firestore);let g;return g=typeof(e=pi(e))=="string"||e instanceof av?FU(d,"updateDoc",t._key,e,r,l):BU(d,"updateDoc",t._key,e),NM(Lb(t.firestore),[g.toMutation(t._key,Fh.exists(!0))])}(function(){(function(r){md=r})(`${fd}_lite`),Zh(new ou("firestore/lite",(e,{instanceIdentifier:r,options:l})=>{const d=e.getProvider("app").getImmediate(),g=new zb(new eU(e.getProvider("auth-internal")),new iU(e.getProvider("app-check-internal")),function(I,a){if(!Object.prototype.hasOwnProperty.apply(I.options,["projectId"]))throw new Kt(wn,'"projectId" not provided in firebase.initializeApp.');return new Qp(I.options.projectId,a)}(d,r),d);return l&&g._setSettings(l),g},"PUBLIC").setMultipleInstances(!0)),$l("firestore-lite","4.3.2",""),$l("firestore-lite","4.3.2","esm2017")})();const GU={apiKey:"AIzaSyCVOJPZxYP9RoB-I_3kdN-36gv9JdHr1cM",authDomain:"routemaps-34d2b.firebaseapp.com",projectId:"routemaps-34d2b",storageBucket:"routemaps-34d2b.appspot.com",messagingSenderId:"528232130057",appId:"1:528232130057:web:25c5779566edc1de92bad8"},WU=GU,HM=Hk(WU),_l=N5(HM),fr=MU(HM);class wl extends Error{constructor(e){super(e)}}var pa=(t=>(t.InvalidRegister="Bad register: Invalid email or password format",t.InvalidLogin="Bad login: Invalid email or password",t.InvalidLogout="Bad logout: There's no user to logout",t.InvalidDelete="Bad delete user: No recent logged user",t.InvalidUuid="Bad uuid: No user found with given uuid",t))(pa||{});class Ml extends Error{constructor(e){super(e)}}var Gl=(t=>(t.FarPathway="Bad pathway: From and to too far away",t.OpenRouteApiNotResponding="Api offline: OpenRouteApi is not responding",t.AlreadyExists="The pathway already exists.",t.InvalidPathway="Bad pathway: The pathway does not have the correct attributes.",t.EmptyPathwayList="The pathway list is empty",t.PathwayNotFound="The pathway does not exists",t))(Gl||{});class Ph extends Error{constructor(e){super(e)}}var Xc=(t=>(t.IllegalArgument="One of the params has an invalid type.",t.OpenRouteApiNotResponding="Api offline: OpenRouteApi is not responding",t.InvalidCoordinates="Bad coordinates: The coordinates are not correct.",t.InvalidToponym="Bad toponym: The toponym is not correct.",t.EmptyPlaces="The place list is empty.",t.PlaceNotFound="The place does not exists.",t))(Xc||{}),gr=(t=>(t.WALKING="foot-walking",t.VEHICLE="driving-car",t.BIKE="cycling-regular",t))(gr||{});class ZM extends Error{constructor(e){super(e),this.name="EmptyVehiclesException"}}class Nh extends Error{constructor(e){super(e),this.name="VehicleNotFoundException"}}class uv{async createUserWithEmailAndPassword(e,r,l){let d;try{d=await wj(_l,e,r)}catch{throw new wl(pa.InvalidRegister)}const{uid:g}=d.user;return _l.currentUser&&await Tj(_l.currentUser,{displayName:l}),{uid:g,email:e,displayName:l}}async startLoginWithEmailAndPassword(e,r){let l;try{l=await bj(_l,e,r)}catch{throw new wl(pa.InvalidLogin)}const{uid:d,displayName:g}=l.user;return{uid:d,email:e,displayName:g||""}}async startLogout(){if(_l.currentUser===null)throw new wl(pa.InvalidLogout);await _l.signOut().catch(()=>{throw new wl(pa.InvalidLogout)})}async startDeletingUser(){if(_l.currentUser)await Cj(_l.currentUser).catch(()=>{throw new wl(pa.InvalidDelete)});else throw new wl(pa.InvalidDelete)}async setDefaultVehicle(e,r){const l=dr(fr,`${r}`,"defaultVehiclePlate");await Ur(l,{vehiclePlate:e})}async getDefaultVehicle(e){const r=dr(fr,`${e}`,"defaultVehiclePlate"),l=await As(r);if(!l.exists())throw new Error("No such document!");return l.data()}async storePlace(e,r){const l=dr(fr,r,"places"),g=(await this.getPlaces(r)).places||[],w=g.findIndex(I=>e.Nombre===I.Nombre||e.Latitud===I.Latitud&&e.Longitud===I.Longitud);return w!==-1?g[w]=e:g.push(e),await Ur(l,{places:g},{merge:!0}),g}async deletePlace(e,r){const l=dr(fr,r,"places"),d=await this.getPlaces(r);if(d.places.length===0)throw new Ph(Xc.EmptyPlaces);let g=(d==null?void 0:d.places)||[];const w=g.filter(I=>I.Nombre!==e.Nombre);if(w.length===g.length)throw new Ph(Xc.PlaceNotFound);await Ur(l,{places:w},{merge:!0})}async getPlaces(e){const r=dr(fr,`${e}`,"places"),l=await As(r);return l.exists()?l.data():(await Ur(r,{places:[]}),{places:[]})}async setPlaces(e,r){const l=dr(fr,`${r}`,"places"),d=await As(l);if(d.exists()){const w=d.data().places.map(I=>{const a=e.find(k=>k.Nombre===I.Nombre);return a?{...I,Favorito:a.Favorito}:I});await z0(l,{places:w})}else await Ur(l,{places:e},{merge:!0})}async replacePlaces(e,r){const l=dr(fr,`${r}`,"places");await Ur(l,{places:e},{merge:!0})}async replacePathways(e,r){const l=dr(fr,`${r}`,"pathways");await Ur(l,{pathways:e},{merge:!0})}async storeVehicle(e,r){const l=dr(fr,r,"vehicles"),g=(await this.getVehicles(r)).vehicles||[],w=g.findIndex(I=>I.plate===e.plate);return w!==-1?g[w]=e:g.push(e),await Ur(l,{vehicles:g},{merge:!0}),g}async getVehicle(e,r){const l=dr(fr,`${e}`,"vehicles"),d=await As(l);if(!d.exists())throw new Error("No vehicles document found for the user!");const g=d.data();if(!g||!Array.isArray(g.vehicles))throw new Error("Invalid vehicle data!");const I=g.vehicles.find(a=>a.plate===r);if(!I)throw new ZM;return I}async getVehicles(e){const r=dr(fr,`${e}`,"vehicles"),l=await As(r);return l.exists()?l.data():(await Ur(r,{vehicles:[]}),{vehicles:[]})}async updateVehicles(e,r){const l=dr(fr,`${r}`,"vehicles"),d=await As(l);if(d.exists()){const w=d.data().vehicles.map(I=>{const a=e.find(k=>k.plate===I.plate);return a?{...I,favorite:a.favorite}:I});await z0(l,{vehicles:w})}else await Ur(l,{vehicles:e},{merge:!0})}async setVehicles(e,r){const l=dr(fr,`${r}`,"vehicles");await Ur(l,{vehicles:e},{merge:!0})}async deleteVehicle(e,r){const l=dr(fr,r,"vehicles");let g=(await this.getVehicles(r)).vehicles||[];const w=g.findIndex(I=>I.plate===e.plate);if(w!==-1)g.splice(w,1),await Ur(l,{vehicles:g},{merge:!0});else throw new Nh}pathwaysAreEqual(e,r){return e.start.name===r.start.name&&e.end.name===r.end.name&&e.type===r.type&&(e.transportMean!==gr.VEHICLE||e.vehiclePlate===r.vehiclePlate)}async storePathway(e,r){const l=dr(fr,r,"pathways");let d;try{d=await this.getPathways(r)}catch(I){if(I instanceof Ml)d={pathways:[]};else throw I}const g=d.pathways||[],w=g.findIndex(I=>this.pathwaysAreEqual(e,I));return w!==-1?g[w]=e:g.push(e),await Ur(l,{pathways:g},{merge:!0}),g}async deletePathway(e,r){const l=dr(fr,r,"pathways"),d=await this.getPathways(r);if(d.pathways.length===0)throw new Ml(Gl.EmptyPathwayList);let g=d.pathways;if(g=g.filter(w=>!this.pathwaysAreEqual(e,w)),g.length===d.pathways.length)throw new Ml(Gl.PathwayNotFound);await Ur(l,{pathways:g},{merge:!0})}async getPathways(e){const r=dr(fr,`${e}`,"pathways"),l=await As(r);if(!l.exists())return await Ur(r,{pathways:[]}),{pathways:[]};if(l.data().pathways.length===0)throw new Ml(Gl.EmptyPathwayList);return l.data()}async updatePathways(e,r){const l=dr(fr,`${r}`,"pathways");(await As(l)).exists()?await z0(l,{pathways:e}):await Ur(l,{pathways:e},{merge:!0})}async storeFuelPrice(e,r){const l=dr(fr,"fuel",`${e}`);await Ur(l,{price:r,date:new Date},{merge:!0})}async getFuelPriceAndDate(e){const r=dr(fr,"fuel",`${e}`),l=await As(r);if(!l.exists())throw new Error("No such document!");return l.data()}async setDefaultPathwayType(e,r){const l=dr(fr,`${r}`,"defaultPathwayType");await Ur(l,{pathwayType:e})}async getDefaultPathwayType(e){const r=dr(fr,`${e}`,"defaultPathwayType"),l=await As(r);if(!l.exists())throw new Error("No such document!");return l.data()}}class qU{constructor(e){this.firebaseService=e}async registerUserWithEmailAndPassword(e,r,l){if(e.includes("@")&&r.length>5){const d=await this.firebaseService.createUserWithEmailAndPassword(e,r,l);return await this.firebaseService.setDefaultPathwayType(Lr.RECOMMENDED,d.uid),localStorage.setItem("uuid",d.uid),localStorage.setItem("displayName",d.displayName),localStorage.setItem("email",d.email),d}else throw new wl(pa.InvalidRegister)}async loginWithEmailAndPassword(e,r){if(e.includes("@")&&r.length>5){const l=await this.firebaseService.startLoginWithEmailAndPassword(e,r);return localStorage.setItem("uuid",l.uid),localStorage.setItem("displayName",l.displayName),localStorage.setItem("email",l.email),l}else throw new wl(pa.InvalidLogin)}async logout(){await this.firebaseService.startLogout(),localStorage.clear()}async deleteUser(){await this.firebaseService.startDeletingUser(),localStorage.clear()}}let O0;function hv(t){return O0||(O0=new qU(t||new uv)),O0}const XM="/assets/routeMapsAuthImage-TV23-bLb.jpeg",Vb="/assets/logoRouteMapsSinFondo-KQ20Kodx.png",HU=()=>{const t=re.useContext(zr),e={displayName:"",email:"",password:""},r=[{id:"displayName",label:"Nombre",type:"text"},{id:"email",label:"Email",type:"email"},{id:"password",label:"Contrasea",type:"password",placeholder:"Longitud mnima 6 caracteres"}],l={name:"Ya tienes una cuenta?",url:"/login",clickable:"Inicia sesin"},d={displayName:w=>w?null:"El nombre es requerido",email:w=>w?null:"El email es requerido",password:w=>w?w.length<6?"La contrasea debe tener al menos 6 caracteres":null:"La contrasea es requerida"},g=async w=>{const a=await hv().registerUserWithEmailAndPassword(w.email,w.password,w.displayName);t.setUser(a),t.setIsLogged(!0)};return j.jsxs("div",{className:"row d-flex align-items-center",style:{margin:"20px",minHeight:"80vh"},children:[j.jsx("div",{className:"col-6",children:j.jsx("div",{className:"card",children:j.jsxs("div",{className:"card-body",children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h1",{className:"card-title",children:"Registrarse"}),j.jsx("img",{src:Vb,width:"55",height:"55",alt:"Logo Route Maps",style:{marginRight:"10px"}})]}),j.jsx("hr",{style:{marginBottom:"20px"}}),j.jsx(mu,{formData:e,formFields:r,validations:d,onSubmit:g,submitButtonLabel:"Crear cuenta",additionalFormLink:l})]})})}),j.jsx("div",{className:"col-6",children:j.jsx("img",{src:XM,alt:"RouteMaps welcome image | auth",style:{maxWidth:"90%",maxHeight:"100%",objectFit:"contain"}})})]})};class ZU extends Error{}class XU{constructor(e){this.firebaseService=e}async toggleFavourite(e,r){const l=await this.firebaseService.getVehicles(r);if(l.vehicles.length===0)throw new ZM;const g=l.vehicles.findIndex(w=>w.plate===e);if(g!==-1)return l.vehicles[g].favorite=!l.vehicles[g].favorite,await this.firebaseService.storeVehicle(l.vehicles[g],r),!0;throw new Nh}async addVehicle(e,r){if(!/^[0-9]{4}[BCDFGHJKLMNPRSTVWXYZ]{3}$/.test(e.plate)||e.consumption>50||e.name.length>30)throw new ZU;try{return await this.firebaseService.storeVehicle(e,r),!0}catch(d){throw d}}async setVehicles(e,r){await this.firebaseService.setVehicles(e,r)}async getVehicle(e,r){return this.firebaseService.getVehicle(r,e)}async setVehicle(e,r){return await this.firebaseService.storeVehicle(e,r)}async getVehicles(e){const r=await this.firebaseService.getVehicles(e);return(r==null?void 0:r.vehicles)||[]}async deleteVehicle(e,r){await this.firebaseService.deleteVehicle(e,r)}async modifyVehicle(e,r){try{return await this.firebaseService.storeVehicle(e,r),!0}catch(l){throw l}}async updateVehicles(e,r){await this.firebaseService.updateVehicles(e,r)}async setDefaultVehicle(e,r){await this.getVehicle(e,r).catch(()=>{throw new Nh("El vehculo no existe")}),await this.firebaseService.setDefaultVehicle(e,r),localStorage.setItem("defaultVehiclePlate",e)}async getDefaultVehicle(e){let r="";return await this.firebaseService.getDefaultVehicle(e).then(l=>{r=l.vehiclePlate}).catch(()=>{throw new Nh("El usuario no tiene vehculo por defecto")}),localStorage.setItem("defaultVehiclePlate",r),r}}let B0;function gd(t){return B0||(B0=new XU(t||new uv)),B0}function KM(t,e){return function(){return t.apply(e,arguments)}}const{toString:KU}=Object.prototype,{getPrototypeOf:$b}=Object,dv=(t=>e=>{const r=KU.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),Ns=t=>(t=t.toLowerCase(),e=>dv(e)===t),fv=t=>e=>typeof e===t,{isArray:_d}=Array,im=fv("undefined");function JU(t){return t!==null&&!im(t)&&t.constructor!==null&&!im(t.constructor)&&Co(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const JM=Ns("ArrayBuffer");function YU(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&JM(t.buffer),e}const QU=fv("string"),Co=fv("function"),YM=fv("number"),pv=t=>t!==null&&typeof t=="object",eV=t=>t===!0||t===!1,F_=t=>{if(dv(t)!=="object")return!1;const e=$b(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},tV=Ns("Date"),nV=Ns("File"),rV=Ns("Blob"),iV=Ns("FileList"),oV=t=>pv(t)&&Co(t.pipe),sV=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Co(t.append)&&((e=dv(t))==="formdata"||e==="object"&&Co(t.toString)&&t.toString()==="[object FormData]"))},aV=Ns("URLSearchParams"),lV=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function vm(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let l,d;if(typeof t!="object"&&(t=[t]),_d(t))for(l=0,d=t.length;l<d;l++)e.call(null,t[l],l,t);else{const g=r?Object.getOwnPropertyNames(t):Object.keys(t),w=g.length;let I;for(l=0;l<w;l++)I=g[l],e.call(null,t[I],I,t)}}function QM(t,e){e=e.toLowerCase();const r=Object.keys(t);let l=r.length,d;for(;l-- >0;)if(d=r[l],e===d.toLowerCase())return d;return null}const eR=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,tR=t=>!im(t)&&t!==eR;function a1(){const{caseless:t}=tR(this)&&this||{},e={},r=(l,d)=>{const g=t&&QM(e,d)||d;F_(e[g])&&F_(l)?e[g]=a1(e[g],l):F_(l)?e[g]=a1({},l):_d(l)?e[g]=l.slice():e[g]=l};for(let l=0,d=arguments.length;l<d;l++)arguments[l]&&vm(arguments[l],r);return e}const cV=(t,e,r,{allOwnKeys:l}={})=>(vm(e,(d,g)=>{r&&Co(d)?t[g]=KM(d,r):t[g]=d},{allOwnKeys:l}),t),uV=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),hV=(t,e,r,l)=>{t.prototype=Object.create(e.prototype,l),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},dV=(t,e,r,l)=>{let d,g,w;const I={};if(e=e||{},t==null)return e;do{for(d=Object.getOwnPropertyNames(t),g=d.length;g-- >0;)w=d[g],(!l||l(w,t,e))&&!I[w]&&(e[w]=t[w],I[w]=!0);t=r!==!1&&$b(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},fV=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const l=t.indexOf(e,r);return l!==-1&&l===r},pV=t=>{if(!t)return null;if(_d(t))return t;let e=t.length;if(!YM(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},mV=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&$b(Uint8Array)),gV=(t,e)=>{const l=(t&&t[Symbol.iterator]).call(t);let d;for(;(d=l.next())&&!d.done;){const g=d.value;e.call(t,g[0],g[1])}},_V=(t,e)=>{let r;const l=[];for(;(r=t.exec(e))!==null;)l.push(r);return l},yV=Ns("HTMLFormElement"),vV=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,l,d){return l.toUpperCase()+d}),LC=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),xV=Ns("RegExp"),nR=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),l={};vm(r,(d,g)=>{let w;(w=e(d,g,t))!==!1&&(l[g]=w||d)}),Object.defineProperties(t,l)},wV=t=>{nR(t,(e,r)=>{if(Co(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const l=t[r];if(Co(l)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},bV=(t,e)=>{const r={},l=d=>{d.forEach(g=>{r[g]=!0})};return _d(t)?l(t):l(String(t).split(e)),r},EV=()=>{},TV=(t,e)=>(t=+t,Number.isFinite(t)?t:e),F0="abcdefghijklmnopqrstuvwxyz",zC="0123456789",rR={DIGIT:zC,ALPHA:F0,ALPHA_DIGIT:F0+F0.toUpperCase()+zC},SV=(t=16,e=rR.ALPHA_DIGIT)=>{let r="";const{length:l}=e;for(;t--;)r+=e[Math.random()*l|0];return r};function IV(t){return!!(t&&Co(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const CV=t=>{const e=new Array(10),r=(l,d)=>{if(pv(l)){if(e.indexOf(l)>=0)return;if(!("toJSON"in l)){e[d]=l;const g=_d(l)?[]:{};return vm(l,(w,I)=>{const a=r(w,d+1);!im(a)&&(g[I]=a)}),e[d]=void 0,g}}return l};return r(t,0)},AV=Ns("AsyncFunction"),PV=t=>t&&(pv(t)||Co(t))&&Co(t.then)&&Co(t.catch),Qe={isArray:_d,isArrayBuffer:JM,isBuffer:JU,isFormData:sV,isArrayBufferView:YU,isString:QU,isNumber:YM,isBoolean:eV,isObject:pv,isPlainObject:F_,isUndefined:im,isDate:tV,isFile:nV,isBlob:rV,isRegExp:xV,isFunction:Co,isStream:oV,isURLSearchParams:aV,isTypedArray:mV,isFileList:iV,forEach:vm,merge:a1,extend:cV,trim:lV,stripBOM:uV,inherits:hV,toFlatObject:dV,kindOf:dv,kindOfTest:Ns,endsWith:fV,toArray:pV,forEachEntry:gV,matchAll:_V,isHTMLForm:yV,hasOwnProperty:LC,hasOwnProp:LC,reduceDescriptors:nR,freezeMethods:wV,toObjectSet:bV,toCamelCase:vV,noop:EV,toFiniteNumber:TV,findKey:QM,global:eR,isContextDefined:tR,ALPHABET:rR,generateString:SV,isSpecCompliantForm:IV,toJSONObject:CV,isAsyncFn:AV,isThenable:PV};function un(t,e,r,l,d){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),l&&(this.request=l),d&&(this.response=d)}Qe.inherits(un,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Qe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const iR=un.prototype,oR={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{oR[t]={value:t}});Object.defineProperties(un,oR);Object.defineProperty(iR,"isAxiosError",{value:!0});un.from=(t,e,r,l,d,g)=>{const w=Object.create(iR);return Qe.toFlatObject(t,w,function(a){return a!==Error.prototype},I=>I!=="isAxiosError"),un.call(w,t.message,e,r,l,d),w.cause=t,w.name=t.name,g&&Object.assign(w,g),w};const kV=null;function l1(t){return Qe.isPlainObject(t)||Qe.isArray(t)}function sR(t){return Qe.endsWith(t,"[]")?t.slice(0,-2):t}function OC(t,e,r){return t?t.concat(e).map(function(d,g){return d=sR(d),!r&&g?"["+d+"]":d}).join(r?".":""):e}function MV(t){return Qe.isArray(t)&&!t.some(l1)}const RV=Qe.toFlatObject(Qe,{},null,function(e){return/^is[A-Z]/.test(e)});function mv(t,e,r){if(!Qe.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=Qe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(le,we){return!Qe.isUndefined(we[le])});const l=r.metaTokens,d=r.visitor||O,g=r.dots,w=r.indexes,a=(r.Blob||typeof Blob<"u"&&Blob)&&Qe.isSpecCompliantForm(e);if(!Qe.isFunction(d))throw new TypeError("visitor must be a function");function k(oe){if(oe===null)return"";if(Qe.isDate(oe))return oe.toISOString();if(!a&&Qe.isBlob(oe))throw new un("Blob is not supported. Use a Buffer instead.");return Qe.isArrayBuffer(oe)||Qe.isTypedArray(oe)?a&&typeof Blob=="function"?new Blob([oe]):Buffer.from(oe):oe}function O(oe,le,we){let te=oe;if(oe&&!we&&typeof oe=="object"){if(Qe.endsWith(le,"{}"))le=l?le:le.slice(0,-2),oe=JSON.stringify(oe);else if(Qe.isArray(oe)&&MV(oe)||(Qe.isFileList(oe)||Qe.endsWith(le,"[]"))&&(te=Qe.toArray(oe)))return le=sR(le),te.forEach(function(ce,Te){!(Qe.isUndefined(ce)||ce===null)&&e.append(w===!0?OC([le],Te,g):w===null?le:le+"[]",k(ce))}),!1}return l1(oe)?!0:(e.append(OC(we,le,g),k(oe)),!1)}const V=[],G=Object.assign(RV,{defaultVisitor:O,convertValue:k,isVisitable:l1});function X(oe,le){if(!Qe.isUndefined(oe)){if(V.indexOf(oe)!==-1)throw Error("Circular reference detected in "+le.join("."));V.push(oe),Qe.forEach(oe,function(te,J){(!(Qe.isUndefined(te)||te===null)&&d.call(e,te,Qe.isString(J)?J.trim():J,le,G))===!0&&X(te,le?le.concat(J):[J])}),V.pop()}}if(!Qe.isObject(t))throw new TypeError("data must be an object");return X(t),e}function BC(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(l){return e[l]})}function Gb(t,e){this._pairs=[],t&&mv(t,this,e)}const aR=Gb.prototype;aR.append=function(e,r){this._pairs.push([e,r])};aR.toString=function(e){const r=e?function(l){return e.call(this,l,BC)}:BC;return this._pairs.map(function(d){return r(d[0])+"="+r(d[1])},"").join("&")};function DV(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function lR(t,e,r){if(!e)return t;const l=r&&r.encode||DV,d=r&&r.serialize;let g;if(d?g=d(e,r):g=Qe.isURLSearchParams(e)?e.toString():new Gb(e,r).toString(l),g){const w=t.indexOf("#");w!==-1&&(t=t.slice(0,w)),t+=(t.indexOf("?")===-1?"?":"&")+g}return t}class FC{constructor(){this.handlers=[]}use(e,r,l){return this.handlers.push({fulfilled:e,rejected:r,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Qe.forEach(this.handlers,function(l){l!==null&&e(l)})}}const cR={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},LV=typeof URLSearchParams<"u"?URLSearchParams:Gb,zV=typeof FormData<"u"?FormData:null,OV=typeof Blob<"u"?Blob:null,BV={isBrowser:!0,classes:{URLSearchParams:LV,FormData:zV,Blob:OV},protocols:["http","https","file","blob","url","data"]},uR=typeof window<"u"&&typeof document<"u",FV=(t=>uR&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),NV=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",jV=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:uR,hasStandardBrowserEnv:FV,hasStandardBrowserWebWorkerEnv:NV},Symbol.toStringTag,{value:"Module"})),Ms={...jV,...BV};function UV(t,e){return mv(t,new Ms.classes.URLSearchParams,Object.assign({visitor:function(r,l,d,g){return Ms.isNode&&Qe.isBuffer(r)?(this.append(l,r.toString("base64")),!1):g.defaultVisitor.apply(this,arguments)}},e))}function VV(t){return Qe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function $V(t){const e={},r=Object.keys(t);let l;const d=r.length;let g;for(l=0;l<d;l++)g=r[l],e[g]=t[g];return e}function hR(t){function e(r,l,d,g){let w=r[g++];const I=Number.isFinite(+w),a=g>=r.length;return w=!w&&Qe.isArray(d)?d.length:w,a?(Qe.hasOwnProp(d,w)?d[w]=[d[w],l]:d[w]=l,!I):((!d[w]||!Qe.isObject(d[w]))&&(d[w]=[]),e(r,l,d[w],g)&&Qe.isArray(d[w])&&(d[w]=$V(d[w])),!I)}if(Qe.isFormData(t)&&Qe.isFunction(t.entries)){const r={};return Qe.forEachEntry(t,(l,d)=>{e(VV(l),d,r,0)}),r}return null}function GV(t,e,r){if(Qe.isString(t))try{return(e||JSON.parse)(t),Qe.trim(t)}catch(l){if(l.name!=="SyntaxError")throw l}return(r||JSON.stringify)(t)}const Wb={transitional:cR,adapter:["xhr","http"],transformRequest:[function(e,r){const l=r.getContentType()||"",d=l.indexOf("application/json")>-1,g=Qe.isObject(e);if(g&&Qe.isHTMLForm(e)&&(e=new FormData(e)),Qe.isFormData(e))return d&&d?JSON.stringify(hR(e)):e;if(Qe.isArrayBuffer(e)||Qe.isBuffer(e)||Qe.isStream(e)||Qe.isFile(e)||Qe.isBlob(e))return e;if(Qe.isArrayBufferView(e))return e.buffer;if(Qe.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let I;if(g){if(l.indexOf("application/x-www-form-urlencoded")>-1)return UV(e,this.formSerializer).toString();if((I=Qe.isFileList(e))||l.indexOf("multipart/form-data")>-1){const a=this.env&&this.env.FormData;return mv(I?{"files[]":e}:e,a&&new a,this.formSerializer)}}return g||d?(r.setContentType("application/json",!1),GV(e)):e}],transformResponse:[function(e){const r=this.transitional||Wb.transitional,l=r&&r.forcedJSONParsing,d=this.responseType==="json";if(e&&Qe.isString(e)&&(l&&!this.responseType||d)){const w=!(r&&r.silentJSONParsing)&&d;try{return JSON.parse(e)}catch(I){if(w)throw I.name==="SyntaxError"?un.from(I,un.ERR_BAD_RESPONSE,this,null,this.response):I}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Ms.classes.FormData,Blob:Ms.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Qe.forEach(["delete","get","head","post","put","patch"],t=>{Wb.headers[t]={}});const qb=Wb,WV=Qe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),qV=t=>{const e={};let r,l,d;return t&&t.split(`
`).forEach(function(w){d=w.indexOf(":"),r=w.substring(0,d).trim().toLowerCase(),l=w.substring(d+1).trim(),!(!r||e[r]&&WV[r])&&(r==="set-cookie"?e[r]?e[r].push(l):e[r]=[l]:e[r]=e[r]?e[r]+", "+l:l)}),e},NC=Symbol("internals");function sp(t){return t&&String(t).trim().toLowerCase()}function N_(t){return t===!1||t==null?t:Qe.isArray(t)?t.map(N_):String(t)}function HV(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=r.exec(t);)e[l[1]]=l[2];return e}const ZV=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function N0(t,e,r,l,d){if(Qe.isFunction(l))return l.call(this,e,r);if(d&&(e=r),!!Qe.isString(e)){if(Qe.isString(l))return e.indexOf(l)!==-1;if(Qe.isRegExp(l))return l.test(e)}}function XV(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,l)=>r.toUpperCase()+l)}function KV(t,e){const r=Qe.toCamelCase(" "+e);["get","set","has"].forEach(l=>{Object.defineProperty(t,l+r,{value:function(d,g,w){return this[l].call(this,e,d,g,w)},configurable:!0})})}class gv{constructor(e){e&&this.set(e)}set(e,r,l){const d=this;function g(I,a,k){const O=sp(a);if(!O)throw new Error("header name must be a non-empty string");const V=Qe.findKey(d,O);(!V||d[V]===void 0||k===!0||k===void 0&&d[V]!==!1)&&(d[V||a]=N_(I))}const w=(I,a)=>Qe.forEach(I,(k,O)=>g(k,O,a));return Qe.isPlainObject(e)||e instanceof this.constructor?w(e,r):Qe.isString(e)&&(e=e.trim())&&!ZV(e)?w(qV(e),r):e!=null&&g(r,e,l),this}get(e,r){if(e=sp(e),e){const l=Qe.findKey(this,e);if(l){const d=this[l];if(!r)return d;if(r===!0)return HV(d);if(Qe.isFunction(r))return r.call(this,d,l);if(Qe.isRegExp(r))return r.exec(d);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=sp(e),e){const l=Qe.findKey(this,e);return!!(l&&this[l]!==void 0&&(!r||N0(this,this[l],l,r)))}return!1}delete(e,r){const l=this;let d=!1;function g(w){if(w=sp(w),w){const I=Qe.findKey(l,w);I&&(!r||N0(l,l[I],I,r))&&(delete l[I],d=!0)}}return Qe.isArray(e)?e.forEach(g):g(e),d}clear(e){const r=Object.keys(this);let l=r.length,d=!1;for(;l--;){const g=r[l];(!e||N0(this,this[g],g,e,!0))&&(delete this[g],d=!0)}return d}normalize(e){const r=this,l={};return Qe.forEach(this,(d,g)=>{const w=Qe.findKey(l,g);if(w){r[w]=N_(d),delete r[g];return}const I=e?XV(g):String(g).trim();I!==g&&delete r[g],r[I]=N_(d),l[I]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return Qe.forEach(this,(l,d)=>{l!=null&&l!==!1&&(r[d]=e&&Qe.isArray(l)?l.join(", "):l)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const l=new this(e);return r.forEach(d=>l.set(d)),l}static accessor(e){const l=(this[NC]=this[NC]={accessors:{}}).accessors,d=this.prototype;function g(w){const I=sp(w);l[I]||(KV(d,w),l[I]=!0)}return Qe.isArray(e)?e.forEach(g):g(e),this}}gv.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Qe.reduceDescriptors(gv.prototype,({value:t},e)=>{let r=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(l){this[r]=l}}});Qe.freezeMethods(gv);const xa=gv;function j0(t,e){const r=this||qb,l=e||r,d=xa.from(l.headers);let g=l.data;return Qe.forEach(t,function(I){g=I.call(r,g,d.normalize(),e?e.status:void 0)}),d.normalize(),g}function dR(t){return!!(t&&t.__CANCEL__)}function xm(t,e,r){un.call(this,t??"canceled",un.ERR_CANCELED,e,r),this.name="CanceledError"}Qe.inherits(xm,un,{__CANCEL__:!0});function JV(t,e,r){const l=r.config.validateStatus;!r.status||!l||l(r.status)?t(r):e(new un("Request failed with status code "+r.status,[un.ERR_BAD_REQUEST,un.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}const YV=Ms.hasStandardBrowserEnv?function(){return{write:function(r,l,d,g,w,I){const a=[];a.push(r+"="+encodeURIComponent(l)),Qe.isNumber(d)&&a.push("expires="+new Date(d).toGMTString()),Qe.isString(g)&&a.push("path="+g),Qe.isString(w)&&a.push("domain="+w),I===!0&&a.push("secure"),document.cookie=a.join("; ")},read:function(r){const l=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return l?decodeURIComponent(l[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function QV(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function e6(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}function fR(t,e){return t&&!QV(e)?e6(t,e):e}const t6=Ms.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");let l;function d(g){let w=g;return e&&(r.setAttribute("href",w),w=r.href),r.setAttribute("href",w),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return l=d(window.location.href),function(w){const I=Qe.isString(w)?d(w):w;return I.protocol===l.protocol&&I.host===l.host}}():function(){return function(){return!0}}();function n6(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function r6(t,e){t=t||10;const r=new Array(t),l=new Array(t);let d=0,g=0,w;return e=e!==void 0?e:1e3,function(a){const k=Date.now(),O=l[g];w||(w=k),r[d]=a,l[d]=k;let V=g,G=0;for(;V!==d;)G+=r[V++],V=V%t;if(d=(d+1)%t,d===g&&(g=(g+1)%t),k-w<e)return;const X=O&&k-O;return X?Math.round(G*1e3/X):void 0}}function jC(t,e){let r=0;const l=r6(50,250);return d=>{const g=d.loaded,w=d.lengthComputable?d.total:void 0,I=g-r,a=l(I),k=g<=w;r=g;const O={loaded:g,total:w,progress:w?g/w:void 0,bytes:I,rate:a||void 0,estimated:a&&w&&k?(w-g)/a:void 0,event:d};O[e?"download":"upload"]=!0,t(O)}}const i6=typeof XMLHttpRequest<"u",o6=i6&&function(t){return new Promise(function(r,l){let d=t.data;const g=xa.from(t.headers).normalize(),w=t.responseType;let I;function a(){t.cancelToken&&t.cancelToken.unsubscribe(I),t.signal&&t.signal.removeEventListener("abort",I)}let k;if(Qe.isFormData(d)){if(Ms.hasStandardBrowserEnv||Ms.hasStandardBrowserWebWorkerEnv)g.setContentType(!1);else if((k=g.getContentType())!==!1){const[oe,...le]=k?k.split(";").map(we=>we.trim()).filter(Boolean):[];g.setContentType([oe||"multipart/form-data",...le].join("; "))}}let O=new XMLHttpRequest;if(t.auth){const oe=t.auth.username||"",le=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";g.set("Authorization","Basic "+btoa(oe+":"+le))}const V=fR(t.baseURL,t.url);O.open(t.method.toUpperCase(),lR(V,t.params,t.paramsSerializer),!0),O.timeout=t.timeout;function G(){if(!O)return;const oe=xa.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders()),we={data:!w||w==="text"||w==="json"?O.responseText:O.response,status:O.status,statusText:O.statusText,headers:oe,config:t,request:O};JV(function(J){r(J),a()},function(J){l(J),a()},we),O=null}if("onloadend"in O?O.onloadend=G:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(G)},O.onabort=function(){O&&(l(new un("Request aborted",un.ECONNABORTED,t,O)),O=null)},O.onerror=function(){l(new un("Network Error",un.ERR_NETWORK,t,O)),O=null},O.ontimeout=function(){let le=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const we=t.transitional||cR;t.timeoutErrorMessage&&(le=t.timeoutErrorMessage),l(new un(le,we.clarifyTimeoutError?un.ETIMEDOUT:un.ECONNABORTED,t,O)),O=null},Ms.hasStandardBrowserEnv){const oe=t6(V)&&t.xsrfCookieName&&YV.read(t.xsrfCookieName);oe&&g.set(t.xsrfHeaderName,oe)}d===void 0&&g.setContentType(null),"setRequestHeader"in O&&Qe.forEach(g.toJSON(),function(le,we){O.setRequestHeader(we,le)}),Qe.isUndefined(t.withCredentials)||(O.withCredentials=!!t.withCredentials),w&&w!=="json"&&(O.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&O.addEventListener("progress",jC(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&O.upload&&O.upload.addEventListener("progress",jC(t.onUploadProgress)),(t.cancelToken||t.signal)&&(I=oe=>{O&&(l(!oe||oe.type?new xm(null,t,O):oe),O.abort(),O=null)},t.cancelToken&&t.cancelToken.subscribe(I),t.signal&&(t.signal.aborted?I():t.signal.addEventListener("abort",I)));const X=n6(V);if(X&&Ms.protocols.indexOf(X)===-1){l(new un("Unsupported protocol "+X+":",un.ERR_BAD_REQUEST,t));return}O.send(d||null)})},c1={http:kV,xhr:o6};Qe.forEach(c1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const UC=t=>`- ${t}`,s6=t=>Qe.isFunction(t)||t===null||t===!1,pR={getAdapter:t=>{t=Qe.isArray(t)?t:[t];const{length:e}=t;let r,l;const d={};for(let g=0;g<e;g++){r=t[g];let w;if(l=r,!s6(r)&&(l=c1[(w=String(r)).toLowerCase()],l===void 0))throw new un(`Unknown adapter '${w}'`);if(l)break;d[w||"#"+g]=l}if(!l){const g=Object.entries(d).map(([I,a])=>`adapter ${I} `+(a===!1?"is not supported by the environment":"is not available in the build"));let w=e?g.length>1?`since :
`+g.map(UC).join(`
`):" "+UC(g[0]):"as no adapter specified";throw new un("There is no suitable adapter to dispatch the request "+w,"ERR_NOT_SUPPORT")}return l},adapters:c1};function U0(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new xm(null,t)}function VC(t){return U0(t),t.headers=xa.from(t.headers),t.data=j0.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),pR.getAdapter(t.adapter||qb.adapter)(t).then(function(l){return U0(t),l.data=j0.call(t,t.transformResponse,l),l.headers=xa.from(l.headers),l},function(l){return dR(l)||(U0(t),l&&l.response&&(l.response.data=j0.call(t,t.transformResponse,l.response),l.response.headers=xa.from(l.response.headers))),Promise.reject(l)})}const $C=t=>t instanceof xa?t.toJSON():t;function Qh(t,e){e=e||{};const r={};function l(k,O,V){return Qe.isPlainObject(k)&&Qe.isPlainObject(O)?Qe.merge.call({caseless:V},k,O):Qe.isPlainObject(O)?Qe.merge({},O):Qe.isArray(O)?O.slice():O}function d(k,O,V){if(Qe.isUndefined(O)){if(!Qe.isUndefined(k))return l(void 0,k,V)}else return l(k,O,V)}function g(k,O){if(!Qe.isUndefined(O))return l(void 0,O)}function w(k,O){if(Qe.isUndefined(O)){if(!Qe.isUndefined(k))return l(void 0,k)}else return l(void 0,O)}function I(k,O,V){if(V in e)return l(k,O);if(V in t)return l(void 0,k)}const a={url:g,method:g,data:g,baseURL:w,transformRequest:w,transformResponse:w,paramsSerializer:w,timeout:w,timeoutMessage:w,withCredentials:w,adapter:w,responseType:w,xsrfCookieName:w,xsrfHeaderName:w,onUploadProgress:w,onDownloadProgress:w,decompress:w,maxContentLength:w,maxBodyLength:w,beforeRedirect:w,transport:w,httpAgent:w,httpsAgent:w,cancelToken:w,socketPath:w,responseEncoding:w,validateStatus:I,headers:(k,O)=>d($C(k),$C(O),!0)};return Qe.forEach(Object.keys(Object.assign({},t,e)),function(O){const V=a[O]||d,G=V(t[O],e[O],O);Qe.isUndefined(G)&&V!==I||(r[O]=G)}),r}const mR="1.6.1",Hb={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Hb[t]=function(l){return typeof l===t||"a"+(e<1?"n ":" ")+t}});const GC={};Hb.transitional=function(e,r,l){function d(g,w){return"[Axios v"+mR+"] Transitional option '"+g+"'"+w+(l?". "+l:"")}return(g,w,I)=>{if(e===!1)throw new un(d(w," has been removed"+(r?" in "+r:"")),un.ERR_DEPRECATED);return r&&!GC[w]&&(GC[w]=!0,console.warn(d(w," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(g,w,I):!0}};function a6(t,e,r){if(typeof t!="object")throw new un("options must be an object",un.ERR_BAD_OPTION_VALUE);const l=Object.keys(t);let d=l.length;for(;d-- >0;){const g=l[d],w=e[g];if(w){const I=t[g],a=I===void 0||w(I,g,t);if(a!==!0)throw new un("option "+g+" must be "+a,un.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new un("Unknown option "+g,un.ERR_BAD_OPTION)}}const u1={assertOptions:a6,validators:Hb},yl=u1.validators;class Ry{constructor(e){this.defaults=e,this.interceptors={request:new FC,response:new FC}}request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=Qh(this.defaults,r);const{transitional:l,paramsSerializer:d,headers:g}=r;l!==void 0&&u1.assertOptions(l,{silentJSONParsing:yl.transitional(yl.boolean),forcedJSONParsing:yl.transitional(yl.boolean),clarifyTimeoutError:yl.transitional(yl.boolean)},!1),d!=null&&(Qe.isFunction(d)?r.paramsSerializer={serialize:d}:u1.assertOptions(d,{encode:yl.function,serialize:yl.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let w=g&&Qe.merge(g.common,g[r.method]);g&&Qe.forEach(["delete","get","head","post","put","patch","common"],oe=>{delete g[oe]}),r.headers=xa.concat(w,g);const I=[];let a=!0;this.interceptors.request.forEach(function(le){typeof le.runWhen=="function"&&le.runWhen(r)===!1||(a=a&&le.synchronous,I.unshift(le.fulfilled,le.rejected))});const k=[];this.interceptors.response.forEach(function(le){k.push(le.fulfilled,le.rejected)});let O,V=0,G;if(!a){const oe=[VC.bind(this),void 0];for(oe.unshift.apply(oe,I),oe.push.apply(oe,k),G=oe.length,O=Promise.resolve(r);V<G;)O=O.then(oe[V++],oe[V++]);return O}G=I.length;let X=r;for(V=0;V<G;){const oe=I[V++],le=I[V++];try{X=oe(X)}catch(we){le.call(this,we);break}}try{O=VC.call(this,X)}catch(oe){return Promise.reject(oe)}for(V=0,G=k.length;V<G;)O=O.then(k[V++],k[V++]);return O}getUri(e){e=Qh(this.defaults,e);const r=fR(e.baseURL,e.url);return lR(r,e.params,e.paramsSerializer)}}Qe.forEach(["delete","get","head","options"],function(e){Ry.prototype[e]=function(r,l){return this.request(Qh(l||{},{method:e,url:r,data:(l||{}).data}))}});Qe.forEach(["post","put","patch"],function(e){function r(l){return function(g,w,I){return this.request(Qh(I||{},{method:e,headers:l?{"Content-Type":"multipart/form-data"}:{},url:g,data:w}))}}Ry.prototype[e]=r(),Ry.prototype[e+"Form"]=r(!0)});const j_=Ry;class Zb{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(g){r=g});const l=this;this.promise.then(d=>{if(!l._listeners)return;let g=l._listeners.length;for(;g-- >0;)l._listeners[g](d);l._listeners=null}),this.promise.then=d=>{let g;const w=new Promise(I=>{l.subscribe(I),g=I}).then(d);return w.cancel=function(){l.unsubscribe(g)},w},e(function(g,w,I){l.reason||(l.reason=new xm(g,w,I),r(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}static source(){let e;return{token:new Zb(function(d){e=d}),cancel:e}}}const l6=Zb;function c6(t){return function(r){return t.apply(null,r)}}function u6(t){return Qe.isObject(t)&&t.isAxiosError===!0}const h1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(h1).forEach(([t,e])=>{h1[e]=t});const h6=h1;function gR(t){const e=new j_(t),r=KM(j_.prototype.request,e);return Qe.extend(r,j_.prototype,e,{allOwnKeys:!0}),Qe.extend(r,e,null,{allOwnKeys:!0}),r.create=function(d){return gR(Qh(t,d))},r}const mr=gR(qb);mr.Axios=j_;mr.CanceledError=xm;mr.CancelToken=l6;mr.isCancel=dR;mr.VERSION=mR;mr.toFormData=mv;mr.AxiosError=un;mr.Cancel=mr.CanceledError;mr.all=function(e){return Promise.all(e)};mr.spread=c6;mr.isAxiosError=u6;mr.mergeConfig=Qh;mr.AxiosHeaders=xa;mr.formToJSON=t=>hR(Qe.isHTMLForm(t)?new FormData(t):t);mr.getAdapter=pR.getAdapter;mr.HttpStatusCode=h6;mr.default=mr;var d6={VITE_API_URL:"https://api.openrouteservice.org",VITE_API_URL_LIGHT_PRICE:"https://apidatos.ree.es/es/datos/mercados",VITE_API_URL_COMBUSTIBLE_PRICE:"https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/EstacionesTerrestres/",VITE_ROUTES_API_KEY:"5b3ce3597851110001cf6248608744a61be6440ba89afba1fde9c799",VITE_MAP_API_KEY:"pk.eyJ1IjoibXItcGF5dSIsImEiOiJjbG54b2NwMzQwbGFrMnBud3pscnM3emVxIn0.r_HBF1121thy3gVQCE8BVQ",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const yd=()=>({...d6}),{VITE_API_URL:f6}=yd(),Cp=mr.create({baseURL:f6}),{VITE_ROUTES_API_KEY:V0}=yd();class _R{async getCoordinatesFromPlaceName(e){const{data:r}=await Cp.get("/geocode/search",{params:{api_key:V0,text:e}});return{name:e,lat:r.features[0].geometry.coordinates[1],lon:r.features[0].geometry.coordinates[0]}}async getPlaceNameByCoords(e){const{data:r}=await Cp.get("/geocode/reverse",{params:{api_key:V0,"point.lon":e.lon,"point.lat":e.lat}});return r.features[0].properties.region||""}async calculatePathway(e,r,l,d){d===void 0&&(d=Lr.RECOMMENDED),l===void 0&&(l=gr.VEHICLE);const{data:g}=await Cp.post(`/v2/directions/${l}`,{coordinates:[[e.lon,e.lat],[r.lon,r.lat]],preference:`${d}`},{headers:{Authorization:V0,"Content-Type":"application/json"},maxBodyLength:1/0}).catch(w=>{var I;throw((I=w.response)==null?void 0:I.status)===400?new Ml(Gl.FarPathway):new Ml(Gl.OpenRouteApiNotResponding)});return{distance:g.routes[0].summary.distance,duration:g.routes[0].summary.duration,end:r,start:e,codifiedPath:g.routes[0].geometry,favourite:!1,transportMean:l,type:d,cost:0}}}const{VITE_API_URL_LIGHT_PRICE:p6}=yd(),m6=mr.create({baseURL:p6}),{VITE_API_URL_COMBUSTIBLE_PRICE:g6}=yd(),_6=mr.create({baseURL:g6});var vi=(t=>(t.Diesel="diesel",t.Gasolina="gasolina",t.Electrico="electrico",t))(vi||{});class y6{async getPrice(e){return e===vi.Electrico?await this.getLightPrice():await this.getCombustiblePrice(e)}async getCombustiblePrice(e){const{data:r}=await _6.get("");var l;return e===vi.Gasolina?l=r.ListaEESSPrecio.map(g=>parseFloat(g["Precio Gasolina 95 E5"].replace(",","."))).filter(g=>!isNaN(g)):l=r.ListaEESSPrecio.map(g=>parseFloat(g["Precio Gasoleo A"].replace(",","."))).filter(g=>!isNaN(g)),l.reduce((g,w)=>g+w,0)/l.length}async getLightPrice(){const{data:e}=await m6.get(`/precios-mercados-tiempo-real?start_date=${this.getCurrentDate()}T00:00&end_date=${this.getTomorrowDate()}T00:00&time_trunc=hour`);return this.getAvgPrice(e)}getAvgPrice(e){const r=e.included[0].attributes.values.map(l=>l.value);return r.reduce((l,d)=>l+d,0)/r.length}getCurrentDate(){const e=new Date,r=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0");return`${r}-${l}-${d}`}getTomorrowDate(){const e=new Date;e.setDate(e.getDate()+1);const r=e.getFullYear(),l=(e.getMonth()+1).toString().padStart(2,"0"),d=e.getDate().toString().padStart(2,"0");return`${r}-${l}-${d}`}}class v6{constructor(e,r,l){this.openRouteService=e,this.firebaseService=r,this.priceService=l}getOpenRouteService(){return this.openRouteService}getFirebaseService(){return this.firebaseService}async calculatePathway(e,r,l,d){return(!e.lat||!e.lon)&&e.name&&(e=await this.openRouteService.getCoordinatesFromPlaceName(e.name)),(!r.lat||!r.lon)&&r.name&&(r=await this.openRouteService.getCoordinatesFromPlaceName(r.name)),await this.openRouteService.calculatePathway(e,r,l,d)}async calculatePrice(e,r){if(r.consumption<=0)throw new Nh("El vehculo no existe");if(e<=0)throw new Ml(Gl.FarPathway);let d=await this.priceService.getPrice(r.propulsion)*r.consumption*e/1e4;return parseFloat(d.toFixed(2))}calculateCalories(e,r){if(e===0)throw new Ml(Gl.FarPathway);if(r===gr.WALKING)return e*12/250;if(r===gr.BIKE)return e*6/250;throw new Nh("No se ha seleccionado un vehculo de tipo Bicicleta o Andando")}async getPathways(e){try{const r=await this.firebaseService.getPathways(e);return(r==null?void 0:r.pathways)||[]}catch(r){throw r}}async updatePathways(e,r){try{await this.firebaseService.updatePathways(e,r)}catch(l){throw l}}async addPathway(e,r){try{return await this.firebaseService.storePathway(e,r)}catch(l){throw l}}async deletePathway(e,r){try{await this.firebaseService.deletePathway(e,r)}catch(l){throw l}}async replacePathways(e,r){await this.firebaseService.replacePathways(e,r)}async setDefaultPathwayType(e,r){await this.firebaseService.setDefaultPathwayType(e,r),localStorage.setItem("defaultPathwayType",e)}async getDefaultPathwayType(e){let r=Lr.UNDEFINED;return await this.firebaseService.getDefaultPathwayType(e).then(l=>{r=l.pathwayType}),localStorage.setItem("defaultPathwayType",r),r}pathwaysAreEqual(e,r){return e.start.name===r.start.name&&e.end.name===r.end.name&&e.type===r.type&&(e.transportMean!==gr.VEHICLE||e.vehiclePlate===r.vehiclePlate)}}let $0;function vd(t,e,r){return $0||(t||(t=new _R),e||(e=new uv),r||(r=new y6),$0=new v6(t,e,r)),$0}const x6=()=>j.jsx("img",{src:XM,alt:"RouteMaps welcome image | auth",style:{maxWidth:"90%",maxHeight:"100%",objectFit:"contain"}}),w6=()=>{const t=re.useContext(zr),e={email:"",password:""},r=[{id:"email",label:"Direccin de correo electrnico",type:"email"},{id:"password",label:"Contrasea",type:"password",placeholder:"Longitud mnima 6 carcteres"}],l={url:"/auth/register",name:"No tienes cuenta?",clickable:"Creala"},d={email:w=>w.includes("@")?null:"Debe ser una direccin de correo electrnico vlida",password:w=>w.length<6?"Debe tener al menos 6 carcteres":null},g=async w=>{const I=hv(),a=vd(),k=gd(),O=await I.loginWithEmailAndPassword(w.email,w.password),V=await a.getDefaultPathwayType(O.uid);let G;try{G=await k.getDefaultVehicle(O.uid)}catch{G=""}t.setUser(O),t.setDefaultPathwayType(V),t.setDefaultVehiclePlate(G),t.setIsLogged(!0)};return j.jsx(j.Fragment,{children:j.jsxs("div",{className:"row d-flex align-items-center",style:{margin:"20px",minHeight:"80vh"},children:[j.jsx("div",{className:"col-6",children:j.jsx("div",{className:"card",children:j.jsxs("div",{className:"card-body",children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h2",{className:"card-title",children:"Iniciar Sesin"}),j.jsx("img",{src:Vb,width:"55",height:"55",alt:"Logo Route Maps",style:{marginRight:"10px"}})]}),j.jsx("hr",{style:{marginBottom:"20px"}}),j.jsx(mu,{formData:e,formFields:r,additionalFormLink:l,onSubmit:g,submitButtonLabel:"Iniciar sesin",validations:d})]})})}),j.jsx("div",{className:"col-6",children:j.jsx(x6,{})})]})})},b6=()=>j.jsxs(dd,{children:[j.jsx(qn,{path:"/register",element:j.jsx(HU,{})}),j.jsx(qn,{path:"/login",element:j.jsx(w6,{})}),j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/auth/login"})})]}),E6=({defaultVehicle:t})=>j.jsxs("ul",{className:"list-group list-group-flush",children:[j.jsxs("li",{className:"list-group-item",children:[j.jsx("strong",{children:"Matrcula"})," - ",t.plate]}),j.jsxs("li",{className:"list-group-item",children:[j.jsx("strong",{children:"Nombre"})," - ",t.name]})]});var yR={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function r(){for(var l=[],d=0;d<arguments.length;d++){var g=arguments[d];if(g){var w=typeof g;if(w==="string"||w==="number")l.push(g);else if(Array.isArray(g)){if(g.length){var I=r.apply(null,g);I&&l.push(I)}}else if(w==="object"){if(g.toString!==Object.prototype.toString&&!g.toString.toString().includes("[native code]")){l.push(g.toString());continue}for(var a in g)e.call(g,a)&&g[a]&&l.push(a)}}}return l.join(" ")}t.exports?(r.default=r,t.exports=r):window.classNames=r})()})(yR);var T6=yR.exports;const rn=od(T6);function d1(){return d1=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(t[l]=r[l])}return t},d1.apply(this,arguments)}function S6(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}function WC(t){return"default"+t.charAt(0).toUpperCase()+t.substr(1)}function I6(t){var e=C6(t,"string");return typeof e=="symbol"?e:String(e)}function C6(t,e){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var l=r.call(t,e||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function A6(t,e,r){var l=re.useRef(t!==void 0),d=re.useState(e),g=d[0],w=d[1],I=t!==void 0,a=l.current;return l.current=I,!I&&a&&g!==e&&w(e),[I?t:g,re.useCallback(function(k){for(var O=arguments.length,V=new Array(O>1?O-1:0),G=1;G<O;G++)V[G-1]=arguments[G];r&&r.apply(void 0,[k].concat(V)),w(k)},[r])]}function P6(t,e){return Object.keys(e).reduce(function(r,l){var d,g=r,w=g[WC(l)],I=g[l],a=S6(g,[WC(l),l].map(I6)),k=e[l],O=A6(I,w,t[k]),V=O[0],G=O[1];return d1({},a,(d={},d[l]=V,d[k]=G,d))},t)}const k6=["xxl","xl","lg","md","sm","xs"],M6="xs",_v=re.createContext({prefixes:{},breakpoints:k6,minBreakpoint:M6});function hn(t,e){const{prefixes:r}=re.useContext(_v);return t||r[e]||e}function vR(){const{breakpoints:t}=re.useContext(_v);return t}function xR(){const{minBreakpoint:t}=re.useContext(_v);return t}function R6(){const{dir:t}=re.useContext(_v);return t==="rtl"}function D6(t){return t&&t.ownerDocument||document}var wR={exports:{}},L6="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",z6=L6,O6=z6;function bR(){}function ER(){}ER.resetWarningCache=bR;var B6=function(){function t(l,d,g,w,I,a){if(a!==O6){var k=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw k.name="Invariant Violation",k}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:ER,resetWarningCache:bR};return r.PropTypes=r,r};wR.exports=B6();var F6=wR.exports;const jh=od(F6),TR=!!(typeof window<"u"&&window.document&&window.document.createElement);var f1=!1,p1=!1;try{var G0={get passive(){return f1=!0},get once(){return p1=f1=!0}};TR&&(window.addEventListener("test",G0,G0),window.removeEventListener("test",G0,!0))}catch{}function SR(t,e,r,l){if(l&&typeof l!="boolean"&&!p1){var d=l.once,g=l.capture,w=r;!p1&&d&&(w=r.__once||function I(a){this.removeEventListener(e,I,g),r.call(this,a)},r.__once=w),t.addEventListener(e,w,f1?l:g)}t.addEventListener(e,r,l)}function N6(t,e,r,l){var d=l&&typeof l!="boolean"?l.capture:l;t.removeEventListener(e,r,d),r.__once&&t.removeEventListener(e,r.__once,d)}function v_(t,e,r,l){return SR(t,e,r,l),function(){N6(t,e,r,l)}}const qC=t=>!t||typeof t=="function"?t:e=>{t.current=e};function j6(t,e){const r=qC(t),l=qC(e);return d=>{r&&r(d),l&&l(d)}}function IR(t,e){return re.useMemo(()=>j6(t,e),[t,e])}function U6(t){const e=re.useRef(t);return re.useEffect(()=>{e.current=t},[t]),e}function wa(t){const e=U6(t);return re.useCallback(function(...r){return e.current&&e.current(...r)},[e])}const CR=t=>re.forwardRef((e,r)=>j.jsx("div",{...e,ref:r,className:rn(e.className,t)}));function V6(){return re.useState(null)}function $6(t,e,r,l=!1){const d=wa(r);re.useEffect(()=>{const g=typeof t=="function"?t():t;return g.addEventListener(e,d,l),()=>g.removeEventListener(e,d,l)},[t])}function G6(){const t=re.useRef(!0),e=re.useRef(()=>t.current);return re.useEffect(()=>(t.current=!0,()=>{t.current=!1}),[]),e.current}function W6(t){const e=re.useRef(null);return re.useEffect(()=>{e.current=t}),e.current}const q6=typeof global<"u"&&global.navigator&&global.navigator.product==="ReactNative",H6=typeof document<"u",Z6=H6||q6?re.useLayoutEffect:re.useEffect,X6=["as","disabled"];function K6(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}function J6(t){return!t||t.trim()==="#"}function Xb({tagName:t,disabled:e,href:r,target:l,rel:d,role:g,onClick:w,tabIndex:I=0,type:a}){t||(r!=null||l!=null||d!=null?t="a":t="button");const k={tagName:t};if(t==="button")return[{type:a||"button",disabled:e},k];const O=G=>{if((e||t==="a"&&J6(r))&&G.preventDefault(),e){G.stopPropagation();return}w==null||w(G)},V=G=>{G.key===" "&&(G.preventDefault(),O(G))};return t==="a"&&(r||(r="#"),e&&(r=void 0)),[{role:g??"button",disabled:void 0,tabIndex:e?void 0:I,href:r,target:t==="a"?l:void 0,"aria-disabled":e||void 0,rel:t==="a"?d:void 0,onClick:O,onKeyDown:V},k]}const AR=re.forwardRef((t,e)=>{let{as:r,disabled:l}=t,d=K6(t,X6);const[g,{tagName:w}]=Xb(Object.assign({tagName:r,disabled:l},d));return j.jsx(w,Object.assign({},d,g,{ref:e}))});AR.displayName="Button";const Y6=["onKeyDown"];function Q6(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}function e$(t){return!t||t.trim()==="#"}const PR=re.forwardRef((t,e)=>{let{onKeyDown:r}=t,l=Q6(t,Y6);const[d]=Xb(Object.assign({tagName:"a"},l)),g=wa(w=>{d.onKeyDown(w),r==null||r(w)});return e$(l.href)||l.role==="button"?j.jsx("a",Object.assign({ref:e},l,d,{onKeyDown:g})):j.jsx("a",Object.assign({ref:e},l,{onKeyDown:r}))});PR.displayName="Anchor";const t$=PR,kR=re.forwardRef(({as:t,bsPrefix:e,variant:r="primary",size:l,active:d=!1,disabled:g=!1,className:w,...I},a)=>{const k=hn(e,"btn"),[O,{tagName:V}]=Xb({tagName:t,disabled:g,...I}),G=V;return j.jsx(G,{...O,...I,ref:a,disabled:g,className:rn(w,k,d&&"active",r&&`${k}-${r}`,l&&`${k}-${l}`,I.href&&g&&"disabled")})});kR.displayName="Button";const no=kR,MR=re.forwardRef(({bsPrefix:t,size:e,vertical:r=!1,className:l,role:d="group",as:g="div",...w},I)=>{const a=hn(t,"btn-group");let k=a;return r&&(k=`${a}-vertical`),j.jsx(g,{...w,ref:I,role:d,className:rn(l,k,e&&`${a}-${e}`)})});MR.displayName="ButtonGroup";const n$=MR,RR=re.forwardRef(({className:t,bsPrefix:e,as:r="div",...l},d)=>(e=hn(e,"card-body"),j.jsx(r,{ref:d,className:rn(t,e),...l})));RR.displayName="CardBody";const DR=RR,LR=re.forwardRef(({className:t,bsPrefix:e,as:r="div",...l},d)=>(e=hn(e,"card-footer"),j.jsx(r,{ref:d,className:rn(t,e),...l})));LR.displayName="CardFooter";const r$=LR,zR=re.createContext(null);zR.displayName="CardHeaderContext";const i$=zR,OR=re.forwardRef(({bsPrefix:t,className:e,as:r="div",...l},d)=>{const g=hn(t,"card-header"),w=re.useMemo(()=>({cardHeaderBsPrefix:g}),[g]);return j.jsx(i$.Provider,{value:w,children:j.jsx(r,{ref:d,...l,className:rn(e,g)})})});OR.displayName="CardHeader";const o$=OR,BR=re.forwardRef(({bsPrefix:t,className:e,variant:r,as:l="img",...d},g)=>{const w=hn(t,"card-img");return j.jsx(l,{ref:g,className:rn(r?`${w}-${r}`:w,e),...d})});BR.displayName="CardImg";const s$=BR,FR=re.forwardRef(({className:t,bsPrefix:e,as:r="div",...l},d)=>(e=hn(e,"card-img-overlay"),j.jsx(r,{ref:d,className:rn(t,e),...l})));FR.displayName="CardImgOverlay";const a$=FR,NR=re.forwardRef(({className:t,bsPrefix:e,as:r="a",...l},d)=>(e=hn(e,"card-link"),j.jsx(r,{ref:d,className:rn(t,e),...l})));NR.displayName="CardLink";const l$=NR,c$=CR("h6"),jR=re.forwardRef(({className:t,bsPrefix:e,as:r=c$,...l},d)=>(e=hn(e,"card-subtitle"),j.jsx(r,{ref:d,className:rn(t,e),...l})));jR.displayName="CardSubtitle";const u$=jR,UR=re.forwardRef(({className:t,bsPrefix:e,as:r="p",...l},d)=>(e=hn(e,"card-text"),j.jsx(r,{ref:d,className:rn(t,e),...l})));UR.displayName="CardText";const h$=UR,d$=CR("h5"),VR=re.forwardRef(({className:t,bsPrefix:e,as:r=d$,...l},d)=>(e=hn(e,"card-title"),j.jsx(r,{ref:d,className:rn(t,e),...l})));VR.displayName="CardTitle";const f$=VR,$R=re.forwardRef(({bsPrefix:t,className:e,bg:r,text:l,border:d,body:g=!1,children:w,as:I="div",...a},k)=>{const O=hn(t,"card");return j.jsx(I,{ref:k,...a,className:rn(e,O,r&&`bg-${r}`,l&&`text-${l}`,d&&`border-${d}`),children:g?j.jsx(DR,{children:w}):w})});$R.displayName="Card";const x_=Object.assign($R,{Img:s$,Title:f$,Subtitle:u$,Body:DR,Link:l$,Text:h$,Header:o$,Footer:r$,ImgOverlay:a$});function p$(t,e){return re.Children.toArray(t).some(r=>re.isValidElement(r)&&r.type===e)}function m$({as:t,bsPrefix:e,className:r,...l}){e=hn(e,"col");const d=vR(),g=xR(),w=[],I=[];return d.forEach(a=>{const k=l[a];delete l[a];let O,V,G;typeof k=="object"&&k!=null?{span:O,offset:V,order:G}=k:O=k;const X=a!==g?`-${a}`:"";O&&w.push(O===!0?`${e}${X}`:`${e}${X}-${O}`),G!=null&&I.push(`order${X}-${G}`),V!=null&&I.push(`offset${X}-${V}`)}),[{...l,className:rn(r,...w,...I)},{as:t,bsPrefix:e,spans:w}]}const GR=re.forwardRef((t,e)=>{const[{className:r,...l},{as:d="div",bsPrefix:g,spans:w}]=m$(t);return j.jsx(d,{...l,ref:e,className:rn(r,!w.length&&g)})});GR.displayName="Col";const U_=GR,WR=re.forwardRef(({bsPrefix:t,fluid:e=!1,as:r="div",className:l,...d},g)=>{const w=hn(t,"container"),I=typeof e=="string"?`-${e}`:"-fluid";return j.jsx(r,{ref:g,...d,className:rn(l,e?`${w}${I}`:w)})});WR.displayName="Container";const g$=WR;var _$=Function.prototype.bind.call(Function.prototype.call,[].slice);function HC(t,e){return _$(t.querySelectorAll(e))}function y$(t,e,r){const l=re.useRef(t!==void 0),[d,g]=re.useState(e),w=t!==void 0,I=l.current;return l.current=w,!w&&I&&d!==e&&g(e),[w?t:d,re.useCallback((...a)=>{const[k,...O]=a;let V=r==null?void 0:r(k,...O);return g(k),V},[r])]}function v$(){const[,t]=re.useReducer(e=>!e,!1);return t}const x$=re.createContext(null),yv=x$;var ZC=Object.prototype.hasOwnProperty;function XC(t,e,r){for(r of t.keys())if(Ap(r,e))return r}function Ap(t,e){var r,l,d;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((l=t.length)===e.length)for(;l--&&Ap(t[l],e[l]););return l===-1}if(r===Set){if(t.size!==e.size)return!1;for(l of t)if(d=l,d&&typeof d=="object"&&(d=XC(e,d),!d)||!e.has(d))return!1;return!0}if(r===Map){if(t.size!==e.size)return!1;for(l of t)if(d=l[0],d&&typeof d=="object"&&(d=XC(e,d),!d)||!Ap(l[1],e.get(d)))return!1;return!0}if(r===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(r===DataView){if((l=t.byteLength)===e.byteLength)for(;l--&&t.getInt8(l)===e.getInt8(l););return l===-1}if(ArrayBuffer.isView(t)){if((l=t.byteLength)===e.byteLength)for(;l--&&t[l]===e[l];);return l===-1}if(!r||typeof t=="object"){l=0;for(r in t)if(ZC.call(t,r)&&++l&&!ZC.call(e,r)||!(r in e)||!Ap(t[r],e[r]))return!1;return Object.keys(e).length===l}}return t!==t&&e!==e}function w$(t){const e=G6();return[t[0],re.useCallback(r=>{if(e())return t[1](r)},[e,t[1]])]}var ji="top",ko="bottom",Mo="right",Ui="left",Kb="auto",wm=[ji,ko,Mo,Ui],ed="start",om="end",b$="clippingParents",qR="viewport",ap="popper",E$="reference",KC=wm.reduce(function(t,e){return t.concat([e+"-"+ed,e+"-"+om])},[]),HR=[].concat(wm,[Kb]).reduce(function(t,e){return t.concat([e,e+"-"+ed,e+"-"+om])},[]),T$="beforeRead",S$="read",I$="afterRead",C$="beforeMain",A$="main",P$="afterMain",k$="beforeWrite",M$="write",R$="afterWrite",D$=[T$,S$,I$,C$,A$,P$,k$,M$,R$];function Os(t){return t.split("-")[0]}function oo(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function uu(t){var e=oo(t).Element;return t instanceof e||t instanceof Element}function Bs(t){var e=oo(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Jb(t){if(typeof ShadowRoot>"u")return!1;var e=oo(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}var Qc=Math.max,Dy=Math.min,td=Math.round;function m1(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function ZR(){return!/^((?!chrome|android).)*safari/i.test(m1())}function nd(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var l=t.getBoundingClientRect(),d=1,g=1;e&&Bs(t)&&(d=t.offsetWidth>0&&td(l.width)/t.offsetWidth||1,g=t.offsetHeight>0&&td(l.height)/t.offsetHeight||1);var w=uu(t)?oo(t):window,I=w.visualViewport,a=!ZR()&&r,k=(l.left+(a&&I?I.offsetLeft:0))/d,O=(l.top+(a&&I?I.offsetTop:0))/g,V=l.width/d,G=l.height/g;return{width:V,height:G,top:O,right:k+V,bottom:O+G,left:k,x:k,y:O}}function Yb(t){var e=nd(t),r=t.offsetWidth,l=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-l)<=1&&(l=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:l}}function XR(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&Jb(r)){var l=e;do{if(l&&t.isSameNode(l))return!0;l=l.parentNode||l.host}while(l)}return!1}function Hl(t){return t?(t.nodeName||"").toLowerCase():null}function Aa(t){return oo(t).getComputedStyle(t)}function L$(t){return["table","td","th"].indexOf(Hl(t))>=0}function Yl(t){return((uu(t)?t.ownerDocument:t.document)||window.document).documentElement}function vv(t){return Hl(t)==="html"?t:t.assignedSlot||t.parentNode||(Jb(t)?t.host:null)||Yl(t)}function JC(t){return!Bs(t)||Aa(t).position==="fixed"?null:t.offsetParent}function z$(t){var e=/firefox/i.test(m1()),r=/Trident/i.test(m1());if(r&&Bs(t)){var l=Aa(t);if(l.position==="fixed")return null}var d=vv(t);for(Jb(d)&&(d=d.host);Bs(d)&&["html","body"].indexOf(Hl(d))<0;){var g=Aa(d);if(g.transform!=="none"||g.perspective!=="none"||g.contain==="paint"||["transform","perspective"].indexOf(g.willChange)!==-1||e&&g.willChange==="filter"||e&&g.filter&&g.filter!=="none")return d;d=d.parentNode}return null}function bm(t){for(var e=oo(t),r=JC(t);r&&L$(r)&&Aa(r).position==="static";)r=JC(r);return r&&(Hl(r)==="html"||Hl(r)==="body"&&Aa(r).position==="static")?e:r||z$(t)||e}function Qb(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Pp(t,e,r){return Qc(t,Dy(e,r))}function O$(t,e,r){var l=Pp(t,e,r);return l>r?r:l}function KR(){return{top:0,right:0,bottom:0,left:0}}function JR(t){return Object.assign({},KR(),t)}function YR(t,e){return e.reduce(function(r,l){return r[l]=t,r},{})}var B$=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,JR(typeof e!="number"?e:YR(e,wm))};function F$(t){var e,r=t.state,l=t.name,d=t.options,g=r.elements.arrow,w=r.modifiersData.popperOffsets,I=Os(r.placement),a=Qb(I),k=[Ui,Mo].indexOf(I)>=0,O=k?"height":"width";if(!(!g||!w)){var V=B$(d.padding,r),G=Yb(g),X=a==="y"?ji:Ui,oe=a==="y"?ko:Mo,le=r.rects.reference[O]+r.rects.reference[a]-w[a]-r.rects.popper[O],we=w[a]-r.rects.reference[a],te=bm(g),J=te?a==="y"?te.clientHeight||0:te.clientWidth||0:0,ce=le/2-we/2,Te=V[X],Ne=J-G[O]-V[oe],Ge=J/2-G[O]/2+ce,Xe=Pp(Te,Ge,Ne),qe=a;r.modifiersData[l]=(e={},e[qe]=Xe,e.centerOffset=Xe-Ge,e)}}function N$(t){var e=t.state,r=t.options,l=r.element,d=l===void 0?"[data-popper-arrow]":l;d!=null&&(typeof d=="string"&&(d=e.elements.popper.querySelector(d),!d)||XR(e.elements.popper,d)&&(e.elements.arrow=d))}const j$={name:"arrow",enabled:!0,phase:"main",fn:F$,effect:N$,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function rd(t){return t.split("-")[1]}var U$={top:"auto",right:"auto",bottom:"auto",left:"auto"};function V$(t,e){var r=t.x,l=t.y,d=e.devicePixelRatio||1;return{x:td(r*d)/d||0,y:td(l*d)/d||0}}function YC(t){var e,r=t.popper,l=t.popperRect,d=t.placement,g=t.variation,w=t.offsets,I=t.position,a=t.gpuAcceleration,k=t.adaptive,O=t.roundOffsets,V=t.isFixed,G=w.x,X=G===void 0?0:G,oe=w.y,le=oe===void 0?0:oe,we=typeof O=="function"?O({x:X,y:le}):{x:X,y:le};X=we.x,le=we.y;var te=w.hasOwnProperty("x"),J=w.hasOwnProperty("y"),ce=Ui,Te=ji,Ne=window;if(k){var Ge=bm(r),Xe="clientHeight",qe="clientWidth";if(Ge===oo(r)&&(Ge=Yl(r),Aa(Ge).position!=="static"&&I==="absolute"&&(Xe="scrollHeight",qe="scrollWidth")),Ge=Ge,d===ji||(d===Ui||d===Mo)&&g===om){Te=ko;var vt=V&&Ge===Ne&&Ne.visualViewport?Ne.visualViewport.height:Ge[Xe];le-=vt-l.height,le*=a?1:-1}if(d===Ui||(d===ji||d===ko)&&g===om){ce=Mo;var ze=V&&Ge===Ne&&Ne.visualViewport?Ne.visualViewport.width:Ge[qe];X-=ze-l.width,X*=a?1:-1}}var Ct=Object.assign({position:I},k&&U$),Ut=O===!0?V$({x:X,y:le},oo(r)):{x:X,y:le};if(X=Ut.x,le=Ut.y,a){var pt;return Object.assign({},Ct,(pt={},pt[Te]=J?"0":"",pt[ce]=te?"0":"",pt.transform=(Ne.devicePixelRatio||1)<=1?"translate("+X+"px, "+le+"px)":"translate3d("+X+"px, "+le+"px, 0)",pt))}return Object.assign({},Ct,(e={},e[Te]=J?le+"px":"",e[ce]=te?X+"px":"",e.transform="",e))}function $$(t){var e=t.state,r=t.options,l=r.gpuAcceleration,d=l===void 0?!0:l,g=r.adaptive,w=g===void 0?!0:g,I=r.roundOffsets,a=I===void 0?!0:I,k={placement:Os(e.placement),variation:rd(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:d,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,YC(Object.assign({},k,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:w,roundOffsets:a})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,YC(Object.assign({},k,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:a})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const G$={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:$$,data:{}};var w_={passive:!0};function W$(t){var e=t.state,r=t.instance,l=t.options,d=l.scroll,g=d===void 0?!0:d,w=l.resize,I=w===void 0?!0:w,a=oo(e.elements.popper),k=[].concat(e.scrollParents.reference,e.scrollParents.popper);return g&&k.forEach(function(O){O.addEventListener("scroll",r.update,w_)}),I&&a.addEventListener("resize",r.update,w_),function(){g&&k.forEach(function(O){O.removeEventListener("scroll",r.update,w_)}),I&&a.removeEventListener("resize",r.update,w_)}}const q$={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:W$,data:{}};var H$={left:"right",right:"left",bottom:"top",top:"bottom"};function V_(t){return t.replace(/left|right|bottom|top/g,function(e){return H$[e]})}var Z$={start:"end",end:"start"};function QC(t){return t.replace(/start|end/g,function(e){return Z$[e]})}function eE(t){var e=oo(t),r=e.pageXOffset,l=e.pageYOffset;return{scrollLeft:r,scrollTop:l}}function tE(t){return nd(Yl(t)).left+eE(t).scrollLeft}function X$(t,e){var r=oo(t),l=Yl(t),d=r.visualViewport,g=l.clientWidth,w=l.clientHeight,I=0,a=0;if(d){g=d.width,w=d.height;var k=ZR();(k||!k&&e==="fixed")&&(I=d.offsetLeft,a=d.offsetTop)}return{width:g,height:w,x:I+tE(t),y:a}}function K$(t){var e,r=Yl(t),l=eE(t),d=(e=t.ownerDocument)==null?void 0:e.body,g=Qc(r.scrollWidth,r.clientWidth,d?d.scrollWidth:0,d?d.clientWidth:0),w=Qc(r.scrollHeight,r.clientHeight,d?d.scrollHeight:0,d?d.clientHeight:0),I=-l.scrollLeft+tE(t),a=-l.scrollTop;return Aa(d||r).direction==="rtl"&&(I+=Qc(r.clientWidth,d?d.clientWidth:0)-g),{width:g,height:w,x:I,y:a}}function nE(t){var e=Aa(t),r=e.overflow,l=e.overflowX,d=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+d+l)}function QR(t){return["html","body","#document"].indexOf(Hl(t))>=0?t.ownerDocument.body:Bs(t)&&nE(t)?t:QR(vv(t))}function kp(t,e){var r;e===void 0&&(e=[]);var l=QR(t),d=l===((r=t.ownerDocument)==null?void 0:r.body),g=oo(l),w=d?[g].concat(g.visualViewport||[],nE(l)?l:[]):l,I=e.concat(w);return d?I:I.concat(kp(vv(w)))}function g1(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function J$(t,e){var r=nd(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function eA(t,e,r){return e===qR?g1(X$(t,r)):uu(e)?J$(e,r):g1(K$(Yl(t)))}function Y$(t){var e=kp(vv(t)),r=["absolute","fixed"].indexOf(Aa(t).position)>=0,l=r&&Bs(t)?bm(t):t;return uu(l)?e.filter(function(d){return uu(d)&&XR(d,l)&&Hl(d)!=="body"}):[]}function Q$(t,e,r,l){var d=e==="clippingParents"?Y$(t):[].concat(e),g=[].concat(d,[r]),w=g[0],I=g.reduce(function(a,k){var O=eA(t,k,l);return a.top=Qc(O.top,a.top),a.right=Dy(O.right,a.right),a.bottom=Dy(O.bottom,a.bottom),a.left=Qc(O.left,a.left),a},eA(t,w,l));return I.width=I.right-I.left,I.height=I.bottom-I.top,I.x=I.left,I.y=I.top,I}function eD(t){var e=t.reference,r=t.element,l=t.placement,d=l?Os(l):null,g=l?rd(l):null,w=e.x+e.width/2-r.width/2,I=e.y+e.height/2-r.height/2,a;switch(d){case ji:a={x:w,y:e.y-r.height};break;case ko:a={x:w,y:e.y+e.height};break;case Mo:a={x:e.x+e.width,y:I};break;case Ui:a={x:e.x-r.width,y:I};break;default:a={x:e.x,y:e.y}}var k=d?Qb(d):null;if(k!=null){var O=k==="y"?"height":"width";switch(g){case ed:a[k]=a[k]-(e[O]/2-r[O]/2);break;case om:a[k]=a[k]+(e[O]/2-r[O]/2);break}}return a}function sm(t,e){e===void 0&&(e={});var r=e,l=r.placement,d=l===void 0?t.placement:l,g=r.strategy,w=g===void 0?t.strategy:g,I=r.boundary,a=I===void 0?b$:I,k=r.rootBoundary,O=k===void 0?qR:k,V=r.elementContext,G=V===void 0?ap:V,X=r.altBoundary,oe=X===void 0?!1:X,le=r.padding,we=le===void 0?0:le,te=JR(typeof we!="number"?we:YR(we,wm)),J=G===ap?E$:ap,ce=t.rects.popper,Te=t.elements[oe?J:G],Ne=Q$(uu(Te)?Te:Te.contextElement||Yl(t.elements.popper),a,O,w),Ge=nd(t.elements.reference),Xe=eD({reference:Ge,element:ce,strategy:"absolute",placement:d}),qe=g1(Object.assign({},ce,Xe)),vt=G===ap?qe:Ge,ze={top:Ne.top-vt.top+te.top,bottom:vt.bottom-Ne.bottom+te.bottom,left:Ne.left-vt.left+te.left,right:vt.right-Ne.right+te.right},Ct=t.modifiersData.offset;if(G===ap&&Ct){var Ut=Ct[d];Object.keys(ze).forEach(function(pt){var Zt=[Mo,ko].indexOf(pt)>=0?1:-1,Hn=[ji,ko].indexOf(pt)>=0?"y":"x";ze[pt]+=Ut[Hn]*Zt})}return ze}function e8(t,e){e===void 0&&(e={});var r=e,l=r.placement,d=r.boundary,g=r.rootBoundary,w=r.padding,I=r.flipVariations,a=r.allowedAutoPlacements,k=a===void 0?HR:a,O=rd(l),V=O?I?KC:KC.filter(function(oe){return rd(oe)===O}):wm,G=V.filter(function(oe){return k.indexOf(oe)>=0});G.length===0&&(G=V);var X=G.reduce(function(oe,le){return oe[le]=sm(t,{placement:le,boundary:d,rootBoundary:g,padding:w})[Os(le)],oe},{});return Object.keys(X).sort(function(oe,le){return X[oe]-X[le]})}function t8(t){if(Os(t)===Kb)return[];var e=V_(t);return[QC(t),e,QC(e)]}function n8(t){var e=t.state,r=t.options,l=t.name;if(!e.modifiersData[l]._skip){for(var d=r.mainAxis,g=d===void 0?!0:d,w=r.altAxis,I=w===void 0?!0:w,a=r.fallbackPlacements,k=r.padding,O=r.boundary,V=r.rootBoundary,G=r.altBoundary,X=r.flipVariations,oe=X===void 0?!0:X,le=r.allowedAutoPlacements,we=e.options.placement,te=Os(we),J=te===we,ce=a||(J||!oe?[V_(we)]:t8(we)),Te=[we].concat(ce).reduce(function(Yt,Zn){return Yt.concat(Os(Zn)===Kb?e8(e,{placement:Zn,boundary:O,rootBoundary:V,padding:k,flipVariations:oe,allowedAutoPlacements:le}):Zn)},[]),Ne=e.rects.reference,Ge=e.rects.popper,Xe=new Map,qe=!0,vt=Te[0],ze=0;ze<Te.length;ze++){var Ct=Te[ze],Ut=Os(Ct),pt=rd(Ct)===ed,Zt=[ji,ko].indexOf(Ut)>=0,Hn=Zt?"width":"height",Dn=sm(e,{placement:Ct,boundary:O,rootBoundary:V,altBoundary:G,padding:k}),Fn=Zt?pt?Mo:Ui:pt?ko:ji;Ne[Hn]>Ge[Hn]&&(Fn=V_(Fn));var _t=V_(Fn),ot=[];if(g&&ot.push(Dn[Ut]<=0),I&&ot.push(Dn[Fn]<=0,Dn[_t]<=0),ot.every(function(Yt){return Yt})){vt=Ct,qe=!1;break}Xe.set(Ct,ot)}if(qe)for(var Tt=oe?3:1,Rt=function(Zn){var cr=Te.find(function(vr){var Ar=Xe.get(vr);if(Ar)return Ar.slice(0,Zn).every(function(ds){return ds})});if(cr)return vt=cr,"break"},Vt=Tt;Vt>0;Vt--){var yr=Rt(Vt);if(yr==="break")break}e.placement!==vt&&(e.modifiersData[l]._skip=!0,e.placement=vt,e.reset=!0)}}const r8={name:"flip",enabled:!0,phase:"main",fn:n8,requiresIfExists:["offset"],data:{_skip:!1}};function tA(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function nA(t){return[ji,Mo,ko,Ui].some(function(e){return t[e]>=0})}function i8(t){var e=t.state,r=t.name,l=e.rects.reference,d=e.rects.popper,g=e.modifiersData.preventOverflow,w=sm(e,{elementContext:"reference"}),I=sm(e,{altBoundary:!0}),a=tA(w,l),k=tA(I,d,g),O=nA(a),V=nA(k);e.modifiersData[r]={referenceClippingOffsets:a,popperEscapeOffsets:k,isReferenceHidden:O,hasPopperEscaped:V},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":O,"data-popper-escaped":V})}const o8={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:i8};function s8(t,e,r){var l=Os(t),d=[Ui,ji].indexOf(l)>=0?-1:1,g=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,w=g[0],I=g[1];return w=w||0,I=(I||0)*d,[Ui,Mo].indexOf(l)>=0?{x:I,y:w}:{x:w,y:I}}function a8(t){var e=t.state,r=t.options,l=t.name,d=r.offset,g=d===void 0?[0,0]:d,w=HR.reduce(function(O,V){return O[V]=s8(V,e.rects,g),O},{}),I=w[e.placement],a=I.x,k=I.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=a,e.modifiersData.popperOffsets.y+=k),e.modifiersData[l]=w}const l8={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:a8};function c8(t){var e=t.state,r=t.name;e.modifiersData[r]=eD({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const u8={name:"popperOffsets",enabled:!0,phase:"read",fn:c8,data:{}};function h8(t){return t==="x"?"y":"x"}function d8(t){var e=t.state,r=t.options,l=t.name,d=r.mainAxis,g=d===void 0?!0:d,w=r.altAxis,I=w===void 0?!1:w,a=r.boundary,k=r.rootBoundary,O=r.altBoundary,V=r.padding,G=r.tether,X=G===void 0?!0:G,oe=r.tetherOffset,le=oe===void 0?0:oe,we=sm(e,{boundary:a,rootBoundary:k,padding:V,altBoundary:O}),te=Os(e.placement),J=rd(e.placement),ce=!J,Te=Qb(te),Ne=h8(Te),Ge=e.modifiersData.popperOffsets,Xe=e.rects.reference,qe=e.rects.popper,vt=typeof le=="function"?le(Object.assign({},e.rects,{placement:e.placement})):le,ze=typeof vt=="number"?{mainAxis:vt,altAxis:vt}:Object.assign({mainAxis:0,altAxis:0},vt),Ct=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Ut={x:0,y:0};if(Ge){if(g){var pt,Zt=Te==="y"?ji:Ui,Hn=Te==="y"?ko:Mo,Dn=Te==="y"?"height":"width",Fn=Ge[Te],_t=Fn+we[Zt],ot=Fn-we[Hn],Tt=X?-qe[Dn]/2:0,Rt=J===ed?Xe[Dn]:qe[Dn],Vt=J===ed?-qe[Dn]:-Xe[Dn],yr=e.elements.arrow,Yt=X&&yr?Yb(yr):{width:0,height:0},Zn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:KR(),cr=Zn[Zt],vr=Zn[Hn],Ar=Pp(0,Xe[Dn],Yt[Dn]),ds=ce?Xe[Dn]/2-Tt-Ar-cr-ze.mainAxis:Rt-Ar-cr-ze.mainAxis,Ro=ce?-Xe[Dn]/2+Tt+Ar+vr+ze.mainAxis:Vt+Ar+vr+ze.mainAxis,lo=e.elements.arrow&&bm(e.elements.arrow),qt=lo?Te==="y"?lo.clientTop||0:lo.clientLeft||0:0,Do=(pt=Ct==null?void 0:Ct[Te])!=null?pt:0,Gr=Fn+ds-Do-qt,js=Fn+Ro-Do,In=Pp(X?Dy(_t,Gr):_t,Fn,X?Qc(ot,js):ot);Ge[Te]=In,Ut[Te]=In-Fn}if(I){var Wr,Oa=Te==="x"?ji:Ui,Vi=Te==="x"?ko:Mo,Xn=Ge[Ne],co=Ne==="y"?"height":"width",Lo=Xn+we[Oa],fs=Xn-we[Vi],Ei=[ji,Ui].indexOf(te)!==-1,zo=(Wr=Ct==null?void 0:Ct[Ne])!=null?Wr:0,Us=Ei?Lo:Xn-Xe[co]-qe[co]-zo+ze.altAxis,Vs=Ei?Xn+Xe[co]+qe[co]-zo-ze.altAxis:fs,qr=X&&Ei?O$(Us,Xn,Vs):Pp(X?Us:Lo,Xn,X?Vs:fs);Ge[Ne]=qr,Ut[Ne]=qr-Xn}e.modifiersData[l]=Ut}}const f8={name:"preventOverflow",enabled:!0,phase:"main",fn:d8,requiresIfExists:["offset"]};function p8(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function m8(t){return t===oo(t)||!Bs(t)?eE(t):p8(t)}function g8(t){var e=t.getBoundingClientRect(),r=td(e.width)/t.offsetWidth||1,l=td(e.height)/t.offsetHeight||1;return r!==1||l!==1}function _8(t,e,r){r===void 0&&(r=!1);var l=Bs(e),d=Bs(e)&&g8(e),g=Yl(e),w=nd(t,d,r),I={scrollLeft:0,scrollTop:0},a={x:0,y:0};return(l||!l&&!r)&&((Hl(e)!=="body"||nE(g))&&(I=m8(e)),Bs(e)?(a=nd(e,!0),a.x+=e.clientLeft,a.y+=e.clientTop):g&&(a.x=tE(g))),{x:w.left+I.scrollLeft-a.x,y:w.top+I.scrollTop-a.y,width:w.width,height:w.height}}function y8(t){var e=new Map,r=new Set,l=[];t.forEach(function(g){e.set(g.name,g)});function d(g){r.add(g.name);var w=[].concat(g.requires||[],g.requiresIfExists||[]);w.forEach(function(I){if(!r.has(I)){var a=e.get(I);a&&d(a)}}),l.push(g)}return t.forEach(function(g){r.has(g.name)||d(g)}),l}function v8(t){var e=y8(t);return D$.reduce(function(r,l){return r.concat(e.filter(function(d){return d.phase===l}))},[])}function x8(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function w8(t){var e=t.reduce(function(r,l){var d=r[l.name];return r[l.name]=d?Object.assign({},d,l,{options:Object.assign({},d.options,l.options),data:Object.assign({},d.data,l.data)}):l,r},{});return Object.keys(e).map(function(r){return e[r]})}var rA={placement:"bottom",modifiers:[],strategy:"absolute"};function iA(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(l){return!(l&&typeof l.getBoundingClientRect=="function")})}function b8(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,l=r===void 0?[]:r,d=e.defaultOptions,g=d===void 0?rA:d;return function(I,a,k){k===void 0&&(k=g);var O={placement:"bottom",orderedModifiers:[],options:Object.assign({},rA,g),modifiersData:{},elements:{reference:I,popper:a},attributes:{},styles:{}},V=[],G=!1,X={state:O,setOptions:function(te){var J=typeof te=="function"?te(O.options):te;le(),O.options=Object.assign({},g,O.options,J),O.scrollParents={reference:uu(I)?kp(I):I.contextElement?kp(I.contextElement):[],popper:kp(a)};var ce=v8(w8([].concat(l,O.options.modifiers)));return O.orderedModifiers=ce.filter(function(Te){return Te.enabled}),oe(),X.update()},forceUpdate:function(){if(!G){var te=O.elements,J=te.reference,ce=te.popper;if(iA(J,ce)){O.rects={reference:_8(J,bm(ce),O.options.strategy==="fixed"),popper:Yb(ce)},O.reset=!1,O.placement=O.options.placement,O.orderedModifiers.forEach(function(ze){return O.modifiersData[ze.name]=Object.assign({},ze.data)});for(var Te=0;Te<O.orderedModifiers.length;Te++){if(O.reset===!0){O.reset=!1,Te=-1;continue}var Ne=O.orderedModifiers[Te],Ge=Ne.fn,Xe=Ne.options,qe=Xe===void 0?{}:Xe,vt=Ne.name;typeof Ge=="function"&&(O=Ge({state:O,options:qe,name:vt,instance:X})||O)}}}},update:x8(function(){return new Promise(function(we){X.forceUpdate(),we(O)})}),destroy:function(){le(),G=!0}};if(!iA(I,a))return X;X.setOptions(k).then(function(we){!G&&k.onFirstUpdate&&k.onFirstUpdate(we)});function oe(){O.orderedModifiers.forEach(function(we){var te=we.name,J=we.options,ce=J===void 0?{}:J,Te=we.effect;if(typeof Te=="function"){var Ne=Te({state:O,name:te,instance:X,options:ce}),Ge=function(){};V.push(Ne||Ge)}})}function le(){V.forEach(function(we){return we()}),V=[]}return X}}const E8=b8({defaultModifiers:[o8,u8,G$,q$,l8,r8,f8,j$]}),T8=["enabled","placement","strategy","modifiers"];function S8(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}const I8={name:"applyStyles",enabled:!1,phase:"afterWrite",fn:()=>{}},C8={name:"ariaDescribedBy",enabled:!0,phase:"afterWrite",effect:({state:t})=>()=>{const{reference:e,popper:r}=t.elements;if("removeAttribute"in e){const l=(e.getAttribute("aria-describedby")||"").split(",").filter(d=>d.trim()!==r.id);l.length?e.setAttribute("aria-describedby",l.join(",")):e.removeAttribute("aria-describedby")}},fn:({state:t})=>{var e;const{popper:r,reference:l}=t.elements,d=(e=r.getAttribute("role"))==null?void 0:e.toLowerCase();if(r.id&&d==="tooltip"&&"setAttribute"in l){const g=l.getAttribute("aria-describedby");if(g&&g.split(",").indexOf(r.id)!==-1)return;l.setAttribute("aria-describedby",g?`${g},${r.id}`:r.id)}}},A8=[];function P8(t,e,r={}){let{enabled:l=!0,placement:d="bottom",strategy:g="absolute",modifiers:w=A8}=r,I=S8(r,T8);const a=re.useRef(w),k=re.useRef(),O=re.useCallback(()=>{var we;(we=k.current)==null||we.update()},[]),V=re.useCallback(()=>{var we;(we=k.current)==null||we.forceUpdate()},[]),[G,X]=w$(re.useState({placement:d,update:O,forceUpdate:V,attributes:{},styles:{popper:{},arrow:{}}})),oe=re.useMemo(()=>({name:"updateStateModifier",enabled:!0,phase:"write",requires:["computeStyles"],fn:({state:we})=>{const te={},J={};Object.keys(we.elements).forEach(ce=>{te[ce]=we.styles[ce],J[ce]=we.attributes[ce]}),X({state:we,styles:te,attributes:J,update:O,forceUpdate:V,placement:we.placement})}}),[O,V,X]),le=re.useMemo(()=>(Ap(a.current,w)||(a.current=w),a.current),[w]);return re.useEffect(()=>{!k.current||!l||k.current.setOptions({placement:d,strategy:g,modifiers:[...le,oe,I8]})},[g,d,oe,l,le]),re.useEffect(()=>{if(!(!l||t==null||e==null))return k.current=E8(t,e,Object.assign({},I,{placement:d,strategy:g,modifiers:[...le,C8,oe]})),()=>{k.current!=null&&(k.current.destroy(),k.current=void 0,X(we=>Object.assign({},we,{attributes:{},styles:{popper:{}}})))}},[l,t,e]),G}function oA(t,e){if(t.contains)return t.contains(e);if(t.compareDocumentPosition)return t===e||!!(t.compareDocumentPosition(e)&16)}var k8=function(){},M8=k8;const R8=od(M8),sA=()=>{};function D8(t){return t.button===0}function L8(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}const W0=t=>t&&("current"in t?t.current:t),aA={click:"mousedown",mouseup:"mousedown",pointerup:"pointerdown"};function z8(t,e=sA,{disabled:r,clickTrigger:l="click"}={}){const d=re.useRef(!1),g=re.useRef(!1),w=re.useCallback(k=>{const O=W0(t);R8(!!O,"ClickOutside captured a close event but does not have a ref to compare it to. useClickOutside(), should be passed a ref that resolves to a DOM node"),d.current=!O||L8(k)||!D8(k)||!!oA(O,k.target)||g.current,g.current=!1},[t]),I=wa(k=>{const O=W0(t);O&&oA(O,k.target)&&(g.current=!0)}),a=wa(k=>{d.current||e(k)});re.useEffect(()=>{var k,O;if(r||t==null)return;const V=D6(W0(t)),G=V.defaultView||window;let X=(k=G.event)!=null?k:(O=G.parent)==null?void 0:O.event,oe=null;aA[l]&&(oe=v_(V,aA[l],I,!0));const le=v_(V,l,w,!0),we=v_(V,l,J=>{if(J===X){X=void 0;return}a(J)});let te=[];return"ontouchstart"in V.documentElement&&(te=[].slice.call(V.body.children).map(J=>v_(J,"mousemove",sA))),()=>{oe==null||oe(),le(),we(),te.forEach(J=>J())}},[t,r,l,w,I,a])}function O8(t){const e={};return Array.isArray(t)?(t==null||t.forEach(r=>{e[r.name]=r}),e):t||e}function B8(t={}){return Array.isArray(t)?t:Object.keys(t).map(e=>(t[e].name=e,t[e]))}function F8({enabled:t,enableEvents:e,placement:r,flip:l,offset:d,fixed:g,containerPadding:w,arrowElement:I,popperConfig:a={}}){var k,O,V,G,X;const oe=O8(a.modifiers);return Object.assign({},a,{placement:r,enabled:t,strategy:g?"fixed":a.strategy,modifiers:B8(Object.assign({},oe,{eventListeners:{enabled:e,options:(k=oe.eventListeners)==null?void 0:k.options},preventOverflow:Object.assign({},oe.preventOverflow,{options:w?Object.assign({padding:w},(O=oe.preventOverflow)==null?void 0:O.options):(V=oe.preventOverflow)==null?void 0:V.options}),offset:{options:Object.assign({offset:d},(G=oe.offset)==null?void 0:G.options)},arrow:Object.assign({},oe.arrow,{enabled:!!I,options:Object.assign({},(X=oe.arrow)==null?void 0:X.options,{element:I})}),flip:Object.assign({enabled:!!l},oe.flip)}))})}const N8=["children"];function j8(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}const U8=()=>{};function tD(t={}){const e=re.useContext(yv),[r,l]=V6(),d=re.useRef(!1),{flip:g,offset:w,rootCloseEvent:I,fixed:a=!1,placement:k,popperConfig:O={},enableEventListeners:V=!0,usePopper:G=!!e}=t,X=(e==null?void 0:e.show)==null?!!t.show:e.show;X&&!d.current&&(d.current=!0);const oe=Ge=>{e==null||e.toggle(!1,Ge)},{placement:le,setMenu:we,menuElement:te,toggleElement:J}=e||{},ce=P8(J,te,F8({placement:k||le||"bottom-start",enabled:G,enableEvents:V??X,offset:w,flip:g,fixed:a,arrowElement:r,popperConfig:O})),Te=Object.assign({ref:we||U8,"aria-labelledby":J==null?void 0:J.id},ce.attributes.popper,{style:ce.styles.popper}),Ne={show:X,placement:le,hasShown:d.current,toggle:e==null?void 0:e.toggle,popper:G?ce:null,arrowProps:G?Object.assign({ref:l},ce.attributes.arrow,{style:ce.styles.arrow}):{}};return z8(te,oe,{clickTrigger:I,disabled:!X}),[Te,Ne]}const V8={usePopper:!0};function rE(t){let{children:e}=t,r=j8(t,N8);const[l,d]=tD(r);return j.jsx(j.Fragment,{children:e(l,d)})}rE.displayName="DropdownMenu";rE.defaultProps=V8;const Ly={prefix:String(Math.round(Math.random()*1e10)),current:0},nD=ro.createContext(Ly),$8=ro.createContext(!1);let G8=!!(typeof window<"u"&&window.document&&window.document.createElement),q0=new WeakMap;function W8(t=!1){let e=re.useContext(nD),r=re.useRef(null);if(r.current===null&&!t){var l,d;let g=(d=ro.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED)===null||d===void 0||(l=d.ReactCurrentOwner)===null||l===void 0?void 0:l.current;if(g){let w=q0.get(g);w==null?q0.set(g,{id:e.current,state:g.memoizedState}):g.memoizedState!==w.state&&(e.current=w.id,q0.delete(g))}r.current=++e.current}return r.current}function q8(t){let e=re.useContext(nD);e===Ly&&!G8&&console.warn("When server rendering, you must wrap your application in an <SSRProvider> to ensure consistent ids are generated between the client and server.");let r=W8(!!t),l=`react-aria${e.prefix}`;return t||`${l}-${r}`}function H8(t){let e=ro.useId(),[r]=re.useState(Y8()),l=r?"react-aria":`react-aria${Ly.prefix}`;return t||`${l}-${e}`}const Z8=typeof ro.useId=="function"?H8:q8;function X8(){return!1}function K8(){return!0}function J8(t){return()=>{}}function Y8(){return typeof ro.useSyncExternalStore=="function"?ro.useSyncExternalStore(J8,X8,K8):re.useContext($8)}const rD=t=>{var e;return((e=t.getAttribute("role"))==null?void 0:e.toLowerCase())==="menu"},lA=()=>{};function iD(){const t=Z8(),{show:e=!1,toggle:r=lA,setToggle:l,menuElement:d}=re.useContext(yv)||{},g=re.useCallback(I=>{r(!e,I)},[e,r]),w={id:t,ref:l||lA,onClick:g,"aria-expanded":!!e};return d&&rD(d)&&(w["aria-haspopup"]=!0),[w,{show:e,toggle:r}]}function oD({children:t}){const[e,r]=iD();return j.jsx(j.Fragment,{children:t(e,r)})}oD.displayName="DropdownToggle";const Q8=re.createContext(null),cA=(t,e=null)=>t!=null?String(t):e||null,_1=Q8,sD=re.createContext(null);sD.displayName="NavContext";const eG=sD,tG="data-rr-ui-";function aD(t){return`${tG}${t}`}const nG=["eventKey","disabled","onClick","active","as"];function rG(t,e){if(t==null)return{};var r={},l=Object.keys(t),d,g;for(g=0;g<l.length;g++)d=l[g],!(e.indexOf(d)>=0)&&(r[d]=t[d]);return r}function lD({key:t,href:e,active:r,disabled:l,onClick:d}){const g=re.useContext(_1),w=re.useContext(eG),{activeKey:I}=w||{},a=cA(t,e),k=r==null&&t!=null?cA(I)===a:r;return[{onClick:wa(V=>{l||(d==null||d(V),g&&!V.isPropagationStopped()&&g(a,V))}),"aria-disabled":l||void 0,"aria-selected":k,[aD("dropdown-item")]:""},{isActive:k}]}const cD=re.forwardRef((t,e)=>{let{eventKey:r,disabled:l,onClick:d,active:g,as:w=AR}=t,I=rG(t,nG);const[a]=lD({key:r,href:I.href,disabled:l,onClick:d,active:g});return j.jsx(w,Object.assign({},I,{ref:e},a))});cD.displayName="DropdownItem";const uD=re.createContext(TR?window:void 0);uD.Provider;function iG(){return re.useContext(uD)}function uA(){const t=v$(),e=re.useRef(null),r=re.useCallback(l=>{e.current=l,t()},[t]);return[e,r]}function Em({defaultShow:t,show:e,onSelect:r,onToggle:l,itemSelector:d=`* [${aD("dropdown-item")}]`,focusFirstItemOnShow:g,placement:w="bottom-start",children:I}){const a=iG(),[k,O]=y$(e,t,l),[V,G]=uA(),X=V.current,[oe,le]=uA(),we=oe.current,te=W6(k),J=re.useRef(null),ce=re.useRef(!1),Te=re.useContext(_1),Ne=re.useCallback((Ct,Ut,pt=Ut==null?void 0:Ut.type)=>{O(Ct,{originalEvent:Ut,source:pt})},[O]),Ge=wa((Ct,Ut)=>{r==null||r(Ct,Ut),Ne(!1,Ut,"select"),Ut.isPropagationStopped()||Te==null||Te(Ct,Ut)}),Xe=re.useMemo(()=>({toggle:Ne,placement:w,show:k,menuElement:X,toggleElement:we,setMenu:G,setToggle:le}),[Ne,w,k,X,we,G,le]);X&&te&&!k&&(ce.current=X.contains(X.ownerDocument.activeElement));const qe=wa(()=>{we&&we.focus&&we.focus()}),vt=wa(()=>{const Ct=J.current;let Ut=g;if(Ut==null&&(Ut=V.current&&rD(V.current)?"keyboard":!1),Ut===!1||Ut==="keyboard"&&!/^key.+$/.test(Ct))return;const pt=HC(V.current,d)[0];pt&&pt.focus&&pt.focus()});re.useEffect(()=>{k?vt():ce.current&&(ce.current=!1,qe())},[k,ce,qe,vt]),re.useEffect(()=>{J.current=null});const ze=(Ct,Ut)=>{if(!V.current)return null;const pt=HC(V.current,d);let Zt=pt.indexOf(Ct)+Ut;return Zt=Math.max(0,Math.min(Zt,pt.length)),pt[Zt]};return $6(re.useCallback(()=>a.document,[a]),"keydown",Ct=>{var Ut,pt;const{key:Zt}=Ct,Hn=Ct.target,Dn=(Ut=V.current)==null?void 0:Ut.contains(Hn),Fn=(pt=oe.current)==null?void 0:pt.contains(Hn);if(/input|textarea/i.test(Hn.tagName)&&(Zt===" "||Zt!=="Escape"&&Dn||Zt==="Escape"&&Hn.type==="search")||!Dn&&!Fn||Zt==="Tab"&&(!V.current||!k))return;J.current=Ct.type;const ot={originalEvent:Ct,source:Ct.type};switch(Zt){case"ArrowUp":{const Tt=ze(Hn,-1);Tt&&Tt.focus&&Tt.focus(),Ct.preventDefault();return}case"ArrowDown":if(Ct.preventDefault(),!k)O(!0,ot);else{const Tt=ze(Hn,1);Tt&&Tt.focus&&Tt.focus()}return;case"Tab":SR(Hn.ownerDocument,"keyup",Tt=>{var Rt;(Tt.key==="Tab"&&!Tt.target||!((Rt=V.current)!=null&&Rt.contains(Tt.target)))&&O(!1,ot)},{once:!0});break;case"Escape":Zt==="Escape"&&(Ct.preventDefault(),Ct.stopPropagation()),O(!1,ot);break}}),j.jsx(_1.Provider,{value:Ge,children:j.jsx(yv.Provider,{value:Xe,children:I})})}Em.displayName="Dropdown";Em.Menu=rE;Em.Toggle=oD;Em.Item=cD;const hD=re.createContext({});hD.displayName="DropdownContext";const dD=hD,fD=re.forwardRef(({className:t,bsPrefix:e,as:r="hr",role:l="separator",...d},g)=>(e=hn(e,"dropdown-divider"),j.jsx(r,{ref:g,className:rn(t,e),role:l,...d})));fD.displayName="DropdownDivider";const oG=fD,pD=re.forwardRef(({className:t,bsPrefix:e,as:r="div",role:l="heading",...d},g)=>(e=hn(e,"dropdown-header"),j.jsx(r,{ref:g,className:rn(t,e),role:l,...d})));pD.displayName="DropdownHeader";const sG=pD,mD=re.forwardRef(({bsPrefix:t,className:e,eventKey:r,disabled:l=!1,onClick:d,active:g,as:w=t$,...I},a)=>{const k=hn(t,"dropdown-item"),[O,V]=lD({key:r,href:I.href,disabled:l,onClick:d,active:g});return j.jsx(w,{...I,...O,ref:a,className:rn(e,k,V.isActive&&"active",l&&"disabled")})});mD.displayName="DropdownItem";const aG=mD,gD=re.forwardRef(({className:t,bsPrefix:e,as:r="span",...l},d)=>(e=hn(e,"dropdown-item-text"),j.jsx(r,{ref:d,className:rn(t,e),...l})));gD.displayName="DropdownItemText";const lG=gD,_D=re.createContext(null);_D.displayName="InputGroupContext";const yD=_D,vD=re.createContext(null);vD.displayName="NavbarContext";const cG=vD;function xD(t,e){return t}function wD(t,e,r){const l=r?"top-end":"top-start",d=r?"top-start":"top-end",g=r?"bottom-end":"bottom-start",w=r?"bottom-start":"bottom-end",I=r?"right-start":"left-start",a=r?"right-end":"left-end",k=r?"left-start":"right-start",O=r?"left-end":"right-end";let V=t?w:g;return e==="up"?V=t?d:l:e==="end"?V=t?O:k:e==="start"?V=t?a:I:e==="down-centered"?V="bottom":e==="up-centered"&&(V="top"),V}const bD=re.forwardRef(({bsPrefix:t,className:e,align:r,rootCloseEvent:l,flip:d=!0,show:g,renderOnMount:w,as:I="div",popperConfig:a,variant:k,...O},V)=>{let G=!1;const X=re.useContext(cG),oe=hn(t,"dropdown-menu"),{align:le,drop:we,isRTL:te}=re.useContext(dD);r=r||le;const J=re.useContext(yD),ce=[];if(r)if(typeof r=="object"){const Ct=Object.keys(r);if(Ct.length){const Ut=Ct[0],pt=r[Ut];G=pt==="start",ce.push(`${oe}-${Ut}-${pt}`)}}else r==="end"&&(G=!0);const Te=wD(G,we,te),[Ne,{hasShown:Ge,popper:Xe,show:qe,toggle:vt}]=tD({flip:d,rootCloseEvent:l,show:g,usePopper:!X&&ce.length===0,offset:[0,2],popperConfig:a,placement:Te});if(Ne.ref=IR(xD(V),Ne.ref),Z6(()=>{qe&&(Xe==null||Xe.update())},[qe]),!Ge&&!w&&!J)return null;typeof I!="string"&&(Ne.show=qe,Ne.close=()=>vt==null?void 0:vt(!1),Ne.align=r);let ze=O.style;return Xe!=null&&Xe.placement&&(ze={...O.style,...Ne.style},O["x-placement"]=Xe.placement),j.jsx(I,{...O,...Ne,style:ze,...(ce.length||X)&&{"data-bs-popper":"static"},className:rn(e,oe,qe&&"show",G&&`${oe}-end`,k&&`${oe}-${k}`,...ce)})});bD.displayName="DropdownMenu";const uG=bD,ED=re.forwardRef(({bsPrefix:t,split:e,className:r,childBsPrefix:l,as:d=no,...g},w)=>{const I=hn(t,"dropdown-toggle"),a=re.useContext(yv);l!==void 0&&(g.bsPrefix=l);const[k]=iD();return k.ref=IR(k.ref,xD(w)),j.jsx(d,{className:rn(r,I,e&&`${I}-split`,(a==null?void 0:a.show)&&"show"),...k,...g})});ED.displayName="DropdownToggle";const hG=ED,TD=re.forwardRef((t,e)=>{const{bsPrefix:r,drop:l="down",show:d,className:g,align:w="start",onSelect:I,onToggle:a,focusFirstItemOnShow:k,as:O="div",navbar:V,autoClose:G=!0,...X}=P6(t,{show:"onToggle"}),oe=re.useContext(yD),le=hn(r,"dropdown"),we=R6(),te=Xe=>G===!1?Xe==="click":G==="inside"?Xe!=="rootClose":G==="outside"?Xe!=="select":!0,J=wa((Xe,qe)=>{qe.originalEvent.currentTarget===document&&(qe.source!=="keydown"||qe.originalEvent.key==="Escape")&&(qe.source="rootClose"),te(qe.source)&&(a==null||a(Xe,qe))}),Te=wD(w==="end",l,we),Ne=re.useMemo(()=>({align:w,drop:l,isRTL:we}),[w,l,we]),Ge={down:le,"down-centered":`${le}-center`,up:"dropup","up-centered":"dropup-center dropup",end:"dropend",start:"dropstart"};return j.jsx(dD.Provider,{value:Ne,children:j.jsx(Em,{placement:Te,show:d,onSelect:I,onToggle:J,focusFirstItemOnShow:k,itemSelector:`.${le}-item:not(.disabled):not(:disabled)`,children:oe?X.children:j.jsx(O,{...X,ref:e,className:rn(g,d&&"show",Ge[l])})})})});TD.displayName="Dropdown";const zi=Object.assign(TD,{Toggle:hG,Menu:uG,Item:aG,ItemText:lG,Divider:oG,Header:sG}),dG={type:jh.string,tooltip:jh.bool,as:jh.elementType},iE=re.forwardRef(({as:t="div",className:e,type:r="valid",tooltip:l=!1,...d},g)=>j.jsx(t,{...d,ref:g,className:rn(e,`${r}-${l?"tooltip":"feedback"}`)}));iE.displayName="Feedback";iE.propTypes=dG;const SD=iE,fG=re.createContext({}),Pa=fG,ID=re.forwardRef(({id:t,bsPrefix:e,className:r,type:l="checkbox",isValid:d=!1,isInvalid:g=!1,as:w="input",...I},a)=>{const{controlId:k}=re.useContext(Pa);return e=hn(e,"form-check-input"),j.jsx(w,{...I,ref:a,type:l,id:t||k,className:rn(r,e,d&&"is-valid",g&&"is-invalid")})});ID.displayName="FormCheckInput";const CD=ID,AD=re.forwardRef(({bsPrefix:t,className:e,htmlFor:r,...l},d)=>{const{controlId:g}=re.useContext(Pa);return t=hn(t,"form-check-label"),j.jsx("label",{...l,ref:d,htmlFor:r||g,className:rn(e,t)})});AD.displayName="FormCheckLabel";const y1=AD,PD=re.forwardRef(({id:t,bsPrefix:e,bsSwitchPrefix:r,inline:l=!1,reverse:d=!1,disabled:g=!1,isValid:w=!1,isInvalid:I=!1,feedbackTooltip:a=!1,feedback:k,feedbackType:O,className:V,style:G,title:X="",type:oe="checkbox",label:le,children:we,as:te="input",...J},ce)=>{e=hn(e,"form-check"),r=hn(r,"form-switch");const{controlId:Te}=re.useContext(Pa),Ne=re.useMemo(()=>({controlId:t||Te}),[Te,t]),Ge=!we&&le!=null&&le!==!1||p$(we,y1),Xe=j.jsx(CD,{...J,type:oe==="switch"?"checkbox":oe,ref:ce,isValid:w,isInvalid:I,disabled:g,as:te});return j.jsx(Pa.Provider,{value:Ne,children:j.jsx("div",{style:G,className:rn(V,Ge&&e,l&&`${e}-inline`,d&&`${e}-reverse`,oe==="switch"&&r),children:we||j.jsxs(j.Fragment,{children:[Xe,Ge&&j.jsx(y1,{title:X,children:le}),k&&j.jsx(SD,{type:O,tooltip:a,children:k})]})})})});PD.displayName="FormCheck";const zy=Object.assign(PD,{Input:CD,Label:y1}),kD=re.forwardRef(({bsPrefix:t,type:e,size:r,htmlSize:l,id:d,className:g,isValid:w=!1,isInvalid:I=!1,plaintext:a,readOnly:k,as:O="input",...V},G)=>{const{controlId:X}=re.useContext(Pa);return t=hn(t,"form-control"),j.jsx(O,{...V,type:e,size:l,ref:G,readOnly:k,id:d||X,className:rn(g,a?`${t}-plaintext`:t,r&&`${t}-${r}`,e==="color"&&`${t}-color`,w&&"is-valid",I&&"is-invalid")})});kD.displayName="FormControl";const pG=Object.assign(kD,{Feedback:SD}),MD=re.forwardRef(({className:t,bsPrefix:e,as:r="div",...l},d)=>(e=hn(e,"form-floating"),j.jsx(r,{ref:d,className:rn(t,e),...l})));MD.displayName="FormFloating";const mG=MD,RD=re.forwardRef(({controlId:t,as:e="div",...r},l)=>{const d=re.useMemo(()=>({controlId:t}),[t]);return j.jsx(Pa.Provider,{value:d,children:j.jsx(e,{...r,ref:l})})});RD.displayName="FormGroup";const DD=RD,LD=re.forwardRef(({as:t="label",bsPrefix:e,column:r=!1,visuallyHidden:l=!1,className:d,htmlFor:g,...w},I)=>{const{controlId:a}=re.useContext(Pa);e=hn(e,"form-label");let k="col-form-label";typeof r=="string"&&(k=`${k} ${k}-${r}`);const O=rn(d,e,l&&"visually-hidden",r&&k);return g=g||a,r?j.jsx(U_,{ref:I,as:"label",className:O,htmlFor:g,...w}):j.jsx(t,{ref:I,className:O,htmlFor:g,...w})});LD.displayName="FormLabel";const gG=LD,zD=re.forwardRef(({bsPrefix:t,className:e,id:r,...l},d)=>{const{controlId:g}=re.useContext(Pa);return t=hn(t,"form-range"),j.jsx("input",{...l,type:"range",ref:d,className:rn(e,t),id:r||g})});zD.displayName="FormRange";const _G=zD,OD=re.forwardRef(({bsPrefix:t,size:e,htmlSize:r,className:l,isValid:d=!1,isInvalid:g=!1,id:w,...I},a)=>{const{controlId:k}=re.useContext(Pa);return t=hn(t,"form-select"),j.jsx("select",{...I,size:r,ref:a,className:rn(l,t,e&&`${t}-${e}`,d&&"is-valid",g&&"is-invalid"),id:w||k})});OD.displayName="FormSelect";const yG=OD,BD=re.forwardRef(({bsPrefix:t,className:e,as:r="small",muted:l,...d},g)=>(t=hn(t,"form-text"),j.jsx(r,{...d,ref:g,className:rn(e,t,l&&"text-muted")})));BD.displayName="FormText";const vG=BD,FD=re.forwardRef((t,e)=>j.jsx(zy,{...t,ref:e,type:"switch"}));FD.displayName="Switch";const xG=Object.assign(FD,{Input:zy.Input,Label:zy.Label}),ND=re.forwardRef(({bsPrefix:t,className:e,children:r,controlId:l,label:d,...g},w)=>(t=hn(t,"form-floating"),j.jsxs(DD,{ref:w,className:rn(e,t),controlId:l,...g,children:[r,j.jsx("label",{htmlFor:l,children:d})]})));ND.displayName="FloatingLabel";const wG=ND,bG={_ref:jh.any,validated:jh.bool,as:jh.elementType},oE=re.forwardRef(({className:t,validated:e,as:r="form",...l},d)=>j.jsx(r,{...l,ref:d,className:rn(t,e&&"was-validated")}));oE.displayName="Form";oE.propTypes=bG;const id=Object.assign(oE,{Group:DD,Control:pG,Floating:mG,Check:zy,Switch:xG,Label:gG,Text:vG,Range:_G,Select:yG,FloatingLabel:wG}),jD=re.forwardRef(({bsPrefix:t,className:e,as:r="div",...l},d)=>{const g=hn(t,"row"),w=vR(),I=xR(),a=`${g}-cols`,k=[];return w.forEach(O=>{const V=l[O];delete l[O];let G;V!=null&&typeof V=="object"?{cols:G}=V:G=V;const X=O!==I?`-${O}`:"";G!=null&&k.push(`${a}${X}-${G}`)}),j.jsx(r,{ref:d,...l,className:rn(e,g,...k)})});jD.displayName="Row";const hA=jD,EG=re.forwardRef(({bsPrefix:t,className:e,striped:r,bordered:l,borderless:d,hover:g,size:w,variant:I,responsive:a,...k},O)=>{const V=hn(t,"table"),G=rn(e,V,I&&`${V}-${I}`,w&&`${V}-${w}`,r&&`${V}-${typeof r=="string"?`striped-${r}`:"striped"}`,l&&`${V}-bordered`,d&&`${V}-borderless`,g&&`${V}-hover`),X=j.jsx("table",{...k,className:G,ref:O});if(a){let oe=`${V}-responsive`;return typeof a=="string"&&(oe=`${oe}-${a}`),j.jsx("div",{className:oe,children:X})}return X}),sE=EG,TG=Object.values(Lr).filter(t=>t!==Lr.UNDEFINED),SG=({pathwayType:t})=>{const e=re.useContext(zr),[r,l]=re.useState(t),d=g=>{g&&(l(g),e.setDefaultPathwayType(g))};return j.jsxs(zi,{onSelect:d,children:[j.jsx(zi.Toggle,{variant:"outline-primary",id:"dropdown-basic",children:r}),j.jsx(zi.Menu,{children:TG.map((g,w)=>j.jsx(zi.Item,{eventKey:g,children:g},w))})]})},dA=gd(),fA=vd(),UD=()=>{const t=re.useContext(zr),{user:e,defaultVehiclePlate:r,defaultPathwayType:l}=t,[d,g]=re.useState({}),[w,I]=re.useState("");re.useEffect(()=>{a(),k()},[]);const a=async()=>{let V="";if(r)V=r;else{try{V=await dA.getDefaultVehicle(e.uid)}catch{I("No hay vehculo por defecto");return}t.setDefaultVehiclePlate(V)}g(await dA.getVehicle(V,e.uid))},k=async()=>{if(l===Lr.UNDEFINED){const V=await fA.getDefaultPathwayType(e.uid);t.setDefaultPathwayType(V)}},O=()=>{fA.setDefaultPathwayType(l,e.uid),t.setWantPreferences(!1)};return j.jsx("div",{className:"card",style:{width:"24rem",height:"auto",position:"absolute",top:"60px",right:"10px"},children:j.jsxs("div",{className:"card-body",children:[j.jsx("h5",{className:"card-title",children:"Preferencias de la cuenta"}),j.jsx("hr",{}),j.jsx("h4",{children:"Vehculo por defecto"}),w.length>0?j.jsx("p",{children:w}):j.jsx(E6,{defaultVehicle:d}),j.jsx("h4",{children:"Tipo de ruta por defecto"}),l===Lr.UNDEFINED?j.jsx("p",{children:"Is loading"}):j.jsx(SG,{pathwayType:l}),j.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:j.jsx("button",{className:"btn btn-primary mt-3",onClick:O,children:"Cerrar"})})]})})},Ql=ro.createContext({from:{lat:0,lon:0,name:""},setFrom:()=>{},to:{lat:0,lon:0,name:""},setTo:()=>{},pathwayTransportMean:gr.VEHICLE,setPathwayTransportMean:()=>{},pathwayType:Lr.RECOMMENDED,setPathwayType:()=>{},distance:0,setDistance:()=>{},duration:0,setDuration:()=>{},showSavedPlaces:!1,setShowSavedPlaces:()=>{},fieldInSelection:"",setFieldInSelection:()=>{},showVehicles:!1,setShowVehicles:()=>{},vehicle:{name:"",plate:"",propulsion:vi.Gasolina,consumption:0,favorite:!1},setVehicle:()=>{},codifiedPath:"",setCodifiedPath:()=>{},cost:0,setCost:()=>{}}),IG=({children:t})=>{const[e,r]=re.useState({lat:0,lon:0,name:""}),[l,d]=re.useState({lat:0,lon:0,name:""}),[g,w]=re.useState(gr.VEHICLE),[I,a]=re.useState(Lr.RECOMMENDED),[k,O]=re.useState(0),[V,G]=re.useState(0),[X,oe]=re.useState(!1),[le,we]=re.useState(""),[te,J]=re.useState(!1),[ce,Te]=re.useState({name:"",plate:"",propulsion:vi.Gasolina,consumption:0,favorite:!1}),[Ne,Ge]=re.useState(""),[Xe,qe]=re.useState(0),vt={from:e,setFrom:r,to:l,setTo:d,pathwayTransportMean:g,setPathwayTransportMean:w,pathwayType:I,setPathwayType:a,distance:k,setDistance:O,duration:V,setDuration:G,showSavedPlaces:X,setShowSavedPlaces:oe,fieldInSelection:le,setFieldInSelection:we,showVehicles:te,setShowVehicles:J,vehicle:ce,setVehicle:Te,codifiedPath:Ne,setCodifiedPath:Ge,cost:Xe,setCost:qe};return j.jsx(j.Fragment,{children:j.jsx(Ql.Provider,{value:vt,children:t})})};class pA extends Error{constructor(e){super(e),this.name="MyError"}}var mA={};const{VITE_ROUTES_API_KEY:CG}=yd();class AG{constructor(){}async getPlaceByToponym(e){var r={Latitud:-1,Longitud:-1,Nombre:e,Favorito:!1};try{var l=await Cp.get("/geocode/search",{params:{api_key:CG,text:e}})}catch{throw new pA}if((l==null?void 0:l.data.features[0].geometry.coordinates)!==void 0&&(r={...r,Longitud:l==null?void 0:l.data.features[0].geometry.coordinates[0],Latitud:l==null?void 0:l.data.features[0].geometry.coordinates[1]}),r.Latitud===-1)throw new Error("");return r}async getPlaceByCoord(e){var d,g;var r={Latitud:e.lat,Longitud:e.lon,Nombre:"",Favorito:!1};try{var l=await Cp.get(`${mA.VITE_API_URL}/geocode/reverse?api_key=${mA.VITE_ROUTES_API_KEY}&point.lon=${e.lon}&point.lat=${e.lat}`)}catch{throw new pA}if(((d=l==null?void 0:l.data)==null?void 0:d.features[0].properties.name)!==void 0&&(r={...r,Nombre:(g=l==null?void 0:l.data)==null?void 0:g.features[0].properties.name}),r.Nombre===void 0)throw new Error("");return r}}class PG{constructor(e,r,l){this.apiService=e,this.openRouteService=r,this.firebaseService=l}getApiService(){return this.apiService}getOpenRouteService(){return this.openRouteService}async toggleFavourite({Longitud:e,Latitud:r},l){const d=await this.firebaseService.getPlaces(l);if(d.places.length===0)throw new Ph(Xc.EmptyPlaces);const w=await d.places.findIndex(I=>this.areFloatsEqual(I.Longitud,e)&&this.areFloatsEqual(I.Latitud,r));if(w!==-1)return d.places[w].Favorito=!d.places[w].Favorito,await this.firebaseService.storePlace(d.places[w],l),!0;throw new Ph(Xc.PlaceNotFound)}areFloatsEqual(e,r,l=Number.EPSILON){return Math.abs(e-r)<l}async addPlaceByToponym(e,r,l){const d=await this.openRouteService.getCoordinatesFromPlaceName(e);return this.checkForValidToponym(d.name),await this.savePlaceIntoDatabase({Nombre:d.name||"",Latitud:d.lat||0,Longitud:d.lon||0,Favorito:r},l)}async addPlaceByCoords(e,r){try{this.checkValidCoordinates(e);const l=await this.apiService.getPlaceByCoord(e);return l?(await this.savePlaceIntoDatabase(l,r),!0):!1}catch(l){throw l}}async getPlaceNameByCoords(e){try{return await this.openRouteService.getPlaceNameByCoords(e)}catch(r){throw r}}checkValidCoordinates(e){if(typeof e.lat!="number"||typeof e.lon!="number")throw new Ph(Xc.IllegalArgument)}async savePlaceIntoDatabase(e,r){return await this.firebaseService.storePlace(e,r)}async deletePlace(e,r){await this.firebaseService.deletePlace(e,r)}async getPlaces(e){const r=await this.firebaseService.getPlaces(e);return(r==null?void 0:r.places)||[]}async setPlaces(e,r){await this.firebaseService.setPlaces(e,r)}async replacePlaces(e,r){await this.firebaseService.replacePlaces(e,r)}async setPlace(e,r){return await this.firebaseService.storePlace(e,r)}checkForValidToponym(e){if(this.containsNumber(e))throw new Ph(Xc.InvalidToponym)}containsNumber(e){return/\d/.test(e)}async transformToValidCoords(e){const r=e.split(",");if(r.length>1&&r.every(d=>this.containsNumber(d))){const d=await this.openRouteService.getPlaceNameByCoords({lon:parseFloat(r[0]),lat:parseFloat(r[1])});return{lat:parseFloat(r[1]),lon:parseFloat(r[0]),name:d}}const l=await this.apiService.getPlaceByToponym(e);return{name:l.Nombre,lat:l.Latitud,lon:l.Longitud}}}let H0;function Tm(t,e,r){return H0||(t||(t=new AG),e||(e=new _R),r||(r=new uv),H0=new PG(t,e,r)),H0}const Sm=ro.createContext({pathways:[],setPathways:()=>{},loadedPathway:{type:Lr.UNDEFINED,start:{lon:0,lat:0},end:{lon:0,lat:0},codifiedPath:"",duration:0,distance:0,favourite:!1,transportMean:gr.VEHICLE,cost:0},setLoadedPathway:()=>{}}),kG=({children:t})=>{const[e,r]=re.useState([]),[l,d]=re.useState({type:Lr.UNDEFINED,start:{lon:0,lat:0},end:{lon:0,lat:0},codifiedPath:"",duration:0,distance:0,favourite:!1,transportMean:gr.VEHICLE,cost:0}),g={pathways:e,setPathways:r,loadedPathway:l,setLoadedPathway:d};return j.jsx(Sm.Provider,{value:g,children:t})},MG=Object.values(Lr).filter(t=>t!==Lr.UNDEFINED),RG=()=>{const t=re.useContext(zr),{user:e,defaultPathwayType:r,defaultVehiclePlate:l}=t,d=re.useContext(Ql),{distance:g,duration:w,pathwayTransportMean:I,vehicle:a,showVehicles:k}=d,{loadedPathway:O}=re.useContext(Sm),V=vd(),G=gd(),[X,oe]=re.useState(r),[le,we]=re.useState({consumption:0,favorite:!1,name:"",plate:"",propulsion:vi.Gasolina}),[te,J]=re.useState(0);re.useEffect(()=>{l&&G.getVehicle(l,e.uid).then(qe=>{we(qe)}),O.type!==Lr.UNDEFINED&&oe(O.type)},[]),re.useEffect(()=>{a.plate===""||a.plate===le.plate||we(a)},[a]),re.useEffect(()=>{ce()},[I,le,g,w]);const ce=async()=>{try{I===gr.VEHICLE?J(await V.calculatePrice(g,le)):J(V.calculateCalories(g,I))}catch{console.log("Fallo al calcular el coste de la ruta"),J(0)}d.setCost(te)},Te=qe=>{d.setPathwayTransportMean(qe)},Ne=qe=>{qe&&(oe(qe),d.setPathwayType(qe))},Ge={[gr.BIKE]:"fas fa-bicycle",[gr.VEHICLE]:"fas fa-car",[gr.WALKING]:"fas fa-walking"},Xe=()=>{d.setShowVehicles(!d.showVehicles)};return j.jsxs(j.Fragment,{children:[j.jsx(n$,{"aria-label":"Transport means",children:Object.values(gr).map(qe=>j.jsx(no,{variant:I===qe?"info":"white",onClick:()=>Te(qe),children:j.jsx("i",{className:Ge[qe]})},qe))}),j.jsxs(zi,{onSelect:Ne,className:"mt-3",children:[j.jsx(zi.Toggle,{variant:"outline-primary",id:"dropdown-basic",children:X}),j.jsx(zi.Menu,{children:MG.map((qe,vt)=>j.jsx(zi.Item,{eventKey:qe,children:qe},vt))})]}),I===gr.VEHICLE?j.jsx(j.Fragment,{children:j.jsxs("div",{className:"input-group mt-2 mb-2",children:[j.jsx("input",{className:"form-control",id:"selectedVehicle",type:"text",name:"selectedVehicle",value:le.name||"No vehculo seleccionado",readOnly:!0}),j.jsx("div",{className:"input-group-append",children:j.jsx("button",{className:"btn btn-outline-info",onClick:Xe,children:j.jsx("i",{className:k?"fas fa-chevron-left":"fas fa-chevron-right"})})})]})}):j.jsx(j.Fragment,{}),j.jsx("h3",{children:"Costes de la ruta"}),j.jsx("hr",{}),j.jsxs("ul",{className:"list-group",children:[j.jsxs("li",{className:"list-group-item",children:["Distancia: ",(g/1e3).toFixed(4)," km"]}),j.jsxs("li",{className:"list-group-item",children:["Duracin: ",Math.floor(w/3600)," horas y ",Math.round(w%3600/60)," minutos"]}),j.jsxs("li",{className:"list-group-item",children:["Coste: ",te.toFixed(2)," ",I===gr.VEHICLE?"":"cal"]})]})]})},Z0=()=>{const t=Ra(),e=re.useContext(zr),{user:r,defaultPathwayType:l}=e,d=re.useContext(Ql),{distance:g,duration:w,pathwayTransportMean:I,pathwayType:a,vehicle:k,cost:O}=d,{setPathways:V}=re.useContext(Sm),G=vd(),X={from:d.from.name,to:d.to.name},oe=[{id:"from",label:"Desde",type:"text"},{id:"to",label:"Hasta",type:"text"}],le={from:ce=>ce.length<3?"Debe tener al menos 3 carcteres":null,to:ce=>ce.length<3?"Debe tener al menos 3 carcteres":null},we=async ce=>{const Te=Tm();let Ne=d.from;d.from.name!==ce.from&&(Ne=await Te.transformToValidCoords(ce.from));let Ge=d.to;d.to.name!==ce.to&&(Ge=await Te.transformToValidCoords(ce.to)),d.setFrom({...Ne}),d.setTo({...Ge}),d.setPathwayType(l)},te={icon:"fas fa-map-marker-alt",onClick:ce=>{d.setShowSavedPlaces(!d.showSavedPlaces),d.setFieldInSelection(ce)}},J=async()=>{await G.addPathway({type:a,start:d.from,end:d.to,codifiedPath:d.codifiedPath,duration:w,distance:g,favourite:!1,transportMean:I,vehiclePlate:I===gr.VEHICLE?k.plate:"Sin vehculo",cost:O},r.uid).then(ce=>V(ce)),t("/pathways")};return j.jsx("div",{className:"card",style:{position:"fixed",top:"55px",left:"50px",height:"calc(100% - 60px)",width:"300px",zIndex:1},children:j.jsxs("div",{className:"card-body",children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h3",{className:"card-title",children:"Ruta"}),j.jsx(no,{style:{display:w>0&&g>0&&O>0?"block":"none"},variant:"outline-info",onClick:J,children:j.jsx("i",{className:"fas fa-save"})})]}),j.jsx("hr",{}),j.jsx(mu,{formData:X,formFields:oe,onSubmit:we,submitButtonLabel:"Navegar",validations:le,inputButtonsSpecification:te}),g>0&&w>0&&j.jsx(RG,{})]})})};var VD={exports:{}};(function(t,e){var r={};(function(l,d){t.exports=d()})(bO,function(){var l,d,g;function w(a,k){if(!l)l=k;else if(!d)d=k;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",V={};l(V),g=k(V),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}w(["exports"],function(a){var k=typeof self<"u"?self:{},O="2.15.0";let V;const G={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(V==null){const i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{V=r.API_URL_REGEX!=null?new RegExp(r.API_URL_REGEX):i}catch{V=i}}return V},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!G.API_URL)return null;try{const i=new URL(G.API_URL);return i.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":i.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},X={supported:!1,testSupport:function(i){!we&&le&&(te?J(i):oe=i)}};let oe,le,we=!1,te=!1;function J(i){const n=i.createTexture();i.bindTexture(i.TEXTURE_2D,n);try{if(i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,le),i.isContextLost())return;X.supported=!0}catch{}i.deleteTexture(n),we=!0}k.document&&(le=k.document.createElement("img"),le.onload=function(){oe&&J(oe),oe=null,te=!0},le.onerror=function(){we=!0,oe=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ce="01";function Te(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ne=Ge;function Ge(i,n,o,c){this.cx=3*i,this.bx=3*(o-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=n,this.p2x=o,this.p2y=c}Ge.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,n){if(n===void 0&&(n=1e-6),i<0)return 0;if(i>1)return 1;for(var o=i,c=0;c<8;c++){var h=this.sampleCurveX(o)-i;if(Math.abs(h)<n)return o;var p=this.sampleCurveDerivativeX(o);if(Math.abs(p)<1e-6)break;o-=h/p}var _=0,v=1;for(o=i,c=0;c<20&&(h=this.sampleCurveX(o),!(Math.abs(h-i)<n));c++)i>h?_=o:v=o,o=.5*(v-_)+_;return o},solve:function(i,n){return this.sampleCurveY(this.solveCurveX(i,n))}};var Xe=Te(Ne),qe=vt;function vt(i,n){this.x=i,this.y=n}vt.prototype={clone:function(){return new vt(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,n){return this.clone()._rotateAround(i,n)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var n=i.x-this.x,o=i.y-this.y;return n*n+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,n){return Math.atan2(this.x*n-this.y*i,this.x*i+this.y*n)},_matMult:function(i){var n=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=n,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var n=Math.cos(i),o=Math.sin(i),c=o*this.x+n*this.y;return this.x=n*this.x-o*this.y,this.y=c,this},_rotateAround:function(i,n){var o=Math.cos(i),c=Math.sin(i),h=n.y+c*(this.x-n.x)+o*(this.y-n.y);return this.x=n.x+o*(this.x-n.x)-c*(this.y-n.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vt.convert=function(i){return i instanceof vt?i:Array.isArray(i)?new vt(i[0],i[1]):i};var ze=Te(qe);const Ct=Math.PI/180,Ut=180/Math.PI;function pt(i){return i*Ct}function Zt(i){return i*Ut}const Hn=[[0,0],[1,0],[1,1],[0,1]];function Dn(i){if(i<=0)return 0;if(i>=1)return 1;const n=i*i,o=n*i;return 4*(i<.5?o:3*(i-n)+o-.75)}function Fn(i,n,o,c){const h=new Xe(i,n,o,c);return function(p){return h.solve(p)}}const _t=Fn(.25,.1,.25,1);function ot(i,n,o){return Math.min(o,Math.max(n,i))}function Tt(i,n,o){return(o=ot((o-i)/(n-i),0,1))*o*(3-2*o)}function Rt(i,n,o){const c=o-n,h=((i-n)%c+c)%c+n;return h===n?o:h}function Vt(i,n,o){if(!i.length)return o(null,[]);let c=i.length;const h=new Array(i.length);let p=null;i.forEach((_,v)=>{n(_,(b,E)=>{b&&(p=b),h[v]=E,--c==0&&o(p,h)})})}function yr(i){const n=[];for(const o in i)n.push(i[o]);return n}function Yt(i,...n){for(const o of n)for(const c in o)i[c]=o[c];return i}let Zn=1;function cr(){return Zn++}function vr(){return function i(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,i)}()}function Ar(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))}function ds(i){return!!i&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(i)}function Ro(i,n){i.forEach(o=>{n[o]&&(n[o]=n[o].bind(n))})}function lo(i,n){return i.indexOf(n,i.length-n.length)!==-1}function qt(i,n,o){const c={};for(const h in i)c[h]=n.call(o||this,i[h],h,i);return c}function Do(i,n,o){const c={};for(const h in i)n.call(o||this,i[h],h,i)&&(c[h]=i[h]);return c}function Gr(i){return Array.isArray(i)?i.map(Gr):typeof i=="object"&&i?qt(i,Gr):i}const js={};function In(i){js[i]||(typeof console<"u"&&console.warn(i),js[i]=!0)}function Wr(i,n,o){return(o.y-i.y)*(n.x-i.x)>(n.y-i.y)*(o.x-i.x)}function Oa(i){let n=0;for(let o,c,h=0,p=i.length,_=p-1;h<p;_=h++)o=i[h],c=i[_],n+=(c.x-o.x)*(o.y+c.y);return n}function Vi(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Xn(i){const n={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(o,c,h,p)=>{const _=h||p;return n[c]=!_||_.toLowerCase(),""}),n["max-age"]){const o=parseInt(n["max-age"],10);isNaN(o)?delete n["max-age"]:n["max-age"]=o}return n}let co=null;function Lo(i){if(co==null){const n=i.navigator?i.navigator.userAgent:null;co=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return co}function fs(i){try{const n=k[i];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ei(i,n){return[i[4*n],i[4*n+1],i[4*n+2],i[4*n+3]]}const zo="mapbox-tiles";let Us=500,Vs=50,qr,ps;function ec(){try{return k.caches}catch{}}function $s(){ec()&&!qr&&(qr=k.caches.open(zo))}function Ba(i){const n=i.indexOf("?");if(n<0)return i;const o=function(h){const p=h.indexOf("?");return p>0?h.slice(p+1).split("&"):[]}(i),c=o.filter(h=>{const p=h.split("=");return p[0]==="language"||p[0]==="worldview"});return c.length?`${i.slice(0,n)}?${c.join("&")}`:i.slice(0,n)}let tc=1/0;const Gs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Gs);class ms extends Error{constructor(n,o,c){o===401&&Ie(c)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=o,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ws=Vi()?()=>self.worker&&self.worker.referrer:()=>(k.location.protocol==="blob:"?k.parent:k).location.href,qs=function(i,n){if(!(/^file:/.test(o=i.url)||/^file:/.test(Ws())&&!/^\w+:/.test(o))){if(k.fetch&&k.Request&&k.AbortController&&k.Request.prototype.hasOwnProperty("signal"))return function(c,h){const p=new k.AbortController,_=new k.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Ws(),referrerPolicy:c.referrerPolicy,signal:p.signal});let v=!1,b=!1;const E=(C=_.url).indexOf("sku=")>0&&Ie(C);var C;c.type==="json"&&_.headers.set("Accept","application/json");const P=(L,z,N)=>{if(b)return;if(L&&L.message!=="SecurityError"&&In(L.toString()),z&&N)return M(z);const q=Date.now();k.fetch(_).then(ee=>{if(ee.ok){const de=E?ee.clone():null;return M(ee,de,q)}return h(new ms(ee.statusText,ee.status,c.url))}).catch(ee=>{ee.name!=="AbortError"&&h(new Error(`${ee.message} ${c.url}`))})},M=(L,z,N)=>{(c.type==="arrayBuffer"?L.arrayBuffer():c.type==="json"?L.json():L.text()).then(q=>{b||(z&&N&&function(ee,de,ne){if($s(),!qr)return;const ue={status:de.status,statusText:de.statusText,headers:new k.Headers};de.headers.forEach((Me,Ae)=>ue.headers.set(Ae,Me));const pe=Xn(de.headers.get("Cache-Control")||"");if(pe["no-store"])return;pe["max-age"]&&ue.headers.set("Expires",new Date(ne+1e3*pe["max-age"]).toUTCString());const fe=ue.headers.get("Expires");fe&&(new Date(fe).getTime()-ne<42e4||function(Me,Ae){if(ps===void 0)try{new Response(new ReadableStream),ps=!0}catch{ps=!1}ps?Ae(Me.body):Me.blob().then(Ae)}(de,Me=>{const Ae=new k.Response(Me,ue);$s(),qr&&qr.then(Fe=>Fe.put(Ba(ee.url),Ae)).catch(Fe=>In(Fe.message))}))}(_,z,N),v=!0,h(null,q,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch(q=>{b||h(new Error(q.message))})};return E?function(L,z){if($s(),!qr)return z(null);const N=Ba(L.url);qr.then(q=>{q.match(N).then(ee=>{const de=function(ne){if(!ne)return!1;const ue=new Date(ne.headers.get("Expires")||0),pe=Xn(ne.headers.get("Cache-Control")||"");return ue>Date.now()&&!pe["no-cache"]}(ee);q.delete(N),de&&q.put(N,ee.clone()),z(null,ee,de)}).catch(z)}).catch(z)}(_,P):P(null,null),{cancel:()=>{b=!0,v||p.abort()}}}(i,n);if(Vi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",i,n,void 0,!0)}var o;return function(c,h){const p=new k.XMLHttpRequest;p.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const _ in c.headers)p.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=c.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(c.type==="json")try{_=JSON.parse(p.response)}catch(v){return h(v)}h(null,_,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new ms(p.statusText,p.status,c.url))},p.send(c.body),{cancel:()=>p.abort()}}(i,n)},Fa=function(i,n){return qs(Yt(i,{type:"arrayBuffer"}),n)};function _u(i){const n=k.document.createElement("a");return n.href=i,n.protocol===k.document.location.protocol&&n.host===k.document.location.host}const he="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let U,$;U=[],$=0;const ae=function(i,n){if(X.supported&&(i.headers||(i.headers={}),i.headers.accept="image/webp,*/*"),$>=G.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:i,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return U.push(p),p}$++;let o=!1;const c=()=>{if(!o)for(o=!0,$--;U.length&&$<G.MAX_PARALLEL_IMAGE_REQUESTS;){const p=U.shift(),{requestParameters:_,callback:v,cancelled:b}=p;b||(p.cancel=ae(_,v).cancel)}},h=Fa(i,(p,_,v,b)=>{c(),p?n(p):_&&(k.createImageBitmap?function(E,C){const P=new k.Blob([new Uint8Array(E)],{type:"image/png"});k.createImageBitmap(P).then(M=>{C(null,M)}).catch(M=>{C(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(E,C)=>n(E,C,v,b)):function(E,C){const P=new k.Image,M=k.URL;P.onload=()=>{C(null,P),M.revokeObjectURL(P.src),P.onload=null,k.requestAnimationFrame(()=>{P.src=he})},P.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const L=new k.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?M.createObjectURL(L):he}(_,(E,C)=>n(E,C,v,b)))});return{cancel:()=>{h.cancel(),c()}}},me="NO_ACCESS_TOKEN";function xe(i){return i.indexOf("mapbox:")===0}function Ie(i){return G.API_URL_REGEX.test(i)}function Se(i){return G.API_CDN_URL_REGEX.test(i)}function ve(i){return G.API_STYLE_REGEX.test(i)&&!Le(i)}function Le(i){return G.API_SPRITE_REGEX.test(i)}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function st(i){const n=i.match(it);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function tt(i){const n=i.params.length?`?${i.params.join("&")}`:"";return`${i.protocol}://${i.authority}${i.path}${n}`}const Dt="mapbox.eventData";function Bt(i){if(!i)return null;const n=i.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(k.atob(n[1]).split("").map(o=>"%"+("00"+o.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Lt{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const o=Bt(G.ACCESS_TOKEN);let c="";return c=o&&o.u?k.btoa(encodeURIComponent(o.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):G.ACCESS_TOKEN||"",n?`${Dt}.${n}:${c}`:`${Dt}:${c}`}fetchEventData(){const n=fs("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{const h=k.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));const p=k.localStorage.getItem(c);p&&(this.anonId=p)}catch{In("Unable to read from LocalStorage")}}saveEventData(){const n=fs("localStorage"),o=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{k.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&k.localStorage.setItem(o,JSON.stringify(this.eventData))}catch{In("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,o,c,h){if(!G.EVENTS_URL)return;const p=st(G.EVENTS_URL);p.params.push(`access_token=${h||G.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(n).toISOString()},v=o?Yt(_,o):_,b={url:tt(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([v])};this.pendingRequest=function(E,C){return qs(Yt(E,{method:"POST"}),C)}(b,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(h)})}queueRequest(n,o){this.queue.push(n),this.processRequests(o)}}const Ft=new class extends Lt{constructor(i){super("appUserTurnstile"),this._customAccessToken=i}postTurnstileEvent(i,n){G.EVENTS_URL&&G.ACCESS_TOKEN&&Array.isArray(i)&&i.some(o=>xe(o)||Ie(o))&&this.queueRequest(Date.now(),n)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Bt(G.ACCESS_TOKEN),o=n?n.u:G.ACCESS_TOKEN;let c=o!==this.eventData.tokenU;ds(this.anonId)||(this.anonId=vr(),c=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),_=new Date(h),v=(h-this.eventData.lastSuccess)/864e5;c=c||v>=1||v<-1||p.getDate()!==_.getDate()}else c=!0;c?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:ce,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=o)},i):this.processRequests()}},Xt=Ft.postTurnstileEvent.bind(Ft),Ln=new class extends Lt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(i,n,o,c){this.skuToken=n,this.errorCb=c,G.EVENTS_URL&&(o||G.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(me)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),ds(this.anonId)||(this.anonId=vr()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:O,skuId:ce,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},i))}},Kn=Ln.postMapLoadEvent.bind(Ln),Or=new class extends Lt{constructor(){super("gljs.performance")}postPerformanceEvent(i,n){G.EVENTS_URL&&(i||G.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:n},i)}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,performanceData:o}=this.queue.shift(),c=function(h){const p=k.performance.getEntriesByType("resource"),_=k.performance.getEntriesByType("mark"),v=function(M){const L={};if(M){for(const z in M)if(z!=="other")for(const N of M[z]){const q=`${z}ResolveRangeMin`,ee=`${z}ResolveRangeMax`,de=`${z}RequestCount`,ne=`${z}RequestCachedCount`;L[q]=Math.min(L[q]||1/0,N.startTime),L[ee]=Math.max(L[ee]||-1/0,N.responseEnd);const ue=pe=>{L[pe]===void 0&&(L[pe]=0),++L[pe]};N.transferSize!==void 0&&N.transferSize===0&&ue(ne),ue(de)}}return L}(function(M,L){const z={};if(M)for(const N of M){const q=L(N);z[q]===void 0&&(z[q]=[]),z[q].push(N)}return z}(p,Cm)),b=k.devicePixelRatio,E=k.navigator.connection||k.navigator.mozConnection||k.navigator.webkitConnection,C={counters:[],metadata:[],attributes:[]},P=(M,L,z)=>{z!=null&&M.push({name:L,value:z.toString()})};for(const M in v)P(C.counters,M,v[M]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(C.counters,"interactionRangeMin",h.interactionRange[0]),P(C.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const M of Object.keys(Na)){const L=Na[M],z=_.find(N=>N.name===L);z&&P(C.counters,L,z.startTime)}return P(C.counters,"visibilityHidden",h.visibilityHidden),P(C.attributes,"style",function(M){if(M)for(const L of M){const z=L.name.split("?")[0];if(ve(z)){const N=z.split("/").slice(-2);if(N.length===2)return`mapbox://styles/${N[0]}/${N[1]}`}}}(p)),P(C.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(C.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(C.attributes,"projection",h.projection),P(C.attributes,"zoom",h.zoom),P(C.metadata,"devicePixelRatio",b),P(C.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(C.metadata,"navigatorUserAgent",k.navigator.userAgent),P(C.metadata,"screenWidth",k.screen.width),P(C.metadata,"screenHeight",k.screen.height),P(C.metadata,"windowWidth",k.innerWidth),P(C.metadata,"windowHeight",k.innerHeight),P(C.metadata,"mapWidth",h.width/b),P(C.metadata,"mapHeight",h.height/b),P(C.metadata,"webglRenderer",h.renderer),P(C.metadata,"webglVendor",h.vendor),P(C.metadata,"sdkVersion",O),P(C.metadata,"sdkIdentifier","mapbox-gl-js"),C}(o);for(const h of c.metadata);for(const h of c.counters);for(const h of c.attributes);this.postEvent(n,c,()=>{},i)}},ur=Or.postPerformanceEvent.bind(Or),uo=new class extends Lt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(i,n,o,c){if(!G.API_URL||!G.SESSION_PATH)return;const h=st(G.API_URL+G.SESSION_PATH);h.params.push(`sku=${n||""}`),h.params.push(`access_token=${c||G.ACCESS_TOKEN||""}`);const p={url:tt(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(_,v){return qs(Yt(_,{method:"GET"}),v)}(p,_=>{this.pendingRequest=null,o(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(i,n,o,c){this.skuToken=n,this.errorCb=c,G.SESSION_PATH&&G.API_URL&&(o||G.ACCESS_TOKEN?this.queueRequest({id:i,timestamp:Date.now()},o):this.errorCb(new Error(me)))}processRequests(i){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:o}=this.queue.shift();n&&this.success[n]||this.getSession(o,this.skuToken,c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},i)}},xr=uo.getSessionAPI.bind(uo),Hr=new Set,Na={create:"create",load:"load",fullLoad:"fullLoad"},xv={mark(i){k.performance.mark(i)},measure(i,n,o){k.performance.measure(i,n,o)}};function Cm(i){const n=i.name.split("?")[0];return Se(n)&&n.includes("mapbox-gl.js")?"javascript":Se(n)&&n.includes("mapbox-gl.css")?"css":function(o){return G.API_FONTS_REGEX.test(o)}(n)?"fontRange":Le(n)?"sprite":ve(n)?"style":function(o){return G.API_TILEJSON_REGEX.test(o)}(n)?"tilejson":"other"}const on=k.performance;function xd(i){const n=i?i.url.toString():void 0;return on.getEntriesByName(n)}let nc,wd,yu,ho;const Oo={now:()=>yu!==void 0?yu:k.performance.now(),setNow(i){yu=i},restoreNow(){yu=void 0},frame(i){const n=k.requestAnimationFrame(i);return{cancel:()=>k.cancelAnimationFrame(n)}},getImageData(i,n=0){const{width:o,height:c}=i;ho||(ho=k.document.createElement("canvas"));const h=ho.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(o>ho.width||c>ho.height)&&(ho.width=o,ho.height=c),h.clearRect(-n,-n,o+2*n,c+2*n),h.drawImage(i,0,0,o,c),h.getImageData(-n,-n,o+2*n,c+2*n)},resolveURL:i=>(nc||(nc=k.document.createElement("a")),nc.href=i,nc.href),get devicePixelRatio(){return k.devicePixelRatio},get prefersReducedMotion(){return!!k.matchMedia&&(wd==null&&(wd=k.matchMedia("(prefers-reduced-motion: reduce)")),wd.matches)}};function bd(i,n,o){o[i]&&o[i].indexOf(n)!==-1||(o[i]=o[i]||[],o[i].push(n))}function Ed(i,n,o){if(o&&o[i]){const c=o[i].indexOf(n);c!==-1&&o[i].splice(c,1)}}class Hs{constructor(n,o={}){Yt(this,o),this.type=n}}class Bo extends Hs{constructor(n,o={}){super("error",Yt({error:n},o))}}class rc{on(n,o){return this._listeners=this._listeners||{},bd(n,o,this._listeners),this}off(n,o){return Ed(n,o,this._listeners),Ed(n,o,this._oneTimeListeners),this}once(n,o){return o?(this._oneTimeListeners=this._oneTimeListeners||{},bd(n,o,this._oneTimeListeners),this):new Promise(c=>this.once(n,c))}fire(n,o){typeof n=="string"&&(n=new Hs(n,o||{}));const c=n.type;if(this.listens(c)){n.target=this;const h=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const v of h)v.call(this,n);const p=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const v of p)Ed(c,v,this._oneTimeListeners),v.call(this,n);const _=this._eventedParent;_&&(Yt(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof Bo&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,o){return this._eventedParent=n,this._eventedParentData=o,this}}var Be=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Fo(i,...n){for(const o of n)for(const c in o)i[c]=o[c];return i}function Jn(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function wr(i){if(Array.isArray(i))return i.map(wr);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const n={};for(const o in i)n[o]=wr(i[o]);return n}return Jn(i)}class Am extends Error{constructor(n,o){super(o),this.message=o,this.key=n}}var fo=Am;class Td{constructor(n,o=[]){this.parent=n,this.bindings={};for(const[c,h]of o)this.bindings[c]=h}concat(n){return new Td(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}var Pm=Td;const ja={kind:"null"},ht={kind:"number"},Ht={kind:"string"},$t={kind:"boolean"},mi={kind:"color"},$i={kind:"object"},Gt={kind:"value"},gi={kind:"collator"},ic={kind:"formatted"},Zs={kind:"resolvedImage"};function Ti(i,n){return{kind:"array",itemType:i,N:n}}function Mn(i){if(i.kind==="array"){const n=Mn(i.itemType);return typeof i.N=="number"?`array<${n}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${n}>`}return i.kind}const km=[ja,ht,Ht,$t,mi,ic,$i,Ti(Gt),Zs];function No(i,n){if(n.kind==="error")return null;if(i.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!No(i.itemType,n.itemType))&&(typeof i.N!="number"||i.N===n.N))return null}else{if(i.kind===n.kind)return null;if(i.kind==="value"){for(const o of km)if(!No(o,n))return null}}return`Expected ${Mn(i)} but found ${Mn(n)} instead.`}function oc(i,n){return n.some(o=>o.kind===i.kind)}function sc(i,n){return n.some(o=>o==="null"?i===null:o==="array"?Array.isArray(i):o==="object"?i&&!Array.isArray(i)&&typeof i=="object":o===typeof i)}var Sd,Mm={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ac(i){return(i=Math.round(i))<0?0:i>255?255:i}function lc(i){return ac(i[i.length-1]==="%"?parseFloat(i)/100*255:parseInt(i))}function vu(i){return(n=i[i.length-1]==="%"?parseFloat(i)/100:parseFloat(i))<0?0:n>1?1:n;var n}function Ua(i,n,o){return o<0?o+=1:o>1&&(o-=1),6*o<1?i+(n-i)*o*6:2*o<1?n:3*o<2?i+(n-i)*(2/3-o)*6:i}try{Sd={}.parseCSSColor=function(i){var n,o=i.replace(/ /g,"").toLowerCase();if(o in Mm)return Mm[o].slice();if(o[0]==="#")return o.length===4?(n=parseInt(o.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:o.length===7&&(n=parseInt(o.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var c=o.indexOf("("),h=o.indexOf(")");if(c!==-1&&h+1===o.length){var p=o.substr(0,c),_=o.substr(c+1,h-(c+1)).split(","),v=1;switch(p){case"rgba":if(_.length!==4)return null;v=vu(_.pop());case"rgb":return _.length!==3?null:[lc(_[0]),lc(_[1]),lc(_[2]),v];case"hsla":if(_.length!==4)return null;v=vu(_.pop());case"hsl":if(_.length!==3)return null;var b=(parseFloat(_[0])%360+360)%360/360,E=vu(_[1]),C=vu(_[2]),P=C<=.5?C*(E+1):C+E-C*E,M=2*C-P;return[ac(255*Ua(M,P,b+1/3)),ac(255*Ua(M,P,b)),ac(255*Ua(M,P,b-1/3)),v];default:return null}}return null}}catch{}class Qr{constructor(n,o,c,h=1){this.r=n,this.g=o,this.b=c,this.a=h}static parse(n){if(!n)return;if(n instanceof Qr)return n;if(typeof n!="string")return;const o=Sd(n);return o?new Qr(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3]):void 0}toString(){const[n,o,c,h]=this.toArray();return`rgba(${Math.round(n)},${Math.round(o)},${Math.round(c)},${h})`}toArray(){const{r:n,g:o,b:c,a:h}=this;return h===0?[0,0,0,0]:[255*n/h,255*o/h,255*c/h,h]}toArray01(){const{r:n,g:o,b:c,a:h}=this;return h===0?[0,0,0,0]:[n/h,o/h,c/h,h]}toArray01PremultipliedAlpha(){const{r:n,g:o,b:c,a:h}=this;return[n,o,c,h]}}Qr.black=new Qr(0,0,0,1),Qr.white=new Qr(1,1,1,1),Qr.transparent=new Qr(0,0,0,0),Qr.red=new Qr(1,0,0,1),Qr.blue=new Qr(0,0,1,1);var $n=Qr;class Id{constructor(n,o,c){this.sensitivity=n?o?"variant":"case":o?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,o){return this.collator.compare(n,o)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Cd{constructor(n,o,c,h,p){this.text=n.normalize?n.normalize():n,this.image=o,this.scale=c,this.fontStack=h,this.textColor=p}}class ei{constructor(n){this.sections=n}static fromString(n){return new ei([new Cd(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof ei?n:ei.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const o of this.sections){if(o.image){n.push(["image",o.image.name]);continue}n.push(o.text);const c={};o.fontStack&&(c["text-font"]=["literal",o.fontStack.split(",")]),o.scale&&(c["font-scale"]=o.scale),o.textColor&&(c["text-color"]=["rgba"].concat(o.textColor.toArray())),n.push(c)}return n}}class Si{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Si({name:n,available:!1}):null}serialize(){return["image",this.name]}}function Rm(i,n,o,c){return typeof i=="number"&&i>=0&&i<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof o=="number"&&o>=0&&o<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[i,n,o,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[i,n,o,c]:[i,n,o]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cc(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof $n||i instanceof Id||i instanceof ei||i instanceof Si)return!0;if(Array.isArray(i)){for(const n of i)if(!cc(n))return!1;return!0}if(typeof i=="object"){for(const n in i)if(!cc(i[n]))return!1;return!0}return!1}function Nn(i){if(i===null)return ja;if(typeof i=="string")return Ht;if(typeof i=="boolean")return $t;if(typeof i=="number")return ht;if(i instanceof $n)return mi;if(i instanceof Id)return gi;if(i instanceof ei)return ic;if(i instanceof Si)return Zs;if(Array.isArray(i)){const n=i.length;let o;for(const c of i){const h=Nn(c);if(o){if(o===h)continue;o=Gt;break}o=h}return Ti(o||Gt,n)}return $i}function uc(i){const n=typeof i;return i===null?"":n==="string"||n==="number"||n==="boolean"?String(i):i instanceof $n||i instanceof ei||i instanceof Si?i.toString():JSON.stringify(i)}class Ad{constructor(n,o){this.type=n,this.value=o}static parse(n,o){if(n.length!==2)return o.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!cc(n[1]))return o.error("invalid value");const c=n[1];let h=Nn(c);const p=o.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ad(h,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof $n?["rgba"].concat(this.value.toArray()):this.value instanceof ei?this.value.serialize():this.value}}var Xs=Ad,Pr=class{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}};const Pd={string:Ht,number:ht,boolean:$t,object:$i};class kd{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");let c,h=1;const p=n[0];if(p==="array"){let v,b;if(n.length>2){const E=n[1];if(typeof E!="string"||!(E in Pd)||E==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);v=Pd[E],h++}else v=Gt;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return o.error('The length argument to "array" must be a positive integer literal',2);b=n[2],h++}c=Ti(v,b)}else c=Pd[p];const _=[];for(;h<n.length;h++){const v=o.parse(n[h],h,Gt);if(!v)return null;_.push(v)}return new kd(c,_)}evaluate(n){for(let o=0;o<this.args.length;o++){const c=this.args[o].evaluate(n);if(!No(this.type,Nn(c)))return c;if(o===this.args.length-1)throw new Pr(`Expected value to be of type ${Mn(this.type)}, but found ${Mn(Nn(c))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,o=[n.kind];if(n.kind==="array"){const c=n.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){o.push(c.kind);const h=n.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(c=>c.serialize()))}}var jo=kd;class gs{constructor(n){this.type=ic,this.sections=n}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return o.error("First argument must be an image or text section.");const h=[];let p=!1;for(let _=1;_<=n.length-1;++_){const v=n[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let b=null;if(v["font-scale"]&&(b=o.parse(v["font-scale"],1,ht),!b))return null;let E=null;if(v["text-font"]&&(E=o.parse(v["text-font"],1,Ti(Ht)),!E))return null;let C=null;if(v["text-color"]&&(C=o.parse(v["text-color"],1,mi),!C))return null;const P=h[h.length-1];P.scale=b,P.font=E,P.textColor=C}else{const b=o.parse(n[_],1,Gt);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new gs(h)}evaluate(n){return new ei(this.sections.map(o=>{const c=o.content.evaluate(n);return Nn(c)===Zs?new Cd("",c,null,null,null):new Cd(uc(c),null,o.scale?o.scale.evaluate(n):null,o.font?o.font.evaluate(n).join(","):null,o.textColor?o.textColor.evaluate(n):null)}))}eachChild(n){for(const o of this.sections)n(o.content),o.scale&&n(o.scale),o.font&&n(o.font),o.textColor&&n(o.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const o of this.sections){n.push(o.content.serialize());const c={};o.scale&&(c["font-scale"]=o.scale.serialize()),o.font&&(c["text-font"]=o.font.serialize()),o.textColor&&(c["text-color"]=o.textColor.serialize()),n.push(c)}return n}}class xu{constructor(n){this.type=Zs,this.input=n}static parse(n,o){if(n.length!==2)return o.error("Expected two arguments.");const c=o.parse(n[1],1,Ht);return c?new xu(c):o.error("No image name provided.")}evaluate(n){const o=this.input.evaluate(n),c=Si.fromString(o);return c&&n.availableImages&&(c.available=n.availableImages.indexOf(o)>-1),c}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wv={"to-boolean":$t,"to-color":mi,"to-number":ht,"to-string":Ht};class Md{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expected at least one argument.");const c=n[0];if((c==="to-boolean"||c==="to-string")&&n.length!==2)return o.error("Expected one argument.");const h=wv[c],p=[];for(let _=1;_<n.length;_++){const v=o.parse(n[_],_,Gt);if(!v)return null;p.push(v)}return new Md(h,p)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let o,c;for(const h of this.args){if(o=h.evaluate(n),c=null,o instanceof $n)return o;if(typeof o=="string"){const p=n.parseColor(o);if(p)return p}else if(Array.isArray(o)&&(c=o.length<3||o.length>4?`Invalid rbga value ${JSON.stringify(o)}: expected an array containing either three or four numeric values.`:Rm(o[0],o[1],o[2],o[3]),!c))return new $n(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Pr(c||`Could not parse color from value '${typeof o=="string"?o:String(JSON.stringify(o))}'`)}if(this.type.kind==="number"){let o=null;for(const c of this.args){if(o=c.evaluate(n),o===null)return 0;const h=Number(o);if(!isNaN(h))return h}throw new Pr(`Could not convert ${JSON.stringify(o)} to number.`)}return this.type.kind==="formatted"?ei.fromString(uc(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Si.fromString(uc(this.args[0].evaluate(n))):uc(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new gs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new xu(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(o=>{n.push(o.serialize())}),n}}var Va=Md;const po=["Unknown","Point","LineString","Polygon"];var Rd=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?po[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const i=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:o,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(o*n-i[0])+this.featureDistanceData.bearing[1]*(c*n-i[1])}return 0}parseColor(i){let n=this._parseColorCache[i];return n||(n=this._parseColorCache[i]=$n.parse(i)),n}};class Ks{constructor(n,o,c,h){this.name=n,this.type=o,this._evaluate=c,this.args=h}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,o){const c=n[0],h=Ks.definitions[c];if(!h)return o.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([E])=>!Array.isArray(E)||E.length===n.length-1);let b=null;for(const[E,C]of v){b=new Fd(o.registry,o.path,null,o.scope);const P=[];let M=!1;for(let L=1;L<n.length;L++){const z=n[L],N=Array.isArray(E)?E[L-1]:E.type,q=b.parse(z,1+P.length,N);if(!q){M=!0;break}P.push(q)}if(!M)if(Array.isArray(E)&&E.length!==P.length)b.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let L=0;L<P.length;L++){const z=Array.isArray(E)?E[L]:E.type,N=P[L];b.concat(L+1).checkSubtype(z,N.type)}if(b.errors.length===0)return new Ks(c,p,C,P)}}if(v.length===1)o.errors.push(...b.errors);else{const E=(v.length?v:_).map(([P])=>{return M=P,Array.isArray(M)?`(${M.map(Mn).join(", ")})`:`(${Mn(M.type)}...)`;var M}).join(" | "),C=[];for(let P=1;P<n.length;P++){const M=o.parse(n[P],1+C.length);if(!M)return null;C.push(Mn(M.type))}o.error(`Expected arguments of type ${E}, but found (${C.join(", ")}) instead.`)}return null}static register(n,o){Ks.definitions=o;for(const c in o)n[c]=Ks}}var Uo=Ks;class hc{constructor(n,o,c){this.type=gi,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=o}static parse(n,o){if(n.length!==2)return o.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return o.error("Collator options argument must be an object.");const h=o.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,$t);if(!h)return null;const p=o.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,$t);if(!p)return null;let _=null;return c.locale&&(_=o.parse(c.locale,1,Ht),!_)?null:new hc(h,p,_)}evaluate(n){return new Id(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const Vo=8192;function wu(i,n){i[0]=Math.min(i[0],n[0]),i[1]=Math.min(i[1],n[1]),i[2]=Math.max(i[2],n[0]),i[3]=Math.max(i[3],n[1])}function $a(i,n){return!(i[0]<=n[0]||i[2]>=n[2]||i[1]<=n[1]||i[3]>=n[3])}function dc(i,n){const o=(180+i[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,n.z);return[Math.round(o*h*Vo),Math.round(c*h*Vo)]}function Dm(i,n,o){const c=i[0]-n[0],h=i[1]-n[1],p=i[0]-o[0],_=i[1]-o[1];return c*_-p*h==0&&c*p<=0&&h*_<=0}function bu(i,n){let o=!1;for(let _=0,v=n.length;_<v;_++){const b=n[_];for(let E=0,C=b.length;E<C-1;E++){if(Dm(i,b[E],b[E+1]))return!1;(h=b[E])[1]>(c=i)[1]!=(p=b[E+1])[1]>c[1]&&c[0]<(p[0]-h[0])*(c[1]-h[1])/(p[1]-h[1])+h[0]&&(o=!o)}}var c,h,p;return o}function Dd(i,n){for(let o=0;o<n.length;o++)if(bu(i,n[o]))return!0;return!1}function Ld(i,n,o,c){const h=c[0]-o[0],p=c[1]-o[1],_=(i[0]-o[0])*p-h*(i[1]-o[1]),v=(n[0]-o[0])*p-h*(n[1]-o[1]);return _>0&&v<0||_<0&&v>0}function Ga(i,n,o){for(const E of o)for(let C=0;C<E.length-1;++C)if((v=[(_=E[C+1])[0]-(p=E[C])[0],_[1]-p[1]])[0]*(b=[(h=n)[0]-(c=i)[0],h[1]-c[1]])[1]-v[1]*b[0]!=0&&Ld(c,h,p,_)&&Ld(p,_,c,h))return!0;var c,h,p,_,v,b;return!1}function sn(i,n){for(let o=0;o<i.length;++o)if(!bu(i[o],n))return!1;for(let o=0;o<i.length-1;++o)if(Ga(i[o],i[o+1],n))return!1;return!0}function bv(i,n){for(let o=0;o<n.length;o++)if(sn(i,n[o]))return!0;return!1}function zd(i,n,o){const c=[];for(let h=0;h<i.length;h++){const p=[];for(let _=0;_<i[h].length;_++){const v=dc(i[h][_],o);wu(n,v),p.push(v)}c.push(p)}return c}function Lm(i,n,o){const c=[];for(let h=0;h<i.length;h++){const p=zd(i[h],n,o);c.push(p)}return c}function Od(i,n,o,c){if(i[0]<o[0]||i[0]>o[2]){const h=.5*c;let p=i[0]-o[0]>h?-c:o[0]-i[0]>h?c:0;p===0&&(p=i[0]-o[2]>h?-c:o[2]-i[0]>h?c:0),i[0]+=p}wu(n,i)}function zm(i,n,o,c){const h=Math.pow(2,c.z)*Vo,p=[c.x*Vo,c.y*Vo],_=[];if(!i)return _;for(const v of i)for(const b of v){const E=[b.x+p[0],b.y+p[1]];Od(E,n,o,h),_.push(E)}return _}function Bd(i,n,o,c){const h=Math.pow(2,c.z)*Vo,p=[c.x*Vo,c.y*Vo],_=[];if(!i)return _;for(const b of i){const E=[];for(const C of b){const P=[C.x+p[0],C.y+p[1]];wu(n,P),E.push(P)}_.push(E)}if(n[2]-n[0]<=h/2){(v=n)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const b of _)for(const E of b)Od(E,n,o,h)}var v;return _}class Wa{constructor(n,o){this.type=$t,this.geojson=n,this.geometries=o}static parse(n,o){if(n.length!==2)return o.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(cc(n[1])){const c=n[1];if(c.type==="FeatureCollection")for(let h=0;h<c.features.length;++h){const p=c.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Wa(c,c.features[h].geometry)}else if(c.type==="Feature"){const h=c.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Wa(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Wa(c,c)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(o,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=zd(c.coordinates,p,_),b=zm(o.geometry(),h,p,_);if(!$a(h,p))return!1;for(const E of b)if(!bu(E,v))return!1}if(c.type==="MultiPolygon"){const v=Lm(c.coordinates,p,_),b=zm(o.geometry(),h,p,_);if(!$a(h,p))return!1;for(const E of b)if(!Dd(E,v))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(o,c){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=o.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const v=zd(c.coordinates,p,_),b=Bd(o.geometry(),h,p,_);if(!$a(h,p))return!1;for(const E of b)if(!sn(E,v))return!1}if(c.type==="MultiPolygon"){const v=Lm(c.coordinates,p,_),b=Bd(o.geometry(),h,p,_);if(!$a(h,p))return!1;for(const E of b)if(!bv(E,v))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Eu=Wa;function qa(i){if(i instanceof Uo&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Eu)return!1;let n=!0;return i.eachChild(o=>{n&&!qa(o)&&(n=!1)}),n}function $o(i){if(i instanceof Uo&&i.name==="feature-state")return!1;let n=!0;return i.eachChild(o=>{n&&!$o(o)&&(n=!1)}),n}function Js(i,n){if(i instanceof Uo&&n.indexOf(i.name)>=0)return!1;let o=!0;return i.eachChild(c=>{o&&!Js(c,n)&&(o=!1)}),o}class Tu{constructor(n,o){this.type=o.type,this.name=n,this.boundExpression=o}static parse(n,o){if(n.length!==2||typeof n[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");const c=n[1];return o.scope.has(c)?new Tu(c,o.scope.get(c)):o.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Om=Tu;class fc{constructor(n,o=[],c,h=new Pm,p=[]){this.registry=n,this.path=o,this.key=o.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=p,this.expectedType=c}parse(n,o,c,h,p={}){return o?this.concat(o,c,h)._parse(n,p):this._parse(n,p)}_parse(n,o){function c(h,p,_){return _==="assert"?new jo(p,[h]):_==="coerce"?new Va(p,[h]):h}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=n[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[h];if(p){let _=p.parse(n,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,b=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||b.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(v,b))return null}else _=c(_,v,o.typeAnnotation||"coerce");else _=c(_,v,o.typeAnnotation||"assert")}if(!(_ instanceof Xs)&&_.type.kind!=="resolvedImage"&&Nd(_)){const v=new Rd;try{_=new Xs(_.type,_.evaluate(v))}catch(b){return this.error(b.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,o,c){const h=typeof n=="number"?this.path.concat(n):this.path,p=c?this.scope.concat(c):this.scope;return new fc(this.registry,h,o||null,p,this.errors)}error(n,...o){const c=`${this.key}${o.map(h=>`[${h}]`).join("")}`;this.errors.push(new fo(c,n))}checkSubtype(n,o){const c=No(n,o);return c&&this.error(c),c}}var Fd=fc;function Nd(i){if(i instanceof Om)return Nd(i.boundExpression);if(i instanceof Uo&&i.name==="error"||i instanceof hc||i instanceof Eu)return!1;const n=i instanceof Va||i instanceof jo;let o=!0;return i.eachChild(c=>{o=n?o&&Nd(c):o&&c instanceof Xs}),!!o&&qa(i)&&Js(i,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Su(i,n){const o=i.length-1;let c,h,p=0,_=o,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),c=i[v],h=i[v+1],c<=n){if(v===o||n<h)return v;p=v+1}else{if(!(c>n))throw new Pr("Input is not a number.");_=v-1}return 0}class Iu{constructor(n,o,c){this.type=n,this.input=o,this.labels=[],this.outputs=[];for(const[h,p]of c)this.labels.push(h),this.outputs.push(p)}static parse(n,o){if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");const c=o.parse(n[1],1,ht);if(!c)return null;const h=[];let p=null;o.expectedType&&o.expectedType.kind!=="value"&&(p=o.expectedType);for(let _=1;_<n.length;_+=2){const v=_===1?-1/0:n[_],b=n[_+1],E=_,C=_+1;if(typeof v!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=v)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=o.parse(b,C,p);if(!P)return null;p=p||P.type,h.push([v,P])}return new Iu(p,c,h)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return c[0].evaluate(n);const p=o.length;return h>=o[p-1]?c[p-1].evaluate(n):c[Su(o,h)].evaluate(n)}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let o=0;o<this.labels.length;o++)o>0&&n.push(this.labels[o]),n.push(this.outputs[o].serialize());return n}}var jd=Iu;function Jt(i,n,o){return i*(1-o)+n*o}var pc=Object.freeze({__proto__:null,array:function(i,n,o){return i.map((c,h)=>Jt(c,n[h],o))},color:function(i,n,o){return new $n(Jt(i.r,n.r,o),Jt(i.g,n.g,o),Jt(i.b,n.b,o),Jt(i.a,n.a,o))},number:Jt});const Bm=.95047,Ud=1.08883,Fm=4/29,Ys=6/29,Vd=3*Ys*Ys,Ev=Ys*Ys*Ys,Tv=Math.PI/180,Sv=180/Math.PI;function $d(i){return i>Ev?Math.pow(i,1/3):i/Vd+Fm}function Gd(i){return i>Ys?i*i*i:Vd*(i-Fm)}function Wd(i){return 255*(i<=.0031308?12.92*i:1.055*Math.pow(i,1/2.4)-.055)}function Cu(i){return(i/=255)<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function Nm(i){const n=Cu(i.r),o=Cu(i.g),c=Cu(i.b),h=$d((.4124564*n+.3575761*o+.1804375*c)/Bm),p=$d((.2126729*n+.7151522*o+.072175*c)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-$d((.0193339*n+.119192*o+.9503041*c)/Ud)),alpha:i.a}}function jm(i){let n=(i.l+16)/116,o=isNaN(i.a)?n:n+i.a/500,c=isNaN(i.b)?n:n-i.b/200;return n=1*Gd(n),o=Bm*Gd(o),c=Ud*Gd(c),new $n(Wd(3.2404542*o-1.5371385*n-.4985314*c),Wd(-.969266*o+1.8760108*n+.041556*c),Wd(.0556434*o-.2040259*n+1.0572252*c),i.alpha)}function Iv(i,n,o){const c=n-i;return i+o*(c>180||c<-180?c-360*Math.round(c/360):c)}const mc={forward:Nm,reverse:jm,interpolate:function(i,n,o){return{l:Jt(i.l,n.l,o),a:Jt(i.a,n.a,o),b:Jt(i.b,n.b,o),alpha:Jt(i.alpha,n.alpha,o)}}},Ha={forward:function(i){const{l:n,a:o,b:c}=Nm(i),h=Math.atan2(c,o)*Sv;return{h:h<0?h+360:h,c:Math.sqrt(o*o+c*c),l:n,alpha:i.a}},reverse:function(i){const n=i.h*Tv,o=i.c;return jm({l:i.l,a:Math.cos(n)*o,b:Math.sin(n)*o,alpha:i.alpha})},interpolate:function(i,n,o){return{h:Iv(i.h,n.h,o),c:Jt(i.c,n.c,o),l:Jt(i.l,n.l,o),alpha:Jt(i.alpha,n.alpha,o)}}};var qd=Object.freeze({__proto__:null,hcl:Ha,lab:mc});class gc{constructor(n,o,c,h,p){this.type=n,this.operator=o,this.interpolation=c,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(n,o,c,h){let p=0;if(n.name==="exponential")p=Hd(o,n.base,c,h);else if(n.name==="linear")p=Hd(o,1,c,h);else if(n.name==="cubic-bezier"){const _=n.controlPoints;p=new Xe(_[0],_[1],_[2],_[3]).solve(Hd(o,1,c,h))}return p}static parse(n,o){let[c,h,p,..._]=n;if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return o.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(n.length-1<4)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(p=o.parse(p,2,ht),!p)return null;const v=[];let b=null;c==="interpolate-hcl"||c==="interpolate-lab"?b=mi:o.expectedType&&o.expectedType.kind!=="value"&&(b=o.expectedType);for(let E=0;E<_.length;E+=2){const C=_[E],P=_[E+1],M=E+3,L=E+4;if(typeof C!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(v.length&&v[v.length-1][0]>=C)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const z=o.parse(P,L,b);if(!z)return null;b=b||z.type,v.push([C,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new gc(b,c,h,p,v):o.error(`Type ${Mn(b)} is not interpolatable.`)}evaluate(n){const o=this.labels,c=this.outputs;if(o.length===1)return c[0].evaluate(n);const h=this.input.evaluate(n);if(h<=o[0])return c[0].evaluate(n);const p=o.length;if(h>=o[p-1])return c[p-1].evaluate(n);const _=Su(o,h),v=gc.interpolationFactor(this.interpolation,h,o[_],o[_+1]),b=c[_].evaluate(n),E=c[_+1].evaluate(n);return this.operator==="interpolate"?pc[this.type.kind.toLowerCase()](b,E,v):this.operator==="interpolate-hcl"?Ha.reverse(Ha.interpolate(Ha.forward(b),Ha.forward(E),v)):mc.reverse(mc.interpolate(mc.forward(b),mc.forward(E),v))}eachChild(n){n(this.input);for(const o of this.outputs)n(o)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const o=[this.operator,n,this.input.serialize()];for(let c=0;c<this.labels.length;c++)o.push(this.labels[c],this.outputs[c].serialize());return o}}function Hd(i,n,o,c){const h=c-o,p=i-o;return h===0?0:n===1?p/h:(Math.pow(n,p)-1)/(Math.pow(n,h)-1)}var mo=gc;class Au{constructor(n,o){this.type=n,this.args=o}static parse(n,o){if(n.length<2)return o.error("Expectected at least one argument.");let c=null;const h=o.expectedType;h&&h.kind!=="value"&&(c=h);const p=[];for(const v of n.slice(1)){const b=o.parse(v,1+p.length,c,void 0,{typeAnnotation:"omit"});if(!b)return null;c=c||b.type,p.push(b)}const _=h&&p.some(v=>No(h,v.type));return new Au(_?Gt:c,p)}evaluate(n){let o,c=null,h=0;for(const p of this.args){if(h++,c=p.evaluate(n),c&&c instanceof Si&&!c.available&&(o||(o=c),c=null,h===this.args.length))return o;if(c!==null)break}return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var Zd=Au;class Pu{constructor(n,o){this.type=o.type,this.bindings=[].concat(n),this.result=o}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const o of this.bindings)n(o[1]);n(this.result)}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let p=1;p<n.length-1;p+=2){const _=n[p];if(typeof _!="string")return o.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return o.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=o.parse(n[p+1],p+1);if(!v)return null;c.push([_,v])}const h=o.parse(n[n.length-1],n.length-1,o.expectedType,c);return h?new Pu(c,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[o,c]of this.bindings)n.push(o,c.serialize());return n.push(this.result.serialize()),n}}var Um=Pu;class Xd{constructor(n,o,c){this.type=n,this.index=o,this.input=c}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,ht),h=o.parse(n[2],2,Ti(o.expectedType||Gt));return c&&h?new Xd(h.type.itemType,c,h):null}evaluate(n){const o=this.index.evaluate(n),c=this.input.evaluate(n);if(o<0)throw new Pr(`Array index out of bounds: ${o} < 0.`);if(o>=c.length)throw new Pr(`Array index out of bounds: ${o} > ${c.length-1}.`);if(o!==Math.floor(o))throw new Pr(`Array index must be an integer, but found ${o} instead.`);return c[o]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Cv=Xd;class Kd{constructor(n,o){this.type=$t,this.needle=n,this.haystack=o}static parse(n,o){if(n.length!==3)return o.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,Gt),h=o.parse(n[2],2,Gt);return c&&h?oc(c.type,[$t,Ht,ht,ja,Gt])?new Kd(c,h):o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(c.type)} instead`):null}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(c==null)return!1;if(!sc(o,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Nn(o))} instead.`);if(!sc(c,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Mn(Nn(c))} instead.`);return c.indexOf(o)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ku=Kd;class _c{constructor(n,o,c){this.type=ht,this.needle=n,this.haystack=o,this.fromIndex=c}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,Gt),h=o.parse(n[2],2,Gt);if(!c||!h)return null;if(!oc(c.type,[$t,Ht,ht,ja,Gt]))return o.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(c.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,ht);return p?new _c(c,h,p):null}return new _c(c,h)}evaluate(n){const o=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!sc(o,["boolean","string","number","null"]))throw new Pr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Nn(o))} instead.`);if(!sc(c,["string","array"]))throw new Pr(`Expected second argument to be of type array or string, but found ${Mn(Nn(c))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(n);return c.indexOf(o,h)}return c.indexOf(o)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Vm=_c;class Jd{constructor(n,o,c,h,p,_){this.inputType=n,this.type=o,this.input=c,this.cases=h,this.outputs=p,this.otherwise=_}static parse(n,o){if(n.length<5)return o.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return o.error("Expected an even number of arguments.");let c,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);const p={},_=[];for(let E=2;E<n.length-1;E+=2){let C=n[E];const P=n[E+1];Array.isArray(C)||(C=[C]);const M=o.concat(E);if(C.length===0)return M.error("Expected at least one branch label.");for(const z of C){if(typeof z!="number"&&typeof z!="string")return M.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return M.error("Numeric branch labels must be integer values.");if(c){if(M.checkSubtype(c,Nn(z)))return null}else c=Nn(z);if(p[String(z)]!==void 0)return M.error("Branch labels must be unique.");p[String(z)]=_.length}const L=o.parse(P,E,h);if(!L)return null;h=h||L.type,_.push(L)}const v=o.parse(n[1],1,Gt);if(!v)return null;const b=o.parse(n[n.length-1],n.length-1,h);return b?v.type.kind!=="value"&&o.concat(1).checkSubtype(c,v.type)?null:new Jd(c,h,v,p,_,b):null}evaluate(n){const o=this.input.evaluate(n);return(Nn(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],o=Object.keys(this.cases).sort(),c=[],h={};for(const _ of o){const v=h[this.cases[_]];v===void 0?(h[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[v][1].push(_)}const p=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of c)n.push(v.length===1?p(v[0]):v.map(p)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}var Av=Jd;class Yd{constructor(n,o,c){this.type=n,this.branches=o,this.otherwise=c}static parse(n,o){if(n.length<4)return o.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return o.error("Expected an odd number of arguments.");let c;o.expectedType&&o.expectedType.kind!=="value"&&(c=o.expectedType);const h=[];for(let _=1;_<n.length-1;_+=2){const v=o.parse(n[_],_,$t);if(!v)return null;const b=o.parse(n[_+1],_+1,c);if(!b)return null;h.push([v,b]),c=c||b.type}const p=o.parse(n[n.length-1],n.length-1,c);return p?new Yd(c,h,p):null}evaluate(n){for(const[o,c]of this.branches)if(o.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[o,c]of this.branches)n(o),n(c);n(this.otherwise)}outputDefined(){return this.branches.every(([n,o])=>o.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(o=>{n.push(o.serialize())}),n}}var $m=Yd;class yc{constructor(n,o,c,h){this.type=n,this.input=o,this.beginIndex=c,this.endIndex=h}static parse(n,o){if(n.length<=2||n.length>=5)return o.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=o.parse(n[1],1,Gt),h=o.parse(n[2],2,ht);if(!c||!h)return null;if(!oc(c.type,[Ti(Gt),Ht,Gt]))return o.error(`Expected first argument to be of type array or string, but found ${Mn(c.type)} instead`);if(n.length===4){const p=o.parse(n[3],3,ht);return p?new yc(c.type,c,h,p):null}return new yc(c.type,c,h)}evaluate(n){const o=this.input.evaluate(n),c=this.beginIndex.evaluate(n);if(!sc(o,["string","array"]))throw new Pr(`Expected first argument to be of type array or string, but found ${Mn(Nn(o))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(n);return o.slice(c,h)}return o.slice(c)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Gm=yc;function Mu(i,n){return i==="=="||i==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Wm(i,n,o,c){return c.compare(n,o)===0}function Za(i,n,o){const c=i!=="=="&&i!=="!=";return class $D{constructor(p,_,v){this.type=$t,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let b=_.parse(p[1],1,Gt);if(!b)return null;if(!Mu(v,b.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${Mn(b.type)}'.`);let E=_.parse(p[2],2,Gt);if(!E)return null;if(!Mu(v,E.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${Mn(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return _.error(`Cannot compare types '${Mn(b.type)}' and '${Mn(E.type)}'.`);c&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new jo(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new jo(b.type,[E])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(C=_.parse(p[3],3,gi),!C)return null}return new $D(b,E,C)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(c&&this.hasUntypedArgument){const b=Nn(_),E=Nn(v);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Pr(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const b=Nn(_),E=Nn(v);if(b.kind!=="string"||E.kind!=="string")return n(p,_,v)}return this.collator?o(p,_,v,this.collator.evaluate(p)):n(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[i];return this.eachChild(_=>{p.push(_.serialize())}),p}}}const Pv=Za("==",function(i,n,o){return n===o},Wm),kv=Za("!=",function(i,n,o){return n!==o},function(i,n,o,c){return!Wm(0,n,o,c)}),Mv=Za("<",function(i,n,o){return n<o},function(i,n,o,c){return c.compare(n,o)<0}),Rv=Za(">",function(i,n,o){return n>o},function(i,n,o,c){return c.compare(n,o)>0}),Dv=Za("<=",function(i,n,o){return n<=o},function(i,n,o,c){return c.compare(n,o)<=0}),qm=Za(">=",function(i,n,o){return n>=o},function(i,n,o,c){return c.compare(n,o)>=0});class Ru{constructor(n,o,c,h,p,_){this.type=Ht,this.number=n,this.locale=o,this.currency=c,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(n,o){if(n.length!==3)return o.error("Expected two arguments.");const c=o.parse(n[1],1,ht);if(!c)return null;const h=n[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=o.parse(h.locale,1,Ht),!p))return null;let _=null;if(h.currency&&(_=o.parse(h.currency,1,Ht),!_))return null;let v=null;if(h.unit&&(v=o.parse(h.unit,1,Ht),!v))return null;let b=null;if(h["min-fraction-digits"]&&(b=o.parse(h["min-fraction-digits"],1,ht),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=o.parse(h["max-fraction-digits"],1,ht),!E)?null:new Ru(c,p,_,v,b,E)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Xa{constructor(n){this.type=ht,this.input=n}static parse(n,o){if(n.length!==2)return o.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=o.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?o.error(`Expected argument of type string or array, but found ${Mn(c.type)} instead.`):new Xa(c):null}evaluate(n){const o=this.input.evaluate(n);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Pr(`Expected value to be of type string or array, but found ${Mn(Nn(o))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(o=>{n.push(o.serialize())}),n}}const Hm={"==":Pv,"!=":kv,">":Rv,"<":Mv,">=":qm,"<=":Dv,array:jo,at:Cv,boolean:jo,case:$m,coalesce:Zd,collator:hc,format:gs,image:xu,in:ku,"index-of":Vm,interpolate:mo,"interpolate-hcl":mo,"interpolate-lab":mo,length:Xa,let:Um,literal:Xs,match:Av,number:jo,"number-format":Ru,object:jo,slice:Gm,step:jd,string:jo,"to-boolean":Va,"to-color":Va,"to-number":Va,"to-string":Va,var:Om,within:Eu};function Zm(i,[n,o,c,h]){n=n.evaluate(i),o=o.evaluate(i),c=c.evaluate(i);const p=h?h.evaluate(i):1,_=Rm(n,o,c,p);if(_)throw new Pr(_);return new $n(n/255*p,o/255*p,c/255*p,p)}function Go(i,n){return i in n}function Du(i,n){const o=n[i];return o===void 0?null:o}function Ii(i){return{type:i}}Uo.register(Hm,{error:[{kind:"error"},[Ht],(i,[n])=>{throw new Pr(n.evaluate(i))}],typeof:[Ht,[Gt],(i,[n])=>Mn(Nn(n.evaluate(i)))],"to-rgba":[Ti(ht,4),[mi],(i,[n])=>n.evaluate(i).toArray()],rgb:[mi,[ht,ht,ht],Zm],rgba:[mi,[ht,ht,ht,ht],Zm],has:{type:$t,overloads:[[[Ht],(i,[n])=>Go(n.evaluate(i),i.properties())],[[Ht,$i],(i,[n,o])=>Go(n.evaluate(i),o.evaluate(i))]]},get:{type:Gt,overloads:[[[Ht],(i,[n])=>Du(n.evaluate(i),i.properties())],[[Ht,$i],(i,[n,o])=>Du(n.evaluate(i),o.evaluate(i))]]},"feature-state":[Gt,[Ht],(i,[n])=>Du(n.evaluate(i),i.featureState||{})],properties:[$i,[],i=>i.properties()],"geometry-type":[Ht,[],i=>i.geometryType()],id:[Gt,[],i=>i.id()],zoom:[ht,[],i=>i.globals.zoom],pitch:[ht,[],i=>i.globals.pitch||0],"distance-from-center":[ht,[],i=>i.distanceFromCenter()],"heatmap-density":[ht,[],i=>i.globals.heatmapDensity||0],"line-progress":[ht,[],i=>i.globals.lineProgress||0],"sky-radial-progress":[ht,[],i=>i.globals.skyRadialProgress||0],accumulated:[Gt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[ht,Ii(ht),(i,n)=>{let o=0;for(const c of n)o+=c.evaluate(i);return o}],"*":[ht,Ii(ht),(i,n)=>{let o=1;for(const c of n)o*=c.evaluate(i);return o}],"-":{type:ht,overloads:[[[ht,ht],(i,[n,o])=>n.evaluate(i)-o.evaluate(i)],[[ht],(i,[n])=>-n.evaluate(i)]]},"/":[ht,[ht,ht],(i,[n,o])=>n.evaluate(i)/o.evaluate(i)],"%":[ht,[ht,ht],(i,[n,o])=>n.evaluate(i)%o.evaluate(i)],ln2:[ht,[],()=>Math.LN2],pi:[ht,[],()=>Math.PI],e:[ht,[],()=>Math.E],"^":[ht,[ht,ht],(i,[n,o])=>Math.pow(n.evaluate(i),o.evaluate(i))],sqrt:[ht,[ht],(i,[n])=>Math.sqrt(n.evaluate(i))],log10:[ht,[ht],(i,[n])=>Math.log(n.evaluate(i))/Math.LN10],ln:[ht,[ht],(i,[n])=>Math.log(n.evaluate(i))],log2:[ht,[ht],(i,[n])=>Math.log(n.evaluate(i))/Math.LN2],sin:[ht,[ht],(i,[n])=>Math.sin(n.evaluate(i))],cos:[ht,[ht],(i,[n])=>Math.cos(n.evaluate(i))],tan:[ht,[ht],(i,[n])=>Math.tan(n.evaluate(i))],asin:[ht,[ht],(i,[n])=>Math.asin(n.evaluate(i))],acos:[ht,[ht],(i,[n])=>Math.acos(n.evaluate(i))],atan:[ht,[ht],(i,[n])=>Math.atan(n.evaluate(i))],min:[ht,Ii(ht),(i,n)=>Math.min(...n.map(o=>o.evaluate(i)))],max:[ht,Ii(ht),(i,n)=>Math.max(...n.map(o=>o.evaluate(i)))],abs:[ht,[ht],(i,[n])=>Math.abs(n.evaluate(i))],round:[ht,[ht],(i,[n])=>{const o=n.evaluate(i);return o<0?-Math.round(-o):Math.round(o)}],floor:[ht,[ht],(i,[n])=>Math.floor(n.evaluate(i))],ceil:[ht,[ht],(i,[n])=>Math.ceil(n.evaluate(i))],"filter-==":[$t,[Ht,Gt],(i,[n,o])=>i.properties()[n.value]===o.value],"filter-id-==":[$t,[Gt],(i,[n])=>i.id()===n.value],"filter-type-==":[$t,[Ht],(i,[n])=>i.geometryType()===n.value],"filter-<":[$t,[Ht,Gt],(i,[n,o])=>{const c=i.properties()[n.value],h=o.value;return typeof c==typeof h&&c<h}],"filter-id-<":[$t,[Gt],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o<c}],"filter->":[$t,[Ht,Gt],(i,[n,o])=>{const c=i.properties()[n.value],h=o.value;return typeof c==typeof h&&c>h}],"filter-id->":[$t,[Gt],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o>c}],"filter-<=":[$t,[Ht,Gt],(i,[n,o])=>{const c=i.properties()[n.value],h=o.value;return typeof c==typeof h&&c<=h}],"filter-id-<=":[$t,[Gt],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o<=c}],"filter->=":[$t,[Ht,Gt],(i,[n,o])=>{const c=i.properties()[n.value],h=o.value;return typeof c==typeof h&&c>=h}],"filter-id->=":[$t,[Gt],(i,[n])=>{const o=i.id(),c=n.value;return typeof o==typeof c&&o>=c}],"filter-has":[$t,[Gt],(i,[n])=>n.value in i.properties()],"filter-has-id":[$t,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[$t,[Ti(Ht)],(i,[n])=>n.value.indexOf(i.geometryType())>=0],"filter-id-in":[$t,[Ti(Gt)],(i,[n])=>n.value.indexOf(i.id())>=0],"filter-in-small":[$t,[Ht,Ti(Gt)],(i,[n,o])=>o.value.indexOf(i.properties()[n.value])>=0],"filter-in-large":[$t,[Ht,Ti(Gt)],(i,[n,o])=>function(c,h,p,_){for(;p<=_;){const v=p+_>>1;if(h[v]===c)return!0;h[v]>c?_=v-1:p=v+1}return!1}(i.properties()[n.value],o.value,0,o.value.length-1)],all:{type:$t,overloads:[[[$t,$t],(i,[n,o])=>n.evaluate(i)&&o.evaluate(i)],[Ii($t),(i,n)=>{for(const o of n)if(!o.evaluate(i))return!1;return!0}]]},any:{type:$t,overloads:[[[$t,$t],(i,[n,o])=>n.evaluate(i)||o.evaluate(i)],[Ii($t),(i,n)=>{for(const o of n)if(o.evaluate(i))return!0;return!1}]]},"!":[$t,[$t],(i,[n])=>!n.evaluate(i)],"is-supported-script":[$t,[Ht],(i,[n])=>{const o=i.globals&&i.globals.isSupportedScript;return!o||o(n.evaluate(i))}],upcase:[Ht,[Ht],(i,[n])=>n.evaluate(i).toUpperCase()],downcase:[Ht,[Ht],(i,[n])=>n.evaluate(i).toLowerCase()],concat:[Ht,Ii(Gt),(i,n)=>n.map(o=>uc(o.evaluate(i))).join("")],"resolved-locale":[Ht,[gi],(i,[n])=>n.evaluate(i).resolvedLocale()]});var vc=Hm;function Xm(i){return{result:"success",value:i}}function Qs(i){return{result:"error",value:i}}function Ka(i){return i["property-type"]==="data-driven"}function Lu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function zu(i){return!!i.expression&&i.expression.interpolated}function Qt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function xc(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Km(i){return i}function Ou(i,n){const o=n.type==="color",c=i.stops&&typeof i.stops[0][0]=="object",h=c||!(c||i.property!==void 0),p=i.type||(zu(n)?"exponential":"interval");if(o&&((i=Fo({},i)).stops&&(i.stops=i.stops.map(E=>[E[0],$n.parse(E[1])])),i.default=$n.parse(i.default?i.default:n.default)),i.colorSpace&&i.colorSpace!=="rgb"&&!qd[i.colorSpace])throw new Error(`Unknown color space: ${i.colorSpace}`);let _,v,b;if(p==="exponential")_=Wo;else if(p==="interval")_=Bu;else if(p==="categorical"){_=Jm,v=Object.create(null);for(const E of i.stops)v[E[0]]=E[1];b=typeof i.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=Ym}if(c){const E={},C=[];for(let L=0;L<i.stops.length;L++){const z=i.stops[L],N=z[0].zoom;E[N]===void 0&&(E[N]={zoom:N,type:i.type,property:i.property,default:i.default,stops:[]},C.push(N)),E[N].stops.push([z[0].value,z[1]])}const P=[];for(const L of C)P.push([E[L].zoom,Ou(E[L],n)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:mo.interpolationFactor.bind(void 0,M),zoomStops:P.map(L=>L[0]),evaluate:({zoom:L},z)=>Wo({stops:P,base:i.base},n,L).evaluate(L,z)}}if(h){const E=p==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:mo.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(C=>C[0]),evaluate:({zoom:C})=>_(i,n,C,v,b)}}return{kind:"source",evaluate(E,C){const P=C&&C.properties?C.properties[i.property]:void 0;return P===void 0?Ja(i.default,n.default):_(i,n,P,v,b)}}}function Ja(i,n,o){return i!==void 0?i:n!==void 0?n:o!==void 0?o:void 0}function Jm(i,n,o,c,h){return Ja(typeof o===h?c[o]:void 0,i.default,n.default)}function Bu(i,n,o){if(Qt(o)!=="number")return Ja(i.default,n.default);const c=i.stops.length;if(c===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[c-1][0])return i.stops[c-1][1];const h=Su(i.stops.map(p=>p[0]),o);return i.stops[h][1]}function Wo(i,n,o){const c=i.base!==void 0?i.base:1;if(Qt(o)!=="number")return Ja(i.default,n.default);const h=i.stops.length;if(h===1||o<=i.stops[0][0])return i.stops[0][1];if(o>=i.stops[h-1][0])return i.stops[h-1][1];const p=Su(i.stops.map(C=>C[0]),o),_=function(C,P,M,L){const z=L-M,N=C-M;return z===0?0:P===1?N/z:(Math.pow(P,N)-1)/(Math.pow(P,z)-1)}(o,c,i.stops[p][0],i.stops[p+1][0]),v=i.stops[p][1],b=i.stops[p+1][1];let E=pc[n.type]||Km;if(i.colorSpace&&i.colorSpace!=="rgb"){const C=qd[i.colorSpace];E=(P,M)=>C.reverse(C.interpolate(C.forward(P),C.forward(M),_))}return typeof v.evaluate=="function"?{evaluate(...C){const P=v.evaluate.apply(void 0,C),M=b.evaluate.apply(void 0,C);if(P!==void 0&&M!==void 0)return E(P,M,_)}}:E(v,b,_)}function Ym(i,n,o){return n.type==="color"?o=$n.parse(o):n.type==="formatted"?o=ei.fromString(o.toString()):n.type==="resolvedImage"?o=Si.fromString(o.toString()):Qt(o)===n.type||n.type==="enum"&&n.values[o]||(o=void 0),Ja(o,i.default,n.default)}class Fu{constructor(n,o){this.expression=n,this._warningHistory={},this._evaluator=new Rd,this._defaultValue=o?function(c){return c.type==="color"&&(xc(c.default)||Array.isArray(c.default))?new $n(0,0,0,0):c.type==="color"?$n.parse(c.default)||null:c.default===void 0?null:c.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null}evaluateWithoutErrorHandling(n,o,c,h,p,_,v,b){return this._evaluator.globals=n,this._evaluator.feature=o,this._evaluator.featureState=c,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(n,o,c,h,p,_,v,b){this._evaluator.globals=n,this._evaluator.feature=o||null,this._evaluator.featureState=c||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Pr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Ya(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in vc}function Qa(i,n){const o=new Fd(vc,[],n?function(h){const p={color:mi,string:Ht,number:ht,enum:Ht,boolean:$t,formatted:ic,resolvedImage:Zs};return h.type==="array"?Ti(p[h.value]||Gt,h.length):p[h.type]}(n):void 0),c=o.parse(i,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Xm(new Fu(c,n)):Qs(o.errors)}class Qd{constructor(n,o){this.kind=n,this._styleExpression=o,this.isStateDependent=n!=="constant"&&!$o(o.expression)}evaluateWithoutErrorHandling(n,o,c,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,h,p,_)}evaluate(n,o,c,h,p,_){return this._styleExpression.evaluate(n,o,c,h,p,_)}}class wc{constructor(n,o,c,h){this.kind=n,this.zoomStops=c,this._styleExpression=o,this.isStateDependent=n!=="camera"&&!$o(o.expression),this.interpolationType=h}evaluateWithoutErrorHandling(n,o,c,h,p,_){return this._styleExpression.evaluateWithoutErrorHandling(n,o,c,h,p,_)}evaluate(n,o,c,h,p,_){return this._styleExpression.evaluate(n,o,c,h,p,_)}interpolationFactor(n,o,c){return this.interpolationType?mo.interpolationFactor(this.interpolationType,n,o,c):0}}function bc(i,n){if((i=Qa(i,n)).result==="error")return i;const o=i.value.expression,c=qa(o);if(!c&&!Ka(n))return Qs([new fo("","data expressions not supported")]);const h=Js(o,["zoom","pitch","distance-from-center"]);if(!h&&!Lu(n))return Qs([new fo("","zoom expressions not supported")]);const p=ju(o);return p||h?p instanceof fo?Qs([p]):p instanceof mo&&!zu(n)?Qs([new fo("",'"interpolate" expressions cannot be used with this property')]):Xm(p?new wc(c?"camera":"composite",i.value,p.labels,p instanceof mo?p.interpolation:void 0):new Qd(c?"constant":"source",i.value)):Qs([new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Nu{constructor(n,o){this._parameters=n,this._specification=o,Fo(this,Ou(this._parameters,this._specification))}static deserialize(n){return new Nu(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function ju(i){let n=null;if(i instanceof Um)n=ju(i.result);else if(i instanceof Zd){for(const o of i.args)if(n=ju(o),n)break}else(i instanceof jd||i instanceof mo)&&i.input instanceof Uo&&i.input.name==="zoom"&&(n=i);return n instanceof fo||i.eachChild(o=>{const c=ju(o);c instanceof fo?n=c:!n&&c?n=new fo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&c&&n!==c&&(n=new fo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}class dt{constructor(n,o,c,h){this.message=(n?`${n}: `:"")+c,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)}}function Gi(i){const n=i.key,o=i.value,c=i.valueSpec||{},h=i.objectElementValidators||{},p=i.style,_=i.styleSpec;let v=[];const b=Qt(o);if(b!=="object")return[new dt(n,o,`object expected, ${b} found`)];for(const E in o){const C=E.split(".")[0];let P;h[C]?P=h[C]:c[C]?P=Br:h["*"]?P=h["*"]:c["*"]&&(P=Br),P?v=v.concat(P({key:(n&&`${n}.`)+E,value:o[E],valueSpec:c[C]||c["*"],style:p,styleSpec:_,object:o,objectKey:E},o)):v.push(new dt(n,o[E],`unknown property "${E}"`))}for(const E in c)h[E]||c[E].required&&c[E].default===void 0&&o[E]===void 0&&v.push(new dt(n,o,`missing required property "${E}"`));return v}function Qm(i){const n=i.value,o=i.valueSpec,c=i.style,h=i.styleSpec,p=i.key,_=i.arrayElementValidator||Br;if(Qt(n)!=="array")return[new dt(p,n,`array expected, ${Qt(n)} found`)];if(o.length&&n.length!==o.length)return[new dt(p,n,`array length ${o.length} expected, length ${n.length} found`)];if(o["min-length"]&&n.length<o["min-length"])return[new dt(p,n,`array length at least ${o["min-length"]} expected, length ${n.length} found`)];let v={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};h.$version<7&&(v.function=o.function),Qt(o.value)==="object"&&(v=o.value);let b=[];for(let E=0;E<n.length;E++)b=b.concat(_({array:n,arrayIndex:E,value:n[E],valueSpec:v,style:c,styleSpec:h,key:`${p}[${E}]`}));return b}function Ec(i){const n=i.key,o=i.value,c=i.valueSpec;let h=Qt(o);if(h==="number"&&o!=o&&(h="NaN"),h!=="number")return[new dt(n,o,`number expected, ${h} found`)];if("minimum"in c){let p=c.minimum;if(Qt(c.minimum)==="array"&&(p=c.minimum[i.arrayIndex]),o<p)return[new dt(n,o,`${o} is less than the minimum value ${p}`)]}if("maximum"in c){let p=c.maximum;if(Qt(c.maximum)==="array"&&(p=c.maximum[i.arrayIndex]),o>p)return[new dt(n,o,`${o} is greater than the maximum value ${p}`)]}return[]}function Tc(i){const n=i.valueSpec,o=Jn(i.value.type);let c,h,p,_={};const v=o!=="categorical"&&i.value.property===void 0,b=!v,E=Qt(i.value.stops)==="array"&&Qt(i.value.stops[0])==="array"&&Qt(i.value.stops[0][0])==="object",C=Gi({key:i.key,value:i.value,valueSpec:i.styleSpec.function,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(o==="identity")return[new dt(L.key,L.value,'identity function may not have a "stops" property')];let z=[];const N=L.value;return z=z.concat(Qm({key:L.key,value:N,valueSpec:L.valueSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:P})),Qt(N)==="array"&&N.length===0&&z.push(new dt(L.key,N,"array must have at least one stop")),z},default:function(L){return Br({key:L.key,value:L.value,valueSpec:n,style:L.style,styleSpec:L.styleSpec})}}});return o==="identity"&&v&&C.push(new dt(i.key,i.value,'missing required property "property"')),o==="identity"||i.value.stops||C.push(new dt(i.key,i.value,'missing required property "stops"')),o==="exponential"&&i.valueSpec.expression&&!zu(i.valueSpec)&&C.push(new dt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(b&&!Ka(i.valueSpec)?C.push(new dt(i.key,i.value,"property functions not supported")):v&&!Lu(i.valueSpec)&&C.push(new dt(i.key,i.value,"zoom functions not supported"))),o!=="categorical"&&!E||i.value.property!==void 0||C.push(new dt(i.key,i.value,'"property" property is required')),C;function P(L){let z=[];const N=L.value,q=L.key;if(Qt(N)!=="array")return[new dt(q,N,`array expected, ${Qt(N)} found`)];if(N.length!==2)return[new dt(q,N,`array length 2 expected, length ${N.length} found`)];if(E){if(Qt(N[0])!=="object")return[new dt(q,N,`object expected, ${Qt(N[0])} found`)];if(N[0].zoom===void 0)return[new dt(q,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new dt(q,N,"object stop key must have value")];const ee=Jn(N[0].zoom);if(typeof ee!="number")return[new dt(q,N[0].zoom,"stop zoom values must be numbers")];if(p&&p>ee)return[new dt(q,N[0].zoom,"stop zoom values must appear in ascending order")];ee!==p&&(p=ee,h=void 0,_={}),z=z.concat(Gi({key:`${q}[0]`,value:N[0],valueSpec:{zoom:{}},style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:Ec,value:M}}))}else z=z.concat(M({key:`${q}[0]`,value:N[0],valueSpec:{},style:L.style,styleSpec:L.styleSpec},N));return Ya(wr(N[1]))?z.concat([new dt(`${q}[1]`,N[1],"expressions are not allowed in function stops.")]):z.concat(Br({key:`${q}[1]`,value:N[1],valueSpec:n,style:L.style,styleSpec:L.styleSpec}))}function M(L,z){const N=Qt(L.value),q=Jn(L.value),ee=L.value!==null?L.value:z;if(c){if(N!==c)return[new dt(L.key,ee,`${N} stop domain type must match previous stop domain type ${c}`)]}else c=N;if(N!=="number"&&N!=="string"&&N!=="boolean"&&typeof q!="number"&&typeof q!="string"&&typeof q!="boolean")return[new dt(L.key,ee,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&o!=="categorical"){let de=`number expected, ${N} found`;return Ka(n)&&o===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new dt(L.key,ee,de)]}return o!=="categorical"||N!=="number"||typeof q=="number"&&isFinite(q)&&Math.floor(q)===q?o!=="categorical"&&N==="number"&&typeof q=="number"&&typeof h=="number"&&h!==void 0&&q<h?[new dt(L.key,ee,"stop domain values must appear in ascending order")]:(h=q,o==="categorical"&&q in _?[new dt(L.key,ee,"stop domain values must be unique")]:(_[q]=!0,[])):[new dt(L.key,ee,`integer expected, found ${String(q)}`)]}}function br(i){const n=(i.expressionContext==="property"?bc:Qa)(wr(i.value),i.valueSpec);if(n.result==="error")return n.value.map(c=>new dt(`${i.key}${c.key}`,i.value,c.message));const o=n.value.expression||n.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!o.outputDefined())return[new dt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!$o(o))return[new dt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter")return Sc(o,i);if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Js(o,["zoom","feature-state"]))return[new dt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!qa(o))return[new dt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sc(i,n){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const h of n.valueSpec.expression.parameters)o.delete(h);if(o.size===0)return[];const c=[];return i instanceof Uo&&o.has(i.name)?[new dt(n.key,n.value,`["${i.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(i.eachChild(h=>{c.push(...Sc(h,n))}),c)}function Uu(i){const n=i.key,o=i.value,c=i.valueSpec,h=[];return Array.isArray(c.values)?c.values.indexOf(Jn(o))===-1&&h.push(new dt(n,o,`expected one of [${c.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(c.values).indexOf(Jn(o))===-1&&h.push(new dt(n,o,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(o)} found`)),h}function ef(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const n of i.slice(1))if(!ef(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function Vu(i,n="fill"){if(i==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ef(i)||(i=tl(i));const o=i;let c=!0;try{c=function(E){if(!el(E))return E;let C=wr(E);return $u(C),C=eg(C),C}(o)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(o,null,2)}
        `)}const h=Be[`filter_${n}`],p=Qa(c,h);let _=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));_=(E,C,P)=>p.value.evaluate(E,C,{},P);let v=null,b=null;if(c!==o){const E=Qa(o,h);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));v=(C,P,M,L,z)=>E.value.evaluate(C,P,{},M,void 0,void 0,L,z),b=!qa(E.value.expression)}return{filter:_,dynamicFilter:v||void 0,needGeometry:tg(c),needFeature:!!b}}function eg(i){if(!Array.isArray(i))return i;const n=function(o){if(tf.has(o[0])){for(let c=1;c<o.length;c++)if(el(o[c]))return!0}return o}(i);return n===!0?n:n.map(o=>eg(o))}function $u(i){let n=!1;const o=[];if(i[0]==="case"){for(let c=1;c<i.length-1;c+=2)n=n||el(i[c]),o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="match"){n=n||el(i[1]);for(let c=2;c<i.length-1;c+=2)o.push(i[c+1]);o.push(i[i.length-1])}else if(i[0]==="step"){n=n||el(i[1]);for(let c=1;c<i.length-1;c+=2)o.push(i[c+1])}n&&(i.length=0,i.push("any",...o));for(let c=1;c<i.length;c++)$u(i[c])}function el(i){if(!Array.isArray(i))return!1;if((n=i[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let o=1;o<i.length;o++)if(el(i[o]))return!0;return!1}const tf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Lv(i,n){return i<n?-1:i>n?1:0}function tg(i){if(!Array.isArray(i))return!1;if(i[0]==="within")return!0;for(let n=1;n<i.length;n++)if(tg(i[n]))return!0;return!1}function tl(i){if(!i)return!0;const n=i[0];return i.length<=1?n!=="any":n==="=="?nf(i[1],i[2],"=="):n==="!="?Gu(nf(i[1],i[2],"==")):n==="<"||n===">"||n==="<="||n===">="?nf(i[1],i[2],n):n==="any"?(o=i.slice(1),["any"].concat(o.map(tl))):n==="all"?["all"].concat(i.slice(1).map(tl)):n==="none"?["all"].concat(i.slice(1).map(tl).map(Gu)):n==="in"?rf(i[1],i.slice(2)):n==="!in"?Gu(rf(i[1],i.slice(2))):n==="has"?of(i[1]):n==="!has"?Gu(of(i[1])):n!=="within"||i;var o}function nf(i,n,o){switch(i){case"$type":return[`filter-type-${o}`,n];case"$id":return[`filter-id-${o}`,n];default:return[`filter-${o}`,i,n]}}function rf(i,n){if(n.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(o=>typeof o!=typeof n[0])?["filter-in-large",i,["literal",n.sort(Lv)]]:["filter-in-small",i,["literal",n]]}}function of(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Gu(i){return["!",i]}function Ic(i){return ef(wr(i.value))?br(Fo({},i,{expressionContext:"filter",valueSpec:i.styleSpec[`filter_${i.layerType||"fill"}`]})):Cc(i)}function Cc(i){const n=i.value,o=i.key;if(Qt(n)!=="array")return[new dt(o,n,`array expected, ${Qt(n)} found`)];const c=i.styleSpec;let h,p=[];if(n.length<1)return[new dt(o,n,"filter array must have at least 1 element")];switch(p=p.concat(Uu({key:`${o}[0]`,value:n[0],valueSpec:c.filter_operator,style:i.style,styleSpec:i.styleSpec})),Jn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&Jn(n[1])==="$type"&&p.push(new dt(o,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&p.push(new dt(o,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(h=Qt(n[1]),h!=="string"&&p.push(new dt(`${o}[1]`,n[1],`string expected, ${h} found`)));for(let _=2;_<n.length;_++)h=Qt(n[_]),Jn(n[1])==="$type"?p=p.concat(Uu({key:`${o}[${_}]`,value:n[_],valueSpec:c.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new dt(`${o}[${_}]`,n[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)p=p.concat(Cc({key:`${o}[${_}]`,value:n[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Qt(n[1]),n.length!==2?p.push(new dt(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new dt(`${o}[1]`,n[1],`string expected, ${h} found`));break;case"within":h=Qt(n[1]),n.length!==2?p.push(new dt(o,n,`filter array for "${n[0]}" operator must have 2 elements`)):h!=="object"&&p.push(new dt(`${o}[1]`,n[1],`object expected, ${h} found`))}return p}function sf(i,n){const o=i.key,c=i.style,h=i.styleSpec,p=i.value,_=i.objectKey,v=h[`${n}_${i.layerType}`];if(!v)return[];const b=_.match(/^(.*)-transition$/);if(n==="paint"&&b&&v[b[1]]&&v[b[1]].transition)return Br({key:o,value:p,valueSpec:h.transition,style:c,styleSpec:h});const E=i.valueSpec||v[_];if(!E)return[new dt(o,p,`unknown property "${_}"`)];let C;if(Qt(p)==="string"&&Ka(E)&&!E.tokens&&(C=/^{([^}]+)}$/.exec(p))){const M=`\`{ "type": "identity", "property": ${C?JSON.stringify(C[1]):'"_"'} }\``;return[new dt(o,p,`"${_}" does not support interpolation syntax
Use an identity property function instead: ${M}.`)]}const P=[];return i.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&P.push(new dt(o,p,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&xc(wr(p))&&Jn(p.type)==="identity"&&P.push(new dt(o,p,'"text-font" does not support identity functions'))),P.concat(Br({key:i.key,value:p,valueSpec:E,style:c,styleSpec:h,expressionContext:"property",propertyType:n,propertyKey:_}))}function ng(i){return sf(i,"paint")}function af(i){return sf(i,"layout")}function rg(i){let n=[];const o=i.value,c=i.key,h=i.style,p=i.styleSpec;o.type||o.ref||n.push(new dt(c,o,'either "type" or "ref" is required'));let _=Jn(o.type);const v=Jn(o.ref);if(o.id){const b=Jn(o.id);for(let E=0;E<i.arrayIndex;E++){const C=h.layers[E];Jn(C.id)===b&&n.push(new dt(c,o.id,`duplicate layer id "${o.id}", previously used at line ${C.id.__line__}`))}}if("ref"in o){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in o&&n.push(new dt(c,o[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{Jn(E.id)===v&&(b=E)}),b?b.ref?n.push(new dt(c,o.ref,"ref cannot reference another ref layer")):_=Jn(b.type):typeof v=="string"&&n.push(new dt(c,o.ref,`ref layer "${v}" not found`))}else if(_!=="background"&&_!=="sky")if(o.source){const b=h.sources&&h.sources[o.source],E=b&&Jn(b.type);b?E==="vector"&&_==="raster"?n.push(new dt(c,o.source,`layer "${o.id}" requires a raster source`)):E==="raster"&&_!=="raster"?n.push(new dt(c,o.source,`layer "${o.id}" requires a vector source`)):E!=="vector"||o["source-layer"]?E==="raster-dem"&&_!=="hillshade"?n.push(new dt(c,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!o.paint||!o.paint["line-gradient"]&&!o.paint["line-trim-offset"]||E==="geojson"&&b.lineMetrics||n.push(new dt(c,o,`layer "${o.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new dt(c,o,`layer "${o.id}" must specify a "source-layer"`)):n.push(new dt(c,o.source,`source "${o.source}" not found`))}else n.push(new dt(c,o,'missing required property "source"'));return n=n.concat(Gi({key:c,value:o,valueSpec:p.layer,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Br({key:`${c}.type`,value:o.type,valueSpec:p.layer.type,style:i.style,styleSpec:i.styleSpec,object:o,objectKey:"type"}),filter:b=>Ic(Fo({layerType:_},b)),layout:b=>Gi({layer:o,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>af(Fo({layerType:_},E))}}),paint:b=>Gi({layer:o,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>ng(Fo({layerType:_},E))}})}})),n}function _s(i){const n=i.value,o=i.key,c=Qt(n);return c!=="string"?[new dt(o,n,`string expected, ${c} found`)]:[]}const ig={promoteId:function({key:i,value:n}){if(Qt(n)==="string")return _s({key:i,value:n});{const o=[];for(const c in n)o.push(..._s({key:`${i}.${c}`,value:n[c]}));return o}}};function og(i){const n=i.value,o=i.key,c=i.styleSpec,h=i.style;if(!n.type)return[new dt(o,n,'"type" is required')];const p=Jn(n.type);let _;switch(p){case"vector":case"raster":case"raster-dem":return _=Gi({key:o,value:n,valueSpec:c[`source_${p.replace("-","_")}`],style:i.style,styleSpec:c,objectElementValidators:ig}),_;case"geojson":if(_=Gi({key:o,value:n,valueSpec:c.source_geojson,style:h,styleSpec:c,objectElementValidators:ig}),n.cluster)for(const v in n.clusterProperties){const[b,E]=n.clusterProperties[v],C=typeof b=="string"?[b,["accumulated"],["get",v]]:b;_.push(...br({key:`${o}.${v}.map`,value:E,expressionContext:"cluster-map"})),_.push(...br({key:`${o}.${v}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return _;case"video":return Gi({key:o,value:n,valueSpec:c.source_video,style:h,styleSpec:c});case"image":return Gi({key:o,value:n,valueSpec:c.source_image,style:h,styleSpec:c});case"canvas":return[new dt(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Uu({key:`${o}.type`,value:n.type,valueSpec:{values:zv(c)},style:h,styleSpec:c})}}function zv(i){return i.source.reduce((n,o)=>{const c=i[o];return c.type.type==="enum"&&(n=n.concat(Object.keys(c.type.values))),n},[])}function sg(i){const n=i.value,o=i.styleSpec,c=o.light,h=i.style;let p=[];const _=Qt(n);if(n===void 0)return p;if(_!=="object")return p=p.concat([new dt("light",n,`object expected, ${_} found`)]),p;for(const v in n){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&c[b[1]]&&c[b[1]].transition?Br({key:v,value:n[v],valueSpec:o.transition,style:h,styleSpec:o}):c[v]?Br({key:v,value:n[v],valueSpec:c[v],style:h,styleSpec:o}):[new dt(v,n[v],`unknown property "${v}"`)])}return p}function lf(i){const n=i.value,o=i.key,c=i.style,h=i.styleSpec,p=h.terrain;let _=[];const v=Qt(n);if(n===void 0)return _;if(v!=="object")return _=_.concat([new dt("terrain",n,`object expected, ${v} found`)]),_;for(const b in n){const E=b.match(/^(.*)-transition$/);_=_.concat(E&&p[E[1]]&&p[E[1]].transition?Br({key:b,value:n[b],valueSpec:h.transition,style:c,styleSpec:h}):p[b]?Br({key:b,value:n[b],valueSpec:p[b],style:c,styleSpec:h}):[new dt(b,n[b],`unknown property "${b}"`)])}if(n.source){const b=c.sources&&c.sources[n.source],E=b&&Jn(b.type);b?E!=="raster-dem"&&_.push(new dt(o,n.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):_.push(new dt(o,n.source,`source "${n.source}" not found`))}else _.push(new dt(o,n,'terrain is missing required property "source"'));return _}function ag(i){const n=i.value,o=i.style,c=i.styleSpec,h=c.fog;let p=[];const _=Qt(n);if(n===void 0)return p;if(_!=="object")return p=p.concat([new dt("fog",n,`object expected, ${_} found`)]),p;for(const v in n){const b=v.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?Br({key:v,value:n[v],valueSpec:c.transition,style:o,styleSpec:c}):h[v]?Br({key:v,value:n[v],valueSpec:h[v],style:o,styleSpec:c}):[new dt(v,n[v],`unknown property "${v}"`)])}return p}const lg={"*":()=>[],array:Qm,boolean:function(i){const n=i.value,o=i.key,c=Qt(n);return c!=="boolean"?[new dt(o,n,`boolean expected, ${c} found`)]:[]},number:Ec,color:function(i){const n=i.key,o=i.value,c=Qt(o);return c!=="string"?[new dt(n,o,`color expected, ${c} found`)]:Sd(o)===null?[new dt(n,o,`color expected, "${o}" found`)]:[]},enum:Uu,filter:Ic,function:Tc,layer:rg,object:Gi,source:og,light:sg,terrain:lf,fog:ag,string:_s,formatted:function(i){return _s(i).length===0?[]:br(i)},resolvedImage:function(i){return _s(i).length===0?[]:br(i)},projection:function(i){const n=i.value,o=i.styleSpec,c=o.projection,h=i.style;let p=[];const _=Qt(n);if(_==="object")for(const v in n)p=p.concat(Br({key:v,value:n[v],valueSpec:c[v],style:h,styleSpec:o}));else _!=="string"&&(p=p.concat([new dt("projection",n,`object or string expected, ${_} found`)]));return p}};function Br(i){const n=i.value,o=i.valueSpec,c=i.styleSpec;return o.expression&&xc(Jn(n))?Tc(i):o.expression&&Ya(wr(n))?br(i):o.type&&lg[o.type]?lg[o.type](i):Gi(Fo({},i,{valueSpec:o.type?c[o.type]:o}))}function Ov(i){const n=i.value,o=i.key,c=_s(i);return c.length||(n.indexOf("{fontstack}")===-1&&c.push(new dt(o,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&c.push(new dt(o,n,'"glyphs" url must include a "{range}" token'))),c}function cg(i,n=Be){return Ci(Br({key:"",value:i,valueSpec:n.$root,styleSpec:n,style:i,objectElementValidators:{glyphs:Ov,"*":()=>[]}}))}const Bv=i=>Ci(ng(i)),Fv=i=>Ci(af(i));function Ci(i){return i.slice().sort((n,o)=>n.line&&o.line?n.line-o.line:0)}function ug(i,n){let o=!1;if(n&&n.length)for(const c of n)i.fire(new Bo(new Error(c.message))),o=!0;return o}var Nv=go,Wi=3;function go(i,n,o){var c=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(n=h[1])+2*(o=h[2]);for(var p=0;p<this.d*this.d;p++){var _=h[Wi+p],v=h[Wi+p+1];c.push(_===v?null:h.subarray(_,v))}var b=h[Wi+c.length+1];this.keys=h.subarray(h[Wi+c.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=n+2*o;for(var E=0;E<this.d*this.d;E++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=i,this.padding=o,this.scale=n/i,this.uid=0;var C=o/n*i;this.min=-C,this.max=i+C}go.prototype.insert=function(i,n,o,c,h){this._forEachCell(n,o,c,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(h)},go.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},go.prototype._insertCell=function(i,n,o,c,h,p){this.cells[h].push(p)},go.prototype.query=function(i,n,o,c,h){var p=this.min,_=this.max;if(i<=p&&n<=p&&_<=o&&_<=c&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,n,o,c,this._queryCell,v,{},h),v},go.prototype._queryCell=function(i,n,o,c,h,p,_,v){var b=this.cells[h];if(b!==null)for(var E=this.keys,C=this.bboxes,P=0;P<b.length;P++){var M=b[P];if(_[M]===void 0){var L=4*M;(v?v(C[L+0],C[L+1],C[L+2],C[L+3]):i<=C[L+2]&&n<=C[L+3]&&o>=C[L+0]&&c>=C[L+1])?(_[M]=!0,p.push(E[M])):_[M]=!1}}},go.prototype._forEachCell=function(i,n,o,c,h,p,_,v){for(var b=this._convertToCellCoord(i),E=this._convertToCellCoord(n),C=this._convertToCellCoord(o),P=this._convertToCellCoord(c),M=b;M<=C;M++)for(var L=E;L<=P;L++){var z=this.d*L+M;if((!v||v(this._convertFromCellCoord(M),this._convertFromCellCoord(L),this._convertFromCellCoord(M+1),this._convertFromCellCoord(L+1)))&&h.call(this,i,n,o,c,z,p,_,v))return}},go.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},go.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},go.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,n=Wi+this.cells.length+1+1,o=0,c=0;c<this.cells.length;c++)o+=this.cells[c].length;var h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=n,_=0;_<i.length;_++){var v=i[_];h[Wi+_]=p,h.set(v,p),p+=v.length}return h[Wi+i.length]=p,h.set(this.keys,p),h[Wi+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var ea=Te(Nv);const Wu={};function ft(i,n,o={}){Object.defineProperty(i,"_classRegistryKey",{value:n,writeable:!1}),Wu[n]={klass:i,omit:o.omit||[]}}ft(Object,"Object"),ea.serialize=function(i,n){const o=i.toArrayBuffer();return n&&n.push(o),{buffer:o}},ea.deserialize=function(i){return new ea(i.buffer)},Object.defineProperty(ea,"name",{value:"Grid"}),ft(ea,"Grid"),ft($n,"Color"),ft(Error,"Error"),ft(ms,"AJAXError"),ft(Si,"ResolvedImage"),ft(Nu,"StylePropertyFunction"),ft(Fu,"StyleExpression",{omit:["_evaluator"]}),ft(wc,"ZoomDependentExpression"),ft(Qd,"ZoomConstantExpression"),ft(Uo,"CompoundExpression",{omit:["_evaluate"]});for(const i in vc)Wu[vc[i]._classRegistryKey]||ft(vc[i],`Expression${i}`);function cf(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function uf(i){return k.ImageBitmap&&i instanceof k.ImageBitmap}function nl(i,n){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp)return i;if(cf(i)||uf(i))return n&&n.push(i),i;if(ArrayBuffer.isView(i)){const o=i;return n&&n.push(o.buffer),o}if(i instanceof k.ImageData)return n&&n.push(i.data.buffer),i;if(Array.isArray(i)){const o=[];for(const c of i)o.push(nl(c,n));return o}if(typeof i=="object"){const o=i.constructor,c=o._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const h=o.serialize?o.serialize(i,n):{};if(!o.serialize){for(const p in i)i.hasOwnProperty(p)&&(Wu[c].omit.indexOf(p)>=0||(h[p]=nl(i[p],n)));i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(h.$name=c),h}throw new Error("can't serialize object of type "+typeof i)}function ta(i){if(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||cf(i)||uf(i)||ArrayBuffer.isView(i)||i instanceof k.ImageData)return i;if(Array.isArray(i))return i.map(ta);if(typeof i=="object"){const n=i.$name||"Object",{klass:o}=Wu[n];if(!o)throw new Error(`can't deserialize unregistered class ${n}`);if(o.deserialize)return o.deserialize(i);const c=Object.create(o.prototype);for(const h of Object.keys(i))h!=="$name"&&(c[h]=ta(i[h]));return c}throw new Error("can't deserialize object of type "+typeof i)}const ut={"Latin-1 Supplement":i=>i>=128&&i<=255,Arabic:i=>i>=1536&&i<=1791,"Arabic Supplement":i=>i>=1872&&i<=1919,"Arabic Extended-A":i=>i>=2208&&i<=2303,"Hangul Jamo":i=>i>=4352&&i<=4607,"Unified Canadian Aboriginal Syllabics":i=>i>=5120&&i<=5759,Khmer:i=>i>=6016&&i<=6143,"Unified Canadian Aboriginal Syllabics Extended":i=>i>=6320&&i<=6399,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"CJK Radicals Supplement":i=>i>=11904&&i<=12031,"Kangxi Radicals":i=>i>=12032&&i<=12255,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Bopomofo:i=>i>=12544&&i<=12591,"Hangul Compatibility Jamo":i=>i>=12592&&i<=12687,Kanbun:i=>i>=12688&&i<=12703,"Bopomofo Extended":i=>i>=12704&&i<=12735,"CJK Strokes":i=>i>=12736&&i<=12783,"Katakana Phonetic Extensions":i=>i>=12784&&i<=12799,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"CJK Unified Ideographs Extension A":i=>i>=13312&&i<=19903,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Yi Syllables":i=>i>=40960&&i<=42127,"Yi Radicals":i=>i>=42128&&i<=42191,"Hangul Jamo Extended-A":i=>i>=43360&&i<=43391,"Hangul Syllables":i=>i>=44032&&i<=55215,"Hangul Jamo Extended-B":i=>i>=55216&&i<=55295,"Private Use Area":i=>i>=57344&&i<=63743,"CJK Compatibility Ideographs":i=>i>=63744&&i<=64255,"Arabic Presentation Forms-A":i=>i>=64336&&i<=65023,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Arabic Presentation Forms-B":i=>i>=65136&&i<=65279,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function hf(i){for(const n of i)if(df(n.charCodeAt(0)))return!0;return!1}function jv(i){for(const n of i)if(!hg(n.charCodeAt(0)))return!1;return!0}function hg(i){return!(ut.Arabic(i)||ut["Arabic Supplement"](i)||ut["Arabic Extended-A"](i)||ut["Arabic Presentation Forms-A"](i)||ut["Arabic Presentation Forms-B"](i))}function df(i){return!(i!==746&&i!==747&&(i<4352||!(ut["Bopomofo Extended"](i)||ut.Bopomofo(i)||ut["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||ut["CJK Compatibility Ideographs"](i)||ut["CJK Compatibility"](i)||ut["CJK Radicals Supplement"](i)||ut["CJK Strokes"](i)||!(!ut["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||ut["CJK Unified Ideographs Extension A"](i)||ut["CJK Unified Ideographs"](i)||ut["Enclosed CJK Letters and Months"](i)||ut["Hangul Compatibility Jamo"](i)||ut["Hangul Jamo Extended-A"](i)||ut["Hangul Jamo Extended-B"](i)||ut["Hangul Jamo"](i)||ut["Hangul Syllables"](i)||ut.Hiragana(i)||ut["Ideographic Description Characters"](i)||ut.Kanbun(i)||ut["Kangxi Radicals"](i)||ut["Katakana Phonetic Extensions"](i)||ut.Katakana(i)&&i!==12540||!(!ut["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!ut["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||ut["Unified Canadian Aboriginal Syllabics"](i)||ut["Unified Canadian Aboriginal Syllabics Extended"](i)||ut["Vertical Forms"](i)||ut["Yijing Hexagram Symbols"](i)||ut["Yi Syllables"](i)||ut["Yi Radicals"](i))))}function dg(i){return!(df(i)||function(n){return!!(ut["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||ut["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||ut["Letterlike Symbols"](n)||ut["Number Forms"](n)||ut["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||ut["Control Pictures"](n)&&n!==9251||ut["Optical Character Recognition"](n)||ut["Enclosed Alphanumerics"](n)||ut["Geometric Shapes"](n)||ut["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||ut["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||ut["CJK Symbols and Punctuation"](n)||ut.Katakana(n)||ut["Private Use Area"](n)||ut["CJK Compatibility Forms"](n)||ut["Small Form Variants"](n)||ut["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(i))}function fg(i){return i>=1424&&i<=2303||ut["Arabic Presentation Forms-A"](i)||ut["Arabic Presentation Forms-B"](i)}function Uv(i,n){return!(!n&&fg(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||ut.Khmer(i))}function Vv(i){for(const n of i)if(fg(n.charCodeAt(0)))return!0;return!1}const ff="deferred",pf="loading",mf="loaded";let rl=null,f="unavailable",s=null;const u=function(i){i&&typeof i=="string"&&i.indexOf("NetworkError")>-1&&(f="error"),rl&&rl(i)};function m(){y.fire(new Hs("pluginStateChange",{pluginStatus:f,pluginURL:s}))}const y=new rc,x=function(){return f},T=function(){if(f!==ff||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");f=pf,m(),s&&Fa({url:s},i=>{i?u(i):(f=mf,m())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>f===mf||S.applyArabicShaping!=null,isLoading:()=>f===pf,setState(i){f=i.pluginStatus,s=i.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>s};class A{constructor(n,o){this.zoom=n,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.transition=o.transition,this.pitch=o.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(n){return function(o,c){for(const h of o)if(!Uv(h.charCodeAt(0),c))return!1;return!0}(n,S.isLoaded())}}class D{constructor(n,o){this.property=n,this.value=o,this.expression=function(c,h){if(xc(c))return new Nu(c,h);if(Ya(c)){const p=bc(c,h);if(p.result==="error")throw new Error(p.value.map(_=>`${_.key}: ${_.message}`).join(", "));return p.value}{let p=c;return typeof c=="string"&&h.type==="color"&&(p=$n.parse(c)),{kind:"constant",evaluate:()=>p}}}(o===void 0?n.specification.default:o,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,o,c){return this.property.possiblyEvaluate(this,n,o,c)}}class R{constructor(n){this.property=n,this.value=new D(n,void 0)}transitioned(n,o){return new W(this.property,this.value,o,Yt({},n.transition,this.transition),n.now)}untransitioned(){return new W(this.property,this.value,null,{},0)}}class B{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Gr(this._values[n].value.value)}setValue(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new R(this._values[n].property)),this._values[n].value=new D(this._values[n].property,o===null?void 0:Gr(o))}getTransition(n){return Gr(this._values[n].transition)}setTransition(n,o){this._values.hasOwnProperty(n)||(this._values[n]=new R(this._values[n].property)),this._values[n].transition=Gr(o)||void 0}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c);const h=this.getTransition(o);h!==void 0&&(n[`${o}-transition`]=h)}return n}transitioned(n,o){const c=new Z(this._properties);for(const h of Object.keys(this._values))c._values[h]=this._values[h].transitioned(n,o._values[h]);return c}untransitioned(){const n=new Z(this._properties);for(const o of Object.keys(this._values))n._values[o]=this._values[o].untransitioned();return n}}class W{constructor(n,o,c,h,p){const _=h.delay||0,v=h.duration||0;p=p||0,this.property=n,this.value=o,this.begin=p+_,this.end=this.begin+v,n.specification.transition&&(h.delay||h.duration)&&(this.prior=c)}possiblyEvaluate(n,o,c){const h=n.now||0,p=this.value.possiblyEvaluate(n,o,c),_=this.prior;if(_){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return _.possiblyEvaluate(n,o,c);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,o,c),p,Dn(v))}}return p}}class Z{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,o,c){const h=new Q(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,c);return h}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Y{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Gr(this._values[n].value)}setValue(n,o){this._values[n]=new D(this._values[n].property,o===null?void 0:Gr(o))}serialize(){const n={};for(const o of Object.keys(this._values)){const c=this.getValue(o);c!==void 0&&(n[o]=c)}return n}possiblyEvaluate(n,o,c){const h=new Q(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(n,o,c);return h}}class K{constructor(n,o,c){this.property=n,this.value=o,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,o,c,h){return this.property.evaluate(this.value,this.parameters,n,o,c,h)}}class Q{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class F{constructor(n){this.specification=n}possiblyEvaluate(n,o){return n.expression.evaluate(o)}interpolate(n,o,c){const h=pc[this.specification.type];return h?h(n,o,c):n}}class H{constructor(n,o){this.specification=n,this.overrides=o}possiblyEvaluate(n,o,c,h){return new K(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(o,null,{},c,h)}:n.expression,o)}interpolate(n,o,c){if(n.value.kind!=="constant"||o.value.kind!=="constant")return n;if(n.value.value===void 0||o.value.value===void 0)return new K(this,{kind:"constant",value:void 0},n.parameters);const h=pc[this.specification.type];return h?new K(this,{kind:"constant",value:h(n.value.value,o.value.value,c)},n.parameters):n}evaluate(n,o,c,h,p,_){return n.kind==="constant"?n.value:n.evaluate(o,c,h,p,_)}}class ie{constructor(n){this.specification=n}possiblyEvaluate(n,o,c,h){return!!n.expression.evaluate(o,null,{},c,h)}interpolate(){return!1}}class se{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const o=new A(0,{});for(const c in n){const h=n[c];h.specification.overridable&&this.overridableProperties.push(c);const p=this.defaultPropertyValues[c]=new D(h,void 0),_=this.defaultTransitionablePropertyValues[c]=new R(h);this.defaultTransitioningPropertyValues[c]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=p.possiblyEvaluate(o)}}}function ge(i,n){return 256*(i=ot(Math.floor(i),0,255))+ot(Math.floor(n),0,255)}ft(H,"DataDrivenProperty"),ft(F,"DataConstantProperty"),ft(ie,"ColorRampProperty");const ye={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _e{constructor(n,o){this._structArray=n,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ee{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,o){return n._trim(),o&&(n.isTransferred=!0,o.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const o=Object.create(this.prototype);return o.arrayBuffer=n.arrayBuffer,o.length=n.length,o.capacity=n.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function be(i,n=1){let o=0,c=0;return{members:i.map(h=>{const p=ye[h.type].BYTES_PER_ELEMENT,_=o=ke(o,Math.max(n,p)),v=h.components||1;return c=Math.max(c,p),o+=p*v,{name:h.name,type:h.type,components:v,offset:_}}),size:ke(o,Math.max(c,n)),alignment:n}}function ke(i,n){return Math.ceil(i/n)*n}class Ke extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const h=2*n;return this.int16[h+0]=o,this.int16[h+1]=c,n}}Ke.prototype.bytesPerElement=4,ft(Ke,"StructArrayLayout2i4");class Ce extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,c)}emplace(n,o,c,h){const p=3*n;return this.int16[p+0]=o,this.int16[p+1]=c,this.int16[p+2]=h,n}}Ce.prototype.bytesPerElement=6,ft(Ce,"StructArrayLayout3i6");class Ue extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c,h)}emplace(n,o,c,h,p){const _=4*n;return this.int16[_+0]=o,this.int16[_+1]=c,this.int16[_+2]=h,this.int16[_+3]=p,n}}Ue.prototype.bytesPerElement=8,ft(Ue,"StructArrayLayout4i8");class Re extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,c,h,p,_,v)}emplace(n,o,c,h,p,_,v,b){const E=6*n,C=12*n,P=3*n;return this.int16[E+0]=o,this.int16[E+1]=c,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=_,this.uint8[C+7]=v,this.float32[P+2]=b,n}}Re.prototype.bytesPerElement=12,ft(Re,"StructArrayLayout2i4ub1f12");class Ze extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c,h)}emplace(n,o,c,h,p){const _=4*n;return this.float32[_+0]=o,this.float32[_+1]=c,this.float32[_+2]=h,this.float32[_+3]=p,n}}Ze.prototype.bytesPerElement=16,ft(Ze,"StructArrayLayout4f16");class Pe extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,h,p)}emplace(n,o,c,h,p,_){const v=6*n,b=3*n;return this.uint16[v+0]=o,this.uint16[v+1]=c,this.uint16[v+2]=h,this.uint16[v+3]=p,this.float32[b+2]=_,n}}Pe.prototype.bytesPerElement=12,ft(Pe,"StructArrayLayout4ui1f12");class je extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c,h)}emplace(n,o,c,h,p){const _=4*n;return this.uint16[_+0]=o,this.uint16[_+1]=c,this.uint16[_+2]=h,this.uint16[_+3]=p,n}}je.prototype.bytesPerElement=8,ft(je,"StructArrayLayout4ui8");class Ye extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,c,h,p,_)}emplace(n,o,c,h,p,_,v){const b=6*n;return this.int16[b+0]=o,this.int16[b+1]=c,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=_,this.int16[b+5]=v,n}}Ye.prototype.bytesPerElement=12,ft(Ye,"StructArrayLayout6i12");class We extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v,b,E,C,P,M){const L=this.length;return this.resize(L+1),this.emplace(L,n,o,c,h,p,_,v,b,E,C,P,M)}emplace(n,o,c,h,p,_,v,b,E,C,P,M,L){const z=12*n;return this.int16[z+0]=o,this.int16[z+1]=c,this.int16[z+2]=h,this.int16[z+3]=p,this.uint16[z+4]=_,this.uint16[z+5]=v,this.uint16[z+6]=b,this.uint16[z+7]=E,this.int16[z+8]=C,this.int16[z+9]=P,this.int16[z+10]=M,this.int16[z+11]=L,n}}We.prototype.bytesPerElement=24,ft(We,"StructArrayLayout4i4ui4i24");class et extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,n,o,c,h,p,_)}emplace(n,o,c,h,p,_,v){const b=10*n,E=5*n;return this.int16[b+0]=o,this.int16[b+1]=c,this.int16[b+2]=h,this.float32[E+2]=p,this.float32[E+3]=_,this.float32[E+4]=v,n}}et.prototype.bytesPerElement=20,ft(et,"StructArrayLayout3i3f20");class xt extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint32[1*n+0]=o,n}}xt.prototype.bytesPerElement=4,ft(xt,"StructArrayLayout1ul4");class At extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v,b,E,C,P,M,L){const z=this.length;return this.resize(z+1),this.emplace(z,n,o,c,h,p,_,v,b,E,C,P,M,L)}emplace(n,o,c,h,p,_,v,b,E,C,P,M,L,z){const N=20*n,q=10*n;return this.int16[N+0]=o,this.int16[N+1]=c,this.int16[N+2]=h,this.int16[N+3]=p,this.int16[N+4]=_,this.float32[q+3]=v,this.float32[q+4]=b,this.float32[q+5]=E,this.float32[q+6]=C,this.int16[N+14]=P,this.uint32[q+8]=M,this.uint16[N+18]=L,this.uint16[N+19]=z,n}}At.prototype.bytesPerElement=40,ft(At,"StructArrayLayout5i4f1i1ul2ui40");class mt extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v){const b=this.length;return this.resize(b+1),this.emplace(b,n,o,c,h,p,_,v)}emplace(n,o,c,h,p,_,v,b){const E=8*n;return this.int16[E+0]=o,this.int16[E+1]=c,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=_,this.int16[E+6]=v,this.int16[E+7]=b,n}}mt.prototype.bytesPerElement=16,ft(mt,"StructArrayLayout3i2i2i16");class St extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,h,p)}emplace(n,o,c,h,p,_){const v=4*n,b=8*n;return this.float32[v+0]=o,this.float32[v+1]=c,this.float32[v+2]=h,this.int16[b+6]=p,this.int16[b+7]=_,n}}St.prototype.bytesPerElement=16,ft(St,"StructArrayLayout2f1f2i16");class Wt extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c,h)}emplace(n,o,c,h,p){const _=12*n,v=3*n;return this.uint8[_+0]=o,this.uint8[_+1]=c,this.float32[v+1]=h,this.float32[v+2]=p,n}}Wt.prototype.bytesPerElement=12,ft(Wt,"StructArrayLayout2ub2f12");class Nt extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,c)}emplace(n,o,c,h){const p=3*n;return this.float32[p+0]=o,this.float32[p+1]=c,this.float32[p+2]=h,n}}Nt.prototype.bytesPerElement=12,ft(Nt,"StructArrayLayout3f12");class yt extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c){const h=this.length;return this.resize(h+1),this.emplace(h,n,o,c)}emplace(n,o,c,h){const p=3*n;return this.uint16[p+0]=o,this.uint16[p+1]=c,this.uint16[p+2]=h,n}}yt.prototype.bytesPerElement=6,ft(yt,"StructArrayLayout3ui6");class ln extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe){const fe=this.length;return this.resize(fe+1),this.emplace(fe,n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe)}emplace(n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe,fe){const Me=30*n,Ae=15*n,Fe=60*n;return this.int16[Me+0]=o,this.int16[Me+1]=c,this.int16[Me+2]=h,this.float32[Ae+2]=p,this.float32[Ae+3]=_,this.uint16[Me+8]=v,this.uint16[Me+9]=b,this.uint32[Ae+5]=E,this.uint32[Ae+6]=C,this.uint32[Ae+7]=P,this.uint16[Me+16]=M,this.uint16[Me+17]=L,this.uint16[Me+18]=z,this.float32[Ae+10]=N,this.float32[Ae+11]=q,this.uint8[Fe+48]=ee,this.uint8[Fe+49]=de,this.uint8[Fe+50]=ne,this.uint32[Ae+13]=ue,this.int16[Me+28]=pe,this.uint8[Fe+58]=fe,n}}ln.prototype.bytesPerElement=60,ft(ln,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class fn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe,fe,Me,Ae,Fe,Je,De,Ve,$e,He){const nt=this.length;return this.resize(nt+1),this.emplace(nt,n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe,fe,Me,Ae,Fe,Je,De,Ve,$e,He)}emplace(n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q,ee,de,ne,ue,pe,fe,Me,Ae,Fe,Je,De,Ve,$e,He,nt){const Oe=38*n,lt=19*n;return this.int16[Oe+0]=o,this.int16[Oe+1]=c,this.int16[Oe+2]=h,this.float32[lt+2]=p,this.float32[lt+3]=_,this.int16[Oe+8]=v,this.int16[Oe+9]=b,this.int16[Oe+10]=E,this.int16[Oe+11]=C,this.int16[Oe+12]=P,this.int16[Oe+13]=M,this.uint16[Oe+14]=L,this.uint16[Oe+15]=z,this.uint16[Oe+16]=N,this.uint16[Oe+17]=q,this.uint16[Oe+18]=ee,this.uint16[Oe+19]=de,this.uint16[Oe+20]=ne,this.uint16[Oe+21]=ue,this.uint16[Oe+22]=pe,this.uint16[Oe+23]=fe,this.uint16[Oe+24]=Me,this.uint16[Oe+25]=Ae,this.uint16[Oe+26]=Fe,this.uint16[Oe+27]=Je,this.uint16[Oe+28]=De,this.uint32[lt+15]=Ve,this.float32[lt+16]=$e,this.float32[lt+17]=He,this.float32[lt+18]=nt,n}}fn.prototype.bytesPerElement=76,ft(fn,"StructArrayLayout3i2f6i15ui1ul3f76");class pn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.float32[1*n+0]=o,n}}pn.prototype.bytesPerElement=4,ft(pn,"StructArrayLayout1f4");class mn extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o,c,h,p){const _=this.length;return this.resize(_+1),this.emplace(_,n,o,c,h,p)}emplace(n,o,c,h,p,_){const v=5*n;return this.float32[v+0]=o,this.float32[v+1]=c,this.float32[v+2]=h,this.float32[v+3]=p,this.float32[v+4]=_,n}}mn.prototype.bytesPerElement=20,ft(mn,"StructArrayLayout5f20");class Fr extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o,c,h){const p=this.length;return this.resize(p+1),this.emplace(p,n,o,c,h)}emplace(n,o,c,h,p){const _=6*n;return this.uint32[3*n+0]=o,this.uint16[_+2]=c,this.uint16[_+3]=h,this.uint16[_+4]=p,n}}Fr.prototype.bytesPerElement=12,ft(Fr,"StructArrayLayout1ul3ui12");class Er extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const h=2*n;return this.uint16[h+0]=o,this.uint16[h+1]=c,n}}Er.prototype.bytesPerElement=4,ft(Er,"StructArrayLayout2ui4");class Ai extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const o=this.length;return this.resize(o+1),this.emplace(o,n)}emplace(n,o){return this.uint16[1*n+0]=o,n}}Ai.prototype.bytesPerElement=2,ft(Ai,"StructArrayLayout1ui2");class _o extends Ee{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,o){const c=this.length;return this.resize(c+1),this.emplace(c,n,o)}emplace(n,o,c){const h=2*n;return this.float32[h+0]=o,this.float32[h+1]=c,n}}_o.prototype.bytesPerElement=8,ft(_o,"StructArrayLayout2f8");class Rn extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Rn.prototype.size=40;class gn extends At{get(n){return new Rn(this,n)}}ft(gn,"CollisionBoxArray");class tn extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}tn.prototype.size=60;class Yn extends ln{get(n){return new tn(this,n)}}ft(Yn,"PlacedSymbolArray");class Zr extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Zr.prototype.size=76;class Pn extends fn{get(n){return new Zr(this,n)}}ft(Pn,"SymbolInstanceArray");class ti extends pn{getoffsetX(n){return this.float32[1*n+0]}}ft(ti,"GlyphOffsetArray");class qu extends Ke{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}ft(qu,"SymbolLineVertexArray");class na extends _e{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}na.prototype.size=12;class Ac extends Fr{get(n){return new na(this,n)}}ft(Ac,"FeatureIndexArray");class qo extends Er{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}ft(qo,"FillExtrusionCentroidArray");const ys=be([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ra=be([{name:"a_dash",components:4,type:"Uint16"}]);var Hu={exports:{}},Pc={exports:{}};Pc.exports=function(i,n){var o,c,h,p,_,v,b,E;for(c=i.length-(o=3&i.length),h=n,_=3432918353,v=461845907,E=0;E<c;)b=255&i.charCodeAt(E)|(255&i.charCodeAt(++E))<<8|(255&i.charCodeAt(++E))<<16|(255&i.charCodeAt(++E))<<24,++E,h=27492+(65535&(p=5*(65535&(h=(h^=b=(65535&(b=(b=(65535&b)*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(b=0,o){case 3:b^=(255&i.charCodeAt(E+2))<<16;case 2:b^=(255&i.charCodeAt(E+1))<<8;case 1:h^=b=(65535&(b=(b=(65535&(b^=255&i.charCodeAt(E)))*_+(((b>>>16)*_&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var gf=Pc.exports,aE={exports:{}};aE.exports=function(i,n){for(var o,c=i.length,h=n^c,p=0;c>=4;)o=1540483477*(65535&(o=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(o>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),c-=4,++p;switch(c){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var lE=gf,HD=aE.exports;Hu.exports=lE,Hu.exports.murmur3=lE,Hu.exports.murmur2=HD;var $v=Te(Hu.exports);class pg{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,o,c,h){this.ids.push(cE(n)),this.positions.push(o,c,h)}getPositions(n){const o=cE(n);let c=0,h=this.ids.length-1;for(;c<h;){const _=c+h>>1;this.ids[_]>=o?h=_:c=_+1}const p=[];for(;this.ids[c]===o;)p.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return p}static serialize(n,o){const c=new Float64Array(n.ids),h=new Uint32Array(n.positions);return Gv(c,h,0,c.length-1),o&&o.push(c.buffer,h.buffer),{ids:c,positions:h}}static deserialize(n){const o=new pg;return o.ids=n.ids,o.positions=n.positions,o.indexed=!0,o}}function cE(i){const n=+i;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:$v(String(i))}function Gv(i,n,o,c){for(;o<c;){const h=i[o+c>>1];let p=o-1,_=c+1;for(;;){do p++;while(i[p]<h);do _--;while(i[_]>h);if(p>=_)break;mg(i,p,_),mg(n,3*p,3*_),mg(n,3*p+1,3*_+1),mg(n,3*p+2,3*_+2)}_-o<c-_?(Gv(i,n,o,_),o=_+1):(Gv(i,n,_+1,c),c=_)}}function mg(i,n,o){const c=i[n];i[n]=i[o],i[o]=c}ft(pg,"FeaturePositionMap");class ia{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,o){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,o),this.initialized=!0),!!this.location}}class gg extends ia{constructor(n){super(n),this.current=0}set(n,o,c){this.fetchUniformLocation(n,o)&&this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))}}class uE extends ia{constructor(n){super(n),this.current=[0,0,0,0]}set(n,o,c){this.fetchUniformLocation(n,o)&&(c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3])))}}class hE extends ia{constructor(n){super(n),this.current=$n.transparent}set(n,o,c){this.fetchUniformLocation(n,o)&&(c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a)))}}const ZD=new Float32Array(16),XD=new Float32Array(9),KD=new Float32Array(4);function Wv(i){return[ge(255*i.r,255*i.g),ge(255*i.b,255*i.a)]}class _f{constructor(n,o,c){this.value=n,this.uniformNames=o.map(h=>`u_${h}`),this.type=c}setUniform(n,o,c,h,p){o.set(n,p,h.constantOr(this.value))}getBinding(n,o){return this.type==="color"?new hE(n):new gg(n)}}class Zu{constructor(n,o){this.uniformNames=o.map(c=>`u_${c}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,o,c,h,p){const _=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;_&&o.set(n,p,_)}getBinding(n,o){return o==="u_pattern"||o==="u_dash"?new uE(n):new gg(n)}}class oa{constructor(n,o,c,h){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=o.map(p=>({name:`a_${p}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(n,o,c,h,p,_){const v=this.paintVertexArray.length,b=this.expression.evaluate(new A(0),o,{},p,h,_);this.paintVertexArray.resize(n),this._setPaintValue(v,n,b)}updatePaintArray(n,o,c,h,p){const _=this.expression.evaluate({zoom:0},c,h,void 0,p);this._setPaintValue(n,o,_)}_setPaintValue(n,o,c){if(this.type==="color"){const h=Wv(c);for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=n;h<o;h++)this.paintVertexArray.emplace(h,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ho{constructor(n,o,c,h,p,_){this.expression=n,this.uniformNames=o.map(v=>`u_${v}_t`),this.type=c,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=o.map(v=>({name:`a_${v}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,o,c,h,p,_){const v=this.expression.evaluate(new A(this.zoom),o,{},p,h,_),b=this.expression.evaluate(new A(this.zoom+1),o,{},p,h,_),E=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(E,n,v,b)}updatePaintArray(n,o,c,h,p){const _=this.expression.evaluate({zoom:this.zoom},c,h,void 0,p),v=this.expression.evaluate({zoom:this.zoom+1},c,h,void 0,p);this._setPaintValue(n,o,_,v)}_setPaintValue(n,o,c,h){if(this.type==="color"){const p=Wv(c),_=Wv(h);for(let v=n;v<o;v++)this.paintVertexArray.emplace(v,p[0],p[1],_[0],_[1])}else{for(let p=n;p<o;p++)this.paintVertexArray.emplace(p,c,h);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,o,c,h,p){const _=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,v=ot(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);o.set(n,p,v)}getBinding(n,o){return new gg(n)}}class il{constructor(n,o,c,h,p){this.expression=n,this.layerId=p,this.paintVertexAttributes=(c==="array"?ra:ys).members;for(let _=0;_<o.length;++_);this.paintVertexArray=new h}populatePaintArray(n,o,c){const h=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(h,n,o.patterns&&o.patterns[this.layerId],c)}updatePaintArray(n,o,c,h,p,_){this._setPaintValues(n,o,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(n,o,c,h){if(!h||!c)return;const p=h[c];if(!p)return;const{tl:_,br:v,pixelRatio:b}=p;for(let E=n;E<o;E++)this.paintVertexArray.emplace(E,_[0],_[1],v[0],v[1],b)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ol{constructor(n,o,c=()=>!0){this.binders={},this._buffers=[];const h=[];for(const p in n.paint._values){if(!c(p))continue;const _=n.paint.get(p);if(!(_ instanceof K&&Ka(_.property.specification)))continue;const v=YD(p,n.type),b=_.value,E=_.property.specification.type,C=!!_.property.useIntegerZoom,P=p==="line-dasharray"||p.endsWith("pattern"),M=p==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||M)if(b.kind==="source"||M||P){const L=dE(p,E,"source");this.binders[p]=P?new il(b,v,E,L,n.id):new oa(b,v,E,L),h.push(`/a_${p}`)}else{const L=dE(p,E,"composite");this.binders[p]=new Ho(b,v,E,C,o,L),h.push(`/z_${p}`)}else this.binders[p]=P?new Zu(b.value,v):new _f(b.value,v,E),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(n){const o=this.binders[n];return o instanceof oa||o instanceof Ho?o.maxValue:0}populatePaintArrays(n,o,c,h,p,_){for(const v in this.binders){const b=this.binders[v];(b instanceof oa||b instanceof Ho||b instanceof il)&&b.populatePaintArray(n,o,c,h,p,_)}}setConstantPatternPositions(n){for(const o in this.binders){const c=this.binders[o];c instanceof Zu&&c.setConstantPatternPositions(n)}}updatePaintArrays(n,o,c,h,p,_){let v=!1;for(const b in n){const E=o.getPositions(b);for(const C of E){const P=c.feature(C.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof oa||L instanceof Ho||L instanceof il)&&L.expression.isStateDependent===!0){const z=h.paint.get(M);L.expression=z.value,L.updatePaintArray(C.start,C.end,P,n[b],p,_),v=!0}}}}return v}defines(){const n=[];for(const o in this.binders){const c=this.binders[o];(c instanceof _f||c instanceof Zu)&&n.push(...c.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return n}getBinderAttributes(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof oa||c instanceof Ho||c instanceof il)for(let h=0;h<c.paintVertexAttributes.length;h++)n.push(c.paintVertexAttributes[h].name)}return n}getBinderUniforms(){const n=[];for(const o in this.binders){const c=this.binders[o];if(c instanceof _f||c instanceof Zu||c instanceof Ho)for(const h of c.uniformNames)n.push(h)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const o=[];for(const c in this.binders){const h=this.binders[c];if(h instanceof _f||h instanceof Zu||h instanceof Ho)for(const p of h.uniformNames)o.push({name:p,property:c,binding:h.getBinding(n,p)})}return o}setUniforms(n,o,c,h,p){for(const{name:_,property:v,binding:b}of c)this.binders[v].setUniform(n,b,p,h.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const o=this.binders[n];(o instanceof oa||o instanceof Ho||o instanceof il)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(n){for(const o in this.binders){const c=this.binders[o];(c instanceof oa||c instanceof Ho||c instanceof il)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const o=this.binders[n];(o instanceof oa||o instanceof Ho||o instanceof il)&&o.destroy()}}}class kc{constructor(n,o,c=()=>!0){this.programConfigurations={};for(const h of n)this.programConfigurations[h.id]=new ol(h,o,c);this.needsUpload=!1,this._featureMap=new pg,this._bufferOffset=0}populatePaintArrays(n,o,c,h,p,_,v){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(n,o,h,p,_,v);o.id!==void 0&&this._featureMap.add(o.id,c,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,o,c,h,p){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,o,_,h,p)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const o in this.programConfigurations)this.programConfigurations[o].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const JD={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function YD(i,n){return JD[i]||[i.replace(`${n}-`,"").replace(/-/g,"_")]}const QD={"line-pattern":{source:Pe,composite:Pe},"fill-pattern":{source:Pe,composite:Pe},"fill-extrusion-pattern":{source:Pe,composite:Pe},"line-dasharray":{source:je,composite:je}},eL={color:{source:_o,composite:Ze},number:{source:pn,composite:_o}};function dE(i,n,o){const c=QD[i];return c&&c[o]||eL[n][o]}ft(_f,"ConstantBinder"),ft(Zu,"PatternConstantBinder"),ft(oa,"SourceExpressionBinder"),ft(il,"PatternCompositeBinder"),ft(Ho,"CompositeExpressionBinder"),ft(ol,"ProgramConfiguration",{omit:["_buffers"]}),ft(kc,"ProgramConfigurationSet");const fE="-transition";class Zo extends rc{constructor(n,o){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),o.layout&&(this._unevaluatedLayout=new Y(o.layout)),o.paint)){this._transitionablePaint=new B(o.paint);for(const c in n.paint)this.setPaintProperty(c,n.paint[c],{validate:!1});for(const c in n.layout)this.setLayoutProperty(c,n.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Q(o.paint)}}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,o,c={}){o!=null&&this._validate(Fv,`layers.${this.id}.layout.${n}`,n,o,c)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,o):this.visibility=o)}getPaintProperty(n){return lo(n,fE)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,o,c={}){if(o!=null&&this._validate(Bv,`layers.${this.id}.paint.${n}`,n,o,c))return!1;if(lo(n,fE))return this._transitionablePaint.setTransition(n.slice(0,-11),o||void 0),!1;{const h=this._transitionablePaint._values[n],p=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(n,o),this._handleSpecialPaintPropertyUpdate(n);const v=this._transitionablePaint._values[n].value,b=v.isDataDriven(),E=lo(n,"pattern")||n==="line-dasharray";return b||p||E||this._handleOverridablePaintPropertyUpdate(n,_,v)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,o,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,o){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,o)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,o)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Do(n,(o,c)=>!(o===void 0||c==="layout"&&!Object.keys(o).length||c==="paint"&&!Object.keys(o).length))}_validate(n,o,c,h,p={}){return(!p||p.validate!==!1)&&ug(this,n.call(cg,{key:o,layerType:this.type,objectKey:c,value:h,styleSpec:Be,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const o=this.paint.get(n);if(o instanceof K&&Ka(o.property.specification)&&(o.value.kind==="source"||o.value.kind==="composite")&&o.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vu(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const tL=be([{name:"a_pos",components:2,type:"Int16"}],4),nL=be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Qn{constructor(n=[]){this.segments=n}prepareSegment(n,o,c,h){let p=this.segments[this.segments.length-1];return n>Qn.MAX_VERTEX_ARRAY_LENGTH&&In(`Max vertices per segment is ${Qn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!p||p.vertexLength+n>Qn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:o.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}get(){return this.segments}destroy(){for(const n of this.segments)for(const o in n.vaos)n.vaos[o].destroy()}static simpleSegment(n,o,c,h){return new Qn([{vertexOffset:n,primitiveOffset:o,vertexLength:c,primitiveLength:h,vaos:{},sortKey:0}])}}Qn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ft(Qn,"SegmentVector");var Et=8192;class sl{constructor(n,o){n&&(o?this.setSouthWest(n).setNorthEast(o):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof _n?new _n(n.lng,n.lat):_n.convert(n),this}setSouthWest(n){return this._sw=n instanceof _n?new _n(n.lng,n.lat):_n.convert(n),this}extend(n){const o=this._sw,c=this._ne;let h,p;if(n instanceof _n)h=n,p=n;else{if(!(n instanceof sl))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(sl.convert(n)):this.extend(_n.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(_n.convert(n)):this;if(h=n._sw,p=n._ne,!h||!p)return this}return o||c?(o.lng=Math.min(h.lng,o.lng),o.lat=Math.min(h.lat,o.lat),c.lng=Math.max(p.lng,c.lng),c.lat=Math.max(p.lat,c.lat)):(this._sw=new _n(h.lng,h.lat),this._ne=new _n(p.lng,p.lat)),this}getCenter(){return new _n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _n(this.getWest(),this.getNorth())}getSouthEast(){return new _n(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:o,lat:c}=_n.convert(n);let h=this._sw.lng<=o&&o<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=o&&o>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&h}static convert(n){return!n||n instanceof sl?n:new sl(n)}}var _g=1e-6,Pi=typeof Float32Array<"u"?Float32Array:Array;function pE(){var i=new Pi(9);return Pi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function mE(i,n,o){var c=n[0],h=n[1],p=n[2],_=n[3],v=n[4],b=n[5],E=n[6],C=n[7],P=n[8],M=o[0],L=o[1],z=o[2],N=o[3],q=o[4],ee=o[5],de=o[6],ne=o[7],ue=o[8];return i[0]=M*c+L*_+z*E,i[1]=M*h+L*v+z*C,i[2]=M*p+L*b+z*P,i[3]=N*c+q*_+ee*E,i[4]=N*h+q*v+ee*C,i[5]=N*p+q*b+ee*P,i[6]=de*c+ne*_+ue*E,i[7]=de*h+ne*v+ue*C,i[8]=de*p+ne*b+ue*P,i}function Xo(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function qv(i,n){var o=n[0],c=n[1],h=n[2],p=n[3],_=n[4],v=n[5],b=n[6],E=n[7],C=n[8],P=n[9],M=n[10],L=n[11],z=n[12],N=n[13],q=n[14],ee=n[15],de=o*v-c*_,ne=o*b-h*_,ue=o*E-p*_,pe=c*b-h*v,fe=c*E-p*v,Me=h*E-p*b,Ae=C*N-P*z,Fe=C*q-M*z,Je=C*ee-L*z,De=P*q-M*N,Ve=P*ee-L*N,$e=M*ee-L*q,He=de*$e-ne*Ve+ue*De+pe*Je-fe*Fe+Me*Ae;return He?(i[0]=(v*$e-b*Ve+E*De)*(He=1/He),i[1]=(h*Ve-c*$e-p*De)*He,i[2]=(N*Me-q*fe+ee*pe)*He,i[3]=(M*fe-P*Me-L*pe)*He,i[4]=(b*Je-_*$e-E*Fe)*He,i[5]=(o*$e-h*Je+p*Fe)*He,i[6]=(q*ue-z*Me-ee*ne)*He,i[7]=(C*Me-M*ue+L*ne)*He,i[8]=(_*Ve-v*Je+E*Ae)*He,i[9]=(c*Je-o*Ve-p*Ae)*He,i[10]=(z*fe-N*ue+ee*de)*He,i[11]=(P*ue-C*fe-L*de)*He,i[12]=(v*Fe-_*De-b*Ae)*He,i[13]=(o*De-c*Fe+h*Ae)*He,i[14]=(N*ne-z*pe-q*de)*He,i[15]=(C*pe-P*ne+M*de)*He,i):null}function Mc(i,n,o){var c=n[0],h=n[1],p=n[2],_=n[3],v=n[4],b=n[5],E=n[6],C=n[7],P=n[8],M=n[9],L=n[10],z=n[11],N=n[12],q=n[13],ee=n[14],de=n[15],ne=o[0],ue=o[1],pe=o[2],fe=o[3];return i[0]=ne*c+ue*v+pe*P+fe*N,i[1]=ne*h+ue*b+pe*M+fe*q,i[2]=ne*p+ue*E+pe*L+fe*ee,i[3]=ne*_+ue*C+pe*z+fe*de,i[4]=(ne=o[4])*c+(ue=o[5])*v+(pe=o[6])*P+(fe=o[7])*N,i[5]=ne*h+ue*b+pe*M+fe*q,i[6]=ne*p+ue*E+pe*L+fe*ee,i[7]=ne*_+ue*C+pe*z+fe*de,i[8]=(ne=o[8])*c+(ue=o[9])*v+(pe=o[10])*P+(fe=o[11])*N,i[9]=ne*h+ue*b+pe*M+fe*q,i[10]=ne*p+ue*E+pe*L+fe*ee,i[11]=ne*_+ue*C+pe*z+fe*de,i[12]=(ne=o[12])*c+(ue=o[13])*v+(pe=o[14])*P+(fe=o[15])*N,i[13]=ne*h+ue*b+pe*M+fe*q,i[14]=ne*p+ue*E+pe*L+fe*ee,i[15]=ne*_+ue*C+pe*z+fe*de,i}function yf(i,n,o){var c,h,p,_,v,b,E,C,P,M,L,z,N=o[0],q=o[1],ee=o[2];return n===i?(i[12]=n[0]*N+n[4]*q+n[8]*ee+n[12],i[13]=n[1]*N+n[5]*q+n[9]*ee+n[13],i[14]=n[2]*N+n[6]*q+n[10]*ee+n[14],i[15]=n[3]*N+n[7]*q+n[11]*ee+n[15]):(h=n[1],p=n[2],_=n[3],v=n[4],b=n[5],E=n[6],C=n[7],P=n[8],M=n[9],L=n[10],z=n[11],i[0]=c=n[0],i[1]=h,i[2]=p,i[3]=_,i[4]=v,i[5]=b,i[6]=E,i[7]=C,i[8]=P,i[9]=M,i[10]=L,i[11]=z,i[12]=c*N+v*q+P*ee+n[12],i[13]=h*N+b*q+M*ee+n[13],i[14]=p*N+E*q+L*ee+n[14],i[15]=_*N+C*q+z*ee+n[15]),i}function Rc(i,n,o){var c=o[0],h=o[1],p=o[2];return i[0]=n[0]*c,i[1]=n[1]*c,i[2]=n[2]*c,i[3]=n[3]*c,i[4]=n[4]*h,i[5]=n[5]*h,i[6]=n[6]*h,i[7]=n[7]*h,i[8]=n[8]*p,i[9]=n[9]*p,i[10]=n[10]*p,i[11]=n[11]*p,i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],i}function Hv(i,n,o){var c=Math.sin(o),h=Math.cos(o),p=n[4],_=n[5],v=n[6],b=n[7],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[4]=p*h+E*c,i[5]=_*h+C*c,i[6]=v*h+P*c,i[7]=b*h+M*c,i[8]=E*h-p*c,i[9]=C*h-_*c,i[10]=P*h-v*c,i[11]=M*h-b*c,i}function yg(i,n,o){var c=Math.sin(o),h=Math.cos(o),p=n[0],_=n[1],v=n[2],b=n[3],E=n[8],C=n[9],P=n[10],M=n[11];return n!==i&&(i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h-E*c,i[1]=_*h-C*c,i[2]=v*h-P*c,i[3]=b*h-M*c,i[8]=p*c+E*h,i[9]=_*c+C*h,i[10]=v*c+P*h,i[11]=b*c+M*h,i}function gE(i,n){return i[0]=n[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=n[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=n[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function _E(i,n,o){var c,h,p,_=o[0],v=o[1],b=o[2],E=Math.hypot(_,v,b);return E<_g?null:(_*=E=1/E,v*=E,b*=E,c=Math.sin(n),h=Math.cos(n),i[0]=_*_*(p=1-h)+h,i[1]=v*_*p+b*c,i[2]=b*_*p-v*c,i[3]=0,i[4]=_*v*p-b*c,i[5]=v*v*p+h,i[6]=b*v*p+_*c,i[7]=0,i[8]=_*b*p+v*c,i[9]=v*b*p-_*c,i[10]=b*b*p+h,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i)}Math.hypot||(Math.hypot=function(){for(var i=0,n=arguments.length;n--;)i+=arguments[n]*arguments[n];return Math.sqrt(i)});var rL=Mc;function Zv(){var i=new Pi(3);return Pi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function yE(i){var n=new Pi(3);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n}function vf(i){return Math.hypot(i[0],i[1],i[2])}function Xu(i,n,o){var c=new Pi(3);return c[0]=i,c[1]=n,c[2]=o,c}function sa(i,n,o){return i[0]=n[0]+o[0],i[1]=n[1]+o[1],i[2]=n[2]+o[2],i}function Xv(i,n,o){return i[0]=n[0]-o[0],i[1]=n[1]-o[1],i[2]=n[2]-o[2],i}function vE(i,n,o){return i[0]=n[0]*o[0],i[1]=n[1]*o[1],i[2]=n[2]*o[2],i}function xf(i,n,o){return i[0]=Math.min(n[0],o[0]),i[1]=Math.min(n[1],o[1]),i[2]=Math.min(n[2],o[2]),i}function wf(i,n,o){return i[0]=Math.max(n[0],o[0]),i[1]=Math.max(n[1],o[1]),i[2]=Math.max(n[2],o[2]),i}function qi(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i}function bf(i,n,o,c){return i[0]=n[0]+o[0]*c,i[1]=n[1]+o[1]*c,i[2]=n[2]+o[2]*c,i}function ni(i,n){var o=n[0],c=n[1],h=n[2],p=o*o+c*c+h*h;return p>0&&(p=1/Math.sqrt(p)),i[0]=n[0]*p,i[1]=n[1]*p,i[2]=n[2]*p,i}function yo(i,n){return i[0]*n[0]+i[1]*n[1]+i[2]*n[2]}function Kv(i,n,o){var c=n[0],h=n[1],p=n[2],_=o[0],v=o[1],b=o[2];return i[0]=h*b-p*v,i[1]=p*_-c*b,i[2]=c*v-h*_,i}function Gn(i,n,o){var c=n[0],h=n[1],p=n[2],_=o[3]*c+o[7]*h+o[11]*p+o[15];return i[0]=(o[0]*c+o[4]*h+o[8]*p+o[12])/(_=_||1),i[1]=(o[1]*c+o[5]*h+o[9]*p+o[13])/_,i[2]=(o[2]*c+o[6]*h+o[10]*p+o[14])/_,i}function xE(i,n,o){var c=o[0],h=o[1],p=o[2],_=n[0],v=n[1],b=n[2],E=h*b-p*v,C=p*_-c*b,P=c*v-h*_,M=h*P-p*C,L=p*E-c*P,z=c*C-h*E,N=2*o[3];return C*=N,P*=N,L*=2,z*=2,i[0]=_+(E*=N)+(M*=2),i[1]=v+C+L,i[2]=b+P+z,i}var Ef,Ko=Xv,iL=vE,oL=vf;function wE(i,n,o){return i[0]=n[0]*o,i[1]=n[1]*o,i[2]=n[2]*o,i[3]=n[3]*o,i}function bE(i,n){var o=n[0],c=n[1],h=n[2],p=n[3],_=o*o+c*c+h*h+p*p;return _>0&&(_=1/Math.sqrt(_)),i[0]=o*_,i[1]=c*_,i[2]=h*_,i[3]=p*_,i}function Dc(i,n,o){var c=n[0],h=n[1],p=n[2],_=n[3];return i[0]=o[0]*c+o[4]*h+o[8]*p+o[12]*_,i[1]=o[1]*c+o[5]*h+o[9]*p+o[13]*_,i[2]=o[2]*c+o[6]*h+o[10]*p+o[14]*_,i[3]=o[3]*c+o[7]*h+o[11]*p+o[15]*_,i}function EE(){var i=new Pi(4);return Pi!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function TE(i){return i[0]=0,i[1]=0,i[2]=0,i[3]=1,i}function SE(i,n,o){o*=.5;var c=n[0],h=n[1],p=n[2],_=n[3],v=Math.sin(o),b=Math.cos(o);return i[0]=c*b+_*v,i[1]=h*b+p*v,i[2]=p*b-h*v,i[3]=_*b-c*v,i}function IE(i,n,o){o*=.5;var c=n[0],h=n[1],p=n[2],_=n[3],v=Math.sin(o),b=Math.cos(o);return i[0]=c*b-p*v,i[1]=h*b+_*v,i[2]=p*b+c*v,i[3]=_*b-h*v,i}Zv(),Ef=new Pi(4),Pi!=Float32Array&&(Ef[0]=0,Ef[1]=0,Ef[2]=0,Ef[3]=0);var sL=bE;Zv(),Xu(1,0,0),Xu(0,1,0),EE(),EE(),pE();const aL=be([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:CE}=aL,AE=be([{name:"a_pos_3",components:3,type:"Int16"}]);var Tf=be([{name:"a_pos",type:"Int16",components:2}]);class Jv{constructor(n,o){this.pos=n,this.dir=o}intersectsPlane(n,o,c){const h=yo(o,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((n[0]-this.pos[0])*o[0]+(n[1]-this.pos[1])*o[1]+(n[2]-this.pos[2])*o[2])/h;return c[0]=this.pos[0]+this.dir[0]*p,c[1]=this.pos[1]+this.dir[1]*p,c[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(n,o,c){if(function(L,z){var N=L[0],q=L[1],ee=L[2],de=z[0],ne=z[1],ue=z[2];return Math.abs(N-de)<=_g*Math.max(1,Math.abs(N),Math.abs(de))&&Math.abs(q-ne)<=_g*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs(ee-ue)<=_g*Math.max(1,Math.abs(ee),Math.abs(ue))}(this.pos,n)||o===0)return c[0]=c[1]=c[2]=0,!1;const[h,p,_]=this.dir,v=this.pos[0]-n[0],b=this.pos[1]-n[1],E=this.pos[2]-n[2],C=h*h+p*p+_*_,P=2*(v*h+b*p+E*_),M=P*P-4*C*(v*v+b*b+E*E-o*o);if(M<0){const L=Math.max(-P/2,0),z=v+h*L,N=b+p*L,q=E+_*L,ee=Math.hypot(z,N,q);return c[0]=z*o/ee,c[1]=N*o/ee,c[2]=q*o/ee,!1}{const L=(-P-Math.sqrt(M))/(2*C);if(L<0){const z=Math.hypot(v,b,E);return c[0]=v*o/z,c[1]=b*o/z,c[2]=E*o/z,!1}return c[0]=v+h*L,c[1]=b+p*L,c[2]=E+_*L,!0}}}class Yv{constructor(n,o,c,h,p){this.TL=n,this.TR=o,this.BR=c,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(n,o,c){const h=[-1,1,1],p=[1,1,1],_=[1,-1,1],v=[-1,-1,1],b=Gn(h,h,n),E=Gn(p,p,n),C=Gn(_,_,n),P=Gn(v,v,n);return new Yv(b,E,C,P,o/c)}}class Qv{constructor(n,o){this.points=n,this.planes=o}static fromInvProjectionMatrix(n,o,c,h){const p=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const E=Dc([],b,n),C=1/E[3]/o*p;return function(P,M,L){return P[0]=M[0]*L[0],P[1]=M[1]*L[1],P[2]=M[2]*L[2],P[3]=M[3]*L[3],P}(E,E,[C,C,h?1/E[3]:C,C])}),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const E=ni([],Kv([],Ko([],_[b[0]],_[b[1]]),Ko([],_[b[2]],_[b[1]]))),C=-yo(E,_[b[1]]);return E.concat(C)});return new Qv(_,v)}}class ri{static fromPoints(n){const o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];for(const h of n)xf(o,o,h),wf(c,c,h);return new ri(o,c)}static applyTransform(n,o){const c=n.getCorners();for(let h=0;h<c.length;++h)Gn(c[h],c[h],o);return ri.fromPoints(c)}constructor(n,o){this.min=n,this.max=o,this.center=qi([],sa([],this.min,this.max),.5)}quadrant(n){const o=[n%2==0,n<2],c=yE(this.min),h=yE(this.max);for(let p=0;p<o.length;p++)c[p]=o[p]?this.min[p]:this.center[p],h[p]=o[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new ri(c,h)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,o=this.max;return[[n[0],n[1],n[2]],[o[0],n[1],n[2]],[o[0],o[1],n[2]],[n[0],o[1],n[2]],[n[0],n[1],o[2]],[o[0],n[1],o[2]],[o[0],o[1],o[2]],[n[0],o[1],o[2]]]}intersects(n){const o=this.getCorners();let c=!0;for(let h=0;h<n.planes.length;h++){const p=n.planes[h];let _=0;for(let v=0;v<o.length;v++)_+=yo(p,o[v])+p[3]>=0;if(_===0)return 0;_!==o.length&&(c=!1)}if(c)return 2;for(let h=0;h<3;h++){let p=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let v=0;v<n.points.length;v++){const b=n.points[v][h]-this.min[h];p=Math.min(p,b),_=Math.max(_,b)}if(_<0||p>this.max[h]-this.min[h])return 0}return 1}}const ex=5,PE=6,vs=Et/Math.PI/2,lL=16383,Lc=64,Sf=[Lc,32,16],vo=-vs,xo=vs,cL=[new ri([vo,vo,vo],[xo,xo,xo]),new ri([vo,vo,vo],[0,0,xo]),new ri([0,vo,vo],[xo,0,xo]),new ri([vo,0,vo],[0,xo,xo]),new ri([0,0,vo],[xo,xo,xo])];function vg(i){return i*vs/Af}function kE(i,n,o,c=!0){const h=qi([],i._camera.position,i.worldSize),p=[n,o,1,1];Dc(p,p,i.pixelMatrixInverse),wE(p,p,1/p[3]);const _=ni([],Ko([],p,h)),v=i.globeMatrix,b=[v[12],v[13],v[14]],E=Ko([],b,h),C=vf(E),P=ni([],E),M=i.worldSize/(2*Math.PI),L=yo(P,_),z=Math.asin(M/C);if(z<Math.acos(L)){if(!c)return null;const Je=[],De=[];qi(Je,_,C/L),ni(De,Ko(De,Je,E)),ni(_,sa(_,E,qi(_,De,Math.tan(z)*C)))}const N=[];new Jv(h,_).closestPointOnSphere(b,M,N);const q=ni([],Ei(v,0)),ee=ni([],Ei(v,1)),de=ni([],Ei(v,2)),ne=yo(q,N),ue=yo(ee,N),pe=yo(de,N),fe=Zt(Math.asin(-ue/M));let Me=Zt(Math.atan2(ne,pe));Me=i.center.lng+function(Je,De){const Ve=(De-Je+180)%360-180;return Ve<-180?Ve+360:Ve}(i.center.lng,Me);const Ae=ws(Me),Fe=ot(bs(fe),0,1);return new Qu(Ae,Fe)}class uL{constructor(n,o,c){this.a=Ko([],n,c),this.b=Ko([],o,c),this.center=c;const h=ni([],this.a),p=ni([],this.b);this.angle=Math.acos(yo(h,p))}}function tx(i,n){if(i.angle===0)return null;let o;return o=i.a[n]===0?1/i.angle*.5*Math.PI:1/i.angle*Math.atan(i.b[n]/i.a[n]/Math.sin(i.angle)-1/Math.tan(i.angle)),o<0||o>1?null:function(c,h,p,_){const v=Math.sin(p);return c*(Math.sin((1-_)*p)/v)+h*(Math.sin(_*p)/v)}(i.a[n],i.b[n],i.angle,ot(o,0,1))+i.center[n]}function xs(i){if(i.z<=1)return cL[i.z+2*i.y+i.x];const n=nx(xg(i));return ri.fromPoints(n)}function zc(i,n,o){return qi(i,i,1-o),bf(i,i,n,o)}function ME(i,n){const o=Yu(n.zoom);if(o===0)return xs(i);const c=xg(i),h=nx(c),p=ws(c.getWest())*n.worldSize,_=ws(c.getEast())*n.worldSize,v=bs(c.getNorth())*n.worldSize,b=bs(c.getSouth())*n.worldSize,E=[p,v,0],C=[_,v,0],P=[p,b,0],M=[_,b,0],L=qv([],n.globeMatrix);return Gn(E,E,L),Gn(C,C,L),Gn(P,P,L),Gn(M,M,L),h[0]=zc(h[0],P,o),h[1]=zc(h[1],M,o),h[2]=zc(h[2],C,o),h[3]=zc(h[3],E,o),ri.fromPoints(h)}function RE(i,n,o){for(const c of i)Gn(c,c,n),qi(c,c,o)}function hL(i,n,o){const c=n/i.worldSize,h=i.globeMatrix;if(o.z<=1){const Ae=xs(o).getCorners();return RE(Ae,h,c),ri.fromPoints(Ae)}const p=xg(o),_=nx(p);RE(_,h,c);const v=Number.MAX_VALUE,b=[-v,-v,-v],E=[v,v,v];if(p.contains(i.center)){for(const Je of _)xf(E,E,Je),wf(b,b,Je);b[2]=0;const Ae=i.point,Fe=[Ae.x*c,Ae.y*c,0];return xf(E,E,Fe),wf(b,b,Fe),new ri(E,b)}const C=[h[12]*c,h[13]*c,h[14]*c],P=p.getCenter(),M=ot(i.center.lat,-jr,jr),L=ot(P.lat,-jr,jr),z=ws(i.center.lng),N=bs(M);let q=z-ws(P.lng);const ee=N-bs(L);q>.5?q-=1:q<-.5&&(q+=1);let de=0;Math.abs(q)>Math.abs(ee)?de=q>=0?1:3:(de=ee>=0?0:2,bf(C,C,[h[4]*c,h[5]*c,h[6]*c],-Math.sin(pt(ee>=0?p.getSouth():p.getNorth()))*vs));const ne=_[de],ue=_[(de+1)%4],pe=new uL(ne,ue,C),fe=[tx(pe,0)||ne[0],tx(pe,1)||ne[1],tx(pe,2)||ne[2]],Me=Yu(i.zoom);if(Me>0){const Ae=function({x:Je,y:De,z:Ve},$e,He,nt,Oe){const lt=1/(1<<Ve);let gt=Je*lt,ct=gt+lt,Pt=De*lt,rt=Pt+lt,wt=0;const kt=(gt+ct)/2-nt;return kt>.5?wt=-1:kt<-.5&&(wt=1),gt=((gt+wt)*$e-(nt*=$e))*He+nt,ct=((ct+wt)*$e-nt)*He+nt,Pt=(Pt*$e-(Oe*=$e))*He+Oe,rt=(rt*$e-Oe)*He+Oe,[[gt,rt,0],[ct,rt,0],[ct,Pt,0],[gt,Pt,0]]}(o,n,i._pixelsPerMercatorPixel,z,N);for(let Je=0;Je<_.length;Je++)zc(_[Je],Ae[Je],Me);const Fe=sa([],Ae[de],Ae[(de+1)%4]);qi(Fe,Fe,.5),zc(fe,Fe,Me)}for(const Ae of _)xf(E,E,Ae),wf(b,b,Ae);return E[2]=Math.min(ne[2],ue[2]),xf(E,E,fe),wf(b,b,fe),new ri(E,b)}function xg({x:i,y:n,z:o}){const c=1/(1<<o),h=new _n(Hi(i*c),Nr((n+1)*c)),p=new _n(Hi((i+1)*c),Nr(n*c));return new sl(h,p)}function nx(i){const n=pt(i.getNorth()),o=pt(i.getSouth()),c=Math.cos(n),h=Math.cos(o),p=Math.sin(n),_=Math.sin(o),v=i.getWest(),b=i.getEast();return[Ku(h,_,v),Ku(h,_,b),Ku(c,p,b),Ku(c,p,v)]}function Ku(i,n,o,c=vs){return o=pt(o),[i*Math.sin(o)*c,-n*c,i*Math.cos(o)*c]}function Ju(i,n,o){return Ku(Math.cos(pt(i)),Math.sin(pt(i)),n,o)}function If(i,n,o,c){const h=1<<o.z,p=(i/Et+o.x)/h;return Ju(Nr((n/Et+o.y)/h),Hi(p),c)}function wg({min:i,max:n}){return lL/Math.max(n[0]-i[0],n[1]-i[1],n[2]-i[2])}const DE=new Float64Array(16);function Cf(i){const n=wg(i),o=gE(DE,[n,n,n]);return yf(o,o,((c=[])[0]=-(h=i.min)[0],c[1]=-h[1],c[2]=-h[2],c));var c,h}function rx(i){const n=(c=i.min,(o=DE)[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=c[0],o[13]=c[1],o[14]=c[2],o[15]=1,o);var o,c;const h=1/wg(i);return Rc(n,n,[h,h,h])}function LE(i,n,o,c,h){const p=function(b){const E=Et/(2*Math.PI);return b/(2*Math.PI)/E}(o),_=[i,n,-o/(2*Math.PI)],v=Xo(new Float64Array(16));return yf(v,v,_),Rc(v,v,[p,p,p]),Hv(v,v,pt(-h)),yg(v,v,pt(-c)),v}function Yu(i){return Tt(ex,PE,i)}function zE(i,n){const o=Ju(n.lat,n.lng),c=function(z){const N=Ju(z._center.lat,z._center.lng);let q=Kv([],Xu(0,1,0),N);const ee=_E([],-z.angle,N);q=Gn(q,q,ee),_E(ee,-z._pitch,q);const de=ni([],N);return qi(de,de,vg(z.cameraToCenterDistance/z.pixelsPerMeter)),Gn(de,de,ee),sa([],N,de)}(i);return _=(h=Xv([],c,o))[0],v=h[1],b=h[2],E=(p=o)[0],C=p[1],P=p[2],L=(M=Math.sqrt(_*_+v*v+b*b)*Math.sqrt(E*E+C*C+P*P))&&yo(h,p)/M,Math.acos(Math.min(Math.max(L,-1),1));var h,p,_,v,b,E,C,P,M,L}function ix(i,n){return zE(i,n)>Math.PI/2*1.01}const OE=pt(85),dL=Math.cos(OE),fL=Math.sin(OE),Af=63710088e-1,BE=2*Math.PI*Af;class al{constructor(n,o){if(isNaN(n)||isNaN(o))throw new Error(`Invalid LngLat object: (${n}, ${o})`);if(this.lng=+n,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new al(Rt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const o=Math.PI/180,c=this.lat*o,h=n.lat*o,p=Math.sin(c)*Math.sin(h)+Math.cos(c)*Math.cos(h)*Math.cos((n.lng-this.lng)*o);return Af*Math.acos(Math.min(p,1))}toBounds(n=0){const o=360*n/40075017,c=o/Math.cos(Math.PI/180*this.lat);return new sl(new al(this.lng-c,this.lat-o),new al(this.lng+c,this.lat+o))}toEcef(n){const o=vg(n);return Ju(this.lat,this.lng,vs+o)}static convert(n){if(n instanceof al)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new al(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new al(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var _n=al;function ox(i){return BE*Math.cos(i*Math.PI/180)}function ws(i){return(180+i)/360}function bs(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Jo(i,n){return i/ox(n)}function Hi(i){return 360*i-180}function Nr(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function FE(i,n){return i*ox(Nr(n))}const jr=85.051129;function NE(i){return 1/Math.cos(i*Math.PI/180)}class Qu{constructor(n,o,c=0){this.x=+n,this.y=+o,this.z=+c}static fromLngLat(n,o=0){const c=_n.convert(n);return new Qu(ws(c.lng),bs(c.lat),Jo(o,c.lat))}toLngLat(){return new _n(Hi(this.x),Nr(this.y))}toAltitude(){return FE(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/BE*NE(Nr(this.y))}}function sx(i,n,o,c,h,p,_,v,b){const E=(n+c)/2,C=(o+h)/2,P=new ze(E,C);v(P),function(M,L,z,N,q,ee){const de=z-q,ne=N-ee;return Math.abs((N-L)*de-(z-M)*ne)/Math.hypot(de,ne)}(P.x,P.y,p.x,p.y,_.x,_.y)>=b?(sx(i,n,o,E,C,p,P,v,b),sx(i,E,C,c,h,P,_,v,b)):i.push(_)}function jE(i,n,o){let c=i[0],h=c.x,p=c.y;n(c);const _=[c];for(let v=1;v<i.length;v++){const b=i[v],{x:E,y:C}=b;n(b),sx(_,h,p,E,C,c,b,n,o),h=E,p=C,c=b}return _}function ax(i,n,o,c){if(c(n,o)){const h=n.add(o)._mult(.5);ax(i,n,h,c),ax(i,h,o,c)}else i.push(o)}function pL(i,n){let o=i[0];const c=[o];for(let h=1;h<i.length;h++){const p=i[h];ax(c,o,p,n),o=p}return c}const lx=Math.pow(2,14)-1,UE=-lx-1;function mL(i,n){const o=Math.round(i.x*n),c=Math.round(i.y*n);return i.x=ot(o,UE,lx),i.y=ot(c,UE,lx),(o<i.x||o>i.x+1||c<i.y||c>i.y+1)&&In("Geometry exceeds allowed extent, reduce your vector tile buffer size"),i}function aa(i,n,o){const c=i.loadGeometry(),h=i.extent,p=Et/h;if(n&&o&&o.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:v,x:b,y:E,projection:C}=o,P=M=>{const L=Hi((n.x+M.x/h)/_),z=Nr((n.y+M.y/h)/_),N=C.project(L,z);M.x=(N.x*v-b)*h,M.y=(N.y*v-E)*h};for(let M=0;M<c.length;M++)if(i.type!==1)c[M]=jE(c[M],P,1);else{const L=[];for(const z of c[M])z.x<0||z.x>=h||z.y<0||z.y>=h||(P(z),L.push(z));c[M]=L}}for(const _ of c)for(const v of _)mL(v,p);return c}function Oc(i,n){return{type:i.type,id:i.id,properties:i.properties,geometry:n?aa(i):[]}}function bg(i,n,o,c,h){i.emplaceBack(2*n+(c+1)/2,2*o+(h+1)/2)}function Eg(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class cx{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Ke,this.indexArray=new yt,this.segments=new Qn,this.programConfigurations=new kc(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,c,h){const p=this.layers[0],_=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:P,sourceLayerIndex:M}of n){const L=this.layers[0]._featureFilter.needGeometry,z=Oc(E,L);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),z,c))continue;const N=v?v.evaluate(z,{},c):void 0,q={id:C,properties:E.properties,type:E.type,sourceLayerIndex:M,index:P,geometry:L?z.geometry:aa(E,c,h),patterns:{},sortKey:N};_.push(q)}v&&_.sort((E,C)=>E.sortKey-C.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Ye,b=h.projection);for(const E of _){const{geometry:C,index:P,sourceLayerIndex:M}=E,L=n[P].feature;this.addFeature(E,C,P,o.availableImages,c,b),o.featureIndex.insert(L,C,P,M,this.index)}}update(n,o,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,tL.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,nL.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,o,c,h,p,_){for(const v of o)for(const b of v){const E=b.x,C=b.y;if(E<0||E>=Et||C<0||C>=Et)continue;if(_){const L=_.projectTilePoint(E,C,p),z=_.upVector(p,E,C),N=this.globeExtVertexArray;Eg(N,L,z),Eg(N,L,z),Eg(N,L,z),Eg(N,L,z)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),M=P.vertexLength;bg(this.layoutVertexArray,E,C,-1,-1),bg(this.layoutVertexArray,E,C,1,-1),bg(this.layoutVertexArray,E,C,1,1),bg(this.layoutVertexArray,E,C,-1,1),this.indexArray.emplaceBack(M,M+1,M+2),this.indexArray.emplaceBack(M,M+2,M+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},h,p)}}function VE(i,n){for(let o=0;o<i.length;o++)if(Bc(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(Bc(i,n[o]))return!0;return!!ux(i,n)}function gL(i,n,o){return!!Bc(i,n)||!!hx(n,i,o)}function $E(i,n){if(i.length===1)return WE(n,i[0]);for(let o=0;o<n.length;o++){const c=n[o];for(let h=0;h<c.length;h++)if(Bc(i,c[h]))return!0}for(let o=0;o<i.length;o++)if(WE(n,i[o]))return!0;for(let o=0;o<n.length;o++)if(ux(i,n[o]))return!0;return!1}function _L(i,n,o){if(i.length>1){if(ux(i,n))return!0;for(let c=0;c<n.length;c++)if(hx(n[c],i,o))return!0}for(let c=0;c<i.length;c++)if(hx(i[c],n,o))return!0;return!1}function ux(i,n){if(i.length===0||n.length===0)return!1;for(let o=0;o<i.length-1;o++){const c=i[o],h=i[o+1];for(let p=0;p<n.length-1;p++)if(yL(c,h,n[p],n[p+1]))return!0}return!1}function yL(i,n,o,c){return Wr(i,o,c)!==Wr(n,o,c)&&Wr(i,n,o)!==Wr(i,n,c)}function hx(i,n,o){const c=o*o;if(n.length===1)return i.distSqr(n[0])<c;for(let h=1;h<n.length;h++)if(GE(i,n[h-1],n[h])<c)return!0;return!1}function GE(i,n,o){const c=n.distSqr(o);if(c===0)return i.distSqr(n);const h=((i.x-n.x)*(o.x-n.x)+(i.y-n.y)*(o.y-n.y))/c;return i.distSqr(h<0?n:h>1?o:o.sub(n)._mult(h)._add(n))}function WE(i,n){let o,c,h,p=!1;for(let _=0;_<i.length;_++){o=i[_];for(let v=0,b=o.length-1;v<o.length;b=v++)c=o[v],h=o[b],c.y>n.y!=h.y>n.y&&n.x<(h.x-c.x)*(n.y-c.y)/(h.y-c.y)+c.x&&(p=!p)}return p}function Bc(i,n){let o=!1;for(let c=0,h=i.length-1;c<i.length;h=c++){const p=i[c],_=i[h];p.y>n.y!=_.y>n.y&&n.x<(_.x-p.x)*(n.y-p.y)/(_.y-p.y)+p.x&&(o=!o)}return o}function qE(i,n,o,c,h){for(const _ of i)if(n<=_.x&&o<=_.y&&c>=_.x&&h>=_.y)return!0;const p=[new ze(n,o),new ze(n,h),new ze(c,h),new ze(c,o)];if(i.length>2){for(const _ of p)if(Bc(i,_))return!0}for(let _=0;_<i.length-1;_++)if(vL(i[_],i[_+1],p))return!0;return!1}function vL(i,n,o){const c=o[0],h=o[2];if(i.x<c.x&&n.x<c.x||i.x>h.x&&n.x>h.x||i.y<c.y&&n.y<c.y||i.y>h.y&&n.y>h.y)return!1;const p=Wr(i,n,o[0]);return p!==Wr(i,n,o[1])||p!==Wr(i,n,o[2])||p!==Wr(i,n,o[3])}function eh(i,n,o){const c=n.paint.get(i).value;return c.kind==="constant"?c.value:o.programConfigurations.get(n.id).getMaxValue(i)}function Tg(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function HE(i,n,o,c,h){if(!n[0]&&!n[1])return i;const p=ze.convert(n)._mult(h);o==="viewport"&&p._rotate(-c);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(p));return _}function ZE(i,n,o,c){const h=ze.convert(i)._mult(c);return n==="viewport"&&h._rotate(-o),h}ft(cx,"CircleBucket",{omit:["layers"]});const xL=new se({"circle-sort-key":new H(Be.layout_circle["circle-sort-key"])});var wL={paint:new se({"circle-radius":new H(Be.paint_circle["circle-radius"]),"circle-color":new H(Be.paint_circle["circle-color"]),"circle-blur":new H(Be.paint_circle["circle-blur"]),"circle-opacity":new H(Be.paint_circle["circle-opacity"]),"circle-translate":new F(Be.paint_circle["circle-translate"]),"circle-translate-anchor":new F(Be.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new F(Be.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new F(Be.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new H(Be.paint_circle["circle-stroke-width"]),"circle-stroke-color":new H(Be.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new H(Be.paint_circle["circle-stroke-opacity"])}),layout:xL};function XE(i,n,o,c,h,p,_,v,b){if(p&&i.queryGeometry.isAboveHorizon)return!1;p&&(b*=i.pixelToTileUnitsFactor);const E=i.tileID.canonical,C=o.projection.upVectorScale(E,o.center.lat,o.worldSize).metersToTile;for(const P of n)for(const M of P){const L=M.add(v),z=h&&o.elevation?o.elevation.exaggeration()*h.getElevationAt(L.x,L.y,!0):0,N=o.projection.projectTilePoint(L.x,L.y,E);if(z>0){const ne=o.projection.upVector(E,L.x,L.y);N.x+=ne[0]*C*z,N.y+=ne[1]*C*z,N.z+=ne[2]*C*z}const q=p?L:bL(N.x,N.y,N.z,c),ee=p?i.tilespaceRays.map(ne=>TL(ne,z)):i.queryGeometry.screenGeometry,de=Dc([],[N.x,N.y,N.z,1],c);if(!_&&p?b*=de[3]/o.cameraToCenterDistance:_&&!p&&(b*=o.cameraToCenterDistance/de[3]),p){const ne=Nr((M.y/Et+E.y)/(1<<E.z));b/=o.projection.pixelsPerMeter(ne,1)/Jo(1,ne)}if(gL(ee,q,b))return!0}return!1}function bL(i,n,o,c){const h=Dc([],[i,n,o,1],c);return new ze(h[0]/h[3],h[1]/h[3])}const KE=Xu(0,0,0),EL=Xu(0,0,1);function TL(i,n){const o=Zv();return KE[2]=n,i.intersectsPlane(KE,EL,o),new ze(o[0],o[1])}class JE extends cx{}function YE(i,{width:n,height:o},c,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==n*o*c)throw new RangeError("mismatched image size")}else h=new Uint8Array(n*o*c);return i.width=n,i.height=o,i.data=h,i}function QE(i,n,o){const{width:c,height:h}=n;c===i.width&&h===i.height||(dx(i,n,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,c),height:Math.min(i.height,h)},o),i.width=c,i.height=h,i.data=n.data)}function dx(i,n,o,c,h,p){if(h.width===0||h.height===0)return n;if(h.width>i.width||h.height>i.height||o.x>i.width-h.width||o.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>n.width||h.height>n.height||c.x>n.width-h.width||c.y>n.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=n.data;for(let b=0;b<h.height;b++){const E=((o.y+b)*i.width+o.x)*p,C=((c.y+b)*n.width+c.x)*p;for(let P=0;P<h.width*p;P++)v[C+P]=_[E+P]}return n}ft(JE,"HeatmapBucket",{omit:["layers"]});class la{constructor(n,o){YE(this,n,1,o)}resize(n){QE(this,new la(n),1)}clone(){return new la({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,h,p){dx(n,o,c,h,p,1)}}class ki{constructor(n,o){YE(this,n,4,o)}resize(n){QE(this,new ki(n),4)}replace(n,o){o?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new ki({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,o,c,h,p){dx(n,o,c,h,p,4)}}ft(la,"AlphaImage"),ft(ki,"RGBAImage");var SL={paint:new se({"heatmap-radius":new H(Be.paint_heatmap["heatmap-radius"]),"heatmap-weight":new H(Be.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new F(Be.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ie(Be.paint_heatmap["heatmap-color"]),"heatmap-opacity":new F(Be.paint_heatmap["heatmap-opacity"])})};function fx(i){const n={},o=i.resolution||256,c=i.clips?i.clips.length:1,h=i.image||new ki({width:o,height:c}),p=(_,v,b)=>{n[i.evaluationKey]=b;const E=i.expression.evaluate(n);h.data[_+v+0]=Math.floor(255*E.r/E.a),h.data[_+v+1]=Math.floor(255*E.g/E.a),h.data[_+v+2]=Math.floor(255*E.b/E.a),h.data[_+v+3]=Math.floor(255*E.a)};if(i.clips)for(let _=0,v=0;_<c;++_,v+=4*o)for(let b=0,E=0;b<o;b++,E+=4){const C=b/(o-1),{start:P,end:M}=i.clips[_];p(v,E,P*(1-C)+M*C)}else for(let _=0,v=0;_<o;_++,v+=4)p(0,v,_/(o-1));return h}var IL={paint:new se({"hillshade-illumination-direction":new F(Be.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new F(Be.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new F(Be.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new F(Be.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new F(Be.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new F(Be.paint_hillshade["hillshade-accent-color"])})};const CL=be([{name:"a_pos",components:2,type:"Int16"}],4),{members:AL}=CL;var px={exports:{}};function Sg(i,n,o){o=o||2;var c,h,p,_,v,b,E,C=n&&n.length,P=C?n[0]*o:i.length,M=eT(i,0,P,o,!0),L=[];if(!M||M.next===M.prev)return L;if(C&&(M=function(N,q,ee,de){var ne,ue,pe,fe=[];for(ne=0,ue=q.length;ne<ue;ne++)(pe=eT(N,q[ne]*de,ne<ue-1?q[ne+1]*de:N.length,de,!1))===pe.next&&(pe.steiner=!0),fe.push(OL(pe));for(fe.sort(DL),ne=0;ne<fe.length;ne++)ee=LL(fe[ne],ee);return ee}(i,n,M,o)),i.length>80*o){c=p=i[0],h=_=i[1];for(var z=o;z<P;z+=o)(v=i[z])<c&&(c=v),(b=i[z+1])<h&&(h=b),v>p&&(p=v),b>_&&(_=b);E=(E=Math.max(p-c,_-h))!==0?32767/E:0}return Pf(M,L,o,c,h,E,0),L}function eT(i,n,o,c,h){var p,_;if(h===_x(i,n,o,c)>0)for(p=n;p<o;p+=c)_=rT(p,i[p],i[p+1],_);else for(p=o-c;p>=n;p-=c)_=rT(p,i[p],i[p+1],_);return _&&Ig(_,_.next)&&(Mf(_),_=_.next),_}function Fc(i,n){if(!i)return i;n||(n=i);var o,c=i;do if(o=!1,c.steiner||!Ig(c,c.next)&&er(c.prev,c,c.next)!==0)c=c.next;else{if(Mf(c),(c=n=c.prev)===c.next)break;o=!0}while(o||c!==n);return n}function Pf(i,n,o,c,h,p,_){if(i){!_&&p&&function(C,P,M,L){var z=C;do z.z===0&&(z.z=mx(z.x,z.y,P,M,L)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==C);z.prevZ.nextZ=null,z.prevZ=null,function(N){var q,ee,de,ne,ue,pe,fe,Me,Ae=1;do{for(ee=N,N=null,ue=null,pe=0;ee;){for(pe++,de=ee,fe=0,q=0;q<Ae&&(fe++,de=de.nextZ);q++);for(Me=Ae;fe>0||Me>0&&de;)fe!==0&&(Me===0||!de||ee.z<=de.z)?(ne=ee,ee=ee.nextZ,fe--):(ne=de,de=de.nextZ,Me--),ue?ue.nextZ=ne:N=ne,ne.prevZ=ue,ue=ne;ee=de}ue.nextZ=null,Ae*=2}while(pe>1)}(z)}(i,c,h,p);for(var v,b,E=i;i.prev!==i.next;)if(v=i.prev,b=i.next,p?kL(i,c,h,p):PL(i))n.push(v.i/o|0),n.push(i.i/o|0),n.push(b.i/o|0),Mf(i),i=b.next,E=b.next;else if((i=b)===E){_?_===1?Pf(i=ML(Fc(i),n,o),n,o,c,h,p,2):_===2&&RL(i,n,o,c,h,p):Pf(Fc(i),n,o,c,h,p,1);break}}}function PL(i){var n=i.prev,o=i,c=i.next;if(er(n,o,c)>=0)return!1;for(var h=n.x,p=o.x,_=c.x,v=n.y,b=o.y,E=c.y,C=h<p?h<_?h:_:p<_?p:_,P=v<b?v<E?v:E:b<E?b:E,M=h>p?h>_?h:_:p>_?p:_,L=v>b?v>E?v:E:b>E?b:E,z=c.next;z!==n;){if(z.x>=C&&z.x<=M&&z.y>=P&&z.y<=L&&th(h,v,p,b,_,E,z.x,z.y)&&er(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function kL(i,n,o,c){var h=i.prev,p=i,_=i.next;if(er(h,p,_)>=0)return!1;for(var v=h.x,b=p.x,E=_.x,C=h.y,P=p.y,M=_.y,L=v<b?v<E?v:E:b<E?b:E,z=C<P?C<M?C:M:P<M?P:M,N=v>b?v>E?v:E:b>E?b:E,q=C>P?C>M?C:M:P>M?P:M,ee=mx(L,z,n,o,c),de=mx(N,q,n,o,c),ne=i.prevZ,ue=i.nextZ;ne&&ne.z>=ee&&ue&&ue.z<=de;){if(ne.x>=L&&ne.x<=N&&ne.y>=z&&ne.y<=q&&ne!==h&&ne!==_&&th(v,C,b,P,E,M,ne.x,ne.y)&&er(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,ue.x>=L&&ue.x<=N&&ue.y>=z&&ue.y<=q&&ue!==h&&ue!==_&&th(v,C,b,P,E,M,ue.x,ue.y)&&er(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;ne&&ne.z>=ee;){if(ne.x>=L&&ne.x<=N&&ne.y>=z&&ne.y<=q&&ne!==h&&ne!==_&&th(v,C,b,P,E,M,ne.x,ne.y)&&er(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;ue&&ue.z<=de;){if(ue.x>=L&&ue.x<=N&&ue.y>=z&&ue.y<=q&&ue!==h&&ue!==_&&th(v,C,b,P,E,M,ue.x,ue.y)&&er(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function ML(i,n,o){var c=i;do{var h=c.prev,p=c.next.next;!Ig(h,p)&&tT(h,c,c.next,p)&&kf(h,p)&&kf(p,h)&&(n.push(h.i/o|0),n.push(c.i/o|0),n.push(p.i/o|0),Mf(c),Mf(c.next),c=i=p),c=c.next}while(c!==i);return Fc(c)}function RL(i,n,o,c,h,p){var _=i;do{for(var v=_.next.next;v!==_.prev;){if(_.i!==v.i&&BL(_,v)){var b=nT(_,v);return _=Fc(_,_.next),b=Fc(b,b.next),Pf(_,n,o,c,h,p,0),void Pf(b,n,o,c,h,p,0)}v=v.next}_=_.next}while(_!==i)}function DL(i,n){return i.x-n.x}function LL(i,n){var o=function(h,p){var _,v=p,b=h.x,E=h.y,C=-1/0;do{if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){var P=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(P<=b&&P>C&&(C=P,_=v.x<v.next.x?v:v.next,P===b))return _}v=v.next}while(v!==p);if(!_)return null;var M,L=_,z=_.x,N=_.y,q=1/0;v=_;do b>=v.x&&v.x>=z&&b!==v.x&&th(E<N?b:C,E,z,N,E<N?C:b,E,v.x,v.y)&&(M=Math.abs(E-v.y)/(b-v.x),kf(v,h)&&(M<q||M===q&&(v.x>_.x||v.x===_.x&&zL(_,v)))&&(_=v,q=M)),v=v.next;while(v!==L);return _}(i,n);if(!o)return n;var c=nT(o,i);return Fc(c,c.next),Fc(o,o.next)}function zL(i,n){return er(i.prev,i,n.prev)<0&&er(n.next,i,i.next)<0}function mx(i,n,o,c,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-o)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-c)*h|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function OL(i){var n=i,o=i;do(n.x<o.x||n.x===o.x&&n.y<o.y)&&(o=n),n=n.next;while(n!==i);return o}function th(i,n,o,c,h,p,_,v){return(h-_)*(n-v)>=(i-_)*(p-v)&&(i-_)*(c-v)>=(o-_)*(n-v)&&(o-_)*(p-v)>=(h-_)*(c-v)}function BL(i,n){return i.next.i!==n.i&&i.prev.i!==n.i&&!function(o,c){var h=o;do{if(h.i!==o.i&&h.next.i!==o.i&&h.i!==c.i&&h.next.i!==c.i&&tT(h,h.next,o,c))return!0;h=h.next}while(h!==o);return!1}(i,n)&&(kf(i,n)&&kf(n,i)&&function(o,c){var h=o,p=!1,_=(o.x+c.x)/2,v=(o.y+c.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==o);return p}(i,n)&&(er(i.prev,i,n.prev)||er(i,n.prev,n))||Ig(i,n)&&er(i.prev,i,i.next)>0&&er(n.prev,n,n.next)>0)}function er(i,n,o){return(n.y-i.y)*(o.x-n.x)-(n.x-i.x)*(o.y-n.y)}function Ig(i,n){return i.x===n.x&&i.y===n.y}function tT(i,n,o,c){var h=Ag(er(i,n,o)),p=Ag(er(i,n,c)),_=Ag(er(o,c,i)),v=Ag(er(o,c,n));return h!==p&&_!==v||!(h!==0||!Cg(i,o,n))||!(p!==0||!Cg(i,c,n))||!(_!==0||!Cg(o,i,c))||!(v!==0||!Cg(o,n,c))}function Cg(i,n,o){return n.x<=Math.max(i.x,o.x)&&n.x>=Math.min(i.x,o.x)&&n.y<=Math.max(i.y,o.y)&&n.y>=Math.min(i.y,o.y)}function Ag(i){return i>0?1:i<0?-1:0}function kf(i,n){return er(i.prev,i,i.next)<0?er(i,n,i.next)>=0&&er(i,i.prev,n)>=0:er(i,n,i.prev)<0||er(i,i.next,n)<0}function nT(i,n){var o=new gx(i.i,i.x,i.y),c=new gx(n.i,n.x,n.y),h=i.next,p=n.prev;return i.next=n,n.prev=i,o.next=h,h.prev=o,c.next=o,o.prev=c,p.next=c,c.prev=p,c}function rT(i,n,o,c){var h=new gx(i,n,o);return c?(h.next=c.next,h.prev=c,c.next.prev=h,c.next=h):(h.prev=h,h.next=h),h}function Mf(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function gx(i,n,o){this.i=i,this.x=n,this.y=o,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function _x(i,n,o,c){for(var h=0,p=n,_=o-c;p<o;p+=c)h+=(i[_]-i[p])*(i[p+1]+i[_+1]),_=p;return h}px.exports=Sg,px.exports.default=Sg,Sg.deviation=function(i,n,o,c){var h=n&&n.length,p=Math.abs(_x(i,0,h?n[0]*o:i.length,o));if(h)for(var _=0,v=n.length;_<v;_++)p-=Math.abs(_x(i,n[_]*o,_<v-1?n[_+1]*o:i.length,o));var b=0;for(_=0;_<c.length;_+=3){var E=c[_]*o,C=c[_+1]*o,P=c[_+2]*o;b+=Math.abs((i[E]-i[P])*(i[C+1]-i[E+1])-(i[E]-i[C])*(i[P+1]-i[E+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},Sg.flatten=function(i){for(var n=i[0][0].length,o={vertices:[],holes:[],dimensions:n},c=0,h=0;h<i.length;h++){for(var p=0;p<i[h].length;p++)for(var _=0;_<n;_++)o.vertices.push(i[h][p][_]);h>0&&o.holes.push(c+=i[h-1].length)}return o};var yx=Te(px.exports);function FL(i,n,o,c,h){iT(i,n,o||0,c||i.length-1,h||NL)}function iT(i,n,o,c,h){for(;c>o;){if(c-o>600){var p=c-o+1,_=n-o+1,v=Math.log(p),b=.5*Math.exp(2*v/3),E=.5*Math.sqrt(v*b*(p-b)/p)*(_-p/2<0?-1:1);iT(i,n,Math.max(o,Math.floor(n-_*b/p+E)),Math.min(c,Math.floor(n+(p-_)*b/p+E)),h)}var C=i[n],P=o,M=c;for(Rf(i,o,n),h(i[c],C)>0&&Rf(i,o,c);P<M;){for(Rf(i,P,M),P++,M--;h(i[P],C)<0;)P++;for(;h(i[M],C)>0;)M--}h(i[o],C)===0?Rf(i,o,M):Rf(i,++M,c),M<=n&&(o=M+1),n<=M&&(c=M-1)}}function Rf(i,n,o){var c=i[n];i[n]=i[o],i[o]=c}function NL(i,n){return i<n?-1:i>n?1:0}function vx(i,n){const o=i.length;if(o<=1)return[i];const c=[];let h,p;for(let _=0;_<o;_++){const v=Oa(i[_]);v!==0&&(i[_].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(h&&c.push(h),h=[i[_]]):h.push(i[_]))}if(h&&c.push(h),n>1)for(let _=0;_<c.length;_++)c[_].length<=n||(FL(c[_],n,1,c[_].length-1,jL),c[_]=c[_].slice(0,n));return c}function jL(i,n){return n.area-i.area}function xx(i,n,o){const c=o.patternDependencies;let h=!1;for(const p of n){const _=p.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,c[v]=!0)}return h}function wx(i,n,o,c,h){const p=h.patternDependencies;for(const _ of n){const v=_.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let b=v.evaluate({zoom:c},o,{},h.availableImages);b=b&&b.name?b.name:b,p[b]=!0,o.patterns[_.id]=b}}return o}class Pg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ke,this.indexArray=new yt,this.indexArray2=new Er,this.programConfigurations=new kc(n.layers,n.zoom),this.segments=new Qn,this.segments2=new Qn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.projection=n.projection}populate(n,o,c,h){this.hasPattern=xx("fill",this.layers,o);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:b,index:E,sourceLayerIndex:C}of n){const P=this.layers[0]._featureFilter.needGeometry,M=Oc(v,P);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),M,c))continue;const L=p?p.evaluate(M,{},c,o.availableImages):void 0,z={id:b,properties:v.properties,type:v.type,sourceLayerIndex:C,index:E,geometry:P?M.geometry:aa(v,c,h),patterns:{},sortKey:L};_.push(z)}p&&_.sort((v,b)=>v.sortKey-b.sortKey);for(const v of _){const{geometry:b,index:E,sourceLayerIndex:C}=v;if(this.hasPattern){const P=wx("fill",this.layers,v,this.zoom,o);this.patternFeatures.push(P)}else this.addFeature(v,b,E,c,{},o.availableImages);o.featureIndex.insert(n[E].feature,b,E,C,this.index)}}update(n,o,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,h)}addFeatures(n,o,c,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,AL),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,o,c,h,p,_=[]){for(const v of vx(o,500)){let b=0;for(const z of v)b+=z.length;const E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),C=E.vertexLength,P=[],M=[];for(const z of v){if(z.length===0)continue;z!==v[0]&&M.push(P.length/2);const N=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),q=N.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(q+z.length-1,q),P.push(z[0].x),P.push(z[0].y);for(let ee=1;ee<z.length;ee++)this.layoutVertexArray.emplaceBack(z[ee].x,z[ee].y),this.indexArray2.emplaceBack(q+ee-1,q+ee),P.push(z[ee].x),P.push(z[ee].y);N.vertexLength+=z.length,N.primitiveLength+=z.length}const L=yx(P,M);for(let z=0;z<L.length;z+=3)this.indexArray.emplaceBack(C+L[z],C+L[z+1],C+L[z+2]);E.vertexLength+=b,E.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,_,h)}}ft(Pg,"FillBucket",{omit:["layers","patternFeatures"]});const UL=new se({"fill-sort-key":new H(Be.layout_fill["fill-sort-key"])});var VL={paint:new se({"fill-antialias":new F(Be.paint_fill["fill-antialias"]),"fill-opacity":new H(Be.paint_fill["fill-opacity"]),"fill-color":new H(Be.paint_fill["fill-color"]),"fill-outline-color":new H(Be.paint_fill["fill-outline-color"]),"fill-translate":new F(Be.paint_fill["fill-translate"]),"fill-translate-anchor":new F(Be.paint_fill["fill-translate-anchor"]),"fill-pattern":new H(Be.paint_fill["fill-pattern"])}),layout:UL};const $L=be([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),GL=be([{name:"a_centroid_pos",components:2,type:"Uint16"}]),WL=be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qL}=$L;var kg={},HL=qe,oT=nh;function nh(i,n,o,c,h){this.properties={},this.extent=o,this.type=0,this._pbf=i,this._geometry=-1,this._keys=c,this._values=h,i.readFields(ZL,this,n)}function ZL(i,n,o){i==1?n.id=o.readVarint():i==2?function(c,h){for(var p=c.readVarint()+c.pos;c.pos<p;){var _=h._keys[c.readVarint()],v=h._values[c.readVarint()];h.properties[_]=v}}(o,n):i==3?n.type=o.readVarint():i==4&&(n._geometry=o.pos)}function XL(i){for(var n,o,c=0,h=0,p=i.length,_=p-1;h<p;_=h++)c+=((o=i[_]).x-(n=i[h]).x)*(n.y+o.y);return c}nh.types=["Unknown","Point","LineString","Polygon"],nh.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var n,o=i.readVarint()+i.pos,c=1,h=0,p=0,_=0,v=[];i.pos<o;){if(h<=0){var b=i.readVarint();c=7&b,h=b>>3}if(h--,c===1||c===2)p+=i.readSVarint(),_+=i.readSVarint(),c===1&&(n&&v.push(n),n=[]),n.push(new HL(p,_));else{if(c!==7)throw new Error("unknown command "+c);n&&n.push(n[0].clone())}}return n&&v.push(n),v},nh.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var n=i.readVarint()+i.pos,o=1,c=0,h=0,p=0,_=1/0,v=-1/0,b=1/0,E=-1/0;i.pos<n;){if(c<=0){var C=i.readVarint();o=7&C,c=C>>3}if(c--,o===1||o===2)(h+=i.readSVarint())<_&&(_=h),h>v&&(v=h),(p+=i.readSVarint())<b&&(b=p),p>E&&(E=p);else if(o!==7)throw new Error("unknown command "+o)}return[_,b,v,E]},nh.prototype.toGeoJSON=function(i,n,o){var c,h,p=this.extent*Math.pow(2,o),_=this.extent*i,v=this.extent*n,b=this.loadGeometry(),E=nh.types[this.type];function C(L){for(var z=0;z<L.length;z++){var N=L[z];L[z]=[360*(N.x+_)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(N.y+v)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(c=0;c<b.length;c++)P[c]=b[c][0];C(b=P);break;case 2:for(c=0;c<b.length;c++)C(b[c]);break;case 3:for(b=function(L){var z=L.length;if(z<=1)return[L];for(var N,q,ee=[],de=0;de<z;de++){var ne=XL(L[de]);ne!==0&&(q===void 0&&(q=ne<0),q===ne<0?(N&&ee.push(N),N=[L[de]]):N.push(L[de]))}return N&&ee.push(N),ee}(b),c=0;c<b.length;c++)for(h=0;h<b[c].length;h++)C(b[c][h])}b.length===1?b=b[0]:E="Multi"+E;var M={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(M.id=this.id),M};var KL=oT,sT=aT;function aT(i,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(JL,this,n),this.length=this._features.length}function JL(i,n,o){i===15?n.version=o.readVarint():i===1?n.name=o.readString():i===5?n.extent=o.readVarint():i===2?n._features.push(o.pos):i===3?n._keys.push(o.readString()):i===4&&n._values.push(function(c){for(var h=null,p=c.readVarint()+c.pos;c.pos<p;){var _=c.readVarint()>>3;h=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return h}(o))}aT.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var n=this._pbf.readVarint()+this._pbf.pos;return new KL(this._pbf,n,this.extent,this._keys,this._values)};var YL=sT;function QL(i,n,o){if(i===3){var c=new YL(o,o.readVarint()+o.pos);c.length&&(n[c.name]=c)}}var bx=kg.VectorTile=function(i,n){this.layers=i.readFields(QL,{},n)},Mg=kg.VectorTileFeature=oT;function Rg(i,n,o,c){const h=[],p=c===0?(_,v,b,E,C,P)=>{_.push(new ze(P,b+(P-v)/(E-v)*(C-b)))}:(_,v,b,E,C,P)=>{_.push(new ze(v+(P-b)/(C-b)*(E-v),P))};for(const _ of i){const v=[];for(const b of _){if(b.length<=2)continue;const E=[];for(let M=0;M<b.length-1;M++){const L=b[M].x,z=b[M].y,N=b[M+1].x,q=b[M+1].y,ee=c===0?L:z,de=c===0?N:q;ee<n?de>n&&p(E,L,z,N,q,n):ee>o?de<o&&p(E,L,z,N,q,o):E.push(b[M]),de<n&&ee>=n&&p(E,L,z,N,q,n),de>o&&ee<=o&&p(E,L,z,N,q,o)}let C=b[b.length-1];const P=c===0?C.x:C.y;P>=n&&P<=o&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),v.push(E))}v.length&&h.push(v)}return h}kg.VectorTileLayer=sT;const ez=Mg.types,tz=Math.pow(2,13);function Df(i,n,o,c,h,p,_,v){i.emplaceBack((n<<1)+_,(o<<1)+p,(Math.floor(c*tz)<<1)+h,Math.round(v))}function Lf(i,n,o){i.emplaceBack(n.x,n.y,n.z,o[0]*16384,o[1]*16384,o[2]*16384)}class lT{constructor(){this.acc=new ze(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new ze(n.x,n.y),this.max=new ze(n.x,n.y))}append(n,o){this.currentPolyCount.edges++,this.acc._add(n);const c=this.min,h=this.max;n.x<c.x?c.x=n.x:n.x>h.x&&(h.x=n.x),n.y<c.y?c.y=n.y:n.y>h.y&&(h.y=n.y),((n.x===0||n.x===Et)&&n.x===o.x)!=((n.y===0||n.y===Et)&&n.y===o.y)&&this.processBorderOverlap(n,o),o.x<0!=n.x<0&&this.addBorderIntersection(0,Jt(o.y,n.y,(0-o.x)/(n.x-o.x))),o.x>Et!=n.x>Et&&this.addBorderIntersection(1,Jt(o.y,n.y,(Et-o.x)/(n.x-o.x))),o.y<0!=n.y<0&&this.addBorderIntersection(2,Jt(o.x,n.x,(0-o.y)/(n.y-o.y))),o.y>Et!=n.y>Et&&this.addBorderIntersection(3,Jt(o.x,n.x,(Et-o.y)/(n.y-o.y)))}addBorderIntersection(n,o){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[n];o<c[0]&&(c[0]=o),o>c[1]&&(c[1]=o)}processBorderOverlap(n,o){if(n.x===o.x){if(n.y===o.y)return;const c=n.x===0?0:1;this.addBorderIntersection(c,o.y),this.addBorderIntersection(c,n.y)}else{const c=n.y===0?2:3;this.addBorderIntersection(c,o.x),this.addBorderIntersection(c,n.x)}}centroid(){const n=this.polyCount.reduce((o,c)=>o+c.edges,0);return n!==0?this.acc.div(n)._round():new ze(0,0)}span(){return new ze(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,o)=>n+ +(o[0]!==Number.MAX_VALUE),0)}}class zf{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.layoutVertexArray=new Ue,this.centroidVertexArray=new qo,this.indexArray=new yt,this.programConfigurations=new kc(n.layers,n.zoom),this.segments=new Qn,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id),this.enableTerrain=n.enableTerrain}populate(n,o,c,h){this.features=[],this.hasPattern=xx("fill-extrusion",this.layers,o),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(p){const _=Math.exp(Math.PI*(1-p.y/(1<<p.z)*2));return 80150034*_/(_*_+1)/Et/(1<<p.z)}(c),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:_,index:v,sourceLayerIndex:b}of n){const E=this.layers[0]._featureFilter.needGeometry,C=Oc(p,E);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),C,c))continue;const P={id:_,sourceLayerIndex:b,index:v,geometry:E?C.geometry:aa(p,c,h),properties:p.properties,type:p.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(wx("fill-extrusion",this.layers,P,this.zoom,o)):this.addFeature(P,P.geometry,v,c,{},o.availableImages,h),o.featureIndex.insert(p,P.geometry,v,b,this.index,M)}this.sortBorders()}addFeatures(n,o,c,h,p){for(const _ of this.features){const{geometry:v}=_;this.addFeature(_,v,_.index,o,c,h,p)}this.sortBorders()}update(n,o,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qL),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,WL.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,GL.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,o,c,h,p,_,v){const b=[new ze(0,0),new ze(Et,Et)],E=v.projection,C=E.name==="globe",P=this.enableTerrain&&!C?new lT:null,M=ez[n.type]==="Polygon";C&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ye);const L=vx(o,500);for(let ee=L.length-1;ee>=0;ee--){const de=L[ee];(de.length===0||(z=de[0]).every(ne=>ne.x<=0)||z.every(ne=>ne.x>=Et)||z.every(ne=>ne.y<=0)||z.every(ne=>ne.y>=Et))&&L.splice(ee,1)}var z;let N;if(C)N=mT(L,b,h);else{N=[];for(const ee of L)N.push({polygon:ee,bounds:b})}const q=M?this.edgeRadius:0;for(const{polygon:ee,bounds:de}of N){let ne=0,ue=0;for(const fe of ee)M&&!fe[0].equals(fe[fe.length-1])&&fe.push(fe[0]),ue+=M?fe.length-1:fe.length;const pe=this.segments.prepareSegment((M?5:4)*ue,this.layoutVertexArray,this.indexArray);if(M){const fe=[],Me=[];ne=pe.vertexLength;for(const Fe of ee){let Je,De;Fe.length&&Fe!==ee[0]&&Me.push(fe.length/2),Je=Fe[1].sub(Fe[0])._perp()._unit();for(let Ve=1;Ve<Fe.length;Ve++){const $e=Fe[Ve],He=Fe[Ve===Fe.length-1?1:Ve+1];let{x:nt,y:Oe}=$e;if(q){De=He.sub($e)._perp()._unit();const lt=Je.add(De)._unit(),gt=q*Math.min(4,1/(Je.x*lt.x+Je.y*lt.y));nt+=gt*lt.x,Oe+=gt*lt.y,Je=De}Df(this.layoutVertexArray,nt,Oe,0,0,1,1,0),pe.vertexLength++,fe.push($e.x,$e.y),C&&Lf(this.layoutVertexExtArray,E.projectTilePoint(nt,Oe,h),E.upVector(h,nt,Oe))}}const Ae=yx(fe,Me);for(let Fe=0;Fe<Ae.length;Fe+=3)this.indexArray.emplaceBack(ne+Ae[Fe],ne+Ae[Fe+2],ne+Ae[Fe+1]),pe.primitiveLength++}for(const fe of ee){P&&fe.length&&P.startRing(fe[0]);let Me,Ae,Fe,Je=fe.length>4&&dT(fe[fe.length-2],fe[0],fe[1]),De=q?nz(fe[fe.length-2],fe[0],fe[1],q):0;Ae=fe[1].sub(fe[0])._perp()._unit();let Ve=!0;for(let $e=1,He=0;$e<fe.length;$e++){let nt=fe[$e-1],Oe=fe[$e];const lt=fe[$e===fe.length-1?1:$e+1];if(P&&M&&P.currentPolyCount.top++,hT(Oe,nt,de)){q&&(Ae=lt.sub(Oe)._perp()._unit(),Ve=!Ve);continue}P&&P.append(Oe,nt);const gt=Oe.sub(nt)._perp(),ct=gt.x/(Math.abs(gt.x)+Math.abs(gt.y)),Pt=gt.y>0?1:0,rt=nt.dist(Oe);if(He+rt>32768&&(He=0),q){Fe=lt.sub(Oe)._perp()._unit();let Mt=uT(nt,Oe,lt,cT(Ae,Fe),q);isNaN(Mt)&&(Mt=0);const It=Oe.sub(nt)._unit();nt=nt.add(It.mult(De))._round(),Oe=Oe.add(It.mult(-Mt))._round(),De=Mt,Ae=Fe}const wt=pe.vertexLength,kt=fe.length>4&&dT(nt,Oe,lt);let en=fT(He,Je,Ve);if(Df(this.layoutVertexArray,nt.x,nt.y,ct,Pt,0,0,en),Df(this.layoutVertexArray,nt.x,nt.y,ct,Pt,0,1,en),He+=rt,en=fT(He,kt,!Ve),Je=kt,Df(this.layoutVertexArray,Oe.x,Oe.y,ct,Pt,0,0,en),Df(this.layoutVertexArray,Oe.x,Oe.y,ct,Pt,0,1,en),pe.vertexLength+=4,this.indexArray.emplaceBack(wt+0,wt+1,wt+2),this.indexArray.emplaceBack(wt+1,wt+3,wt+2),pe.primitiveLength+=2,q){const Mt=ne+($e===1?fe.length-2:$e-2),It=$e===1?ne:Mt+1;if(this.indexArray.emplaceBack(wt+1,Mt,wt+3),this.indexArray.emplaceBack(Mt,It,wt+3),pe.primitiveLength+=2,Me===void 0&&(Me=wt),!hT(lt,fe[$e],de)){const Cn=$e===fe.length-1?Me:pe.vertexLength;this.indexArray.emplaceBack(wt+2,wt+3,Cn),this.indexArray.emplaceBack(wt+3,Cn+1,Cn),this.indexArray.emplaceBack(wt+3,It,Cn+1),pe.primitiveLength+=3}Ve=!Ve}if(C){const Mt=this.layoutVertexExtArray,It=E.projectTilePoint(nt.x,nt.y,h),Cn=E.projectTilePoint(Oe.x,Oe.y,h),zt=E.upVector(h,nt.x,nt.y),Ot=E.upVector(h,Oe.x,Oe.y);Lf(Mt,It,zt),Lf(Mt,It,zt),Lf(Mt,Cn,Ot),Lf(Mt,Cn,Ot)}}M&&(ne+=fe.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ee=P.borders,de=this.featuresOnBorder.push(P)-1;for(let ne=0;ne<4;ne++)ee[ne][0]!==Number.MAX_VALUE&&this.borders[ne].push(de)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,_,h)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((o,c)=>this.featuresOnBorder[o].borders[n][0]-this.featuresOnBorder[c].borders[n][0])}encodeCentroid(n,o,c=!0){let h,p;if(n)if(n.y!==0){const v=o.span()._mult(this.tileToMeter);h=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(v.x/10)),p=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(v.y/10))}else h=Math.ceil(7*(n.x+450)),p=0;else h=0,p=+c;let _=c?this.centroidVertexArray.length:o.vertexArrayOffset;for(const v of o.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*v.edges+v.top);for(let b=0;b<v.top;b++)this.centroidVertexArray.emplace(_++,h,p);for(let b=0;b<2*v.edges;b++)this.centroidVertexArray.emplace(_++,0,p),this.centroidVertexArray.emplace(_++,h,p)}}}function cT(i,n){const o=i.add(n)._unit();return i.x*o.x+i.y*o.y}function nz(i,n,o,c){const h=n.sub(i)._perp()._unit(),p=o.sub(n)._perp()._unit();return uT(i,n,o,cT(h,p),c)}function uT(i,n,o,c,h){const p=Math.sqrt(1-c*c);return Math.min(i.dist(n)/3,n.dist(o)/3,h*p/c)}function hT(i,n,o){return i.x<o[0].x&&n.x<o[0].x||i.x>o[1].x&&n.x>o[1].x||i.y<o[0].y&&n.y<o[0].y||i.y>o[1].y&&n.y>o[1].y}function dT(i,n,o){if(i.x<0||i.x>=Et||n.x<0||n.x>=Et||o.x<0||o.x>=Et)return!1;const c=o.sub(n),h=c.perp(),p=i.sub(n);return(c.x*p.x+c.y*p.y)/Math.sqrt((c.x*c.x+c.y*c.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function fT(i,n,o){const c=n?2|i:-3&i;return o?1|c:-2&c}function pT(){const i=Math.PI/32,n=Math.tan(i),o=Af;return o*Math.sqrt(1+2*n*n)-o}function mT(i,n,o){const c=1<<o.z,h=Hi(o.x/c),p=Hi((o.x+1)/c),_=Nr(o.y/c),v=Nr((o.y+1)/c);return function(b,E,C,P,M=0,L){const z=[];if(!b.length||!C||!P)return z;const N=(fe,Me)=>{for(const Ae of fe)z.push({polygon:Ae,bounds:Me})},q=Math.ceil(Math.log2(C)),ee=Math.ceil(Math.log2(P)),de=q-ee,ne=[];for(let fe=0;fe<Math.abs(de);fe++)ne.push(de>0?0:1);for(let fe=0;fe<Math.min(q,ee);fe++)ne.push(0),ne.push(1);let ue=b;if(ue=Rg(ue,E[0].y-M,E[1].y+M,1),ue=Rg(ue,E[0].x-M,E[1].x+M,0),!ue.length)return z;const pe=[];for(ne.length?pe.push({polygons:ue,bounds:E,depth:0}):N(ue,E);pe.length;){const fe=pe.pop(),Me=fe.depth,Ae=ne[Me],Fe=fe.bounds[0],Je=fe.bounds[1],De=Ae===0?Fe.x:Fe.y,Ve=Ae===0?Je.x:Je.y,$e=L?L(Ae,De,Ve):.5*(De+Ve),He=Rg(fe.polygons,De-M,$e+M,Ae),nt=Rg(fe.polygons,$e-M,Ve+M,Ae);if(He.length){const Oe=[Fe,new ze(Ae===0?$e:Je.x,Ae===1?$e:Je.y)];ne.length>Me+1?pe.push({polygons:He,bounds:Oe,depth:Me+1}):N(He,Oe)}if(nt.length){const Oe=[new ze(Ae===0?$e:Fe.x,Ae===1?$e:Fe.y),Je];ne.length>Me+1?pe.push({polygons:nt,bounds:Oe,depth:Me+1}):N(nt,Oe)}}return z}(i,n,Math.ceil((p-h)/11.25),Math.ceil((_-v)/11.25),1,(b,E,C)=>{if(b===0)return .5*(E+C);{const P=Nr((o.y+E/Et)/c);return(bs(.5*(Nr((o.y+C/Et)/c)+P))*c-o.y)*Et}})}ft(zf,"FillExtrusionBucket",{omit:["layers","features"]}),ft(lT,"PartMetadata");const rz=new se({"fill-extrusion-edge-radius":new F(Be["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var iz={paint:new se({"fill-extrusion-opacity":new F(Be["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new H(Be["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new F(Be["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new F(Be["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new H(Be["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new H(Be["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new H(Be["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new F(Be["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new F(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new F(Be["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new F(Be["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:rz};function gT(i,n,o){var c=2*Math.PI*6378137/256/Math.pow(2,o);return[i*c-2*Math.PI*6378137/2,n*c-2*Math.PI*6378137/2]}class Dg{constructor(n,o,c){this.z=n,this.x=o,this.y=c,this.key=Of(0,n,n,o,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,o){const c=function(p,_,v){var b=gT(256*p,256*(_=Math.pow(2,v)-_-1),v),E=gT(256*(p+1),256*(_+1),v);return b[0]+","+b[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(p,_,v){let b,E="";for(let C=p;C>0;C--)b=1<<C-1,E+=(_&b?1:0)+(v&b?2:0);return E}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class _T{constructor(n,o){this.wrap=n,this.canonical=o,this.key=Of(n,o.z,o.z,o.x,o.y)}}class ii{constructor(n,o,c,h,p){this.overscaledZ=n,this.wrap=o,this.canonical=new Dg(c,+h,+p),this.key=o===0&&n===c?this.canonical.key:Of(o,n,c,h,p)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const o=this.canonical.z-n;return n>this.canonical.z?new ii(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ii(n,this.wrap,n,this.canonical.x>>o,this.canonical.y>>o)}calculateScaledKey(n,o=!0){if(this.overscaledZ===n&&o)return this.key;if(n>this.canonical.z)return Of(this.wrap*+o,n,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-n;return Of(this.wrap*+o,n,n,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const o=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>o&&n.canonical.y===this.canonical.y>>o}children(n){if(this.overscaledZ>=n)return[new ii(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const o=this.canonical.z+1,c=2*this.canonical.x,h=2*this.canonical.y;return[new ii(o,this.wrap,o,c,h),new ii(o,this.wrap,o,c+1,h),new ii(o,this.wrap,o,c,h+1),new ii(o,this.wrap,o,c+1,h+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ii(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ii(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new _T(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Of(i,n,o,c,h){const p=1<<Math.min(o,22);let _=p*(h%p)+c%p;return i&&o<22&&(_+=p*p*((i<0?-2*i-1:2*i)%(1<<2*(22-o)))),16*(32*_+o)+(n-o)}ft(Dg,"CanonicalTileID"),ft(ii,"OverscaledTileID",{omit:["projMatrix"]});class rh extends ze{constructor(n,o,c){super(n,o),this.z=c}}function Bf(i,n){return i.x*n.x+i.y*n.y}function yT(i,n){if(i.length===1){let o=0;const c=n[o++];let h;for(;!h||c.equals(h);)if(h=n[o++],!h)return 1/0;for(;o<n.length;o++){const p=n[o],_=i[0],v=h.sub(c),b=p.sub(c),E=_.sub(c),C=Bf(v,v),P=Bf(v,b),M=Bf(b,b),L=Bf(E,v),z=Bf(E,b),N=C*M-P*P,q=(M*L-P*z)/N,ee=(C*z-P*L)/N,de=c.z*(1-q-ee)+h.z*q+p.z*ee;if(isFinite(de))return de}return 1/0}{let o=1/0;for(const c of n)o=Math.min(o,c.z);return o}}function vT(i,n,o,c,h,p,_,v){const b=_*h.getElevationAt(i,n,!0,!0),E=p[0]!==0,C=E?p[1]===0?_*(p[0]/7-450):_*function(P,M,L){const z=Math.floor(M[0]/8),N=Math.floor(M[1]/8),q=10*(M[0]-8*z),ee=10*(M[1]-8*N),de=P.getElevationAt(z,N,!0,!0),ne=P.getMeterToDEM(L),ue=Math.floor(.5*(q*ne-1)),pe=Math.floor(.5*(ee*ne-1)),fe=P.tileCoordToPixel(z,N),Me=2*ue+1,Ae=2*pe+1,Fe=function(nt,Oe,lt,gt,ct){return[nt.getElevationAtPixel(Oe,lt,!0),nt.getElevationAtPixel(Oe+ct,lt,!0),nt.getElevationAtPixel(Oe,lt+ct,!0),nt.getElevationAtPixel(Oe+gt,lt+ct,!0)]}(P,fe.x-ue,fe.y-pe,Me,Ae),Je=Math.abs(Fe[0]-Fe[1]),De=Math.abs(Fe[2]-Fe[3]),Ve=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),$e=Math.min(.25,.5*ne*(Je+De)/Me),He=Math.min(.25,.5*ne*Ve/Ae);return de+Math.max($e*q,He*ee)}(h,p,v):b;return{base:b+(o===0)?-1:o,top:E?Math.max(C+c,b+o+2):b+c}}const oz=be([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sz}=oz,az=be([{name:"a_packed",components:4,type:"Float32"}]),{members:lz}=az,cz=Mg.types,uz=Math.cos(Math.PI/180*37.5);class Lg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(o=>o.id),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(o=>{this.gradients[o.id]={}}),this.layoutVertexArray=new Re,this.layoutVertexArray2=new Ze,this.indexArray=new yt,this.programConfigurations=new kc(n.layers,n.zoom),this.segments=new Qn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(o=>o.isStateDependent()).map(o=>o.id)}populate(n,o,c,h){this.hasPattern=xx("line",this.layers,o);const p=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:C,id:P,index:M,sourceLayerIndex:L}of n){const z=this.layers[0]._featureFilter.needGeometry,N=Oc(C,z);if(!this.layers[0]._featureFilter.filter(new A(this.zoom),N,c))continue;const q=p?p.evaluate(N,{},c):void 0,ee={id:P,properties:C.properties,type:C.type,sourceLayerIndex:L,index:M,geometry:z?N.geometry:aa(C,c,h),patterns:{},sortKey:q};_.push(ee)}p&&_.sort((C,P)=>C.sortKey-P.sortKey);const{lineAtlas:v,featureIndex:b}=o,E=this.addConstantDashes(v);for(const C of _){const{geometry:P,index:M,sourceLayerIndex:L}=C;if(E&&this.addFeatureDashes(C,v),this.hasPattern){const z=wx("line",this.layers,C,this.zoom,o);this.patternFeatures.push(z)}else this.addFeature(C,P,M,c,v.positions,o.availableImages);b.insert(n[M].feature,P,M,L,this.index)}}addConstantDashes(n){let o=!1;for(const c of this.layers){const h=c.paint.get("line-dasharray").value,p=c.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")o=!0;else{const _=p.value,v=h.value;if(!v)continue;n.addDash(v,_)}}return o}addFeatureDashes(n,o){const c=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let v,b;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:c},n);b=_.kind==="constant"?_.value:_.evaluate({zoom:c},n),o.addDash(v,b),n.patterns[h.id]=o.getKey(v,b)}}update(n,o,c,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,o,this.stateDependentLayers,c,h)}addFeatures(n,o,c,h,p){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,o,c,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,lz)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,sz),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,o,c,h,p,_){const v=this.layers[0].layout,b=v.get("line-join").evaluate(n,{}),E=v.get("line-cap").evaluate(n,{}),C=v.get("line-miter-limit"),P=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const M of o)this.addLine(M,n,b,E,C,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,p,_,h)}addLine(n,o,c,h,p,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<n.length-1;ee++)this.totalDistance+=n[ee].dist(n[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=cz[o.type]==="Polygon";let b=n.length;for(;b>=2&&n[b-1].equals(n[b-2]);)b--;let E=0;for(;E<b-1&&n[E].equals(n[E+1]);)E++;if(b<(v?3:2))return;c==="bevel"&&(p=1.05);const C=this.overscaling<=16?15*Et/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let M,L,z,N,q;this.e1=this.e2=-1,v&&(M=n[b-2],q=n[E].sub(M)._unit()._perp());for(let ee=E;ee<b;ee++){if(z=ee===b-1?v?n[E+1]:void 0:n[ee+1],z&&n[ee].equals(z))continue;q&&(N=q),M&&(L=M),M=n[ee],q=z?z.sub(M)._unit()._perp():N,N=N||q;let de=N.add(q);de.x===0&&de.y===0||de._unit();const ne=N.x*q.x+N.y*q.y,ue=de.x*q.x+de.y*q.y,pe=ue!==0?1/ue:1/0,fe=2*Math.sqrt(2-2*ue),Me=ue<uz&&L&&z,Ae=N.x*q.y-N.y*q.x>0;if(Me&&ee>E){const De=M.dist(L);if(De>2*C){const Ve=M.sub(M.sub(L)._mult(C/De)._round());this.updateDistance(L,Ve),this.addCurrentVertex(Ve,N,0,0,P),L=Ve}}const Fe=L&&z;let Je=Fe?c:v?"butt":h;if(Fe&&Je==="round"&&(pe<_?Je="miter":pe<=2&&(Je="fakeround")),Je==="miter"&&pe>p&&(Je="bevel"),Je==="bevel"&&(pe>2&&(Je="flipbevel"),pe<p&&(Je="miter")),L&&this.updateDistance(L,M),Je==="miter")de._mult(pe),this.addCurrentVertex(M,de,0,0,P);else if(Je==="flipbevel"){if(pe>100)de=q.mult(-1);else{const De=pe*N.add(q).mag()/N.sub(q).mag();de._perp()._mult(De*(Ae?-1:1))}this.addCurrentVertex(M,de,0,0,P),this.addCurrentVertex(M,de.mult(-1),0,0,P)}else if(Je==="bevel"||Je==="fakeround"){const De=-Math.sqrt(pe*pe-1),Ve=Ae?De:0,$e=Ae?0:De;if(L&&this.addCurrentVertex(M,N,Ve,$e,P),Je==="fakeround"){const He=Math.round(180*fe/Math.PI/20);for(let nt=1;nt<He;nt++){let Oe=nt/He;if(Oe!==.5){const gt=Oe-.5;Oe+=Oe*gt*(Oe-1)*((1.0904+ne*(ne*(3.55645-1.43519*ne)-3.2452))*gt*gt+(.848013+ne*(.215638*ne-1.06021)))}const lt=q.sub(N)._mult(Oe)._add(N)._unit()._mult(Ae?-1:1);this.addHalfVertex(M,lt.x,lt.y,!1,Ae,0,P)}}z&&this.addCurrentVertex(M,q,-Ve,-$e,P)}else if(Je==="butt")this.addCurrentVertex(M,de,0,0,P);else if(Je==="square"){const De=L?1:-1;L||this.addCurrentVertex(M,de,De,De,P),this.addCurrentVertex(M,de,0,0,P),L&&this.addCurrentVertex(M,de,De,De,P)}else Je==="round"&&(L&&(this.addCurrentVertex(M,N,0,0,P),this.addCurrentVertex(M,N,1,1,P,!0)),z&&(this.addCurrentVertex(M,q,-1,-1,P,!0),this.addCurrentVertex(M,q,0,0,P)));if(Me&&ee<b-1){const De=M.dist(z);if(De>2*C){const Ve=M.add(z.sub(M)._mult(C/De)._round());this.updateDistance(M,Ve),this.addCurrentVertex(Ve,q,0,0,P),M=Ve}}}}addCurrentVertex(n,o,c,h,p,_=!1){const v=o.y*h-o.x,b=-o.y-o.x*h;this.addHalfVertex(n,o.x+o.y*c,o.y-o.x*c,_,!1,c,p),this.addHalfVertex(n,v,b,_,!0,-h,p)}addHalfVertex({x:n,y:o},c,h,p,_,v,b){this.layoutVertexArray.emplaceBack((n<<1)+(p?1:0),(o<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,o){this.distance+=n.dist(o),this.updateScaledDistance()}}ft(Lg,"LineBucket",{omit:["layers","patternFeatures"]});const hz=new se({"line-cap":new H(Be.layout_line["line-cap"]),"line-join":new H(Be.layout_line["line-join"]),"line-miter-limit":new F(Be.layout_line["line-miter-limit"]),"line-round-limit":new F(Be.layout_line["line-round-limit"]),"line-sort-key":new H(Be.layout_line["line-sort-key"])});var xT={paint:new se({"line-opacity":new H(Be.paint_line["line-opacity"]),"line-color":new H(Be.paint_line["line-color"]),"line-translate":new F(Be.paint_line["line-translate"]),"line-translate-anchor":new F(Be.paint_line["line-translate-anchor"]),"line-width":new H(Be.paint_line["line-width"]),"line-gap-width":new H(Be.paint_line["line-gap-width"]),"line-offset":new H(Be.paint_line["line-offset"]),"line-blur":new H(Be.paint_line["line-blur"]),"line-dasharray":new H(Be.paint_line["line-dasharray"]),"line-pattern":new H(Be.paint_line["line-pattern"]),"line-gradient":new ie(Be.paint_line["line-gradient"]),"line-trim-offset":new F(Be.paint_line["line-trim-offset"])}),layout:hz};const wT=new class extends H{possiblyEvaluate(i,n){return n=new A(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(i,n)}evaluate(i,n,o,c){return n=Yt({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(i,n,o,c)}}(xT.paint.properties["line-width"].specification);function bT(i,n){return n>0?n+2*i:i}wT.useIntegerZoom=!0;const dz=be([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),fz=be([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),pz=be([{name:"a_projected_pos",components:4,type:"Float32"}],4);be([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const mz=be([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),gz=be([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ET=be([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),_z=be([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);be([{name:"triangle",components:3,type:"Uint16"}]),be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),be([{type:"Float32",name:"offsetX"}]),be([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var kr=24;const Yo=128;function Ex(i,n){const{expression:o}=n;if(o.kind==="constant")return{kind:"constant",layoutSize:o.evaluate(new A(i+1))};if(o.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:h}=o;let p=0;for(;p<c.length&&c[p]<=i;)p++;p=Math.max(0,p-1);let _=p;for(;_<c.length&&c[_]<i+1;)_++;_=Math.min(c.length-1,_);const v=c[p],b=c[_];return o.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:b,minSize:o.evaluate(new A(v)),maxSize:o.evaluate(new A(b)),interpolationType:h}}}function zg(i,{uSize:n,uSizeT:o},{lowerSize:c,upperSize:h}){return i.kind==="source"?c/Yo:i.kind==="composite"?Jt(c/Yo,h/Yo,o):n}function ih(i,n){let o=0,c=0;if(i.kind==="constant")c=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:_}=i,v=h?ot(mo.interpolationFactor(h,n,p,_),0,1):0;i.kind==="camera"?c=Jt(i.minSize,i.maxSize,v):o=v}return{uSizeT:o,uSize:c}}var yz=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Yo,evaluateSizeForFeature:zg,evaluateSizeForZoom:ih,getSizeData:Ex});function vz(i,n,o){return i.sections.forEach(c=>{c.text=function(h,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),S.applyArabicShaping&&(h=S.applyArabicShaping(h)),h}(c.text,n,o)}),i}const Ff={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function xz(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}function wz(i){return i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""||i===""}var TT=bn,ST=function(i,n,o,c,h){var p,_,v=8*h-c-1,b=(1<<v)-1,E=b>>1,C=-7,P=o?h-1:0,M=o?-1:1,L=i[n+P];for(P+=M,p=L&(1<<-C)-1,L>>=-C,C+=v;C>0;p=256*p+i[n+P],P+=M,C-=8);for(_=p&(1<<-C)-1,p>>=-C,C+=c;C>0;_=256*_+i[n+P],P+=M,C-=8);if(p===0)p=1-E;else{if(p===b)return _?NaN:1/0*(L?-1:1);_+=Math.pow(2,c),p-=E}return(L?-1:1)*_*Math.pow(2,p-c)},IT=function(i,n,o,c,h,p){var _,v,b,E=8*p-h-1,C=(1<<E)-1,P=C>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=c?0:p-1,z=c?1:-1,N=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(v=isNaN(n)?1:0,_=C):(_=Math.floor(Math.log(n)/Math.LN2),n*(b=Math.pow(2,-_))<1&&(_--,b*=2),(n+=_+P>=1?M/b:M*Math.pow(2,1-P))*b>=2&&(_++,b/=2),_+P>=C?(v=0,_=C):_+P>=1?(v=(n*b-1)*Math.pow(2,h),_+=P):(v=n*Math.pow(2,P-1)*Math.pow(2,h),_=0));h>=8;i[o+L]=255&v,L+=z,v/=256,h-=8);for(_=_<<h|v,E+=h;E>0;i[o+L]=255&_,L+=z,_/=256,E-=8);i[o+L-z]|=128*N};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function bn(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}bn.Varint=0,bn.Fixed64=1,bn.Bytes=2,bn.Fixed32=5;var Tx=4294967296,CT=1/Tx,AT=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ca(i){return i.type===bn.Bytes?i.readVarint()+i.pos:i.pos+1}function oh(i,n,o){return o?4294967296*n+(i>>>0):4294967296*(n>>>0)+(i>>>0)}function PT(i,n,o){var c=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));o.realloc(c);for(var h=o.pos-1;h>=i;h--)o.buf[h+c]=o.buf[h]}function bz(i,n){for(var o=0;o<i.length;o++)n.writeVarint(i[o])}function Ez(i,n){for(var o=0;o<i.length;o++)n.writeSVarint(i[o])}function Tz(i,n){for(var o=0;o<i.length;o++)n.writeFloat(i[o])}function Sz(i,n){for(var o=0;o<i.length;o++)n.writeDouble(i[o])}function Iz(i,n){for(var o=0;o<i.length;o++)n.writeBoolean(i[o])}function Cz(i,n){for(var o=0;o<i.length;o++)n.writeFixed32(i[o])}function Az(i,n){for(var o=0;o<i.length;o++)n.writeSFixed32(i[o])}function Pz(i,n){for(var o=0;o<i.length;o++)n.writeFixed64(i[o])}function kz(i,n){for(var o=0;o<i.length;o++)n.writeSFixed64(i[o])}function Og(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+16777216*i[n+3]}function sh(i,n,o){i[o]=n,i[o+1]=n>>>8,i[o+2]=n>>>16,i[o+3]=n>>>24}function kT(i,n){return(i[n]|i[n+1]<<8|i[n+2]<<16)+(i[n+3]<<24)}bn.prototype={destroy:function(){this.buf=null},readFields:function(i,n,o){for(o=o||this.length;this.pos<o;){var c=this.readVarint(),h=c>>3,p=this.pos;this.type=7&c,i(h,n,this),this.pos===p&&this.skip(c)}return n},readMessage:function(i,n){return this.readFields(i,n,this.readVarint()+this.pos)},readFixed32:function(){var i=Og(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=kT(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Og(this.buf,this.pos)+Og(this.buf,this.pos+4)*Tx;return this.pos+=8,i},readSFixed64:function(){var i=Og(this.buf,this.pos)+kT(this.buf,this.pos+4)*Tx;return this.pos+=8,i},readFloat:function(){var i=ST(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=ST(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var n,o,c=this.buf;return n=127&(o=c[this.pos++]),o<128?n:(n|=(127&(o=c[this.pos++]))<<7,o<128?n:(n|=(127&(o=c[this.pos++]))<<14,o<128?n:(n|=(127&(o=c[this.pos++]))<<21,o<128?n:function(h,p,_){var v,b,E=_.buf;if(v=(112&(b=E[_.pos++]))>>4,b<128||(v|=(127&(b=E[_.pos++]))<<3,b<128)||(v|=(127&(b=E[_.pos++]))<<10,b<128)||(v|=(127&(b=E[_.pos++]))<<17,b<128)||(v|=(127&(b=E[_.pos++]))<<24,b<128)||(v|=(1&(b=E[_.pos++]))<<31,b<128))return oh(h,v,p);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(o=c[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,n=this.pos;return this.pos=i,i-n>=12&&AT?function(o,c,h){return AT.decode(o.subarray(c,h))}(this.buf,n,i):function(o,c,h){for(var p="",_=c;_<h;){var v,b,E,C=o[_],P=null,M=C>239?4:C>223?3:C>191?2:1;if(_+M>h)break;M===1?C<128&&(P=C):M===2?(192&(v=o[_+1]))==128&&(P=(31&C)<<6|63&v)<=127&&(P=null):M===3?(b=o[_+2],(192&(v=o[_+1]))==128&&(192&b)==128&&((P=(15&C)<<12|(63&v)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):M===4&&(b=o[_+2],E=o[_+3],(192&(v=o[_+1]))==128&&(192&b)==128&&(192&E)==128&&((P=(15&C)<<18|(63&v)<<12|(63&b)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,M=1):P>65535&&(P-=65536,p+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),p+=String.fromCharCode(P),_+=M}return p}(this.buf,n,i)},readBytes:function(){var i=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,i);return this.pos=i,n},readPackedVarint:function(i,n){if(this.type!==bn.Bytes)return i.push(this.readVarint(n));var o=ca(this);for(i=i||[];this.pos<o;)i.push(this.readVarint(n));return i},readPackedSVarint:function(i){if(this.type!==bn.Bytes)return i.push(this.readSVarint());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==bn.Bytes)return i.push(this.readBoolean());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==bn.Bytes)return i.push(this.readFloat());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==bn.Bytes)return i.push(this.readDouble());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==bn.Bytes)return i.push(this.readFixed32());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==bn.Bytes)return i.push(this.readSFixed32());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==bn.Bytes)return i.push(this.readFixed64());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==bn.Bytes)return i.push(this.readSFixed64());var n=ca(this);for(i=i||[];this.pos<n;)i.push(this.readSFixed64());return i},skip:function(i){var n=7&i;if(n===bn.Varint)for(;this.buf[this.pos++]>127;);else if(n===bn.Bytes)this.pos=this.readVarint()+this.pos;else if(n===bn.Fixed32)this.pos+=4;else{if(n!==bn.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(i,n){this.writeVarint(i<<3|n)},realloc:function(i){for(var n=this.length||16;n<this.pos+i;)n*=2;if(n!==this.length){var o=new Uint8Array(n);o.set(this.buf),this.buf=o,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),sh(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),sh(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),sh(this.buf,-1&i,this.pos),sh(this.buf,Math.floor(i*CT),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),sh(this.buf,-1&i,this.pos),sh(this.buf,Math.floor(i*CT),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(n,o){var c,h;if(n>=0?(c=n%4294967296|0,h=n/4294967296|0):(h=~(-n/4294967296),4294967295^(c=~(-n%4294967296))?c=c+1|0:(c=0,h=h+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");o.realloc(10),function(p,_,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)}(c,0,o),function(p,_){var v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))}(h,o)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var n=this.pos;this.pos=function(c,h,p){for(var _,v,b=0;b<h.length;b++){if((_=h.charCodeAt(b))>55295&&_<57344){if(!v){_>56319||b+1===h.length?(c[p++]=239,c[p++]=191,c[p++]=189):v=_;continue}if(_<56320){c[p++]=239,c[p++]=191,c[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(c[p++]=239,c[p++]=191,c[p++]=189,v=null);_<128?c[p++]=_:(_<2048?c[p++]=_>>6|192:(_<65536?c[p++]=_>>12|224:(c[p++]=_>>18|240,c[p++]=_>>12&63|128),c[p++]=_>>6&63|128),c[p++]=63&_|128)}return p}(this.buf,i,this.pos);var o=this.pos-n;o>=128&&PT(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeFloat:function(i){this.realloc(4),IT(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),IT(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var n=i.length;this.writeVarint(n),this.realloc(n);for(var o=0;o<n;o++)this.buf[this.pos++]=i[o]},writeRawMessage:function(i,n){this.pos++;var o=this.pos;i(n,this);var c=this.pos-o;c>=128&&PT(o,c,this),this.pos=o-1,this.writeVarint(c),this.pos+=c},writeMessage:function(i,n,o){this.writeTag(i,bn.Bytes),this.writeRawMessage(n,o)},writePackedVarint:function(i,n){n.length&&this.writeMessage(i,bz,n)},writePackedSVarint:function(i,n){n.length&&this.writeMessage(i,Ez,n)},writePackedBoolean:function(i,n){n.length&&this.writeMessage(i,Iz,n)},writePackedFloat:function(i,n){n.length&&this.writeMessage(i,Tz,n)},writePackedDouble:function(i,n){n.length&&this.writeMessage(i,Sz,n)},writePackedFixed32:function(i,n){n.length&&this.writeMessage(i,Cz,n)},writePackedSFixed32:function(i,n){n.length&&this.writeMessage(i,Az,n)},writePackedFixed64:function(i,n){n.length&&this.writeMessage(i,Pz,n)},writePackedSFixed64:function(i,n){n.length&&this.writeMessage(i,kz,n)},writeBytesField:function(i,n){this.writeTag(i,bn.Bytes),this.writeBytes(n)},writeFixed32Field:function(i,n){this.writeTag(i,bn.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(i,n){this.writeTag(i,bn.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(i,n){this.writeTag(i,bn.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(i,n){this.writeTag(i,bn.Fixed64),this.writeSFixed64(n)},writeVarintField:function(i,n){this.writeTag(i,bn.Varint),this.writeVarint(n)},writeSVarintField:function(i,n){this.writeTag(i,bn.Varint),this.writeSVarint(n)},writeStringField:function(i,n){this.writeTag(i,bn.Bytes),this.writeString(n)},writeFloatField:function(i,n){this.writeTag(i,bn.Fixed32),this.writeFloat(n)},writeDoubleField:function(i,n){this.writeTag(i,bn.Fixed64),this.writeDouble(n)},writeBooleanField:function(i,n){this.writeVarintField(i,!!n)}};var Bg=Te(TT);const Sx=3;function Mz(i,n,o){n.glyphs=[],i===1&&o.readMessage(Rz,n)}function Rz(i,n,o){if(i===3){const{id:c,bitmap:h,width:p,height:_,left:v,top:b,advance:E}=o.readMessage(Dz,{});n.glyphs.push({id:c,bitmap:new la({width:p+2*Sx,height:_+2*Sx},h),metrics:{width:p,height:_,left:v,top:b,advance:E}})}else i===4?n.ascender=o.readSVarint():i===5&&(n.descender=o.readSVarint())}function Dz(i,n,o){i===1?n.id=o.readVarint():i===2?n.bitmap=o.readBytes():i===3?n.width=o.readVarint():i===4?n.height=o.readVarint():i===5?n.left=o.readSVarint():i===6?n.top=o.readSVarint():i===7&&(n.advance=o.readVarint())}const MT=Sx;function Ix(i){let n=0,o=0;for(const _ of i)n+=_.w*_.h,o=Math.max(o,_.w);i.sort((_,v)=>v.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),o),h:1/0}];let h=0,p=0;for(const _ of i)for(let v=c.length-1;v>=0;v--){const b=c[v];if(!(_.w>b.w||_.h>b.h)){if(_.x=b.x,_.y=b.y,p=Math.max(p,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===b.w&&_.h===b.h){const E=c.pop();v<c.length&&(c[v]=E)}else _.h===b.h?(b.x+=_.w,b.w-=_.w):_.w===b.w?(b.y+=_.h,b.h-=_.h):(c.push({x:b.x+_.w,y:b.y,w:b.w-_.w,h:_.h}),b.y+=_.h,b.h-=_.h);break}}return{w:h,h:p,fill:n/(h*p)||0}}const _i=1;class Cx{constructor(n,{pixelRatio:o,version:c,stretchX:h,stretchY:p,content:_}){this.paddedRect=n,this.pixelRatio=o,this.stretchX=h,this.stretchY=p,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+_i,this.paddedRect.y+_i]}get br(){return[this.paddedRect.x+this.paddedRect.w-_i,this.paddedRect.y+this.paddedRect.h-_i]}get displaySize(){return[(this.paddedRect.w-2*_i)/this.pixelRatio,(this.paddedRect.h-2*_i)/this.pixelRatio]}}class RT{constructor(n,o){const c={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(n,c,p),this.addImages(o,h,p);const{w:_,h:v}=Ix(p),b=new ki({width:_||1,height:v||1});for(const E in n){const C=n[E],P=c[E].paddedRect;ki.copy(C.data,b,{x:0,y:0},{x:P.x+_i,y:P.y+_i},C.data)}for(const E in o){const C=o[E],P=h[E].paddedRect,M=P.x+_i,L=P.y+_i,z=C.data.width,N=C.data.height;ki.copy(C.data,b,{x:0,y:0},{x:M,y:L},C.data),ki.copy(C.data,b,{x:0,y:N-1},{x:M,y:L-1},{width:z,height:1}),ki.copy(C.data,b,{x:0,y:0},{x:M,y:L+N},{width:z,height:1}),ki.copy(C.data,b,{x:z-1,y:0},{x:M-1,y:L},{width:1,height:N}),ki.copy(C.data,b,{x:0,y:0},{x:M+z,y:L},{width:1,height:N})}this.image=b,this.iconPositions=c,this.patternPositions=h}addImages(n,o,c){for(const h in n){const p=n[h],_={x:0,y:0,w:p.data.width+2*_i,h:p.data.height+2*_i};c.push(_),o[h]=new Cx(_,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(n,o){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>n.hasImage(c)),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in n.updatedImages)this.patchUpdatedImage(this.iconPositions[c],n.getImage(c),o),this.patchUpdatedImage(this.patternPositions[c],n.getImage(c),o)}patchUpdatedImage(n,o,c){if(!n||!o||n.version===o.version)return;n.version=o.version;const[h,p]=n.tl;c.update(o.data,void 0,{x:h,y:p})}}ft(Cx,"ImagePosition"),ft(RT,"ImageAtlas");const Zi={horizontal:1,vertical:2,horizontalOnly:3},DT=-17;class Nf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,o){const c=new Nf;return c.scale=n||1,c.fontStack=o,c}static forImage(n){const o=new Nf;return o.imageName=n,o}}class ah{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,o){const c=new ah;for(let h=0;h<n.sections.length;h++){const p=n.sections[h];p.image?c.addImageSection(p):c.addTextSection(p,o)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(o,c){let h="";for(let p=0;p<o.length;p++){const _=o.charCodeAt(p+1)||null,v=o.charCodeAt(p-1)||null;h+=!c&&(_&&dg(_)&&!Ff[o[p+1]]||v&&dg(v)&&!Ff[o[p-1]])||!Ff[o[p]]?o[p]:Ff[o[p]]}return h}(this.text,n)}trim(){let n=0;for(let c=0;c<this.text.length&&Fg[this.text.charCodeAt(c)];c++)n++;let o=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&Fg[this.text.charCodeAt(c)];c--)o--;this.text=this.text.substring(n,o),this.sectionIndex=this.sectionIndex.slice(n,o)}substring(n,o){const c=new ah;return c.text=this.text.substring(n,o),c.sectionIndex=this.sectionIndex.slice(n,o),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,o)=>Math.max(n,this.sections[o].scale),0)}addTextSection(n,o){this.text+=n.text,this.sections.push(Nf.forText(n.scale,n.fontStack||o));const c=this.sections.length-1;for(let h=0;h<n.text.length;++h)this.sectionIndex.push(c)}addImageSection(n){const o=n.image?n.image.name:"";if(o.length===0)return void In("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Nf.forImage(o)),this.sectionIndex.push(this.sections.length-1)):In("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ax(i,n,o,c,h,p,_,v,b,E,C,P,M,L,z){const N=ah.fromFeature(i,h);P===Zi.vertical&&N.verticalizePunctuation(M);let q=[];const ee=function(fe,Me,Ae,Fe,Je,De){if(!fe)return[];const Ve=[],$e=function(lt,gt,ct,Pt,rt,wt){let kt=0;for(let en=0;en<lt.length();en++){const Mt=lt.getSection(en);kt+=LT(lt.getCharCode(en),Mt,Pt,rt,gt,wt)}return kt/Math.max(1,Math.ceil(kt/ct))}(fe,Me,Ae,Fe,Je,De),He=fe.text.indexOf("")>=0;let nt=0;for(let lt=0;lt<fe.length();lt++){const gt=fe.getSection(lt),ct=fe.getCharCode(lt);if(Fg[ct]||(nt+=LT(ct,gt,Fe,Je,Me,De)),lt<fe.length()-1){const Pt=!((Oe=ct)<11904||!(ut["Bopomofo Extended"](Oe)||ut.Bopomofo(Oe)||ut["CJK Compatibility Forms"](Oe)||ut["CJK Compatibility Ideographs"](Oe)||ut["CJK Compatibility"](Oe)||ut["CJK Radicals Supplement"](Oe)||ut["CJK Strokes"](Oe)||ut["CJK Symbols and Punctuation"](Oe)||ut["CJK Unified Ideographs Extension A"](Oe)||ut["CJK Unified Ideographs"](Oe)||ut["Enclosed CJK Letters and Months"](Oe)||ut["Halfwidth and Fullwidth Forms"](Oe)||ut.Hiragana(Oe)||ut["Ideographic Description Characters"](Oe)||ut["Kangxi Radicals"](Oe)||ut["Katakana Phonetic Extensions"](Oe)||ut.Katakana(Oe)||ut["Vertical Forms"](Oe)||ut["Yi Radicals"](Oe)||ut["Yi Syllables"](Oe)));(Lz[ct]||Pt||gt.imageName)&&Ve.push(OT(lt+1,nt,$e,Ve,zz(ct,fe.getCharCode(lt+1),Pt&&He),!1))}}var Oe;return BT(OT(fe.length(),nt,$e,Ve,0,!0))}(N,E,p,n,c,L),{processBidirectionalText:de,processStyledBidirectionalText:ne}=S;if(de&&N.sections.length===1){const fe=de(N.toString(),ee);for(const Me of fe){const Ae=new ah;Ae.text=Me,Ae.sections=N.sections;for(let Fe=0;Fe<Me.length;Fe++)Ae.sectionIndex.push(0);q.push(Ae)}}else if(ne){const fe=ne(N.text,N.sectionIndex,ee);for(const Me of fe){const Ae=new ah;Ae.text=Me[0],Ae.sectionIndex=Me[1],Ae.sections=N.sections,q.push(Ae)}}else q=function(fe,Me){const Ae=[],Fe=fe.text;let Je=0;for(const De of Me)Ae.push(fe.substring(Je,De)),Je=De;return Je<Fe.length&&Ae.push(fe.substring(Je,Fe.length)),Ae}(N,ee);const ue=[],pe={positionedLines:ue,text:N.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(fe,Me,Ae,Fe,Je,De,Ve,$e,He,nt,Oe,lt){let gt=0,ct=0,Pt=0;const rt=$e==="right"?1:$e==="left"?0:.5;let wt=!1;for(const zt of Je){const Ot=zt.getSections();for(const yn of Ot){if(yn.imageName)continue;const En=Me[yn.fontStack];if(En&&(wt=En.ascender!==void 0&&En.descender!==void 0,!wt))break}if(!wt)break}let kt=0;for(const zt of Je){zt.trim();const Ot=zt.getMaxScale(),yn=(Ot-1)*kr,En={positionedGlyphs:[],lineOffset:0};fe.positionedLines[kt]=En;const Tn=En.positionedGlyphs;let vn=0;if(!zt.length()){ct+=De,++kt;continue}let zn=0,jn=0;for(let xn=0;xn<zt.length();xn++){const hr=zt.getSection(xn),nr=zt.getSectionIndex(xn),On=zt.getCharCode(xn);let nn=hr.scale,rr=null,Sn=null,oi=null,ir=kr,Mr=0;const Tr=!(He===Zi.horizontal||!Oe&&!df(On)||Oe&&(Fg[On]||(en=On,ut.Arabic(en)||ut["Arabic Supplement"](en)||ut["Arabic Extended-A"](en)||ut["Arabic Presentation Forms-A"](en)||ut["Arabic Presentation Forms-B"](en))));if(hr.imageName){const si=Fe[hr.imageName];if(!si)continue;oi=hr.imageName,fe.iconsInText=fe.iconsInText||!0,Sn=si.paddedRect;const Sr=si.displaySize;nn=nn*kr/lt,rr={width:Sr[0],height:Sr[1],left:_i,top:-MT,advance:Tr?Sr[1]:Sr[0],localGlyph:!1},Mr=wt?-rr.height*nn:DT+Ot*kr-Sr[1]*nn,ir=rr.advance;const ts=(Tr?Sr[0]:Sr[1])*nn-kr*Ot;ts>0&&ts>vn&&(vn=ts)}else{const si=Ae[hr.fontStack];if(!si)continue;si[On]&&(Sn=si[On]);const Sr=Me[hr.fontStack];if(!Sr)continue;const ts=Sr.glyphs[On];if(!ts)continue;if(rr=ts.metrics,ir=On!==8203?kr:0,wt){const ph=Sr.ascender!==void 0?Math.abs(Sr.ascender):0,Xf=Sr.descender!==void 0?Math.abs(Sr.descender):0,Kf=(ph+Xf)*nn;zn<Kf&&(zn=Kf,jn=(ph-Xf)/2*nn),Mr=-ph*nn}else Mr=DT+(Ot-nn)*kr}Tr?(fe.verticalizable=!0,Tn.push({glyph:On,imageName:oi,x:gt,y:ct+Mr,vertical:Tr,scale:nn,localGlyph:rr.localGlyph,fontStack:hr.fontStack,sectionIndex:nr,metrics:rr,rect:Sn}),gt+=ir*nn+nt):(Tn.push({glyph:On,imageName:oi,x:gt,y:ct+Mr,vertical:Tr,scale:nn,localGlyph:rr.localGlyph,fontStack:hr.fontStack,sectionIndex:nr,metrics:rr,rect:Sn}),gt+=rr.advance*nn+nt)}Tn.length!==0&&(Pt=Math.max(gt-nt,Pt),wt?FT(Tn,rt,vn,jn,De*Ot/2):FT(Tn,rt,vn,0,De/2)),gt=0;const tr=De*Ot+vn;En.lineOffset=Math.max(vn,yn),ct+=tr,++kt}var en;const Mt=ct,{horizontalAlign:It,verticalAlign:Cn}=Px(Ve);(function(zt,Ot,yn,En,Tn,vn){const zn=(Ot-yn)*Tn,jn=-vn*En;for(const tr of zt)for(const xn of tr.positionedGlyphs)xn.x+=zn,xn.y+=jn})(fe.positionedLines,rt,It,Cn,Pt,Mt),fe.top+=-Cn*Mt,fe.bottom=fe.top+Mt,fe.left+=-It*Pt,fe.right=fe.left+Pt,fe.hasBaseline=wt}(pe,n,o,c,q,_,v,b,P,E,M,z),!function(fe){for(const Me of fe)if(Me.positionedGlyphs.length!==0)return!1;return!0}(ue)&&pe}const Fg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function LT(i,n,o,c,h,p){if(n.imageName){const _=c[n.imageName];return _?_.displaySize[0]*n.scale*kr/p+h:0}{const _=o[n.fontStack],v=_&&_.glyphs[i];return v?v.metrics.advance*n.scale+h:0}}function zT(i,n,o,c){const h=Math.pow(i-n,2);return c?i<n?h/2:2*h:h+Math.abs(o)*o}function zz(i,n,o){let c=0;return i===10&&(c-=1e4),o&&(c+=150),i!==40&&i!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function OT(i,n,o,c,h,p){let _=null,v=zT(n,o,h,p);for(const b of c){const E=zT(n-b.x,o,h,p)+b.badness;E<=v&&(_=b,v=E)}return{index:i,x:n,priorBreak:_,badness:v}}function BT(i){return i?BT(i.priorBreak).concat(i.index):[]}function Px(i){let n=.5,o=.5;switch(i){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}return{horizontalAlign:n,verticalAlign:o}}function FT(i,n,o,c,h){if(!(n||o||c||h))return;const p=i.length-1,_=i[p],v=(_.x+_.metrics.advance*_.scale)*n;for(let b=0;b<=p;b++)i[b].x-=v,i[b].y+=o+c+h}function Oz(i,n,o){const{horizontalAlign:c,verticalAlign:h}=Px(o),p=n[0]-i.displaySize[0]*c,_=n[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:p,right:p+i.displaySize[0]}}function NT(i,n,o,c,h,p){const _=i.image;let v;if(_.content){const q=_.content,ee=_.pixelRatio||1;v=[q[0]/ee,q[1]/ee,_.displaySize[0]-q[2]/ee,_.displaySize[1]-q[3]/ee]}const b=n.left*p,E=n.right*p;let C,P,M,L;o==="width"||o==="both"?(L=h[0]+b-c[3],P=h[0]+E+c[1]):(L=h[0]+(b+E-_.displaySize[0])/2,P=L+_.displaySize[0]);const z=n.top*p,N=n.bottom*p;return o==="height"||o==="both"?(C=h[1]+z-c[0],M=h[1]+N+c[2]):(C=h[1]+(z+N-_.displaySize[1])/2,M=C+_.displaySize[1]),{image:_,top:C,right:P,bottom:M,left:L,collisionPadding:v}}class ua extends ze{constructor(n,o,c,h,p){super(n,o),this.angle=h,this.z=c,p!==void 0&&(this.segment=p)}clone(){return new ua(this.x,this.y,this.z,this.angle,this.segment)}}function jT(i,n,o,c,h){if(n.segment===void 0)return!0;let p=n,_=n.segment+1,v=0;for(;v>-o/2;){if(_--,_<0)return!1;v-=i[_].dist(p),p=i[_]}v+=i[_].dist(i[_+1]),_++;const b=[];let E=0;for(;v<o/2;){const C=i[_],P=i[_+1];if(!P)return!1;let M=i[_-1].angleTo(C)-C.angleTo(P);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:v,angleDelta:M}),E+=M;v-b[0].distance>c;)E-=b.shift().angleDelta;if(E>h)return!1;_++,v+=C.dist(P)}return!0}function UT(i){let n=0;for(let o=0;o<i.length-1;o++)n+=i[o].dist(i[o+1]);return n}function VT(i,n,o){return i?.6*n*o:0}function $T(i,n){return Math.max(i?i.right-i.left:0,n?n.right-n.left:0)}function Bz(i,n,o,c,h,p){const _=VT(o,h,p),v=$T(o,c)*p;let b=0;const E=UT(i)/2;for(let C=0;C<i.length-1;C++){const P=i[C],M=i[C+1],L=P.dist(M);if(b+L>E){const z=(E-b)/L,N=Jt(P.x,M.x,z),q=Jt(P.y,M.y,z),ee=new ua(N,q,0,M.angleTo(P),C);return!_||jT(i,ee,v,_,n)?ee:void 0}b+=L}}function Fz(i,n,o,c,h,p,_,v,b){const E=VT(c,p,_),C=$T(c,h),P=C*_,M=i[0].x===0||i[0].x===b||i[0].y===0||i[0].y===b;return n-P<n/4&&(n=P+n/4),GT(i,M?n/2*v%n:(C/2+2*p)*_*v%n,n,E,o,P,M,!1,b)}function GT(i,n,o,c,h,p,_,v,b){const E=p/2,C=UT(i);let P=0,M=n-o,L=[];for(let z=0;z<i.length-1;z++){const N=i[z],q=i[z+1],ee=N.dist(q),de=q.angleTo(N);for(;M+o<P+ee;){M+=o;const ne=(M-P)/ee,ue=Jt(N.x,q.x,ne),pe=Jt(N.y,q.y,ne);if(ue>=0&&ue<b&&pe>=0&&pe<b&&M-E>=0&&M+E<=C){const fe=new ua(ue,pe,0,de,z);fe._round(),c&&!jT(i,fe,p,c,h)||L.push(fe)}}P+=ee}return v||L.length||_||(L=GT(i,P/2,o,c,h,p,_,!0,b)),L}function WT(i,n,o,c,h){const p=[];for(let _=0;_<i.length;_++){const v=i[_];let b;for(let E=0;E<v.length-1;E++){let C=v[E],P=v[E+1];C.x<n&&P.x<n||(C.x<n?C=new ze(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x<n&&(P=new ze(n,C.y+(n-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y<o&&P.y<o||(C.y<o?C=new ze(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round():P.y<o&&(P=new ze(C.x+(o-C.y)/(P.y-C.y)*(P.x-C.x),o)._round()),C.x>=c&&P.x>=c||(C.x>=c?C=new ze(c,C.y+(c-C.x)/(P.x-C.x)*(P.y-C.y))._round():P.x>=c&&(P=new ze(c,C.y+(c-C.x)/(P.x-C.x)*(P.y-C.y))._round()),C.y>=h&&P.y>=h||(C.y>=h?C=new ze(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round():P.y>=h&&(P=new ze(C.x+(h-C.y)/(P.y-C.y)*(P.x-C.x),h)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(P)))))}}return p}ft(ua,"Anchor");const jf=1e20;function qT(i,n,o,c,h,p,_,v,b){for(let E=n;E<n+c;E++)HT(i,o*p+E,p,h,_,v,b);for(let E=o;E<o+h;E++)HT(i,E*p+n,1,c,_,v,b)}function HT(i,n,o,c,h,p,_){p[0]=0,_[0]=-jf,_[1]=jf,h[0]=i[n];for(let v=1,b=0,E=0;v<c;v++){h[v]=i[n+v*o];const C=v*v;do{const P=p[b];E=(h[v]-h[P]+C-P*P)/(v-P)/2}while(E<=_[b]&&--b>-1);b++,p[b]=v,_[b]=E,_[b+1]=jf}for(let v=0,b=0;v<c;v++){for(;_[b+1]<v;)b++;const E=p[b],C=v-E;i[n+v*o]=h[E]+C*C}}const Qo=2,kx={none:0,ideographs:1,all:2};class lh{constructor(n,o,c){this.requestManager=n,this.localGlyphMode=o,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,o){const c=[];for(const h in n)for(const p of n[h])c.push({stack:h,id:p});Vt(c,({stack:h,id:p},_)=>{let v=this.entries[h];v||(v=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=v.glyphs[p];if(b!==void 0)return void _(null,{stack:h,id:p,glyph:b});if(b=this._tinySDF(v,h,p),b)return v.glyphs[p]=b,void _(null,{stack:h,id:p,glyph:b});const E=Math.floor(p/256);if(256*E>65535)return void _(new Error("glyphs > 65535 not supported"));if(v.ranges[E])return void _(null,{stack:h,id:p,glyph:b});let C=v.requests[E];C||(C=v.requests[E]=[],lh.loadGlyphRange(h,E,this.url,this.requestManager,(P,M)=>{if(M){v.ascender=M.ascender,v.descender=M.descender;for(const L in M.glyphs)this._doesCharSupportLocalGlyph(+L)||(v.glyphs[+L]=M.glyphs[+L]);v.ranges[E]=!0}for(const L of C)L(P,M);delete v.requests[E]})),C.push((P,M)=>{P?_(P):M&&_(null,{stack:h,id:p,glyph:M.glyphs[p]||null})})},(h,p)=>{if(h)o(h);else if(p){const _={};for(const{stack:v,id:b,glyph:E}of p)_[v]===void 0&&(_[v]={}),_[v].glyphs===void 0&&(_[v].glyphs={}),_[v].glyphs[b]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},_[v].ascender=this.entries[v].ascender,_[v].descender=this.entries[v].descender;o(null,_)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==kx.none&&(this.localGlyphMode===kx.all?!!this.localFontFamily:!!this.localFontFamily&&(ut["CJK Unified Ideographs"](n)||ut["Hangul Syllables"](n)||ut.Hiragana(n)||ut.Katakana(n)||ut["CJK Symbols and Punctuation"](n)))}_tinySDF(n,o,c){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(c))return;let p=n.tinySDF;if(!p){let N="400";/bold/i.test(o)?N="900":/medium/i.test(o)?N="500":/light/i.test(o)&&(N="200"),p=n.tinySDF=new lh.TinySDF({fontFamily:h,fontWeight:N,fontSize:24*Qo,buffer:3*Qo,radius:8*Qo}),p.fontWeight=N}if(this.localGlyphs[p.fontWeight][c])return this.localGlyphs[p.fontWeight][c];const _=String.fromCharCode(c),{data:v,width:b,height:E,glyphWidth:C,glyphHeight:P,glyphLeft:M,glyphTop:L,glyphAdvance:z}=p.draw(_);return this.localGlyphs[p.fontWeight][c]={id:c,bitmap:new la({width:b,height:E},v),metrics:{width:C/Qo,height:P/Qo,left:M/Qo,top:L/Qo-27,advance:z/Qo,localGlyph:!0}}}}lh.loadGlyphRange=function(i,n,o,c,h){const p=256*n,_=p+255,v=c.transformRequest(c.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",`${p}-${_}`),Gs.Glyphs);Fa(v,(b,E)=>{if(b)h(b);else if(E){const C={},P=function(M){return new Bg(M).readFields(Mz,{})}(E);for(const M of P.glyphs)C[M.id]=M;h(null,{glyphs:C,ascender:P.ascender,descender:P.descender})}})},lh.TinySDF=class{constructor({fontSize:i=24,buffer:n=3,radius:o=8,cutoff:c=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:_="normal"}={}){this.buffer=n,this.cutoff=c,this.radius=o;const v=this.size=i+4*n,b=this._createCanvas(v),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${_} ${p} ${i}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(v*v),this.gridInner=new Float64Array(v*v),this.f=new Float64Array(v),this.z=new Float64Array(v+1),this.v=new Uint16Array(v)}_createCanvas(i){const n=document.createElement("canvas");return n.width=n.height=i,n}draw(i){const{width:n,actualBoundingBoxAscent:o,actualBoundingBoxDescent:c,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(i),_=Math.ceil(o),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),b=Math.min(this.size-this.buffer,_+Math.ceil(c)),E=v+2*this.buffer,C=b+2*this.buffer,P=Math.max(E*C,0),M=new Uint8ClampedArray(P),L={data:M,width:E,height:C,glyphWidth:v,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(v===0||b===0)return L;const{ctx:z,buffer:N,gridInner:q,gridOuter:ee}=this;z.clearRect(N,N,v,b),z.fillText(i,N,N+_);const de=z.getImageData(N,N,v,b);ee.fill(jf,0,P),q.fill(0,0,P);for(let ne=0;ne<b;ne++)for(let ue=0;ue<v;ue++){const pe=de.data[4*(ne*v+ue)+3]/255;if(pe===0)continue;const fe=(ne+N)*E+ue+N;if(pe===1)ee[fe]=0,q[fe]=jf;else{const Me=.5-pe;ee[fe]=Me>0?Me*Me:0,q[fe]=Me<0?Me*Me:0}}qT(ee,0,0,E,C,E,this.f,this.v,this.z),qT(q,N,N,v,b,E,this.f,this.v,this.z);for(let ne=0;ne<P;ne++){const ue=Math.sqrt(ee[ne])-Math.sqrt(q[ne]);M[ne]=Math.round(255-255*(ue/this.radius+this.cutoff))}return L}};const ch=_i;function ZT(i,n,o,c){const h=[],p=i.image,_=p.pixelRatio,v=p.paddedRect.w-2*ch,b=p.paddedRect.h-2*ch,E=i.right-i.left,C=i.bottom-i.top,P=p.stretchX||[[0,v]],M=p.stretchY||[[0,b]],L=(De,Ve)=>De+Ve[1]-Ve[0],z=P.reduce(L,0),N=M.reduce(L,0),q=v-z,ee=b-N;let de=0,ne=z,ue=0,pe=N,fe=0,Me=q,Ae=0,Fe=ee;if(p.content&&c){const De=p.content;de=Ng(P,0,De[0]),ue=Ng(M,0,De[1]),ne=Ng(P,De[0],De[2]),pe=Ng(M,De[1],De[3]),fe=De[0]-de,Ae=De[1]-ue,Me=De[2]-De[0]-ne,Fe=De[3]-De[1]-pe}const Je=(De,Ve,$e,He)=>{const nt=jg(De.stretch-de,ne,E,i.left),Oe=Ug(De.fixed-fe,Me,De.stretch,z),lt=jg(Ve.stretch-ue,pe,C,i.top),gt=Ug(Ve.fixed-Ae,Fe,Ve.stretch,N),ct=jg($e.stretch-de,ne,E,i.left),Pt=Ug($e.fixed-fe,Me,$e.stretch,z),rt=jg(He.stretch-ue,pe,C,i.top),wt=Ug(He.fixed-Ae,Fe,He.stretch,N),kt=new ze(nt,lt),en=new ze(ct,lt),Mt=new ze(ct,rt),It=new ze(nt,rt),Cn=new ze(Oe/_,gt/_),zt=new ze(Pt/_,wt/_),Ot=n*Math.PI/180;if(Ot){const Tn=Math.sin(Ot),vn=Math.cos(Ot),zn=[vn,-Tn,Tn,vn];kt._matMult(zn),en._matMult(zn),It._matMult(zn),Mt._matMult(zn)}const yn=De.stretch+De.fixed,En=Ve.stretch+Ve.fixed;return{tl:kt,tr:en,bl:It,br:Mt,tex:{x:p.paddedRect.x+ch+yn,y:p.paddedRect.y+ch+En,w:$e.stretch+$e.fixed-yn,h:He.stretch+He.fixed-En},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Cn,pixelOffsetBR:zt,minFontScaleX:Me/_/E,minFontScaleY:Fe/_/C,isSDF:o}};if(c&&(p.stretchX||p.stretchY)){const De=XT(P,q,z),Ve=XT(M,ee,N);for(let $e=0;$e<De.length-1;$e++){const He=De[$e],nt=De[$e+1];for(let Oe=0;Oe<Ve.length-1;Oe++)h.push(Je(He,Ve[Oe],nt,Ve[Oe+1]))}}else h.push(Je({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:b+1}));return h}function Ng(i,n,o){let c=0;for(const h of i)c+=Math.max(n,Math.min(o,h[1]))-Math.max(n,Math.min(o,h[0]));return c}function XT(i,n,o){const c=[{fixed:-ch,stretch:0}];for(const[h,p]of i){const _=c[c.length-1];c.push({fixed:h-_.stretch,stretch:_.stretch}),c.push({fixed:h-_.stretch,stretch:_.stretch+(p-h)})}return c.push({fixed:n+ch,stretch:o}),c}function jg(i,n,o,c){return i/n*o+c}function Ug(i,n,o,c){return i-n*o/c}function Nz(i,n,o,c){const h=n+i.positionedLines[c].lineOffset;return c===0?o+h/2:o+(h+(n+i.positionedLines[c-1].lineOffset))/2}class jz{constructor(n=[],o=Uz){if(this.data=n,this.length=this.data.length,this.compare=o,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:o,compare:c}=this,h=o[n];for(;n>0;){const p=n-1>>1,_=o[p];if(c(h,_)>=0)break;o[n]=_,n=p}o[n]=h}_down(n){const{data:o,compare:c}=this,h=this.length>>1,p=o[n];for(;n<h;){let _=1+(n<<1),v=o[_];const b=_+1;if(b<this.length&&c(o[b],v)<0&&(_=b,v=o[b]),c(v,p)>=0)break;o[n]=v,n=_}o[n]=p}}function Uz(i,n){return i<n?-1:i>n?1:0}function Vz(i,n=1,o=!1){let c=1/0,h=1/0,p=-1/0,_=-1/0;const v=i[0];for(let L=0;L<v.length;L++){const z=v[L];(!L||z.x<c)&&(c=z.x),(!L||z.y<h)&&(h=z.y),(!L||z.x>p)&&(p=z.x),(!L||z.y>_)&&(_=z.y)}const b=Math.min(p-c,_-h);let E=b/2;const C=new jz([],$z);if(b===0)return new ze(c,h);for(let L=c;L<p;L+=b)for(let z=h;z<_;z+=b)C.push(new uh(L+E,z+E,E,i));let P=function(L){let z=0,N=0,q=0;const ee=L[0];for(let de=0,ne=ee.length,ue=ne-1;de<ne;ue=de++){const pe=ee[de],fe=ee[ue],Me=pe.x*fe.y-fe.x*pe.y;N+=(pe.x+fe.x)*Me,q+=(pe.y+fe.y)*Me,z+=3*Me}return new uh(N/z,q/z,0,L)}(i),M=C.length;for(;C.length;){const L=C.pop();(L.d>P.d||!P.d)&&(P=L,o&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-P.d<=n||(E=L.h/2,C.push(new uh(L.p.x-E,L.p.y-E,E,i)),C.push(new uh(L.p.x+E,L.p.y-E,E,i)),C.push(new uh(L.p.x-E,L.p.y+E,E,i)),C.push(new uh(L.p.x+E,L.p.y+E,E,i)),M+=4)}return o&&(console.log(`num probes: ${M}`),console.log(`best distance: ${P.d}`)),P.p}function $z(i,n){return n.max-i.max}class uh{constructor(n,o,c,h){this.p=new ze(n,o),this.h=c,this.d=function(p,_){let v=!1,b=1/0;for(let E=0;E<_.length;E++){const C=_[E];for(let P=0,M=C.length,L=M-1;P<M;L=P++){const z=C[P],N=C[L];z.y>p.y!=N.y>p.y&&p.x<(N.x-z.x)*(p.y-z.y)/(N.y-z.y)+z.x&&(v=!v),b=Math.min(b,GE(p,z,N))}}return(v?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const hh=7,Mx=Number.POSITIVE_INFINITY,Gz=Math.sqrt(2);function KT(i,[n,o]){let c=0,h=0;if(o===Mx){n<0&&(n=0);const p=n/Gz;switch(i){case"top-right":case"top-left":h=p-hh;break;case"bottom-right":case"bottom-left":h=-p+hh;break;case"bottom":h=-n+hh;break;case"top":h=n-hh}switch(i){case"top-right":case"bottom-right":c=-p;break;case"top-left":case"bottom-left":c=p;break;case"left":c=n;break;case"right":c=-n}}else{switch(n=Math.abs(n),o=Math.abs(o),i){case"top-right":case"top-left":case"top":h=o-hh;break;case"bottom-right":case"bottom-left":case"bottom":h=-o+hh}switch(i){case"top-right":case"bottom-right":case"right":c=-n;break;case"top-left":case"bottom-left":case"left":c=n}}return[c,h]}function Wz(i,n,o,c,h,p,_,v,b,E){i.createArrays(),i.tilePixelRatio=Et/(512*i.overscaling),i.compareText={},i.iconsNeedLinear=!1;const C=i.layers[0].layout,P=i.layers[0]._unevaluatedLayout._values,M={};if(i.textSizeData.kind==="composite"){const{minZoom:N,maxZoom:q}=i.textSizeData;M.compositeTextSizes=[P["text-size"].possiblyEvaluate(new A(N),v),P["text-size"].possiblyEvaluate(new A(q),v)]}if(i.iconSizeData.kind==="composite"){const{minZoom:N,maxZoom:q}=i.iconSizeData;M.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new A(N),v),P["icon-size"].possiblyEvaluate(new A(q),v)]}M.layoutTextSize=P["text-size"].possiblyEvaluate(new A(b+1),v),M.layoutIconSize=P["icon-size"].possiblyEvaluate(new A(b+1),v),M.textMaxSize=P["text-size"].possiblyEvaluate(new A(18),v);const L=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",z=C.get("text-size");for(const N of i.features){const q=C.get("text-font").evaluate(N,{},v).join(","),ee=z.evaluate(N,{},v),de=M.layoutTextSize.evaluate(N,{},v),ne=(M.layoutIconSize.evaluate(N,{},v),{horizontal:{},vertical:void 0}),ue=N.text;let pe,fe=[0,0];if(ue){const Fe=ue.toString(),Je=C.get("text-letter-spacing").evaluate(N,{},v)*kr,De=C.get("text-line-height").evaluate(N,{},v)*kr,Ve=jv(Fe)?Je:0,$e=C.get("text-anchor").evaluate(N,{},v),He=C.get("text-variable-anchor");if(!He){const ct=C.get("text-radial-offset").evaluate(N,{},v);fe=ct?KT($e,[ct*kr,Mx]):C.get("text-offset").evaluate(N,{},v).map(Pt=>Pt*kr)}let nt=L?"center":C.get("text-justify").evaluate(N,{},v);const Oe=C.get("symbol-placement")==="point",lt=Oe?C.get("text-max-width").evaluate(N,{},v)*kr:1/0,gt=ct=>{i.allowVerticalPlacement&&hf(Fe)&&(ne.vertical=Ax(ue,n,o,h,q,lt,De,$e,ct,Ve,fe,Zi.vertical,!0,de,ee))};if(!L&&He){const ct=nt==="auto"?He.map(rt=>Rx(rt)):[nt];let Pt=!1;for(let rt=0;rt<ct.length;rt++){const wt=ct[rt];if(!ne.horizontal[wt])if(Pt)ne.horizontal[wt]=ne.horizontal[0];else{const kt=Ax(ue,n,o,h,q,lt,De,"center",wt,Ve,fe,Zi.horizontal,!1,de,ee);kt&&(ne.horizontal[wt]=kt,Pt=kt.positionedLines.length===1)}}gt("left")}else{if(nt==="auto"&&(nt=Rx($e)),Oe||C.get("text-writing-mode").indexOf("horizontal")>=0||!hf(Fe)){const ct=Ax(ue,n,o,h,q,lt,De,$e,nt,Ve,fe,Zi.horizontal,!1,de,ee);ct&&(ne.horizontal[nt]=ct)}gt(Oe?"left":nt)}}let Me=!1;if(N.icon&&N.icon.name){const Fe=c[N.icon.name];Fe&&(pe=Oz(h[N.icon.name],C.get("icon-offset").evaluate(N,{},v),C.get("icon-anchor").evaluate(N,{},v)),Me=Fe.sdf,i.sdfIcons===void 0?i.sdfIcons=Fe.sdf:i.sdfIcons!==Fe.sdf&&In("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==i.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(i.iconsNeedLinear=!0))}const Ae=YT(ne.horizontal)||ne.vertical;i.iconsInText||(i.iconsInText=!!Ae&&Ae.iconsInText),(Ae||pe)&&qz(i,N,ne,pe,c,M,de,0,fe,Me,_,v,E)}p&&i.generateCollisionDebugBuffers(b,i.collisionBoxArray)}function Rx(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function qz(i,n,o,c,h,p,_,v,b,E,C,P,M){let L=p.textMaxSize.evaluate(n,{},P);L===void 0&&(L=_);const z=i.layers[0].layout,N=z.get("icon-offset").evaluate(n,{},P),q=YT(o.horizontal)||o.vertical,ee=M.name==="globe",de=kr,ne=_/de,ue=i.tilePixelRatio*L/de,pe=($e=i.overscaling,i.zoom>18&&$e>2&&($e>>=1),Math.max(Et/(512*$e),1)*z.get("symbol-spacing")),fe=z.get("text-padding")*i.tilePixelRatio,Me=z.get("icon-padding")*i.tilePixelRatio,Ae=pt(z.get("text-max-angle")),Fe=z.get("text-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Je=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",De=z.get("symbol-placement"),Ve=pe/2;var $e;const He=z.get("icon-text-fit");let nt;c&&He!=="none"&&(i.allowVerticalPlacement&&o.vertical&&(nt=NT(c,o.vertical,He,z.get("icon-text-fit-padding"),N,ne)),q&&(c=NT(c,q,He,z.get("icon-text-fit-padding"),N,ne)));const Oe=(lt,gt,ct)=>{if(gt.x<0||gt.x>=Et||gt.y<0||gt.y>=Et)return;let Pt=null;if(ee){const{x:rt,y:wt,z:kt}=M.projectTilePoint(gt.x,gt.y,ct);Pt={anchor:new ua(rt,wt,kt,0,void 0),up:M.upVector(ct,gt.x,gt.y)}}(function(rt,wt,kt,en,Mt,It,Cn,zt,Ot,yn,En,Tn,vn,zn,jn,tr,xn,hr,nr,On,nn,rr,Sn,oi,ir){const Mr=rt.addToLineVertexArray(wt,en);let Tr,si,Sr,ts,ph,Xf,Kf,MS=0,RS=0,DS=0,LS=0,Hx=-1,Zx=-1;const Is={};let zS=$v("");const Uc=kt?kt.anchor:wt;let Xx=0,Kx=0;if(Ot._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Xx,Kx]=Ot.layout.get("text-offset").evaluate(nn,{},ir).map(Mi=>Mi*kr):(Xx=Ot.layout.get("text-radial-offset").evaluate(nn,{},ir)*kr,Kx=Mx),rt.allowVerticalPlacement&&Mt.vertical){const Mi=Mt.vertical;if(jn)Xf=Dx(Mi),zt&&(Kf=Dx(zt));else{const Ri=Ot.layout.get("text-rotate").evaluate(nn,{},ir)+90;Sr=Vg(yn,Uc,wt,En,Tn,vn,Mi,zn,Ri,tr),zt&&(ts=Vg(yn,Uc,wt,En,Tn,vn,zt,hr,Ri))}}if(It){const Mi=Ot.layout.get("icon-rotate").evaluate(nn,{},ir),Ri=Ot.layout.get("icon-text-fit")!=="none",Jf=ZT(It,Mi,Sn,Ri),Yx=zt?ZT(zt,Mi,Sn,Ri):void 0;si=Vg(yn,Uc,wt,En,Tn,vn,It,hr,Mi),MS=4*Jf.length;const OS=rt.iconSizeData;let Vc=null;OS.kind==="source"?(Vc=[Yo*Ot.layout.get("icon-size").evaluate(nn,{},ir)],Vc[0]>ll&&In(`${rt.layerIds[0]}: Value for "icon-size" is >= ${Uf}. Reduce your "icon-size".`)):OS.kind==="composite"&&(Vc=[Yo*rr.compositeIconSizes[0].evaluate(nn,{},ir),Yo*rr.compositeIconSizes[1].evaluate(nn,{},ir)],(Vc[0]>ll||Vc[1]>ll)&&In(`${rt.layerIds[0]}: Value for "icon-size" is >= ${Uf}. Reduce your "icon-size".`)),rt.addSymbols(rt.icon,Jf,Vc,On,nr,nn,!1,kt,wt,Mr.lineStartIndex,Mr.lineLength,-1,oi,ir),Hx=rt.icon.placedSymbolArray.length-1,Yx&&(RS=4*Yx.length,rt.addSymbols(rt.icon,Yx,Vc,On,nr,nn,Zi.vertical,kt,wt,Mr.lineStartIndex,Mr.lineLength,-1,oi,ir),Zx=rt.icon.placedSymbolArray.length-1)}for(const Mi in Mt.horizontal){const Ri=Mt.horizontal[Mi];Tr||(zS=$v(Ri.text),jn?ph=Dx(Ri):Tr=Vg(yn,Uc,wt,En,Tn,vn,Ri,zn,Ot.layout.get("text-rotate").evaluate(nn,{},ir),tr));const Jf=Ri.positionedLines.length===1;if(DS+=JT(rt,kt,wt,Ri,Cn,Ot,jn,nn,tr,Mr,Mt.vertical?Zi.horizontal:Zi.horizontalOnly,Jf?Object.keys(Mt.horizontal):[Mi],Is,Hx,rr,oi,ir),Jf)break}Mt.vertical&&(LS+=JT(rt,kt,wt,Mt.vertical,Cn,Ot,jn,nn,tr,Mr,Zi.vertical,["vertical"],Is,Zx,rr,oi,ir));let pl=-1;const Jx=(Mi,Ri)=>Mi?Math.max(Mi,Ri):Ri;pl=Jx(ph,pl),pl=Jx(Xf,pl),pl=Jx(Kf,pl);const xO=pl>-1?1:0;rt.glyphOffsetArray.length>=ul.MAX_GLYPHS&&In("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nn.sortKey!==void 0&&rt.addToSortKeyRanges(rt.symbolInstances.length,nn.sortKey),rt.symbolInstances.emplaceBack(Uc.x,Uc.y,Uc.z,wt.x,wt.y,Is.right>=0?Is.right:-1,Is.center>=0?Is.center:-1,Is.left>=0?Is.left:-1,Is.vertical>=0?Is.vertical:-1,Hx,Zx,zS,Tr!==void 0?Tr:rt.collisionBoxArray.length,Tr!==void 0?Tr+1:rt.collisionBoxArray.length,Sr!==void 0?Sr:rt.collisionBoxArray.length,Sr!==void 0?Sr+1:rt.collisionBoxArray.length,si!==void 0?si:rt.collisionBoxArray.length,si!==void 0?si+1:rt.collisionBoxArray.length,ts||rt.collisionBoxArray.length,ts?ts+1:rt.collisionBoxArray.length,En,DS,LS,MS,RS,xO,0,Xx,Kx,pl)})(i,gt,Pt,lt,o,c,h,nt,i.layers[0],i.collisionBoxArray,n.index,n.sourceLayerIndex,i.index,fe,Fe,b,0,Me,Je,N,n,p,E,C,P)};if(De==="line")for(const lt of WT(n.geometry,0,0,Et,Et)){const gt=Fz(lt,pe,Ae,o.vertical||q,c,de,ue,i.overscaling,Et);for(const ct of gt)q&&Hz(i,q.text,Ve,ct)||Oe(lt,ct,P)}else if(De==="line-center"){for(const lt of n.geometry)if(lt.length>1){const gt=Bz(lt,Ae,o.vertical||q,c,de,ue);gt&&Oe(lt,gt,P)}}else if(n.type==="Polygon")for(const lt of vx(n.geometry,0)){const gt=Vz(lt,16);Oe(lt[0],new ua(gt.x,gt.y,0,0,void 0),P)}else if(n.type==="LineString")for(const lt of n.geometry)Oe(lt,new ua(lt[0].x,lt[0].y,0,0,void 0),P);else if(n.type==="Point")for(const lt of n.geometry)for(const gt of lt)Oe([gt],new ua(gt.x,gt.y,0,0,void 0),P)}const Uf=255,ll=Uf*Yo;function JT(i,n,o,c,h,p,_,v,b,E,C,P,M,L,z,N,q){const ee=function(ue,pe,fe,Me,Ae,Fe,Je,De){const Ve=[];if(pe.positionedLines.length===0)return Ve;const $e=Me.layout.get("text-rotate").evaluate(Fe,{})*Math.PI/180,He=function(ct){const Pt=ct[0],rt=ct[1],wt=Pt*rt;return wt>0?[Pt,-rt]:wt<0?[-Pt,rt]:Pt===0?[rt,Pt]:[rt,-Pt]}(fe);let nt=Math.abs(pe.top-pe.bottom);for(const ct of pe.positionedLines)nt-=ct.lineOffset;const Oe=pe.positionedLines.length,lt=nt/Oe;let gt=pe.top-fe[1];for(let ct=0;ct<Oe;++ct){const Pt=pe.positionedLines[ct];gt=Nz(pe,lt,gt,ct);for(const rt of Pt.positionedGlyphs){if(!rt.rect)continue;const wt=rt.rect||{};let kt=MT+1,en=!0,Mt=1,It=0;if(rt.imageName){const Sn=Je[rt.imageName];if(!Sn)continue;if(Sn.sdf){In("SDF images are not supported in formatted text and will be ignored.");continue}en=!1,Mt=Sn.pixelRatio,kt=_i/Mt}const Cn=(Ae||De)&&rt.vertical,zt=rt.metrics.advance*rt.scale/2,Ot=rt.metrics,yn=rt.rect;if(yn===null)continue;De&&pe.verticalizable&&(It=rt.imageName?zt-rt.metrics.width*rt.scale/2:0);const En=Ae?[rt.x+zt,rt.y]:[0,0];let Tn=[0,0],vn=[0,0],zn=!1;Ae||(Cn?(vn=[rt.x+zt+He[0],rt.y+He[1]-It],zn=!0):Tn=[rt.x+zt+fe[0],rt.y+fe[1]-It]);const jn=yn.w*rt.scale/(Mt*(rt.localGlyph?Qo:1)),tr=yn.h*rt.scale/(Mt*(rt.localGlyph?Qo:1));let xn,hr,nr,On;if(Cn){const Sn=rt.y-gt,oi=new ze(-zt,zt-Sn),ir=-Math.PI/2,Mr=new ze(...vn);xn=new ze(-zt+Tn[0],Tn[1]),xn._rotateAround(ir,oi)._add(Mr),xn.x+=-Sn+zt,xn.y-=(Ot.left-kt)*rt.scale;const Tr=rt.imageName?Ot.advance*rt.scale:kr*rt.scale,si=String.fromCharCode(rt.glyph);xz(si)?xn.x+=(1-kt)*rt.scale:wz(si)?xn.x+=Tr-Ot.height*rt.scale+(-kt-1)*rt.scale:xn.x+=rt.imageName||Ot.width+2*kt===yn.w&&Ot.height+2*kt===yn.h?(Tr-tr)/2:(Tr-(Ot.height+2*kt)*rt.scale)/2,hr=new ze(xn.x,xn.y-jn),nr=new ze(xn.x+tr,xn.y),On=new ze(xn.x+tr,xn.y-jn)}else{const Sn=(Ot.left-kt)*rt.scale-zt+Tn[0],oi=(-Ot.top-kt)*rt.scale+Tn[1],ir=Sn+jn,Mr=oi+tr;xn=new ze(Sn,oi),hr=new ze(ir,oi),nr=new ze(Sn,Mr),On=new ze(ir,Mr)}if($e){let Sn;Sn=Ae?new ze(0,0):zn?new ze(He[0],He[1]):new ze(fe[0],fe[1]),xn._rotateAround($e,Sn),hr._rotateAround($e,Sn),nr._rotateAround($e,Sn),On._rotateAround($e,Sn)}const nn=new ze(0,0),rr=new ze(0,0);Ve.push({tl:xn,tr:hr,bl:nr,br:On,tex:wt,writingMode:pe.writingMode,glyphOffset:En,sectionIndex:rt.sectionIndex,isSDF:en,pixelOffsetTL:nn,pixelOffsetBR:rr,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,c,b,p,_,v,h,i.allowVerticalPlacement),de=i.textSizeData;let ne=null;de.kind==="source"?(ne=[Yo*p.layout.get("text-size").evaluate(v,{},q)],ne[0]>ll&&In(`${i.layerIds[0]}: Value for "text-size" is >= ${Uf}. Reduce your "text-size".`)):de.kind==="composite"&&(ne=[Yo*z.compositeTextSizes[0].evaluate(v,{},q),Yo*z.compositeTextSizes[1].evaluate(v,{},q)],(ne[0]>ll||ne[1]>ll)&&In(`${i.layerIds[0]}: Value for "text-size" is >= ${Uf}. Reduce your "text-size".`)),i.addSymbols(i.text,ee,ne,b,_,v,C,n,o,E.lineStartIndex,E.lineLength,L,N,q);for(const ue of P)M[ue]=i.text.placedSymbolArray.length-1;return 4*ee.length}function YT(i){for(const n in i)return i[n];return null}function Vg(i,n,o,c,h,p,_,v,b,E){let C=_.top,P=_.bottom,M=_.left,L=_.right;const z=_.collisionPadding;if(z&&(M-=z[0],C-=z[1],L+=z[2],P+=z[3]),b){const N=new ze(M,C),q=new ze(L,C),ee=new ze(M,P),de=new ze(L,P),ne=pt(b);let ue=new ze(0,0);E&&(ue=new ze(E[0],E[1])),N._rotateAround(ne,ue),q._rotateAround(ne,ue),ee._rotateAround(ne,ue),de._rotateAround(ne,ue),M=Math.min(N.x,q.x,ee.x,de.x),L=Math.max(N.x,q.x,ee.x,de.x),C=Math.min(N.y,q.y,ee.y,de.y),P=Math.max(N.y,q.y,ee.y,de.y)}return i.emplaceBack(n.x,n.y,n.z,o.x,o.y,M,C,L,P,v,c,h,p),i.length-1}function Dx(i){i.collisionPadding&&(i.top-=i.collisionPadding[1],i.bottom+=i.collisionPadding[3]);const n=i.bottom-i.top;return n>0?Math.max(10,n):null}function Hz(i,n,o,c){const h=i.compareText;if(n in h){const p=h[n];for(let _=p.length-1;_>=0;_--)if(c.dist(p[_])<o)return!0}else h[n]=[];return h[n].push(c),!1}function QT(i,n){const o=i.fovAboveCenter,c=i.elevation?i.elevation.getMinElevationBelowMSL()*n:0,h=(i._camera.position[2]*i.worldSize-c)/Math.cos(i._pitch),p=Math.sin(o)*h/Math.sin(Math.max(Math.PI/2-i._pitch-o,.01)),_=Math.sin(i._pitch)*p+h;return Math.min(1.01*_,h*(1/i._horizonShift))}function Nc(i,n){if(!n.isReprojectedInTileSpace)return{scale:1<<i.z,x:i.x,y:i.y,x2:i.x+1,y2:i.y+1,projection:n};const o=Math.pow(2,-i.z),c=i.x*o,h=(i.x+1)*o,p=i.y*o,_=(i.y+1)*o,v=Hi(c),b=Hi(h),E=Nr(p),C=Nr(_),P=n.project(v,E),M=n.project(b,E),L=n.project(b,C),z=n.project(v,C);let N=Math.min(P.x,M.x,L.x,z.x),q=Math.min(P.y,M.y,L.y,z.y),ee=Math.max(P.x,M.x,L.x,z.x),de=Math.max(P.y,M.y,L.y,z.y);const ne=o/16;function ue(fe,Me,Ae,Fe,Je,De){const Ve=(Ae+Je)/2,$e=(Fe+De)/2,He=n.project(Hi(Ve),Nr($e)),nt=Math.max(0,N-He.x,q-He.y,He.x-ee,He.y-de);N=Math.min(N,He.x),ee=Math.max(ee,He.x),q=Math.min(q,He.y),de=Math.max(de,He.y),nt>ne&&(ue(fe,He,Ae,Fe,Ve,$e),ue(He,Me,Ve,$e,Je,De))}ue(P,M,c,p,h,p),ue(M,L,h,p,h,_),ue(L,z,h,_,c,_),ue(z,P,c,_,c,p),N-=ne,q-=ne,ee+=ne,de+=ne;const pe=1/Math.max(ee-N,de-q);return{scale:pe,x:N*pe,y:q*pe,x2:ee*pe,y2:de*pe,projection:n}}const Zz=Xo(new Float32Array(16));class cl{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,o){return{x:0,y:0,z:0}}unproject(n,o){return new _n(0,0)}projectTilePoint(n,o,c){return{x:n,y:o,z:0}}locationPoint(n,o,c=!0){return n._coordinatePoint(n.locationCoordinate(o),c)}pixelsPerMeter(n,o){return Jo(1,n)*o}pixelSpaceConversion(n,o,c){return 1}farthestPixelDistance(n){return QT(n,n.pixelsPerMeter)}pointCoordinate(n,o,c,h){const p=n.horizonLineFromTop(!1),_=new ze(o,Math.max(p,c));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,h))}pointCoordinate3D(n,o,c){const h=new ze(o,c);if(n.elevation)return n.elevation.pointCoordinate(h);{const p=this.pointCoordinate(n,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(n,o){if(n.elevation)return!this.pointCoordinate3D(n,o.x,o.y);const c=n.horizonLineFromTop();return o.y<c}createInversionMatrix(n,o){return Zz}createTileMatrix(n,o,c){let h,p,_;const v=c.canonical,b=Xo(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Nc(v,this);h=1,p=E.x+c.wrap*E.scale,_=E.y,Rc(b,b,[h/E.scale,h/E.scale,n.pixelsPerMeter/o])}else h=o/n.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*c.wrap)*h,_=v.y*h;return yf(b,b,[p,_,0]),Rc(b,b,[h/Et,h/Et,1]),b}upVector(n,o,c){return[0,0,1]}upVectorScale(n,o,c){return{metersToTile:1}}}class Xz extends cl{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[o,c]=this.parallels=n.parallels||[29.5,45.5],h=Math.sin(pt(o));this.n=(h+Math.sin(pt(c)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(n,o){const{n:c,c:h,r0:p}=this,_=pt(n-this.center[0]),v=pt(o),b=Math.sqrt(h-2*c*Math.sin(v))/c;return{x:b*Math.sin(_*c),y:b*Math.cos(_*c)-p,z:0}}unproject(n,o){const{n:c,c:h,r0:p}=this,_=p+o;let v=Math.atan2(n,Math.abs(_))*Math.sign(_);_*c<0&&(v-=Math.PI*Math.sign(n)*Math.sign(_));const b=pt(this.center[0])*c;v=Rt(v,-Math.PI-b,Math.PI-b);const E=ot(Zt(v/c)+this.center[0],-180,180),C=Math.asin(ot((h-(n*n+_*_)*c*c)/(2*c),-1,1)),P=ot(Zt(C),-jr,jr);return new _n(E,P)}}const Vf=1.340264,$f=-.081106,Gf=893e-6,Wf=.003796,$g=Math.sqrt(3)/2;class Kz extends cl{project(n,o){o=o/180*Math.PI,n=n/180*Math.PI;const c=Math.asin($g*Math.sin(o)),h=c*c,p=h*h*h;return{x:.5*(n*Math.cos(c)/($g*(Vf+3*$f*h+p*(7*Gf+9*Wf*h)))/Math.PI+.5),y:1-.5*(c*(Vf+$f*h+p*(Gf+Wf*h))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=c*c,p=h*h*h;for(let C,P,M,L=0;L<12&&(P=c*(Vf+$f*h+p*(Gf+Wf*h))-o,M=Vf+3*$f*h+p*(7*Gf+9*Wf*h),C=P/M,c=ot(c-C,-Math.PI/3,Math.PI/3),h=c*c,p=h*h*h,!(Math.abs(C)<1e-12));++L);const _=$g*n*(Vf+3*$f*h+p*(7*Gf+9*Wf*h))/Math.cos(c),v=Math.asin(Math.sin(c)/$g),b=ot(180*_/Math.PI,-180,180),E=ot(180*v/Math.PI,-jr,jr);return new _n(b,E)}}class Jz extends cl{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){return{x:.5+n/360,y:.5-o/360,z:0}}unproject(n,o){const c=360*(n-.5),h=ot(360*(.5-o),-jr,jr);return new _n(c,h)}}const dh=Math.PI/2;function Gg(i){return Math.tan((dh+i)/2)}class Yz extends cl{constructor(n){super(n),this.center=n.center||[0,30];const[o,c]=this.parallels=n.parallels||[30,30];let h=pt(o),p=pt(c);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const _=Math.cos(h),v=Gg(h);this.n=h===p?Math.sin(h):Math.log(_/Math.cos(p))/Math.log(Gg(p)/v),this.f=_*Math.pow(Gg(h),this.n)/this.n}project(n,o){o=pt(o),this.southernCenter&&(o=-o),n=pt(n-this.center[0]);const c=1e-6,{n:h,f:p}=this;p>0?o<-dh+c&&(o=-dh+c):o>dh-c&&(o=dh-c);const _=p/Math.pow(Gg(o),h);let v=_*Math.sin(h*n),b=p-_*Math.cos(h*n);return v=.5*(v/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:v,y:this.southernCenter?b:1-b,z:0}}unproject(n,o){n=(2*n-.5)*Math.PI,this.southernCenter&&(o=1-o),o=(2*(1-o)-.5)*Math.PI;const{n:c,f:h}=this,p=h-o,_=Math.sign(p),v=Math.sign(c)*Math.sqrt(n*n+p*p);let b=Math.atan2(n,Math.abs(p))*_;p*c<0&&(b-=Math.PI*Math.sign(n)*_);const E=ot(Zt(b/c)+this.center[0],-180,180),C=ot(Zt(2*Math.atan(Math.pow(h/v,1/c))-dh),-jr,jr);return new _n(E,this.southernCenter?-C:C)}}class eS extends cl{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,o){return{x:ws(n),y:bs(o),z:0}}unproject(n,o){const c=Hi(n),h=Nr(o);return new _n(c,h)}}const tS=pt(jr);class Qz extends cl{project(n,o){const c=(o=pt(o))*o,h=c*c;return{x:.5*((n=pt(n))*(.8707-.131979*c+h*(h*(.003971*c-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(o*(1.007226+c*(.015085+h*(.028874*c-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(n,o){n=(2*n-.5)*Math.PI;let c=o=(2*(1-o)-1)*Math.PI,h=25,p=0,_=c*c;do{_=c*c;const E=_*_;p=(c*(1.007226+_*(.015085+E*(.028874*_-.044475-.005916*E)))-o)/(1.007226+_*(.045255+E*(.259866*_-.311325-.005916*11*E))),c=ot(c-p,-tS,tS)}while(Math.abs(p)>1e-6&&--h>0);_=c*c;const v=ot(Zt(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),b=Zt(c);return new _n(v,b)}}const nS=pt(jr);class eO extends cl{project(n,o){o=pt(o),n=pt(n);const c=Math.cos(o),h=2/Math.PI,p=Math.acos(c*Math.cos(n/2)),_=Math.sin(p)/p,v=.5*(n*h+2*c*Math.sin(n/2)/_)||0,b=.5*(o+Math.sin(o)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(n,o){let c=n=(2*n-.5)*Math.PI,h=o=(2*(1-o)-1)*Math.PI,p=25;const _=1e-6;let v=0,b=0;do{const E=Math.cos(h),C=Math.sin(h),P=2*C*E,M=C*C,L=E*E,z=Math.cos(c/2),N=Math.sin(c/2),q=2*z*N,ee=N*N,de=1-L*z*z,ne=de?1/de:0,ue=de?Math.acos(E*z)*Math.sqrt(1/de):0,pe=.5*(2*ue*E*N+2*c/Math.PI)-n,fe=.5*(ue*C+h)-o,Me=.5*ne*(L*ee+ue*E*z*M)+1/Math.PI,Ae=ne*(q*P/4-ue*C*N),Fe=.125*ne*(P*N-ue*C*L*q),Je=.5*ne*(M*z+ue*ee*E)+.5,De=Ae*Fe-Je*Me;v=(fe*Ae-pe*Je)/De,b=(pe*Fe-fe*Me)/De,c=ot(c-v,-Math.PI,Math.PI),h=ot(h-b,-nS,nS)}while((Math.abs(v)>_||Math.abs(b)>_)&&--p>0);return new _n(Zt(c),Zt(h))}}class rS extends cl{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(pt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,o){const{scale:c,cosPhi:h}=this;return{x:pt(n)*h*c+.5,y:-Math.sin(pt(o))/h*c+.5,z:0}}unproject(n,o){const{scale:c,cosPhi:h}=this,p=-(o-.5)/c,_=ot(Zt((n-.5)/c)/h,-180,180),v=Math.asin(ot(p*h,-1,1)),b=ot(Zt(v),-jr,jr);return new _n(_,b)}}class tO extends eS{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,o,c){const h=If(n,o,c);return Gn(h,h,Cf(xs(c))),{x:h[0],y:h[1],z:h[2]}}locationPoint(n,o){const c=Ju(o.lat,o.lng),h=ni([],c),p=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(o),n._centerAltitude):n._centerAltitude;bf(c,c,h,Jo(1,0)*Et*p);const _=Xo(new Float64Array(16));return Mc(_,n.pixelMatrix,n.globeMatrix),Gn(c,c,_),new ze(c[0],c[1])}pixelsPerMeter(n,o){return Jo(1,0)*o}pixelSpaceConversion(n,o,c){const h=Jo(1,n)*o,p=Jt(Jo(1,45)*o,h,c);return this.pixelsPerMeter(n,o)/p}createTileMatrix(n,o,c){const h=rx(xs(c.canonical));return Mc(new Float64Array(16),n.globeMatrix,h)}createInversionMatrix(n,o){const{center:c}=n,h=Cf(xs(o));return yg(h,h,pt(c.lng)),Hv(h,h,pt(c.lat)),Rc(h,h,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(n,o,c,h){return kE(n,o,c,!0)||new Qu(0,0)}pointCoordinate3D(n,o,c){const h=this.pointCoordinate(n,o,c,0);return[h.x,h.y,h.z]}isPointAboveHorizon(n,o){return!kE(n,o.x,o.y,!1)}farthestPixelDistance(n){const o=function(h,p){const _=h.cameraToCenterDistance,v=h._centerAltitude*p,b=h._camera,E=h._camera.forward(),C=sa([],qi([],E,-_),[0,0,v]),P=h.worldSize/(2*Math.PI),M=[0,0,-P],L=h.width/h.height,z=Math.tan(h.fovAboveCenter),N=qi([],b.up(),z),q=qi([],b.right(),z*L),ee=ni([],sa([],sa([],E,N),q)),de=[];let ne;if(new Jv(C,ee).closestPointOnSphere(M,P,de)){const ue=sa([],de,M),pe=Ko([],ue,C);ne=Math.cos(h.fovAboveCenter)*vf(pe)}else{const ue=Ko([],C,M),pe=Ko([],M,C);ni(pe,pe);const fe=vf(ue)-P;ne=Math.sqrt(fe*(fe+2*P));const Me=Math.acos(ne/(P+fe))-Math.acos(yo(E,pe));ne*=Math.cos(Me)}return 1.01*ne}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),c=Yu(n.zoom);if(c>0){const h=QT(n,Jo(1,n.center.lat)*n.worldSize),p=n.worldSize/(2*Math.PI),_=Math.max(n.width,n.height)/n.worldSize*Math.PI;return Jt(o,h+p*(1-Math.cos(_)),Math.pow(c,10))}return o}upVector(n,o,c){return If(o,c,n,1)}upVectorScale(n){return{metersToTile:vg(wg(xs(n)))}}}function iS(i){const n=i.parallels,o=!!n&&Math.abs(n[0]+n[1])<.01;switch(i.name){case"mercator":return new eS(i);case"equirectangular":return new Jz(i);case"naturalEarth":return new Qz(i);case"equalEarth":return new Kz(i);case"winkelTripel":return new eO(i);case"albers":return o?new rS(i):new Xz(i);case"lambertConformalConic":return o?new rS(i):new Yz(i);case"globe":return new tO(i)}throw new Error(`Invalid projection name: ${i.name}`)}const nO=Mg.types,rO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Wg(i,n,o,c,h,p,_,v,b,E,C,P,M){const L=v?Math.min(ll,Math.round(v[0])):0,z=v?Math.min(ll,Math.round(v[1])):0;i.emplaceBack(n,o,Math.round(32*c),Math.round(32*h),p,_,(L<<1)+(b?1:0),z,16*E,16*C,256*P,256*M)}function qg(i,n,o,c,h,p,_){i.emplaceBack(n,o,c,h,p,_)}function Hg(i,n,o,c,h){i.emplaceBack(n,o,c,h),i.emplaceBack(n,o,c,h),i.emplaceBack(n,o,c,h),i.emplaceBack(n,o,c,h)}function iO(i){for(const n of i.sections)if(Vv(n.text))return!0;return!1}class Lx{constructor(n){this.layoutVertexArray=new We,this.indexArray=new yt,this.programConfigurations=n,this.segments=new Qn,this.dynamicLayoutVertexArray=new Ze,this.opacityVertexArray=new xt,this.placedSymbolArray=new Yn,this.globeExtVertexArray=new et}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,o,c,h){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,dz.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,pz.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,rO,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,fz.members,!0)),this.opacityVertexBuffer.itemSize=1),(c||h)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ft(Lx,"SymbolBuffers");class zx{constructor(n,o,c){this.layoutVertexArray=new n,this.layoutAttributes=o,this.indexArray=new c,this.segments=new Qn,this.collisionVertexArray=new Wt,this.collisionVertexArrayExt=new Nt}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,mz.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,gz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ft(zx,"CollisionBuffers");class ul{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Xo([]),this.placementViewportMatrix=Xo([]);const o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ex(this.zoom,o["text-size"]),this.iconSizeData=Ex(this.zoom,o["icon-size"]);const c=this.layers[0].layout,h=c.get("symbol-sort-key"),p=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>Zi[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Lx(new kc(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Lx(new kc(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new ti,this.lineVertexArray=new qu,this.symbolInstances=new Pn}calculateGlyphDependencies(n,o,c,h,p){for(let _=0;_<n.length;_++)if(o[n.charCodeAt(_)]=!0,h&&p){const v=Ff[n.charAt(_)];v&&(o[v.charCodeAt(0)]=!0)}}populate(n,o,c,h){const p=this.layers[0],_=p.layout,v=this.projection.name==="globe",b=_.get("text-font"),E=_.get("text-field"),C=_.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof ei&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),M=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,L=_.get("symbol-sort-key");if(this.features=[],!P&&!M)return;const z=o.iconDependencies,N=o.glyphDependencies,q=o.availableImages,ee=new A(this.zoom);for(const{feature:de,id:ne,index:ue,sourceLayerIndex:pe}of n){const fe=p._featureFilter.needGeometry,Me=Oc(de,fe);if(!p._featureFilter.filter(ee,Me,c))continue;if(fe||(Me.geometry=aa(de,c,h)),v&&de.type!==1&&c.z<=5){const De=Me.geometry,Ve=.98078528056,$e=(He,nt)=>yo(If(He.x,He.y,c,1),If(nt.x,nt.y,c,1))<Ve;for(let He=0;He<De.length;He++)De[He]=pL(De[He],$e)}let Ae,Fe;if(P){const De=p.getValueAndResolveTokens("text-field",Me,c,q),Ve=ei.factory(De);iO(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||x()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Ae=vz(Ve,p,Me))}if(M){const De=p.getValueAndResolveTokens("icon-image",Me,c,q);Fe=De instanceof Si?De:Si.fromString(De)}if(!Ae&&!Fe)continue;const Je=this.sortFeaturesByKey?L.evaluate(Me,{},c):void 0;if(this.features.push({id:ne,text:Ae,icon:Fe,index:ue,sourceLayerIndex:pe,geometry:Me.geometry,properties:de.properties,type:nO[de.type],sortKey:Je}),Fe&&(z[Fe.name]=!0),Ae){const De=b.evaluate(Me,{},c).join(","),Ve=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zi.vertical)>=0;for(const $e of Ae.sections)if($e.image)z[$e.image.name]=!0;else{const He=hf(Ae.toString()),nt=$e.fontStack||De,Oe=N[nt]=N[nt]||{};this.calculateGlyphDependencies($e.text,Oe,Ve,this.allowVerticalPlacement,He)}}}_.get("symbol-placement")==="line"&&(this.features=function(de){const ne={},ue={},pe=[];let fe=0;function Me(De){pe.push(de[De]),fe++}function Ae(De,Ve,$e){const He=ue[De];return delete ue[De],ue[Ve]=He,pe[He].geometry[0].pop(),pe[He].geometry[0]=pe[He].geometry[0].concat($e[0]),He}function Fe(De,Ve,$e){const He=ne[Ve];return delete ne[Ve],ne[De]=He,pe[He].geometry[0].shift(),pe[He].geometry[0]=$e[0].concat(pe[He].geometry[0]),He}function Je(De,Ve,$e){const He=$e?Ve[0][Ve[0].length-1]:Ve[0][0];return`${De}:${He.x}:${He.y}`}for(let De=0;De<de.length;De++){const Ve=de[De],$e=Ve.geometry,He=Ve.text?Ve.text.toString():null;if(!He){Me(De);continue}const nt=Je(He,$e),Oe=Je(He,$e,!0);if(nt in ue&&Oe in ne&&ue[nt]!==ne[Oe]){const lt=Fe(nt,Oe,$e),gt=Ae(nt,Oe,pe[lt].geometry);delete ne[nt],delete ue[Oe],ue[Je(He,pe[gt].geometry,!0)]=gt,pe[lt].geometry=null}else nt in ue?Ae(nt,Oe,$e):Oe in ne?Fe(nt,Oe,$e):(Me(De),ne[nt]=fe-1,ue[Oe]=fe-1)}return pe.filter(De=>De.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((de,ne)=>de.sortKey-ne.sortKey)}update(n,o,c,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,o,this.layers,c,h),this.icon.programConfigurations.updatePaintArrays(n,o,this.layers,c,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=iS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,o){const c=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:h,y:p}of o)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,o,c,h,p,_,v,b,E,C,P,M,L,z){const N=n.indexArray,q=n.layoutVertexArray,ee=n.globeExtVertexArray,de=n.segments.prepareSegment(4*o.length,q,N,this.canOverlap?_.sortKey:void 0),ne=this.glyphOffsetArray.length,ue=de.vertexLength,pe=this.allowVerticalPlacement&&v===Zi.vertical?Math.PI/2:0,fe=_.text&&_.text.sections;for(let Ae=0;Ae<o.length;Ae++){const{tl:Fe,tr:Je,bl:De,br:Ve,tex:$e,pixelOffsetTL:He,pixelOffsetBR:nt,minFontScaleX:Oe,minFontScaleY:lt,glyphOffset:gt,isSDF:ct,sectionIndex:Pt}=o[Ae],rt=de.vertexLength,wt=gt[1];if(Wg(q,E.x,E.y,Fe.x,wt+Fe.y,$e.x,$e.y,c,ct,He.x,He.y,Oe,lt),Wg(q,E.x,E.y,Je.x,wt+Je.y,$e.x+$e.w,$e.y,c,ct,nt.x,He.y,Oe,lt),Wg(q,E.x,E.y,De.x,wt+De.y,$e.x,$e.y+$e.h,c,ct,He.x,nt.y,Oe,lt),Wg(q,E.x,E.y,Ve.x,wt+Ve.y,$e.x+$e.w,$e.y+$e.h,c,ct,nt.x,nt.y,Oe,lt),b){const{x:kt,y:en,z:Mt}=b.anchor,[It,Cn,zt]=b.up;qg(ee,kt,en,Mt,It,Cn,zt),qg(ee,kt,en,Mt,It,Cn,zt),qg(ee,kt,en,Mt,It,Cn,zt),qg(ee,kt,en,Mt,It,Cn,zt),Hg(n.dynamicLayoutVertexArray,kt,en,Mt,pe)}else Hg(n.dynamicLayoutVertexArray,E.x,E.y,E.z,pe);N.emplaceBack(rt,rt+1,rt+2),N.emplaceBack(rt+1,rt+2,rt+3),de.vertexLength+=4,de.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Ae!==o.length-1&&Pt===o[Ae+1].sectionIndex||n.programConfigurations.populatePaintArrays(q.length,_,_.index,{},L,z,fe&&fe[Pt])}const Me=b?b.anchor:E;n.placedSymbolArray.emplaceBack(Me.x,Me.y,Me.z,E.x,E.y,ne,this.glyphOffsetArray.length-ne,ue,C,P,E.segment,c?c[0]:0,c?c[1]:0,h[0],h[1],v,0,!1,0,M,0)}_commitLayoutVertex(n,o,c,h,p,_,v){n.emplaceBack(o,c,h,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(n,o,c,h,p,_,v){const b=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),E=b.vertexLength,C=v.tileAnchorX,P=v.tileAnchorY;for(let L=0;L<4;L++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(o,-n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(o,n.padding,n.padding),c.collisionVertexArrayExt.emplaceBack(o,-n.padding,n.padding),this._commitLayoutVertex(c.layoutVertexArray,h,p,_,C,P,new ze(n.x1,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,_,C,P,new ze(n.x2,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,h,p,_,C,P,new ze(n.x2,n.y2)),this._commitLayoutVertex(c.layoutVertexArray,h,p,_,C,P,new ze(n.x1,n.y2)),b.vertexLength+=4;const M=c.indexArray;M.emplaceBack(E,E+1),M.emplaceBack(E+1,E+2),M.emplaceBack(E+2,E+3),M.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(n,o,c,h,p,_){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceTextSize(n,_,o,v);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,o,c,h,p,_){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceIconSize(n,o,_.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,o){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zx(mt,ET.members,Er),this.iconCollisionBox=new zx(mt,ET.members,Er);const c=ih(this.iconSizeData,n),h=ih(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,n,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,n,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,o,c,h){const p=this.text.placedSymbolArray.get(o.rightJustifiedTextSymbolIndex>=0?o.rightJustifiedTextSymbolIndex:o.centerJustifiedTextSymbolIndex>=0?o.centerJustifiedTextSymbolIndex:o.leftJustifiedTextSymbolIndex>=0?o.leftJustifiedTextSymbolIndex:o.verticalPlacedTextSymbolIndex>=0?o.verticalPlacedTextSymbolIndex:h),_=zg(this.textSizeData,n,p)/kr;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,o,c){const h=this.icon.placedSymbolArray.get(c),p=zg(this.iconSizeData,n,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(n,o,c){n.emplaceBack(o,-c,-c),n.emplaceBack(o,c,-c),n.emplaceBack(o,c,c),n.emplaceBack(o,-c,c)}_updateTextDebugCollisionBoxes(n,o,c,h,p,_){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceTextSize(n,_,o,v);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding)}}_updateIconDebugCollisionBoxes(n,o,c,h,p,_){for(let v=h;v<p;v++){const b=c.get(v),E=this.getSymbolInstanceIconSize(n,o,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding)}}updateCollisionDebugBuffers(n,o){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=ih(this.iconSizeData,n),h=ih(this.textSizeData,n);for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,n,o,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,n,o,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,n,o,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(c,n,o,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,o,c,h,p,_,v,b,E){const C={};if(o<c){const{x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue,featureIndex:pe}=n.get(o);C.textBox={x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue},C.textFeatureIndex=pe}if(h<p){const{x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue,featureIndex:pe}=n.get(h);C.verticalTextBox={x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue},C.verticalTextFeatureIndex=pe}if(_<v){const{x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue,featureIndex:pe}=n.get(_);C.iconBox={x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue},C.iconFeatureIndex=pe}if(b<E){const{x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue,featureIndex:pe}=n.get(b);C.verticalIconBox={x1:P,y1:M,x2:L,y2:z,padding:N,projectedAnchorX:q,projectedAnchorY:ee,projectedAnchorZ:de,tileAnchorX:ne,tileAnchorY:ue},C.verticalIconFeatureIndex=pe}return C}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let o=0;o<this.symbolInstances.length;o++){const c=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,o){const c=n.placedSymbolArray.get(o),h=c.vertexStartIndex+4*c.numGlyphs;for(let p=c.vertexStartIndex;p<h;p+=4)n.indexArray.emplaceBack(p,p+1,p+2),n.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const o=Math.sin(n),c=Math.cos(n),h=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const b=this.symbolInstances.get(v);h.push(0|Math.round(o*b.tileAnchorX+c*b.tileAnchorY)),p.push(b.featureIndex)}return _.sort((v,b)=>h[v]-h[b]||p[b]-p[v]),_}addToSortKeyRanges(n,o){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===o?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const o of this.symbolInstanceIndexes){const c=this.symbolInstances.get(o);this.featureSortOrder.push(c.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=c;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ft(ul,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ul.MAX_GLYPHS=65535,ul.addDynamicAttributes=Hg;const oO=new se({"symbol-placement":new F(Be.layout_symbol["symbol-placement"]),"symbol-spacing":new F(Be.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new F(Be.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new H(Be.layout_symbol["symbol-sort-key"]),"symbol-z-order":new F(Be.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new F(Be.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new F(Be.layout_symbol["icon-ignore-placement"]),"icon-optional":new F(Be.layout_symbol["icon-optional"]),"icon-rotation-alignment":new F(Be.layout_symbol["icon-rotation-alignment"]),"icon-size":new H(Be.layout_symbol["icon-size"]),"icon-text-fit":new F(Be.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new F(Be.layout_symbol["icon-text-fit-padding"]),"icon-image":new H(Be.layout_symbol["icon-image"]),"icon-rotate":new H(Be.layout_symbol["icon-rotate"]),"icon-padding":new F(Be.layout_symbol["icon-padding"]),"icon-keep-upright":new F(Be.layout_symbol["icon-keep-upright"]),"icon-offset":new H(Be.layout_symbol["icon-offset"]),"icon-anchor":new H(Be.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new F(Be.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new F(Be.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new F(Be.layout_symbol["text-rotation-alignment"]),"text-field":new H(Be.layout_symbol["text-field"]),"text-font":new H(Be.layout_symbol["text-font"]),"text-size":new H(Be.layout_symbol["text-size"]),"text-max-width":new H(Be.layout_symbol["text-max-width"]),"text-line-height":new H(Be.layout_symbol["text-line-height"]),"text-letter-spacing":new H(Be.layout_symbol["text-letter-spacing"]),"text-justify":new H(Be.layout_symbol["text-justify"]),"text-radial-offset":new H(Be.layout_symbol["text-radial-offset"]),"text-variable-anchor":new F(Be.layout_symbol["text-variable-anchor"]),"text-anchor":new H(Be.layout_symbol["text-anchor"]),"text-max-angle":new F(Be.layout_symbol["text-max-angle"]),"text-writing-mode":new F(Be.layout_symbol["text-writing-mode"]),"text-rotate":new H(Be.layout_symbol["text-rotate"]),"text-padding":new F(Be.layout_symbol["text-padding"]),"text-keep-upright":new F(Be.layout_symbol["text-keep-upright"]),"text-transform":new H(Be.layout_symbol["text-transform"]),"text-offset":new H(Be.layout_symbol["text-offset"]),"text-allow-overlap":new F(Be.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new F(Be.layout_symbol["text-ignore-placement"]),"text-optional":new F(Be.layout_symbol["text-optional"])});var Ox={paint:new se({"icon-opacity":new H(Be.paint_symbol["icon-opacity"]),"icon-color":new H(Be.paint_symbol["icon-color"]),"icon-halo-color":new H(Be.paint_symbol["icon-halo-color"]),"icon-halo-width":new H(Be.paint_symbol["icon-halo-width"]),"icon-halo-blur":new H(Be.paint_symbol["icon-halo-blur"]),"icon-translate":new F(Be.paint_symbol["icon-translate"]),"icon-translate-anchor":new F(Be.paint_symbol["icon-translate-anchor"]),"text-opacity":new H(Be.paint_symbol["text-opacity"]),"text-color":new H(Be.paint_symbol["text-color"],{runtimeType:mi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new H(Be.paint_symbol["text-halo-color"]),"text-halo-width":new H(Be.paint_symbol["text-halo-width"]),"text-halo-blur":new H(Be.paint_symbol["text-halo-blur"]),"text-translate":new F(Be.paint_symbol["text-translate"]),"text-translate-anchor":new F(Be.paint_symbol["text-translate-anchor"])}),layout:oO};class oS{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:ja,this.defaultValue=n}evaluate(n){if(n.formattedSection){const o=this.defaultValue.property.overrides;if(o&&o.hasOverride(n.formattedSection))return o.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ft(oS,"FormatSectionOverride",{omit:["defaultValue"]});class Zg extends Zo{constructor(n){super(n,Ox)}recalculate(n,o){super.recalculate(n,o),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const h=[];for(const p of c)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,o,c,h){const p=this.layout.get(n).evaluate(o,{},c,h),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Ya(_.value)||!p?p:function(v,b){return b.replace(/{([^{}]+)}/g,(E,C)=>C in v?String(v[C]):"")}(o.properties,p)}createBucket(n){return new ul(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Ox.paint.overridableProperties){if(!Zg.hasPaintOverride(this.layout,n))continue;const o=this.paint.get(n),c=new oS(o),h=new Fu(c,o.property.specification);let p=null;p=o.value.kind==="constant"||o.value.kind==="source"?new Qd("source",h):new wc("composite",h,o.value.zoomStops,o.value._interpolationType),this.paint._values[n]=new K(o.property,p,o.parameters)}}_handleOverridablePaintPropertyUpdate(n,o,c){return!(!this.layout||o.isDataDriven()||c.isDataDriven())&&Zg.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,o){const c=n.get("text-field"),h=Ox.paint.properties[o];let p=!1;const _=v=>{for(const b of v)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(c.value.kind==="constant"&&c.value.value instanceof ei)_(c.value.value.sections);else if(c.value.kind==="source"){const v=E=>{p||(E instanceof Xs&&Nn(E.value)===ic?_(E.value.sections):E instanceof gs?_(E.sections):E.eachChild(v))},b=c.value;b._styleExpression&&v(b._styleExpression.expression)}return p}getProgramConfiguration(n){return new ol(this,n)}}var sO={paint:new se({"background-color":new F(Be.paint_background["background-color"]),"background-pattern":new F(Be.paint_background["background-pattern"]),"background-opacity":new F(Be.paint_background["background-opacity"])})},aO={paint:new se({"raster-opacity":new F(Be.paint_raster["raster-opacity"]),"raster-hue-rotate":new F(Be.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new F(Be.paint_raster["raster-brightness-min"]),"raster-brightness-max":new F(Be.paint_raster["raster-brightness-max"]),"raster-saturation":new F(Be.paint_raster["raster-saturation"]),"raster-contrast":new F(Be.paint_raster["raster-contrast"]),"raster-resampling":new F(Be.paint_raster["raster-resampling"]),"raster-fade-duration":new F(Be.paint_raster["raster-fade-duration"])})};class lO extends Zo{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var cO={paint:new se({"sky-type":new F(Be.paint_sky["sky-type"]),"sky-atmosphere-sun":new F(Be.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new F(Be.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new F(Be.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new F(Be.paint_sky["sky-gradient-radius"]),"sky-gradient":new ie(Be.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new F(Be.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new F(Be.paint_sky["sky-atmosphere-color"]),"sky-opacity":new F(Be.paint_sky["sky-opacity"])})};function Bx(i,n,o){const c=[0,0,1],h=TE([]);return IE(h,h,o?-pt(i)+Math.PI:pt(i)),SE(h,h,-pt(n)),xE(c,c,h),ni(c,c)}const uO={circle:class extends Zo{constructor(i){super(i,wL)}createBucket(i){return new cx(i)}queryRadius(i){const n=i;return eh("circle-radius",this,n)+eh("circle-stroke-width",this,n)+Tg(this.paint.get("circle-translate"))}queryIntersectsFeature(i,n,o,c,h,p,_,v){const b=ZE(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o);return XE(i,c,p,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getProgramConfiguration(i){return new ol(this,i)}},heatmap:class extends Zo{createBucket(i){return new JE(i)}constructor(i){super(i,SL),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fx({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(i){return eh("heatmap-radius",this,i)}queryIntersectsFeature(i,n,o,c,h,p,_,v){const b=this.paint.get("heatmap-radius").evaluate(n,o);return XE(i,c,p,_,v,!0,!0,new ze(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(i){return new ol(this,i)}},hillshade:class extends Zo{constructor(i){super(i,IL)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Zo{constructor(i){super(i,VL)}getProgramIds(){const i=this.paint.get("fill-pattern"),n=i&&i.constantOr(1),o=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&o.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),o}getProgramConfiguration(i){return new ol(this,i)}recalculate(i,n){super.recalculate(i,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Pg(i)}queryRadius(){return Tg(this.paint.get("fill-translate"))}queryIntersectsFeature(i,n,o,c,h,p){return!i.queryGeometry.isAboveHorizon&&$E(HE(i.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Zo{constructor(i){super(i,iz)}createBucket(i){return new zf(i)}queryRadius(){return Tg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(i){return new ol(this,i)}queryIntersectsFeature(i,n,o,c,h,p,_,v,b){const E=ZE(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(n,o),P=this.paint.get("fill-extrusion-base").evaluate(n,o),M=[0,0],L=v&&p.elevation,z=p.elevation?p.elevation.exaggeration():1,N=i.tile.getBucket(this);if(L&&N instanceof zf){const ue=N.centroidVertexArray,pe=b+1;pe<ue.length&&(M[0]=ue.geta_centroid_pos0(pe),M[1]=ue.geta_centroid_pos1(pe))}if(M[0]===0&&M[1]===1)return!1;p.projection.name==="globe"&&(c=mT([c],[new ze(0,0),new ze(Et,Et)],i.tileID.canonical).map(ue=>ue.polygon).flat());const q=L?v:null,[ee,de]=function(ue,pe,fe,Me,Ae,Fe,Je,De,Ve,$e,He){return ue.projection.name==="globe"?function(nt,Oe,lt,gt,ct,Pt,rt,wt,kt,en,Mt){const It=[],Cn=[],zt=nt.projection.upVectorScale(Mt,nt.center.lat,nt.worldSize).metersToTile,Ot=[0,0,0,1],yn=[0,0,0,1],En=(vn,zn,jn,tr)=>{vn[0]=zn,vn[1]=jn,vn[2]=tr,vn[3]=1},Tn=pT();lt>0&&(lt+=Tn),gt+=Tn;for(const vn of Oe){const zn=[],jn=[];for(const tr of vn){const xn=tr.x+ct.x,hr=tr.y+ct.y,nr=nt.projection.projectTilePoint(xn,hr,Mt),On=nt.projection.upVector(Mt,tr.x,tr.y);let nn=lt,rr=gt;if(rt){const Sn=vT(xn,hr,lt,gt,rt,wt,kt,en);nn+=Sn.base,rr+=Sn.top}lt!==0?En(Ot,nr.x+On[0]*zt*nn,nr.y+On[1]*zt*nn,nr.z+On[2]*zt*nn):En(Ot,nr.x,nr.y,nr.z),En(yn,nr.x+On[0]*zt*rr,nr.y+On[1]*zt*rr,nr.z+On[2]*zt*rr),Gn(Ot,Ot,Pt),Gn(yn,yn,Pt),zn.push(new rh(Ot[0],Ot[1],Ot[2])),jn.push(new rh(yn[0],yn[1],yn[2]))}It.push(zn),Cn.push(jn)}return[It,Cn]}(ue,pe,fe,Me,Ae,Fe,Je,De,Ve,$e,He):Je?function(nt,Oe,lt,gt,ct,Pt,rt,wt,kt){const en=[],Mt=[],It=[0,0,0,1];for(const Cn of nt){const zt=[],Ot=[];for(const yn of Cn){const En=yn.x+gt.x,Tn=yn.y+gt.y,vn=vT(En,Tn,Oe,lt,Pt,rt,wt,kt);It[0]=En,It[1]=Tn,It[2]=vn.base,It[3]=1,Dc(It,It,ct),It[3]=Math.max(It[3],1e-5);const zn=new rh(It[0]/It[3],It[1]/It[3],It[2]/It[3]);It[0]=En,It[1]=Tn,It[2]=vn.top,It[3]=1,Dc(It,It,ct),It[3]=Math.max(It[3],1e-5);const jn=new rh(It[0]/It[3],It[1]/It[3],It[2]/It[3]);zt.push(zn),Ot.push(jn)}en.push(zt),Mt.push(Ot)}return[en,Mt]}(pe,fe,Me,Ae,Fe,Je,De,Ve,$e):function(nt,Oe,lt,gt,ct){const Pt=[],rt=[],wt=ct[8]*Oe,kt=ct[9]*Oe,en=ct[10]*Oe,Mt=ct[11]*Oe,It=ct[8]*lt,Cn=ct[9]*lt,zt=ct[10]*lt,Ot=ct[11]*lt;for(const yn of nt){const En=[],Tn=[];for(const vn of yn){const zn=vn.x+gt.x,jn=vn.y+gt.y,tr=ct[0]*zn+ct[4]*jn+ct[12],xn=ct[1]*zn+ct[5]*jn+ct[13],hr=ct[2]*zn+ct[6]*jn+ct[14],nr=ct[3]*zn+ct[7]*jn+ct[15],On=tr+wt,nn=xn+kt,rr=hr+en,Sn=Math.max(nr+Mt,1e-5),oi=tr+It,ir=xn+Cn,Mr=hr+zt,Tr=Math.max(nr+Ot,1e-5);En.push(new rh(On/Sn,nn/Sn,rr/Sn)),Tn.push(new rh(oi/Tr,ir/Tr,Mr/Tr))}Pt.push(En),rt.push(Tn)}return[Pt,rt]}(pe,fe,Me,Ae,Fe)}(p,c,P,C,E,_,q,M,z,p.center.lat,i.tileID.canonical),ne=i.queryGeometry;return function(ue,pe,fe){let Me=1/0;$E(fe,pe)&&(Me=yT(fe,pe[0]));for(let Ae=0;Ae<pe.length;Ae++){const Fe=pe[Ae],Je=ue[Ae];for(let De=0;De<Fe.length-1;De++){const Ve=Fe[De],$e=[Ve,Fe[De+1],Je[De+1],Je[De],Ve];VE(fe,$e)&&(Me=Math.min(Me,yT(fe,$e)))}}return Me!==1/0&&Me}(ee,de,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends Zo{constructor(i){super(i,xT),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof jd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(i,n){super.recalculate(i,n),this.paint._values["line-floorwidth"]=wT.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Lg(i)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(i){return new ol(this,i)}queryRadius(i){const n=i,o=bT(eh("line-width",this,n),eh("line-gap-width",this,n)),c=eh("line-offset",this,n);return o/2+Math.abs(c)+Tg(this.paint.get("line-translate"))}queryIntersectsFeature(i,n,o,c,h,p){if(i.queryGeometry.isAboveHorizon)return!1;const _=HE(i.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,i.pixelToTileUnitsFactor),v=i.pixelToTileUnitsFactor/2*bT(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),b=this.paint.get("line-offset").evaluate(n,o);return b&&(c=function(E,C){const P=[],M=new ze(0,0);for(let L=0;L<E.length;L++){const z=E[L],N=[];for(let q=0;q<z.length;q++){const ee=z[q],de=z[q+1],ne=q===0?M:ee.sub(z[q-1])._unit()._perp(),ue=q===z.length-1?M:de.sub(ee)._unit()._perp(),pe=ne._add(ue)._unit();pe._mult(1/(pe.x*ue.x+pe.y*ue.y)),N.push(pe._mult(C)._add(ee))}P.push(N)}return P}(c,b*i.pixelToTileUnitsFactor)),function(E,C,P){for(let M=0;M<C.length;M++){const L=C[M];if(E.length>=3){for(let z=0;z<L.length;z++)if(Bc(E,L[z]))return!0}if(_L(E,L,P))return!0}return!1}(_,c,v)}isTileClipped(){return!0}},symbol:Zg,background:class extends Zo{constructor(i){super(i,sO)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Zo{constructor(i){super(i,aO)}getProgramIds(){return["raster"]}},sky:class extends Zo{constructor(i){super(i,cO),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="sky-gradient"?this._updateColorRamp():i!=="sky-atmosphere-sun"&&i!=="sky-atmosphere-halo-color"&&i!=="sky-atmosphere-color"&&i!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=fx({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(i){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=i.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(i,n){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),h=!c,p=i.style.light,_=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&In("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Bx(_.azimuthal,90-_.polar,n):Bx(c[0],90-c[1],n)}const o=this.paint.get("sky-gradient-center");return Bx(o[0],90-o[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(i){this._skyboxInvalidated=!1,this._lightPosition=i.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const i=this.paint.get("sky-type");return i==="atmosphere"?["skyboxCapture","skybox"]:i==="gradient"?["skyboxGradient"]:null}}};class qf{constructor(n,o,c,h){this.context=n,this.format=c,this.texture=n.gl.createTexture(),this.update(o,h)}update(n,o,c){const{width:h,height:p}=n,{context:_}=this,{gl:v}=_,{HTMLImageElement:b,HTMLCanvasElement:E,HTMLVideoElement:C,ImageData:P,ImageBitmap:M}=k;if(v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!o||o.premultiply!==!1)),c||this.size&&this.size[0]===h&&this.size[1]===p){const{x:L,y:z}=c||{x:0,y:0};n instanceof b||n instanceof E||n instanceof C||n instanceof P||M&&n instanceof M?v.texSubImage2D(v.TEXTURE_2D,0,L,z,v.RGBA,v.UNSIGNED_BYTE,n):v.texSubImage2D(v.TEXTURE_2D,0,L,z,h,p,v.RGBA,v.UNSIGNED_BYTE,n.data)}else this.size=[h,p],n instanceof b||n instanceof E||n instanceof C||n instanceof P||M&&n instanceof M?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,n):v.texImage2D(v.TEXTURE_2D,0,this.format,h,p,0,this.format,v.UNSIGNED_BYTE,n.data);this.useMipmap=!!(o&&o.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(n,o){const{context:c}=this,{gl:h}=c;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?n===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:n),this.filter=n),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class hO{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class dO{constructor(){this.tasks={},this.taskQueue=[],Ro(["process"],this),this.invoker=new hO(this.process),this.nextId=0}add(n,o){const c=this.nextId++,h=function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-v:p==="maybePrepare"&&_?400-v:500:200-v:100-v}(o);if(h===0){Vi();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:n,metadata:o,priority:h,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){Vi();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const o=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!o)return;o.fn()}finally{}}pick(){let n=null,o=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<o&&(o=p.priority,n=h)}if(n===null)return null;const c=this.taskQueue[n];return this.taskQueue.splice(n,1),c}remove(){this.invoker.remove()}}class sS{constructor(n){this._stringToNumber={},this._numberToString=[];for(let o=0;o<n.length;o++){const c=n[o];this._stringToNumber[c]=o,this._numberToString[o]=c}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const fO=["tile","layer","source","sourceLayer","state"];class aS{constructor(n,o,c,h,p){this.type="Feature",this._vectorTileFeature=n,this._z=o,this._x=c,this._y=h,this.properties=n.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const o of fO)this[o]!==void 0&&(n[o]=this[o]);return n}}const wo=32,Es=33,hl=new Uint16Array(8184);for(let i=0;i<2046;i++){let n=i+2,o=0,c=0,h=0,p=0,_=0,v=0;for(1&n?h=p=_=wo:o=c=v=wo;(n>>=1)>1;){const E=o+h>>1,C=c+p>>1;1&n?(h=o,p=c,o=_,c=v):(o=h,c=p,h=_,p=v),_=E,v=C}const b=4*i;hl[b+0]=o,hl[b+1]=c,hl[b+2]=h,hl[b+3]=p}const Ts=new Uint16Array(2178),dl=new Uint8Array(1089),Xg=new Uint16Array(1089);function lS(i){return i===0?-.03125:i===32?.03125:0}var cS=be([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const uS={type:2,extent:Et,loadGeometry:()=>[[new ze(0,0),new ze(Et+1,0),new ze(Et+1,Et+1),new ze(0,Et+1),new ze(0,0)]]};class Fx{constructor(n,o,c,h,p){this.tileID=n,this.uid=cr(),this.uses=0,this.tileSize=o,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(n){const o=n+this.timeAdded;o<Oo.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Nc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,o,c){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(h,p){const _={};if(!p)return _;for(const v of h){const b=v.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(b.length!==0){v.layers=b,v.stateDependentLayerIds&&(v.stateDependentLayers=v.stateDependentLayerIds.map(E=>b.filter(C=>C.id===E)[0]));for(const E of b)_[E.id]=v}}return _}(n.buckets,o.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof ul){if(this.hasSymbolBuckets=!0,!c)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof ul&&p.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||x()!=="deferred"||T();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(h).queryRadius(p))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new gn}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const c in this.buckets){const h=this.buckets[c];h.uploadPending()&&h.upload(n)}const o=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qf(n,this.imageAtlas.image,o.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qf(n,this.glyphAtlasImage,o.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new qf(n,this.lineAtlas.image,o.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,o,c,h,p,_,v,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:v,transform:_,params:p,tileTransform:this.tileTransform},n,o,c):{}}querySourceFeatures(n,o){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const h=c.loadVTLayers(),p=o?o.sourceLayer:"",_=h._geojsonTileLayer||h[p];if(!_)return;const v=Vu(o&&o.filter),{z:b,x:E,y:C}=this.tileID.canonical,P={z:b,x:E,y:C};for(let M=0;M<_.length;M++){const L=_.feature(M);if(v.needGeometry){const q=Oc(L,!0);if(!v.filter(new A(this.tileID.overscaledZ),q,this.tileID.canonical))continue}else if(!v.filter(new A(this.tileID.overscaledZ),L))continue;const z=c.getId(L,p),N=new aS(L,b,E,C,z);N.tile=P,n.push(N)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const o=this.expirationTime;if(n.cacheControl){const c=Xn(n.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const c=Date.now();let h=!1;if(this.expirationTime>c)h=!1;else if(o)if(this.expirationTime<o)h=!0;else{const p=this.expirationTime-o;p?this.expirationTime=c+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!o)return;const c=this.latestFeatureIndex.loadVTLayers(),h=o.style.listImages();for(const p in this.buckets){if(!o.style.hasLayer(p))continue;const _=this.buckets[p],v=_.layers[0].sourceLayer||"_geojsonTileLayer",b=c[v],E=n[v];if(!b||!E||Object.keys(E).length===0)continue;if(_.update(E,b,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Lg||_ instanceof Pg){const P=o.style._getSourceCache(_.layers[0].source);o._terrain&&o._terrain.enabled&&P&&_.programConfigurations.needsUpload&&o._terrain._clearRenderCacheForTile(P.id,this.tileID)}const C=o&&o.style&&o.style.getLayer(p);C&&(this.queryPadding=Math.max(this.queryPadding,C.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Oo.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=Oo.now()+n}setTexture(n,o){const c=o.context,h=c.gl;this.texture=this.texture||o.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new qf(c,n,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(n,o){const c={};for(const h of o)c[h]=!0;this.dependencies[n]=c}hasDependency(n,o){for(const c of n){const h=this.dependencies[c];if(h){for(const p of o)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const c=aa(uS,this.tileID.canonical,this.tileTransform)[0],h=new Ke,p=new Ai;for(let _=0;_<c.length;_++){const{x:v,y:b}=c[_];h.emplaceBack(v,b),p.emplaceBack(_)}p.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(p),this._tileDebugBuffer=n.createVertexBuffer(h,Tf.members),this._tileDebugSegments=Qn.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(n,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const c=aa(uS,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const _=function(v,b){const E=Nc(v,b),C=Math.pow(2,v.z);for(let q=0;q<Es;q++)for(let ee=0;ee<Es;ee++){const de=Hi((v.x+(ee+lS(ee))/wo)/C),ne=Nr((v.y+(q+lS(q))/wo)/C),ue=b.project(de,ne),pe=q*Es+ee;Ts[2*pe+0]=Math.round((ue.x*E.scale-E.x)*Et),Ts[2*pe+1]=Math.round((ue.y*E.scale-E.y)*Et)}dl.fill(0),Xg.fill(0);for(let q=2045;q>=0;q--){const ee=4*q,de=hl[ee+0],ne=hl[ee+1],ue=hl[ee+2],pe=hl[ee+3],fe=de+ue>>1,Me=ne+pe>>1,Ae=fe+Me-ne,Fe=Me+de-fe,Je=ne*Es+de,De=pe*Es+ue,Ve=Me*Es+fe,$e=Math.hypot((Ts[2*Je+0]+Ts[2*De+0])/2-Ts[2*Ve+0],(Ts[2*Je+1]+Ts[2*De+1])/2-Ts[2*Ve+1])>=16;dl[Ve]=dl[Ve]||($e?1:0),q<1022&&(dl[Ve]=dl[Ve]||dl[(ne+Fe>>1)*Es+(de+Ae>>1)]||dl[(pe+Fe>>1)*Es+(ue+Ae>>1)])}const P=new Ue,M=new yt;let L=0;function z(q,ee){const de=ee*Es+q;return Xg[de]===0&&(P.emplaceBack(Ts[2*de+0],Ts[2*de+1],q*Et/wo,ee*Et/wo),Xg[de]=++L),Xg[de]-1}function N(q,ee,de,ne,ue,pe){const fe=q+de>>1,Me=ee+ne>>1;if(Math.abs(q-ue)+Math.abs(ee-pe)>1&&dl[Me*Es+fe])N(ue,pe,q,ee,fe,Me),N(de,ne,ue,pe,fe,Me);else{const Ae=z(q,ee),Fe=z(de,ne),Je=z(ue,pe);M.emplaceBack(Ae,Fe,Je)}}return N(0,0,wo,wo,wo,0),N(wo,wo,0,0,0,wo),{vertices:P,indices:M}}(this.tileID.canonical,o);h=_.vertices,p=_.indices}else{h=new Ue,p=new yt;for(const{x:v,y:b}of c)h.emplaceBack(v,b,0,0);const _=yx(h.int16,void 0,4);for(let v=0;v<_.length;v+=3)p.emplaceBack(_[v],_[v+1],_[v+2])}this._tileBoundsBuffer=n.createVertexBuffer(h,cS.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(p),this._tileBoundsSegments=Qn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(n,o){const c=o.projection;if(!c||c.name!=="globe"||o.freezeTileCoverage)return;const h=this.tileID.canonical,p=Cf(ME(h,o)),_=Yu(o.zoom);let v;_>0&&(v=qv(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(n,h,o,p,v,_),this._makeGlobeTileDebugTextBuffer(n,h,o,p,v,_)}_globePoint(n,o,c,h,p,_,v){let b=If(n,o,c);if(_){const E=1<<c.z,C=ws(h.center.lng),P=bs(h.center.lat),M=(c.x+.5)/E-C;let L=0;M>.5?L=-1:M<-.5&&(L=1);let z=(n/Et+c.x)/E+L,N=(o/Et+c.y)/E;z=(z-C)*h._pixelsPerMercatorPixel+C,N=(N-P)*h._pixelsPerMercatorPixel+P;const q=[z*h.worldSize,N*h.worldSize,0];Gn(q,q,_),b=zc(b,q,v)}return Gn(b,b,p)}_makeGlobeTileDebugBorderBuffer(n,o,c,h,p,_){const v=new Ke,b=new Ai,E=new Ce,C=(M,L,z,N,q)=>{const ee=(z-M)/(q-1),de=(N-L)/(q-1),ne=v.length;for(let ue=0;ue<q;ue++){const pe=M+ue*ee,fe=L+ue*de;v.emplaceBack(pe,fe);const Me=this._globePoint(pe,fe,o,c,h,p,_);E.emplaceBack(Me[0],Me[1],Me[2]),b.emplaceBack(ne+ue)}},P=Et;C(0,0,P,0,16),C(P,0,P,P,16),C(P,P,0,P,16),C(0,P,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(b),this._tileDebugBuffer=n.createVertexBuffer(v,Tf.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(E,AE.members),this._tileDebugSegments=Qn.simpleSegment(0,0,v.length,b.length)}_makeGlobeTileDebugTextBuffer(n,o,c,h,p,_){const v=Et/4,b=new Ke,E=new yt,C=new Ce,P=25;E.reserve(32),b.reserve(P),C.reserve(P);const M=(L,z)=>P*L+z;for(let L=0;L<P;L++){const z=L*v;for(let N=0;N<P;N++){const q=N*v;b.emplaceBack(q,z);const ee=this._globePoint(q,z,o,c,h,p,_);C.emplaceBack(ee[0],ee[1],ee[2])}}for(let L=0;L<4;L++)for(let z=0;z<4;z++){const N=M(L,z),q=M(L,z+1),ee=M(L+1,z),de=M(L+1,z+1);E.emplaceBack(N,q,ee),E.emplaceBack(ee,q,de)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(E),this._tileDebugTextBuffer=n.createVertexBuffer(b,Tf.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(C,AE.members),this._tileDebugTextSegments=Qn.simpleSegment(0,0,P,32)}}class pO{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,o,c){const h=String(o);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][h]=this.stateChanges[n][h]||{},Yt(this.stateChanges[n][h],c),this.deletedStates[n]===null){this.deletedStates[n]={};for(const p in this.state[n])p!==h&&(this.deletedStates[n][p]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][h]===null){this.deletedStates[n][h]={};for(const p in this.state[n][h])c[p]||(this.deletedStates[n][h][p]=null)}else for(const p in c)this.deletedStates[n]&&this.deletedStates[n][h]&&this.deletedStates[n][h][p]===null&&delete this.deletedStates[n][h][p]}removeFeatureState(n,o,c){if(this.deletedStates[n]===null)return;const h=String(o);if(this.deletedStates[n]=this.deletedStates[n]||{},c&&o!==void 0)this.deletedStates[n][h]!==null&&(this.deletedStates[n][h]=this.deletedStates[n][h]||{},this.deletedStates[n][h][c]=null);else if(o!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][h])for(c in this.deletedStates[n][h]={},this.stateChanges[n][h])this.deletedStates[n][h][c]=null;else this.deletedStates[n][h]=null;else this.deletedStates[n]=null}getState(n,o){const c=String(o),h=Yt({},(this.state[n]||{})[c],(this.stateChanges[n]||{})[c]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const p=this.deletedStates[n][o];if(p===null)return{};for(const _ in p)delete h[_]}return h}initializeTileState(n,o){n.setFeatureState(this.state,o)}coalesceChanges(n,o){const c={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),Yt(this.state[h][_],this.stateChanges[h][_]),p[_]=this.state[h][_];c[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const _ in this.state[h])p[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(this.deletedStates[h][_]===null)this.state[h][_]={};else if(this.state[h][_])for(const v of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][v];p[_]=this.state[h][_]}c[h]=c[h]||{},Yt(c[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const h in n)n[h].setFeatureState(c,o)}}class hS{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,o){const c=this.toIdx(n,o);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(n,o){return this.leaves[this.toIdx(n,o)]}toIdx(n,o){return o*this.size+n}}function dS(i,n,o,c){let h=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(o[_]<i[_]||o[_]>n[_])return null}else{const v=1/c[_];let b=(i[_]-o[_])*v,E=(n[_]-o[_])*v;if(b>E){const C=b;b=E,E=C}if(b>h&&(h=b),E<p&&(p=E),h>p)return null}return h}function fS(i,n,o,c,h,p,_,v,b,E,C){const P=c-i,M=h-n,L=p-o,z=_-i,N=v-n,q=b-o,ee=C[1]*q-C[2]*N,de=C[2]*z-C[0]*q,ne=C[0]*N-C[1]*z,ue=P*ee+M*de+L*ne;if(Math.abs(ue)<1e-15)return null;const pe=1/ue,fe=E[0]-i,Me=E[1]-n,Ae=E[2]-o,Fe=(fe*ee+Me*de+Ae*ne)*pe;if(Fe<0||Fe>1)return null;const Je=Me*L-Ae*M,De=Ae*P-fe*L,Ve=fe*M-Me*P,$e=(C[0]*Je+C[1]*De+C[2]*Ve)*pe;return $e<0||Fe+$e>1?null:(z*Je+N*De+q*Ve)*pe}function pS(i,n,o){return(i-n)/(o-n)}function mS(i,n,o,c,h,p,_,v,b){const E=1<<o,C=p-c,P=_-h,M=(i+1)/E*C+c,L=(n+0)/E*P+h,z=(n+1)/E*P+h;v[0]=(i+0)/E*C+c,v[1]=L,b[0]=M,b[1]=z}class gS{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const o=function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let b=Math.ceil(Math.pow(2,_));const E=1/b,C=(L,z,N,q,ee)=>{const de=q?1:0,ne=(L+1)*N-de,ue=z*N,pe=(z+1)*N-de;ee[0]=L*N,ee[1]=ue,ee[2]=ne,ee[3]=pe};let P=new hS(b);const M=[];for(let L=0;L<b*b;L++){C(L%b,Math.floor(L/b),E,!1,M);const z=fl(M[0],M[1],p),N=fl(M[2],M[1],p),q=fl(M[2],M[3],p),ee=fl(M[0],M[3],p);P.minimums.push(Math.min(z,N,q,ee)),P.maximums.push(Math.max(z,N,q,ee)),P.leaves.push(1)}for(v.push(P),b/=2;b>=1;b/=2){const L=v[v.length-1];P=new hS(b);for(let z=0;z<b*b;z++){C(z%b,Math.floor(z/b),2,!0,M);const N=L.getElevation(M[0],M[1]),q=L.getElevation(M[2],M[1]),ee=L.getElevation(M[2],M[3]),de=L.getElevation(M[0],M[3]),ne=L.isLeaf(M[0],M[1]),ue=L.isLeaf(M[2],M[1]),pe=L.isLeaf(M[2],M[3]),fe=L.isLeaf(M[0],M[3]),Me=Math.min(N.min,q.min,ee.min,de.min),Ae=Math.max(N.max,q.max,ee.max,de.max),Fe=ne&&ue&&pe&&fe;P.maximums.push(Ae),P.minimums.push(Me),P.leaves.push(Ae-Me<=5&&Fe?1:0)}v.push(P)}return v}(this.dem),c=o.length-1,h=o[c];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(o,0,0,c,0)}raycastRoot(n,o,c,h,p,_,v=1){return dS([n,o,-100],[c,h,this.maximums[0]*v],p,_)}raycast(n,o,c,h,p,_,v=1){if(!this.nodeCount)return null;const b=this.raycastRoot(n,o,c,h,p,_,v);if(b==null)return null;const E=[],C=[],P=[],M=[],L=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:z,t:N,nodex:q,nodey:ee,depth:de}=L.pop();if(this.leaves[z]){mS(q,ee,de,n,o,c,h,P,M);const ue=1<<de,pe=(q+0)/ue,fe=(q+1)/ue,Me=(ee+0)/ue,Ae=(ee+1)/ue,Fe=fl(pe,Me,this.dem)*v,Je=fl(fe,Me,this.dem)*v,De=fl(fe,Ae,this.dem)*v,Ve=fl(pe,Ae,this.dem)*v,$e=fS(P[0],P[1],Fe,M[0],P[1],Je,M[0],M[1],De,p,_),He=fS(M[0],M[1],De,P[0],M[1],Ve,P[0],P[1],Fe,p,_),nt=Math.min($e!==null?$e:Number.MAX_VALUE,He!==null?He:Number.MAX_VALUE);if(nt!==Number.MAX_VALUE)return nt;{const Oe=bf([],p,_,N);if(_S(Fe,Je,Ve,De,pS(Oe[0],P[0],M[0]),pS(Oe[1],P[1],M[1]))>=Oe[2])return N}continue}let ne=0;for(let ue=0;ue<this._siblingOffset.length;ue++){mS((q<<1)+this._siblingOffset[ue][0],(ee<<1)+this._siblingOffset[ue][1],de+1,n,o,c,h,P,M),P[2]=-100,M[2]=this.maximums[this.childOffsets[z]+ue]*v;const pe=dS(P,M,p,_);if(pe!=null){const fe=pe;E[ue]=fe;let Me=!1;for(let Ae=0;Ae<ne&&!Me;Ae++)fe>=E[C[Ae]]&&(C.splice(Ae,0,ue),Me=!0);Me||(C[ne]=ue),ne++}}for(let ue=0;ue<ne;ue++){const pe=C[ue];L.push({idx:this.childOffsets[z]+pe,t:E[pe],nodex:(q<<1)+this._siblingOffset[pe][0],nodey:(ee<<1)+this._siblingOffset[pe][1],depth:de+1})}}return null}_addNode(n,o,c){return this.minimums.push(n),this.maximums.push(o),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(n,o,c,h,p){if(n[h].isLeaf(o,c)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=h-1,v=n[_];let b=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const P=2*o+this._siblingOffset[C][0],M=2*c+this._siblingOffset[C][1],L=v.getElevation(P,M),z=v.isLeaf(P,M),N=this._addNode(L.min,L.max,z);z&&(b|=1<<C),E||(E=N)}for(let C=0;C<this._siblingOffset.length;C++)b&1<<C||this._construct(n,2*o+this._siblingOffset[C][0],2*c+this._siblingOffset[C][1],_,E+C)}}function _S(i,n,o,c,h,p){return Jt(Jt(i,o,p),Jt(n,c,p),h)}function fl(i,n,o){const c=o.dim,h=ot(i*c-.5,0,c-1),p=ot(n*c-.5,0,c-1),_=Math.floor(h),v=Math.floor(p),b=Math.min(_+1,c-1),E=Math.min(v+1,c-1);return _S(o.get(_,v),o.get(b,v),o.get(_,E),o.get(b,E),h-_,p-v)}const yS={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function mO(i,n,o){return(256*i*256+256*n+o)/10-1e4}function gO(i,n,o){return 256*i+n+o/256-32768}class Kg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,o,c,h=!1,p=!1){if(this.uid=n,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return In(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=o.height;const _=this.dim=o.height-2,v=new Uint32Array(o.data.buffer);if(this.pixels=new Uint8Array(o.data.buffer),this.encoding=c||"mapbox",this.borderReady=h,!h){for(let b=0;b<_;b++)v[this._idx(-1,b)]=v[this._idx(0,b)],v[this._idx(_,b)]=v[this._idx(_-1,b)],v[this._idx(b,-1)]=v[this._idx(b,0)],v[this._idx(b,_)]=v[this._idx(b,_-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(_,-1)]=v[this._idx(_-1,0)],v[this._idx(-1,_)]=v[this._idx(0,_-1)],v[this._idx(_,_)]=v[this._idx(_-1,_-1)],p&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new gS(this)}get(n,o,c=!1){c&&(n=ot(n,-1,this.dim),o=ot(o,-1,this.dim));const h=4*this._idx(n,o);return(this.encoding==="terrarium"?gO:mO)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(n){return yS[n]}get unpackVector(){return yS[this.encoding]}_idx(n,o){if(n<-1||n>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(n+1)}static pack(n,o){const c=[0,0,0,0],h=Kg.getUnpackVector(o);let p=Math.floor((n+h[3])/h[2]);return c[2]=p%256,p=Math.floor(p/256),c[1]=p%256,p=Math.floor(p/256),c[0]=p,c}getPixels(){return new ki({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,o,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let h=o*this.dim,p=o*this.dim+this.dim,_=c*this.dim,v=c*this.dim+this.dim;switch(o){case-1:h=p-1;break;case 1:p=h+1}switch(c){case-1:_=v-1;break;case 1:v=_+1}const b=-o*this.dim,E=-c*this.dim;for(let C=_;C<v;C++)for(let P=h;P<p;P++){const M=4*this._idx(P,C),L=4*this._idx(P+b,C+E);this.pixels[M+0]=n.pixels[L+0],this.pixels[M+1]=n.pixels[L+1],this.pixels[M+2]=n.pixels[L+2],this.pixels[M+3]=n.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ft(Kg,"DEMData"),ft(gS,"DemMinMaxQuadTree",{omit:["dem"]});class _O{constructor(n,o){this.max=n,this.onRemove=o,this.reset()}reset(){for(const n in this.data)for(const o of this.data[n])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(n,o,c){const h=n.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:o,timeout:void 0};if(c!==void 0&&(p.timeout=setTimeout(()=>{this.remove(n,p)},c)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const o=this.data[n].shift();return o.timeout&&clearTimeout(o.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),o.value}getByKey(n){const o=this.data[n];return o?o[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,o){if(!this.has(n))return this;const c=n.wrapped().key,h=o===void 0?0:this.data[c].indexOf(o),p=this.data[c][h];return this.data[c].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(p.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(n){const o=[];for(const c in this.data)for(const h of this.data[c])n(h.value)||o.push(h);for(const c of o)this.remove(c.value.tileID,c)}}class fh{constructor(n,o,c){this.func=n,this.mask=o,this.range=c}}fh.ReadOnly=!1,fh.ReadWrite=!0,fh.disabled=new fh(519,fh.ReadOnly,[0,1]);const Nx=7680;class jx{constructor(n,o,c,h,p,_){this.test=n,this.ref=o,this.mask=c,this.fail=h,this.depthFail=p,this.pass=_}}jx.disabled=new jx({func:519,mask:0},0,0,Nx,Nx,Nx);class Ss{constructor(n,o,c){this.blendFunction=n,this.blendColor=o,this.mask=c}}Ss.Replace=[1,0],Ss.disabled=new Ss(Ss.Replace,$n.transparent,[!1,!1,!1,!1]),Ss.unblended=new Ss(Ss.Replace,$n.transparent,[!0,!0,!0,!0]),Ss.alphaBlended=new Ss([1,771],$n.transparent,[!0,!0,!0,!0]);const Ux=1029,Vx=2305;class es{constructor(n,o,c){this.enable=n,this.mode=o,this.frontFace=c}}es.disabled=new es(!1,Ux,Vx),es.backCCW=new es(!0,Ux,Vx),es.backCW=new es(!0,Ux,2304),es.frontCW=new es(!0,1028,2304),es.frontCCW=new es(!0,1028,Vx);class jc extends rc{constructor(n,o,c){super(),this.id=n,this._onlySymbols=c,o.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new _O(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new pO,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const o=this._tiles[n];if(o.state!=="loaded"&&o.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,o){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,o)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const c=this._tiles[o];c.upload(n),c.prepare(this.map.style.imageManager)}}getIds(){return yr(this._tiles).map(n=>n.tileID).sort(vS).map(n=>n.key)}getRenderableIds(n){const o=[];for(const c in this._tiles)this._isIdRenderable(+c,n)&&o.push(this._tiles[c]);return n?o.sort((c,h)=>{const p=c.tileID,_=h.tileID,v=new ze(p.canonical.x,p.canonical.y)._rotate(this.transform.angle),b=new ze(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return p.overscaledZ-_.overscaledZ||b.y-v.y||b.x-v.x}).map(c=>c.tileID.key):o.map(c=>c.tileID).sort(vS).map(c=>c.key)}hasRenderableParent(n){const o=this.findLoadedParent(n,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(n,o){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(o||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,o){const c=this._tiles[n];c&&(c.state!=="loading"&&(c.state=o),this._loadTile(c,this._tileLoaded.bind(this,c,n,o)))}_tileLoaded(n,o,c,h){if(h)if(n.state="errored",h.status!==404)this._source.fire(new Bo(h,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=Oo.now(),c==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(o,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new Hs("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const o=this.getRenderableIds();for(let h=0;h<o.length;h++){const p=o[h];if(n.neighboringTiles&&n.neighboringTiles[p]){const _=this.getTileByID(p);c(n,_),c(_,n)}}function c(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=p.tileID.canonical.x-h.tileID.canonical.x;const v=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;_===0&&v===0||Math.abs(v)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,_,v),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,o,c,h){for(const p in this._tiles){let _=this._tiles[p];if(h[p]||!_.hasData()||_.tileID.overscaledZ<=o||_.tileID.overscaledZ>c)continue;let v=_.tileID;for(;_&&_.tileID.overscaledZ>o+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(v=E)}let b=v;for(;b.overscaledZ>o;)if(b=b.scaledTo(b.overscaledZ-1),n[b.key]){h[v.key]=v;break}}}findLoadedParent(n,o){if(n.key in this._loadedParentTiles){const c=this._loadedParentTiles[n.key];return c&&c.tileID.overscaledZ>=o?c:null}for(let c=n.overscaledZ-1;c>=o;c--){const h=n.scaledTo(c),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(n){const o=this._tiles[n.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,o){o=o||this._source.tileSize;const c=Math.ceil(n.width/o)+1,h=Math.ceil(n.height/o)+1,p=Math.floor(c*h*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(v)}handleWrapJump(n){const o=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,o){const c={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+o),c[p.tileID.key]=p}this._tiles=c;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(n,o,c){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let h;this.updateCacheSize(n,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(v=>new ii(v.canonical.z,v.wrap,v.canonical.z,v.canonical.x,v.canonical.y)):(h=n.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(v=>this._source.hasTile(v)))):h=[];const p=this._updateRetainedTiles(h);if(xS(this._source.type)&&h.length!==0){const v={},b={},E=Object.keys(p);for(const P of E){const M=p[P],L=this._tiles[P];if(!L||L.fadeEndTime&&L.fadeEndTime<=Oo.now())continue;const z=this.findLoadedParent(M,Math.max(M.overscaledZ-jc.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),v[z.tileID.key]=z.tileID),b[P]=M}const C=h[h.length-1].overscaledZ;for(const P in this._tiles){const M=this._tiles[P];if(p[P]||!M.hasData())continue;let L=M.tileID;for(;L.overscaledZ>C;){L=L.scaledTo(L.overscaledZ-1);const z=this._tiles[L.key];if(z&&z.hasData()&&b[L.key]){p[P]=M.tileID;break}}}for(const P in v)p[P]||(this._coveredTiles[P]=!0,p[P]=v[P])}for(const v in p)this._tiles[v].clearFadeHold();const _=function(v,b){const E=[];for(const C in v)C in b||E.push(C);return E}(this._tiles,p);for(const v of _){const b=this._tiles[v];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+v)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const o={};if(n.length===0)return o;const c={},h=n.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=n[0].overscaledZ,_=Math.max(p-jc.maxOverzooming,this._source.minzoom),v=Math.max(p+jc.maxUnderzooming,this._source.minzoom),b={};for(const E of n){const C=this._addTile(E);o[E.key]=E,C.hasData()||h<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,h,v,o);for(const E of n){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const M=E.children(this._source.maxzoom)[0],L=this.getTile(M);if(L&&L.hasData()){o[M.key]=M;continue}}else{const M=E.children(this._source.maxzoom);if(o[M[0].key]&&o[M[1].key]&&o[M[2].key]&&o[M[3].key])continue}let P=C.wasRequested();for(let M=E.overscaledZ-1;M>=_;--M){const L=E.scaledTo(M);if(c[L.key]||(c[L.key]=!0,C=this.getTile(L),!C&&P&&(C=this._addTile(L)),C&&(o[L.key]=L,P=C.wasRequested(),C.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const o=[];let c,h=this._tiles[n].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){c=this._loadedParentTiles[h.key];break}o.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(c=this._getLoadedTile(p),c)break;h=p}for(const p of o)this._loadedParentTiles[p]=c}}_addTile(n){let o=this._tiles[n.key];if(o)return o;o=this._cache.getAndRemove(n),o&&(this._setTileReloadTimer(n.key,o),o.tileID=n,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,o)));const c=!!o;if(!c){const h=this.map?this.map.painter:null;o=new Fx(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(o,this._tileLoaded.bind(this,o,n.key,o.state))}return o?(o.uses++,this._tiles[n.key]=o,c||this._source.fire(new Hs("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o):null}_setTileReloadTimer(n,o){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const c=o.getExpiryTimeout();c&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},c))}_removeTile(n){const o=this._tiles[n];o&&(o.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),o.uses>0||(o.hasData()&&o.state!=="reloading"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,o,c){const h=[],p=this.transform;if(!p)return h;const _=p.projection.name==="globe",v=ws(p.center.lng);for(const b in this._tiles){const E=this._tiles[b];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(_){const P=E.tileID.canonical;if(P.z===0){const M=[Math.abs(ot(v,...Hf(P,-1))-v),Math.abs(ot(v,...Hf(P,1))-v)];C=[0,2*M.indexOf(Math.min(...M))-1]}else{const M=[Math.abs(ot(v,...Hf(P,-1))-v),Math.abs(ot(v,...Hf(P,0))-v),Math.abs(ot(v,...Hf(P,1))-v)];C=[M.indexOf(Math.min(...M))-1]}}else C=[0];for(const P of C){const M=n.containsTile(E,p,o,P);M&&h.push(M)}}return h}getVisibleCoordinates(n){const o=this.getRenderableIds(n).map(c=>this._tiles[c].tileID);for(const c of o)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return o}hasTransition(){if(this._source.hasTransition())return!0;if(xS(this._source.type))for(const n in this._tiles){const o=this._tiles[n];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=Oo.now())return!0}return!1}setFeatureState(n,o,c){this._state.updateState(n=n||"_geojsonTileLayer",o,c)}removeFeatureState(n,o,c){this._state.removeFeatureState(n=n||"_geojsonTileLayer",o,c)}getFeatureState(n,o){return this._state.getState(n=n||"_geojsonTileLayer",o)}setDependencies(n,o,c){const h=this._tiles[n];h&&h.setDependencies(o,c)}reloadTilesForDependencies(n,o){for(const c in this._tiles)this._tiles[c].hasDependency(n,o)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(n,o))}_preloadTiles(n,o){if(!this._sourceLoaded){const v=()=>{this._sourceLoaded&&(this._source.off("data",v),this._preloadTiles(n,o))};return void this._source.on("data",v)}const c=new Map,h=Array.isArray(n)?n:[n],p=this.map.painter.terrain,_=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const v of h){const b=v.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of b)c.set(E.key,E);this.usedForTerrain&&v.updateElevation(!1)}Vt(Array.from(c.values()),(v,b)=>{const E=new Fx(v,this._source.tileSize*v.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),b(C,E)})},o)}}function vS(i,n){const o=Math.abs(2*i.wrap)-+(i.wrap<0),c=Math.abs(2*n.wrap)-+(n.wrap<0);return i.overscaledZ-n.overscaledZ||c-o||n.canonical.y-i.canonical.y||n.canonical.x-i.canonical.x}function xS(i){return i==="raster"||i==="image"||i==="video"||i==="custom"}function Hf(i,n){const o=1<<i.z;return[i.x/o+n,(i.x+1)/o+n]}jc.maxOverzooming=10,jc.maxUnderzooming=3;class Jg{constructor(n,o,c){this._demTile=n,this._dem=this._demTile.dem,this._scale=o,this._offset=c}static create(n,o,c){const h=c||n.findDEMTileFor(o);if(!h||!h.dem)return;const p=h.dem,_=h.tileID,v=1<<o.canonical.z-_.canonical.z;return new Jg(h,h.tileSize/Et/v,[(o.canonical.x/v-_.canonical.x)*p.dim,(o.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(n,o){const c=o*this._scale+this._offset[1],h=Math.floor(n*this._scale+this._offset[0]),p=Math.floor(c);return new ze(h,p)}getElevationAt(n,o,c,h){const p=n*this._scale+this._offset[0],_=o*this._scale+this._offset[1],v=Math.floor(p),b=Math.floor(_),E=this._dem;return h=!!h,c?Jt(Jt(E.get(v,b,h),E.get(v,b+1,h),_-b),Jt(E.get(v+1,b,h),E.get(v+1,b+1,h),_-b),p-v):E.get(v,b,h)}getElevationAtPixel(n,o,c){return this._dem.get(n,o,!!c)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Jo(1,n)*this._dem.stride}}class wS{constructor(n,o){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ea(Et,16,0),this.featureIndexArray=new Ac,this.promoteId=o}insert(n,o,c,h,p,_=0){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,h,p,_);const b=this.grid;for(let E=0;E<o.length;E++){const C=o[E],P=[1/0,1/0,-1/0,-1/0];for(let M=0;M<C.length;M++){const L=C[M];P[0]=Math.min(P[0],L.x),P[1]=Math.min(P[1],L.y),P[2]=Math.max(P[2],L.x),P[3]=Math.max(P[3],L.y)}P[0]<Et&&P[1]<Et&&P[2]>=0&&P[3]>=0&&b.insert(v,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new bx(new Bg(this.rawTileData)).layers,this.sourceLayerCoder=new sS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,o,c,h){this.loadVTLayers();const p=n.params||{},_=Vu(p.filter),v=n.tileResult,b=n.transform,E=v.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,N,q,ee)=>qE(v.bufferedTilespaceGeometry,z,N,q,ee));C.sort(yO);let P=null;b.elevation&&C.length>0&&(P=Jg.create(b.elevation,this.tileID));const M={};let L;for(let z=0;z<C.length;z++){const N=C[z];if(N===L)continue;L=N;const q=this.featureIndexArray.get(N);let ee=null;this.loadMatchingFeature(M,q,_,p.layers,p.availableImages,o,c,h,(de,ne,ue,pe=0)=>(ee||(ee=aa(de,this.tileID.canonical,n.tileTransform)),ne.queryIntersectsFeature(v,de,ue,ee,this.z,n.transform,n.pixelPosMatrix,P,pe)))}return M}loadMatchingFeature(n,o,c,h,p,_,v,b,E){const{featureIndex:C,bucketIndex:P,sourceLayerIndex:M,layoutVertexArrayOffset:L}=o,z=this.bucketLayerIDs[P];if(h&&!function(de,ne){for(let ue=0;ue<de.length;ue++)if(ne.indexOf(de[ue])>=0)return!0;return!1}(h,z))return;const N=this.sourceLayerCoder.decode(M),q=this.vtLayers[N].feature(C);if(c.needGeometry){const de=Oc(q,!0);if(!c.filter(new A(this.tileID.overscaledZ),de,this.tileID.canonical))return}else if(!c.filter(new A(this.tileID.overscaledZ),q))return;const ee=this.getId(q,N);for(let de=0;de<z.length;de++){const ne=z[de];if(h&&h.indexOf(ne)<0)continue;const ue=_[ne];if(!ue)continue;let pe={};ee!==void 0&&b&&(pe=b.getState(ue.sourceLayer||"_geojsonTileLayer",ee));const fe=Yt({},v[ne]);fe.paint=bS(fe.paint,ue.paint,q,pe,p),fe.layout=bS(fe.layout,ue.layout,q,pe,p);const Me=!E||E(q,ue,pe,L);if(!Me)continue;const Ae=new aS(q,this.z,this.x,this.y,ee);Ae.layer=fe;let Fe=n[ne];Fe===void 0&&(Fe=n[ne]=[]),Fe.push({featureIndex:C,feature:Ae,intersectionZ:Me})}}lookupSymbolFeatures(n,o,c,h,p,_,v,b){const E={};this.loadVTLayers();const C=Vu(p);for(const P of n)this.loadMatchingFeature(E,{bucketIndex:c,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},C,_,v,b,o);return E}loadFeature(n){const{featureIndex:o,sourceLayerIndex:c}=n;this.loadVTLayers();const h=this.sourceLayerCoder.decode(c),p=this.vtFeatures[h];if(p[o])return p[o];const _=this.vtLayers[h].feature(o);return p[o]=_,_}hasLayer(n){for(const o of this.bucketLayerIDs)for(const c of o)if(n===c)return!0;return!1}getId(n,o){let c=n.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[o];h!=null&&(c=n.properties[h]),typeof c=="boolean"&&(c=Number(c))}return c}}function bS(i,n,o,c,h){return qt(i,(p,_)=>{const v=n instanceof Q?n.get(_):null;return v&&v.evaluate?v.evaluate(o,c,h):v})}function yO(i,n){return n-i}ft(wS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ES{constructor(n,o){this.width=n,this.height=o,this.nextRow=0,this.image=new la({width:n,height:o}),this.positions={},this.uploaded=!1}getDash(n,o){const c=this.getKey(n,o);return this.positions[c]}trim(){const n=this.width,o=this.height=Ar(this.nextRow);this.image.resize({width:n,height:o})}getKey(n,o){return n.join(",")+o}getDashRanges(n,o,c){const h=[];let p=n.length%2==1?-n[n.length-1]*c:0,_=n[0]*c,v=!0;h.push({left:p,right:_,isDash:v,zeroLength:n[0]===0});let b=n[0];for(let E=1;E<n.length;E++){v=!v;const C=n[E];p=b*c,b+=C,_=b*c,h.push({left:p,right:_,isDash:v,zeroLength:C===0})}return h}addRoundDash(n,o,c){const h=o/2;for(let p=-c;p<=c;p++){const _=this.width*(this.nextRow+c+p);let v=0,b=n[v];for(let E=0;E<this.width;E++){E/b.right>1&&(b=n[++v]);const C=Math.abs(E-b.left),P=Math.abs(E-b.right),M=Math.min(C,P);let L;const z=p/c*(h+1);if(b.isDash){const N=h-Math.abs(z);L=Math.sqrt(M*M+N*N)}else L=h-Math.sqrt(M*M+z*z);this.image.data[_+E]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(n,o){for(let b=n.length-1;b>=0;--b){const E=n[b],C=n[b+1];E.zeroLength?n.splice(b,1):C&&C.isDash===E.isDash&&(C.left=E.left,n.splice(b,1))}const c=n[0],h=n[n.length-1];c.isDash===h.isDash&&(c.left=h.left-this.width,h.right=c.right+this.width);const p=this.width*this.nextRow;let _=0,v=n[_];for(let b=0;b<this.width;b++){b/v.right>1&&(v=n[++_]);const E=Math.abs(b-v.left),C=Math.abs(b-v.right),P=Math.min(E,C);this.image.data[p+b]=Math.max(0,Math.min(255,(v.isDash?P:-P)+o+128))}}addDash(n,o){const c=this.getKey(n,o);if(this.positions[c])return this.positions[c];const h=o==="round",p=h?7:0,_=2*p+1;if(this.nextRow+_>this.height)return In("LineAtlas out of space"),null;n.length===0&&n.push(1);let v=0;for(let C=0;C<n.length;C++)n[C]<0&&(In("Negative value is found in line dasharray, replacing values with 0"),n[C]=0),v+=n[C];if(v!==0){const C=this.width/v,P=this.getDashRanges(n,this.width,C);h?this.addRoundDash(P,C,p):this.addRegularDash(P,o==="square"?.5*C:0)}const b=this.nextRow+p;this.nextRow+=_;const E={tl:[b,p],br:[v,0]};return this.positions[c]=E,E}}ft(ES,"LineAtlas");const TS=1*Qo;class SS{constructor(n){const o={},c=[];for(const v in n){const b=n[v],E=o[v]={};for(const C in b.glyphs){const P=b.glyphs[+C];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const M=P.metrics.localGlyph?TS:1,L={x:0,y:0,w:P.bitmap.width+2*M,h:P.bitmap.height+2*M};c.push(L),E[C]=L}}const{w:h,h:p}=Ix(c),_=new la({width:h||1,height:p||1});for(const v in n){const b=n[v];for(const E in b.glyphs){const C=b.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const P=o[v][E],M=C.metrics.localGlyph?TS:1;la.copy(C.bitmap,_,{x:0,y:0},{x:P.x+M,y:P.y+M},C.bitmap)}}this.image=_,this.positions=o}}ft(SS,"GlyphAtlas");class vO{constructor(n){this.tileID=new ii(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=Nc(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,o,c,h,p){this.status="parsing",this.data=n,this.collisionBoxArray=new gn;const _=new sS(Object.keys(n.layers).sort()),v=new wS(this.tileID,this.promoteId);v.bucketLayerIDs=[];const b={},E=new ES(256,256),C={featureIndex:v,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:c},P=o.familiesBySource[this.source];for(const pe in P){const fe=n.layers[pe];if(!fe)continue;let Me=!1,Ae=!1;for(const De of P[pe])De[0].type==="symbol"?Me=!0:Ae=!0;if(this.isSymbolTile===!0&&!Me||this.isSymbolTile===!1&&!Ae)continue;fe.version===1&&In(`Vector tile source "${this.source}" layer "${pe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fe=_.encode(pe),Je=[];for(let De=0;De<fe.length;De++){const Ve=fe.feature(De),$e=v.getId(Ve,pe);Je.push({feature:Ve,id:$e,index:De,sourceLayerIndex:Fe})}for(const De of P[pe]){const Ve=De[0];this.isSymbolTile!==void 0&&Ve.type==="symbol"!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||Ve.visibility!=="none"&&($x(De,this.zoom,c),(b[Ve.id]=Ve.createBucket({index:v.bucketLayerIDs.length,layers:De,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:c})).populate(Je,C,this.tileID.canonical,this.tileTransform),v.bucketLayerIDs.push(De.map($e=>$e.id)))}}let M,L,z,N;E.trim();const q={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=()=>{if(M)return p(M);if(L&&z&&N){const pe=new SS(L),fe=new RT(z,N);for(const Me in b){const Ae=b[Me];Ae instanceof ul?($x(Ae.layers,this.zoom,c),Wz(Ae,L,pe.positions,z,fe.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):Ae.hasPattern&&(Ae instanceof Lg||Ae instanceof Pg||Ae instanceof zf)&&($x(Ae.layers,this.zoom,c),Ae.addFeatures(C,this.tileID.canonical,fe.patternPositions,c,this.tileTransform))}this.status="done",p(null,{buckets:yr(b).filter(Me=>!Me.isEmpty()),featureIndex:v,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:pe.image,lineAtlas:E,imageAtlas:fe,glyphMap:this.returnDependencies?L:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?pe.positions:null})}},de=qt(C.glyphDependencies,pe=>Object.keys(pe).map(Number));Object.keys(de).length?h.send("getGlyphs",{uid:this.uid,stacks:de},(pe,fe)=>{M||(M=pe,L=fe,ee())},void 0,!1,q):L={};const ne=Object.keys(C.iconDependencies);ne.length?h.send("getImages",{icons:ne,source:this.source,tileID:this.tileID,type:"icons"},(pe,fe)=>{M||(M=pe,z=fe,ee())},void 0,!1,q):z={};const ue=Object.keys(C.patternDependencies);ue.length?h.send("getImages",{icons:ue,source:this.source,tileID:this.tileID,type:"patterns"},(pe,fe)=>{M||(M=pe,N=fe,ee())},void 0,!1,q):N={},ee()}}function $x(i,n,o){const c=new A(n);for(const h of i)h.recalculate(c,o)}class IS{constructor(n){this.entries={},this.scheduler=n}request(n,o,c,h){const p=this.entries[n]=this.entries[n]||{callbacks:[]};if(p.result){const[_,v]=p.result;return this.scheduler?this.scheduler.add(()=>{h(_,v)},o):h(_,v),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=c((_,v)=>{p.result=[_,v];for(const b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(_,v)},o):b(_,v);setTimeout(()=>delete this.entries[n],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(_=>_!==h),p.callbacks.length||(p.cancel(),delete this.entries[n]))}}}function CS(i,n,o){const c=JSON.stringify(i.request);return i.data&&(this.deduped.entries[c]={result:[null,i.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom},h=>{const p=Fa(i.request,(_,v,b,E)=>{_?h(_):v&&h(null,{vectorTile:o?void 0:new bx(new Bg(v)),rawData:v,cacheControl:b,expires:E})});return()=>{p.cancel(),h()}},n)}const AS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Gx{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[o,c]=new Uint8Array(n,0,2);if(o!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=c>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=AS[15&c];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(n,2,1),[v]=new Uint32Array(n,4,1);return new Gx(v,_,p,n)}constructor(n,o=64,c=Float64Array,h){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+o,2),65535),this.ArrayType=c,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const p=AS.indexOf(this.ArrayType),_=2*n*this.ArrayType.BYTES_PER_ELEMENT,v=n*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${c}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+b,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+b),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+v+b,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=o,new Uint32Array(this.data,4,1)[0]=n)}add(n,o){const c=this._pos>>1;return this.ids[c]=c,this.coords[this._pos++]=n,this.coords[this._pos++]=o,c}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Wx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,o,c,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,b=[0,p.length-1,0],E=[];for(;b.length;){const C=b.pop()||0,P=b.pop()||0,M=b.pop()||0;if(P-M<=v){for(let q=M;q<=P;q++){const ee=_[2*q],de=_[2*q+1];ee>=n&&ee<=c&&de>=o&&de<=h&&E.push(p[q])}continue}const L=M+P>>1,z=_[2*L],N=_[2*L+1];z>=n&&z<=c&&N>=o&&N<=h&&E.push(p[L]),(C===0?n<=z:o<=N)&&(b.push(M),b.push(L-1),b.push(1-C)),(C===0?c>=z:h>=N)&&(b.push(L+1),b.push(P),b.push(1-C))}return E}within(n,o,c){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:_}=this,v=[0,h.length-1,0],b=[],E=c*c;for(;v.length;){const C=v.pop()||0,P=v.pop()||0,M=v.pop()||0;if(P-M<=_){for(let q=M;q<=P;q++)kS(p[2*q],p[2*q+1],n,o)<=E&&b.push(h[q]);continue}const L=M+P>>1,z=p[2*L],N=p[2*L+1];kS(z,N,n,o)<=E&&b.push(h[L]),(C===0?n-c<=z:o-c<=N)&&(v.push(M),v.push(L-1),v.push(1-C)),(C===0?n+c>=z:o+c>=N)&&(v.push(L+1),v.push(P),v.push(1-C))}return b}}function Wx(i,n,o,c,h,p){if(h-c<=o)return;const _=c+h>>1;PS(i,n,_,c,h,p),Wx(i,n,o,c,_-1,1-p),Wx(i,n,o,_+1,h,1-p)}function PS(i,n,o,c,h,p){for(;h>c;){if(h-c>600){const E=h-c+1,C=o-c+1,P=Math.log(E),M=.5*Math.exp(2*P/3),L=.5*Math.sqrt(P*M*(E-M)/E)*(C-E/2<0?-1:1);PS(i,n,o,Math.max(c,Math.floor(o-C*M/E+L)),Math.min(h,Math.floor(o+(E-C)*M/E+L)),p)}const _=n[2*o+p];let v=c,b=h;for(Zf(i,n,c,o),n[2*h+p]>_&&Zf(i,n,c,h);v<b;){for(Zf(i,n,v,b),v++,b--;n[2*v+p]<_;)v++;for(;n[2*b+p]>_;)b--}n[2*c+p]===_?Zf(i,n,c,b):(b++,Zf(i,n,b,h)),b<=o&&(c=b+1),o<=b&&(h=b-1)}}function Zf(i,n,o,c){qx(i,o,c),qx(n,2*o,2*c),qx(n,2*o+1,2*c+1)}function qx(i,n,o){const c=i[n];i[n]=i[o],i[o]=c}function kS(i,n,o,c){const h=i-o,p=n-c;return h*h+p*p}a.ARRAY_TYPE=Pi,a.AUTH_ERR_MSG=me,a.Aabb=ri,a.Actor=class{constructor(i,n,o){this.target=i,this.parent=n,this.mapId=o,this.callbacks={},this.cancelCallbacks={},Ro(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Vi()?i:k,this.scheduler=new dO}send(i,n,o,c,h=!1,p){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);o&&(o.metadata=p,this.callbacks[_]=o);const v=Lo(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:i,hasCallback:!!o,targetMapId:c,mustQueue:h,sourceMapId:this.mapId,data:nl(n,v)},v),{cancel:()=>{o&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(i){const n=i.data,o=n.id;if(o&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const c=this.cancelCallbacks[o];delete this.cancelCallbacks[o],c&&c.cancel()}else if(n.mustQueue||Vi()){const c=this.callbacks[o];this.cancelCallbacks[o]=this.scheduler.add(()=>this.processTask(o,n),c&&c.metadata||{type:"message"})}else this.processTask(o,n)}processTask(i,n){if(n.type==="<response>"){const o=this.callbacks[i];delete this.callbacks[i],o&&(n.error?o(ta(n.error)):o(null,ta(n.data)))}else{const o=Lo(this.globalScope)?void 0:[],c=n.hasCallback?(p,_)=>{delete this.cancelCallbacks[i],this.target.postMessage({id:i,type:"<response>",sourceMapId:this.mapId,error:p?nl(p):null,data:nl(_,o)},o)}:p=>{},h=ta(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,c);else if(this.parent.getWorkerSource){const p=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,p[0],h.source)[p[1]](h,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},a.CanonicalTileID=Dg,a.Color=$n,a.ColorMode=Ss,a.CullFaceMode=es,a.DEMData=Kg,a.DataConstantProperty=F,a.DedupedRequest=IS,a.DepthMode=fh,a.EXTENT=Et,a.Elevation=class{isDataAvailableAtPoint(i){const n=this._source();if(this.isUsingMockSource()||!n||i.y<0||i.y>1)return!1;const o=n.getSource().maxzoom,c=1<<o,h=Math.floor(i.x),p=Math.floor((i.x-h)*c),_=Math.floor(i.y*c),v=this.findDEMTileFor(new ii(o,h,o,p,_));return!(!v||!v.dem)}getAtPointOrZero(i,n=0){return this.getAtPoint(i,n)||0}getAtPoint(i,n,o=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const c=this._source();if(!c||i.y<0||i.y>1)return n;const h=c.getSource().maxzoom,p=1<<h,_=Math.floor(i.x),v=i.x-_,b=new ii(h,_,h,Math.floor(v*p),Math.floor(i.y*p)),E=this.findDEMTileFor(b);if(!E||!E.dem)return n;const C=E.dem,P=1<<E.tileID.canonical.z,M=(v*P-E.tileID.canonical.x)*C.dim,L=(i.y*P-E.tileID.canonical.y)*C.dim,z=Math.floor(M),N=Math.floor(L);return(o?this.exaggeration():1)*Jt(Jt(C.get(z,N),C.get(z,N+1),L-N),Jt(C.get(z+1,N),C.get(z+1,N+1),L-N),M-z)}getAtTileOffset(i,n,o){const c=1<<i.canonical.z;return this.getAtPointOrZero(new Qu(i.wrap+(i.canonical.x+n/Et)/c,(i.canonical.y+o/Et)/c))}getAtTileOffsetFunc(i,n,o,c){return h=>{const p=this.getAtTileOffset(i,h.x,h.y),_=c.upVector(i.canonical,h.x,h.y);return qi(_,_,p*c.upVectorScale(i.canonical,n,o).metersToTile),_}}getForTilePoints(i,n,o,c){if(this.isUsingMockSource())return!1;const h=Jg.create(this,i,c);return!!h&&(n.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],o)}),!0)}getMinMaxForTile(i){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(i);if(!n||!n.dem)return null;const o=n.dem.tree,c=n.tileID,h=1<<i.canonical.z-c.canonical.z;let p=i.canonical.x/h-c.canonical.x,_=i.canonical.y/h-c.canonical.y,v=0;for(let b=0;b<i.canonical.z-c.canonical.z&&!o.leaves[v];b++){p*=2,_*=2;const E=2*Math.floor(_)+Math.floor(p);v=o.childOffsets[v]+E,p%=1,_%=1}return{min:this.exaggeration()*o.minimums[v],max:this.exaggeration()*o.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(i,n,o){throw new Error("Pure virtual method called.")}pointCoordinate(i){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(i){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},a.ErrorEvent=Bo,a.EvaluationParameters=A,a.Event=Hs,a.Evented=rc,a.FillExtrusionBucket=zf,a.Frustum=Qv,a.FrustumCorners=Yv,a.GLOBE_RADIUS=vs,a.GLOBE_SCALE_MATCH_LATITUDE=45,a.GLOBE_ZOOM_THRESHOLD_MAX=PE,a.GLOBE_ZOOM_THRESHOLD_MIN=ex,a.GlobeSharedBuffers=class{constructor(i){this._createGrid(i),this._createPoles(i)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const i of this._poleSegments)i.destroy();for(const i of this._gridSegments)i.withSkirts.destroy(),i.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const i of this._wireframeSegments)i.destroy()}}_fillGridMeshWithLods(i,n){const o=new Ke,c=new yt,h=[],p=i+1+2,_=n[0]+1,v=n[0]+1+(1+n.length),b=(E,C,P)=>{let M=E===p-1?E-2:E===0?E:E-1;return M+=P?24575:0,[M,C]};for(let E=0;E<p;++E)o.emplaceBack(...b(E,0,!0));for(let E=0;E<_;++E)for(let C=0;C<p;++C)o.emplaceBack(...b(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<n.length;++E){const C=n[E];for(let P=0;P<p;++P)o.emplaceBack(...b(P,C,!0))}for(let E=0;E<n.length;++E){const C=c.length,P=n[E]+1+2,M=new yt;for(let N=0;N<P-1;N++){const q=N===P-2,ee=q?p*(v-n.length+E-N):p;for(let de=0;de<p-1;de++){const ne=N*p+de;N===0||q||de===0||de===p-2?(M.emplaceBack(ne+1,ne,ne+ee),M.emplaceBack(ne+ee,ne+ee+1,ne+1)):(c.emplaceBack(ne+1,ne,ne+ee),c.emplaceBack(ne+ee,ne+ee+1,ne+1))}}const L=Qn.simpleSegment(0,C,o.length,c.length-C);for(let N=0;N<M.uint16.length;N+=3)c.emplaceBack(M.uint16[N],M.uint16[N+1],M.uint16[N+2]);const z=Qn.simpleSegment(0,C,o.length,c.length-C);h.push({withoutSkirts:L,withSkirts:z})}return{vertices:o,indices:c,segments:h}}_createGrid(i){const n=this._fillGridMeshWithLods(Lc,Sf);this._gridSegments=n.segments,this._gridBuffer=i.createVertexBuffer(n.vertices,Tf.members),this._gridIndexBuffer=i.createIndexBuffer(n.indices,!0)}_createPoles(i){const n=new yt;for(let h=0;h<=Lc;h++)n.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=i.createIndexBuffer(n,!0);const o=new mn,c=new mn;this._poleSegments=[];for(let h=0,p=0;h<ex;h++){const _=360/(1<<h);o.emplaceBack(0,-vs,0,.5,0),c.emplaceBack(0,-vs,0,.5,1);for(let v=0;v<=Lc;v++){const b=v/Lc,E=Jt(0,_,b),[C,P,M]=Ku(dL,fL,E,vs);o.emplaceBack(C,P,M,b,0),c.emplaceBack(C,P,M,b,1)}this._poleSegments.push(Qn.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=i.createVertexBuffer(o,CE,!1),this._poleSouthVertexBuffer=i.createVertexBuffer(c,CE,!1)}getGridBuffers(i,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[i].withSkirts:this._gridSegments[i].withoutSkirts]}getPoleBuffers(i){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[i]]}getWirefameBuffers(i,n){if(!this._wireframeSegments){const o=new Er,c=Lc,h=c+1+2,p=1;this._wireframeSegments=[];for(let _=0,v=0;_<Sf.length;_++){const b=Sf[_];for(let C=p;C<b+p;C++)for(let P=p;P<c+p;P++){const M=C*h+P;o.emplaceBack(M,M+1),o.emplaceBack(M,M+h),o.emplaceBack(M,M+h+1)}const E=b*c*3;this._wireframeSegments.push(Qn.simpleSegment(0,v,(b+1)*h,E)),v+=E}this._wireframeIndexBuffer=i.createIndexBuffer(o)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[n]]}},a.GlyphManager=lh,a.ImagePosition=Cx,a.KDBush=Gx,a.LivePerformanceUtils=xv,a.LngLat=_n,a.LngLatBounds=sl,a.LocalGlyphMode=kx,a.MAX_MERCATOR_LATITUDE=jr,a.MercatorCoordinate=Qu,a.ONE_EM=kr,a.OverscaledTileID=ii,a.PerformanceMarkers=Na,a.Point=ze,a.Properties=se,a.RGBAImage=ki,a.Ray=Jv,a.RequestManager=class{constructor(i,n,o){this._transformRequestFn=i,this._customAccessToken=n,this._silenceAuthErrors=!!o,this._createSkuToken()}_createSkuToken(){const i=function(){let n="";for(let o=0;o<10;o++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ce,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,n){return this._transformRequestFn&&this._transformRequestFn(i,n)||{url:i}}normalizeStyleURL(i,n){if(!xe(i))return i;const o=st(i);return o.path=`/styles/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeGlyphsURL(i,n){if(!xe(i))return i;const o=st(i);return o.path=`/fonts/v1${o.path}`,this._makeAPIURL(o,this._customAccessToken||n)}normalizeSourceURL(i,n,o,c){if(!xe(i))return i;const h=st(i);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),o&&h.params.push(`language=${o}`),c&&h.params.push(`worldview=${c}`),this._makeAPIURL(h,this._customAccessToken||n)}normalizeSpriteURL(i,n,o,c){const h=st(i);return xe(i)?(h.path=`/styles/v1${h.path}/sprite${n}${o}`,this._makeAPIURL(h,this._customAccessToken||c)):(h.path+=`${n}${o}`,tt(h))}normalizeTileURL(i,n,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!xe(i))return i;const c=st(i);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||o&&c.authority!=="raster"&&o===512?"@2x":""}${X.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${G.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${G.TILE_URL_VERSION}${c.path}`);const h=this._customAccessToken||function(p){for(const _ of p){const v=_.match(/^access_token=(.*)$/);if(v)return v[1]}return null}(c.params)||G.ACCESS_TOKEN;return G.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,h)}canonicalizeTileURL(i,n){const o=st(i);if(!o.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!o.path.match(/\.[\w]+$/))return i;let c="mapbox://";o.path.match(/^\/raster\/v1\//)?c+=`raster/${o.path.replace(`/${G.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${o.path.replace(`/${G.TILE_URL_VERSION}/`,"")}`;let h=o.params;return n&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(c+=`?${h.join("&")}`),c}canonicalizeTileset(i,n){const o=!!n&&xe(n),c=[];for(const h of i.tiles||[])Ie(h)?c.push(this.canonicalizeTileURL(h,o)):c.push(h);return c}_makeAPIURL(i,n){const o="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",c=st(G.API_URL);if(i.protocol=c.protocol,i.authority=c.authority,i.protocol==="http"){const h=i.params.indexOf("secure");h>=0&&i.params.splice(h,1)}if(c.path!=="/"&&(i.path=`${c.path}${i.path}`),!G.REQUIRE_ACCESS_TOKEN)return tt(i);if(n=n||G.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${o}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${o}`)}return i.params=i.params.filter(h=>h.indexOf("access_token")===-1),i.params.push(`access_token=${n||""}`),tt(i)}},a.ResourceType=Gs,a.SegmentVector=Qn,a.SourceCache=jc,a.StencilMode=jx,a.StructArrayLayout1ui2=Ai,a.StructArrayLayout2f1f2i16=St,a.StructArrayLayout2i4=Ke,a.StructArrayLayout2ui4=Er,a.StructArrayLayout3f12=Nt,a.StructArrayLayout3ui6=yt,a.StructArrayLayout4i8=Ue,a.StructArrayLayout5f20=mn,a.Texture=qf,a.Tile=Fx,a.Transitionable=B,a.Uniform1f=gg,a.Uniform1i=class extends ia{constructor(i){super(i),this.current=0}set(i,n,o){this.fetchUniformLocation(i,n)&&this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},a.Uniform2f=class extends ia{constructor(i){super(i),this.current=[0,0]}set(i,n,o){this.fetchUniformLocation(i,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1])))}},a.Uniform3f=class extends ia{constructor(i){super(i),this.current=[0,0,0]}set(i,n,o){this.fetchUniformLocation(i,n)&&(o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2])))}},a.Uniform4f=uE,a.UniformColor=hE,a.UniformMatrix2f=class extends ia{constructor(i){super(i),this.current=KD}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let c=0;c<4;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}}},a.UniformMatrix3f=class extends ia{constructor(i){super(i),this.current=XD}set(i,n,o){if(this.fetchUniformLocation(i,n)){for(let c=0;c<9;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}}},a.UniformMatrix4f=class extends ia{constructor(i){super(i),this.current=ZD}set(i,n,o){if(this.fetchUniformLocation(i,n)){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let c=1;c<16;c++)if(o[c]!==this.current[c]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}}},a.UnwrappedTileID=_T,a.ValidationError=dt,a.VectorTileFeature=Mg,a.VectorTileWorkerSource=class extends rc{constructor(i,n,o,c,h){super(),this.actor=i,this.layerIndex=n,this.availableImages=o,this.loadVectorData=h||CS,this.loading={},this.loaded={},this.deduped=new IS(i.scheduler),this.isSpriteLoaded=c,this.scheduler=i.scheduler}loadTile(i,n){const o=i.uid,c=i&&i.request,h=c&&c.collectResourceTiming,p=this.loading[o]=new vO(i);p.abort=this.loadVectorData(i,(_,v)=>{const b=!this.loading[o];if(delete this.loading[o],b||_||!v)return p.status="done",b||(this.loaded[o]=p),n(_);const E=v.rawData,C={};v.expires&&(C.expires=v.expires),v.cacheControl&&(C.cacheControl=v.cacheControl),p.vectorTile=v.vectorTile||new bx(new Bg(E));const P=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(M,L)=>{if(M||!L)return n(M);const z={};if(h){const N=xd(c);N.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(N)))}n(null,Yt({rawTileData:E.slice(0)},L,C,z))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:i.isSymbolTile,zoom:i.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[o]=p})}reloadTile(i,n){const o=this.loaded,c=i.uid,h=this;if(o&&o[c]){const p=o[c];p.showCollisionBoxes=i.showCollisionBoxes,p.enableTerrain=!!i.enableTerrain,p.projection=i.projection,p.tileTransform=Nc(i.tileID.canonical,i.projection);const _=(v,b)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,E)),n(v,b)};p.status==="parsing"?p.reloadCallback=_:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(i,n){const o=i.uid,c=this.loading[o];c&&(c.abort&&c.abort(),delete this.loading[o]),n()}removeTile(i,n){const o=this.loaded,c=i.uid;o&&o[c]&&delete o[c],n()}},a.WritingMode=Zi,a.ZoomDependentExpression=wc,a.add=sa,a.addDynamicAttributes=Hg,a.adjoint=function(i,n){var o=n[0],c=n[1],h=n[2],p=n[3],_=n[4],v=n[5],b=n[6],E=n[7],C=n[8];return i[0]=_*C-v*E,i[1]=h*E-c*C,i[2]=c*v-h*_,i[3]=v*b-p*C,i[4]=o*C-h*b,i[5]=h*p-o*v,i[6]=p*E-_*b,i[7]=c*b-o*E,i[8]=o*_-c*p,i},a.asyncAll=Vt,a.bezier=Fn,a.bindAll=Ro,a.boundsAttributes=cS,a.bufferConvexPolygon=function(i,n){const o=[];for(let c=0;c<i.length;c++){const h=Rt(c-1,-1,i.length-1),p=Rt(c+1,-1,i.length-1),_=i[c],v=i[p],b=i[h].sub(_).unit(),E=v.sub(_).unit(),C=E.angleWithSep(b.x,b.y),P=b.add(E).unit().mult(-1*n/Math.sin(C/2));o.push(_.add(P))}return o},a.cacheEntryPossiblyAdded=function(i){tc++,tc>Vs&&(i.getActor().send("enforceCacheSizeLimit",Us),tc=0)},a.calculateGlobeLabelMatrix=function(i,n){const{x:o,y:c}=i.point,h=LE(o,c,i.worldSize/i._pixelsPerMercatorPixel,0,0);return Mc(h,h,rx(xs(n)))},a.calculateGlobeMatrix=function(i){const{x:n,y:o}=i.point,{lng:c,lat:h}=i._center;return LE(n,o,i.worldSize,c,h)},a.calculateGlobeMercatorMatrix=function(i){const n=i.pixelsPerMeter,o=n/Jo(1,i.center.lat),c=Xo(new Float64Array(16));return yf(c,c,[i.point.x,i.point.y,0]),Rc(c,c,[o,o,n]),Float32Array.from(c)},a.circumferenceAtLatitude=ox,a.clamp=ot,a.clearTileCache=function(i){if(!ec())return;const n=k.caches.delete(zo);i&&n.catch(i).then(()=>i())},a.clipLine=WT,a.clone=function(i){var n=new Pi(16);return n[0]=i[0],n[1]=i[1],n[2]=i[2],n[3]=i[3],n[4]=i[4],n[5]=i[5],n[6]=i[6],n[7]=i[7],n[8]=i[8],n[9]=i[9],n[10]=i[10],n[11]=i[11],n[12]=i[12],n[13]=i[13],n[14]=i[14],n[15]=i[15],n},a.clone$1=Gr,a.collisionCircleLayout=_z,a.config=G,a.conjugate=function(i,n){return i[0]=-n[0],i[1]=-n[1],i[2]=-n[2],i[3]=n[3],i},a.create=function(){var i=new Pi(16);return Pi!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},a.create$1=pE,a.createExpression=Qa,a.createLayout=be,a.createStyleLayer=function(i){return i.type==="custom"?new lO(i):new uO[i.type](i)},a.cross=Kv,a.degToRad=pt,a.distance=function(i,n){return Math.hypot(n[0]-i[0],n[1]-i[1],n[2]-i[2])},a.div=function(i,n,o){return i[0]=n[0]/o[0],i[1]=n[1]/o[1],i[2]=n[2]/o[2],i},a.dot=yo,a.earthRadius=Af,a.ease=_t,a.easeCubicInOut=Dn,a.ecefToLatLng=function([i,n,o]){const c=Math.hypot(i,n,o),h=Math.atan2(i,o),p=.5*Math.PI-Math.acos(-n/c);return new _n(Zt(h),Zt(p))},a.emitValidationErrors=ug,a.endsWith=lo,a.enforceCacheSizeLimit=function(i){$s(),qr&&qr.then(n=>{n.keys().then(o=>{for(let c=0;c<o.length-i;c++)n.delete(o[c])})})},a.evaluateSizeForFeature=zg,a.evaluateSizeForZoom=ih,a.evaluateVariableOffset=KT,a.evented=y,a.exactEquals=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]&&i[3]===n[3]},a.exactEquals$1=function(i,n){return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]},a.exported=Oo,a.exported$1=X,a.extend=Yt,a.extend$1=Fo,a.fillExtrusionHeightLift=pT,a.filterObject=Do,a.fromMat4=function(i,n){return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[4],i[4]=n[5],i[5]=n[6],i[6]=n[8],i[7]=n[9],i[8]=n[10],i},a.fromQuat=function(i,n){var o=n[0],c=n[1],h=n[2],p=n[3],_=o+o,v=c+c,b=h+h,E=o*_,C=c*_,P=c*v,M=h*_,L=h*v,z=h*b,N=p*_,q=p*v,ee=p*b;return i[0]=1-P-z,i[1]=C+ee,i[2]=M-q,i[3]=0,i[4]=C-ee,i[5]=1-E-z,i[6]=L+N,i[7]=0,i[8]=M+q,i[9]=L-N,i[10]=1-E-P,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},a.fromRotation=function(i,n){var o=Math.sin(n),c=Math.cos(n);return i[0]=c,i[1]=o,i[2]=0,i[3]=-o,i[4]=c,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},a.fromScaling=gE,a.furthestTileCorner=function(i){const n=Math.round((i+45+360)%360/90)%4;return Hn[n]},a.getAABBPointSquareDist=function(i,n,o){let c=0;for(let h=0;h<2;++h){const p=o?o[h]:0;i[h]>p&&(c+=(i[h]-p)*(i[h]-p)),n[h]<p&&(c+=(p-n[h])*(p-n[h]))}return c},a.getAnchorAlignment=Px,a.getAnchorJustification=Rx,a.getBounds=function(i){let n=1/0,o=1/0,c=-1/0,h=-1/0;for(const p of i)n=Math.min(n,p.x),o=Math.min(o,p.y),c=Math.max(c,p.x),h=Math.max(h,p.y);return{min:new ze(n,o),max:new ze(c,h)}},a.getColumn=Ei,a.getDefaultExportFromCjs=Te,a.getGridMatrix=function(i,n,o,c){const h=n.getNorth(),p=n.getSouth(),_=n.getWest(),v=n.getEast(),b=1<<i.z,E=v-_,C=h-p,P=E/Lc,M=-C/Sf[o],L=[0,P,0,M,0,0,h,_,0];if(i.z>0){const z=180/c;mE(L,L,[z/E+1,0,0,0,z/C+1,0,-.5*z/P,.5*z/M,1])}return L[2]=b,L[5]=i.x,L[8]=i.y,L},a.getImage=ae,a.getJSON=function(i,n){return qs(Yt(i,{type:"json"}),n)},a.getLatitudinalLod=function(i){const n=jr-5;i=ot(i,-n,n)/n*90;const o=Math.pow(Math.abs(Math.sin(pt(i))),3);return Math.round(o*(Sf.length-1))},a.getMapSessionAPI=xr,a.getPerformanceMeasurement=xd,a.getProjection=iS,a.getRTLTextPluginStatus=x,a.getReferrer=Ws,a.getTilePoint=function(i,{x:n,y:o},c=0){return new ze(((n-c)*i.scale-i.x)*Et,(o*i.scale-i.y)*Et)},a.getTileVec3=function(i,n,o=0){return Xu(((n.x-o)*i.scale-i.x)*Et,(n.y*i.scale-i.y)*Et,FE(n.z,n.y))},a.getVideo=function(i,n){const o=k.document.createElement("video");o.muted=!0,o.onloadstart=function(){n(null,o)};for(let c=0;c<i.length;c++){const h=k.document.createElement("source");_u(i[c])||(o.crossOrigin="Anonymous"),h.src=i[c],o.appendChild(h)}return{cancel:()=>{}}},a.globeCenterToScreenPoint=function(i){const n=[0,0,0],o=Xo(new Float64Array(16));return Mc(o,i.pixelMatrix,i.globeMatrix),Gn(n,n,o),new ze(n[0],n[1])},a.globeDenormalizeECEF=rx,a.globeECEFOrigin=function(i,n){const o=[0,0,0];return Gn(o,o,Cf(xs(n.canonical))),Gn(o,o,i),o},a.globeMetersToEcef=vg,a.globeNormalizeECEF=Cf,a.globePixelsToTileUnits=function(i,n){return Et/(512*Math.pow(2,i))*wg(xs(n))},a.globePoleMatrixForTile=function(i,n,o){const c=Xo(new Float64Array(16)),h=(n/(1<<i)-.5)*Math.PI*2;return yg(c,o.globeMatrix,h),Float32Array.from(c)},a.globeTileBounds=xs,a.globeTiltAtLngLat=zE,a.globeToMercatorTransition=Yu,a.globeUseCustomAntiAliasing=function(i,n,o){const c=Yu(o.zoom),h=i.style.map._antialias,p=!!n.extStandardDerivatives,_=n.extStandardDerivativesForceOff||i.terrain&&i.terrain.exaggeration()>0;return c===0&&!h&&!_&&p},a.identity=Xo,a.identity$1=TE,a.invert=qv,a.isFullscreen=function(){return!!k.document.fullscreenElement||!!k.document.webkitFullscreenElement},a.isLngLatBehindGlobe=ix,a.isMapAuthenticated=function(i){return Hr.has(i)},a.isMapboxURL=xe,a.isSafariWithAntialiasingBug=function(i){const n=i.navigator?i.navigator.userAgent:null;return!!Lo(i)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},a.latFromMercatorY=Nr,a.latLngToECEF=Ju,a.len=oL,a.length=vf,a.length$1=function(i){return Math.hypot(i[0],i[1],i[2],i[3])},a.lngFromMercatorX=Hi,a.loadVectorTile=CS,a.makeRequest=qs,a.mapValue=function(i,n,o,c,h){return ot((i-n)/(o-n)*(h-c)+c,c,h)},a.mercatorScale=NE,a.mercatorXfromLng=ws,a.mercatorYfromLat=bs,a.mercatorZfromAltitude=Jo,a.mul=rL,a.mul$1=iL,a.multiply=Mc,a.multiply$1=mE,a.multiply$2=vE,a.nextPowerOfTwo=Ar,a.normalize=ni,a.normalize$1=sL,a.normalize$2=bE,a.number=Jt,a.ortho=function(i,n,o,c,h,p,_){var v=1/(n-o),b=1/(c-h),E=1/(p-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*b,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*E,i[11]=0,i[12]=(n+o)*v,i[13]=(h+c)*b,i[14]=(_+p)*E,i[15]=1,i},a.pbf=TT,a.perspective=function(i,n,o,c,h){var p,_=1/Math.tan(n/2);return i[0]=_/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+c)*(p=1/(c-h)),i[14]=2*h*c*p):(i[10]=-1,i[14]=-2*c),i},a.pick=function(i,n){const o={};for(let c=0;c<n.length;c++){const h=n[c];h in i&&(o[h]=i[h])}return o},a.plugin=S,a.pointGeometry=qe,a.polesInViewport=function(i){const n=Xo(new Float64Array(16));Mc(n,i.pixelMatrix,i.globeMatrix);const o=[0,vo,0],c=[0,xo,0];return Gn(o,o,n),Gn(c,c,n),[o[0]>0&&o[0]<=i.width&&o[1]>0&&o[1]<=i.height&&!ix(i,new _n(i.center.lat,90)),c[0]>0&&c[0]<=i.width&&c[1]>0&&c[1]<=i.height&&!ix(i,new _n(i.center.lat,-90))]},a.polygonContainsPoint=Bc,a.polygonIntersectsBox=qE,a.polygonIntersectsPolygon=VE,a.polygonizeBounds=function(i,n,o=0,c=!0){const h=new ze(o,o),p=i.sub(h),_=n.add(h),v=[p,new ze(_.x,p.y),_,new ze(p.x,_.y)];return c&&v.push(p.clone()),v},a.posAttributes=Tf,a.postMapLoadEvent=Kn,a.postPerformanceEvent=ur,a.postTurnstileEvent=Xt,a.potpack=Ix,a.prevPowerOfTwo=function(i){return i<=1?1:Math.pow(2,Math.floor(Math.log(i)/Math.LN2))},a.radToDeg=Zt,a.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],a.registerForPluginStateChange=function(i){return i({pluginStatus:f,pluginURL:s}),y.on("pluginStateChange",i),i},a.removeAuthState=function(i){Hr.delete(i)},a.renderColorRamp=fx,a.resample=jE,a.rotateX=Hv,a.rotateX$1=SE,a.rotateY=yg,a.rotateY$1=IE,a.rotateZ=function(i,n,o){var c=Math.sin(o),h=Math.cos(o),p=n[0],_=n[1],v=n[2],b=n[3],E=n[4],C=n[5],P=n[6],M=n[7];return n!==i&&(i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15]),i[0]=p*h+E*c,i[1]=_*h+C*c,i[2]=v*h+P*c,i[3]=b*h+M*c,i[4]=E*h-p*c,i[5]=C*h-_*c,i[6]=P*h-v*c,i[7]=M*h-b*c,i},a.rotateZ$1=function(i,n,o){o*=.5;var c=n[0],h=n[1],p=n[2],_=n[3],v=Math.sin(o),b=Math.cos(o);return i[0]=c*b+h*v,i[1]=h*b-c*v,i[2]=p*b+_*v,i[3]=_*b-p*v,i},a.scale=Rc,a.scale$1=wE,a.scale$2=qi,a.scaleAndAdd=bf,a.set=function(i,n,o,c){return i[0]=n,i[1]=o,i[2]=c,i},a.setCacheLimits=function(i,n){Us=i,Vs=n},a.setColumn=function(i,n,o){i[4*n+0]=o[0],i[4*n+1]=o[1],i[4*n+2]=o[2],i[4*n+3]=o[3]},a.setRTLTextPlugin=function(i,n,o=!1){if(f===ff||f===pf||f===mf)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=Oo.resolveURL(i),f=ff,rl=n,m(),o||T()},a.smoothstep=Tt,a.spec=Be,a.squaredLength=function(i){var n=i[0],o=i[1],c=i[2];return n*n+o*o+c*c},a.storeAuthState=function(i,n){n?Hr.add(i):Hr.delete(i)},a.sub=Ko,a.subtract=Xv,a.symbolSize=yz,a.tileAABB=function(i,n,o,c,h,p,_,v,b){if(b.name==="globe")return hL(i,n,new Dg(o,c,h));const E=Nc({z:o,x:c,y:h},b);return new ri([(p+E.x/E.scale)*n,n*(E.y/E.scale),_],[(p+E.x2/E.scale)*n,n*(E.y2/E.scale),v])},a.tileCornersToBounds=xg,a.tileTransform=Nc,a.transformMat3=function(i,n,o){var c=n[0],h=n[1],p=n[2];return i[0]=c*o[0]+h*o[3]+p*o[6],i[1]=c*o[1]+h*o[4]+p*o[7],i[2]=c*o[2]+h*o[5]+p*o[8],i},a.transformMat4=Gn,a.transformMat4$1=Dc,a.transformQuat=xE,a.transitionTileAABBinECEF=ME,a.translate=yf,a.transpose=function(i,n){if(i===n){var o=n[1],c=n[2],h=n[5];i[1]=n[3],i[2]=n[6],i[3]=o,i[5]=n[7],i[6]=c,i[7]=h}else i[0]=n[0],i[1]=n[3],i[2]=n[6],i[3]=n[1],i[4]=n[4],i[5]=n[7],i[6]=n[2],i[7]=n[5],i[8]=n[8];return i},a.triggerPluginCompletionEvent=u,a.uniqueId=cr,a.updateGlobeVertexNormal=function(i,n,o,c,h){const p=5*n+2;i.float32[p+0]=o,i.float32[p+1]=c,i.float32[p+2]=h},a.validateCustomStyleLayer=function(i){const n=[],o=i.id;return o===void 0&&n.push({message:`layers.${o}: missing required property "id"`}),i.render===void 0&&n.push({message:`layers.${o}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&n.push({message:`layers.${o}: property "renderingMode" must be either "2d" or "3d"`}),n},a.validateFilter=i=>Ci(Ic(i)),a.validateFog=i=>Ci(ag(i)),a.validateLayer=i=>Ci(rg(i)),a.validateLight=i=>Ci(sg(i)),a.validateSource=i=>Ci(og(i)),a.validateStyle=cg,a.validateTerrain=i=>Ci(lf(i)),a.values=yr,a.vectorTile=kg,a.version=O,a.warnOnce=In,a.window=k,a.wrap=Rt}),w(["./shared"],function(a){function k(he){if(typeof he=="number"||typeof he=="boolean"||typeof he=="string"||he==null)return JSON.stringify(he);if(Array.isArray(he)){let $="[";for(const ae of he)$+=`${k(ae)},`;return`${$}]`}let U="{";for(const $ of Object.keys(he).sort())U+=`${$}:${k(he[$])},`;return`${U}}`}function O(he){let U="";for(const $ of a.refProperties)U+=`/${k(he[$])}`;return U}class V{constructor(U){this.keyCache={},U&&this.replace(U)}replace(U){this._layerConfigs={},this._layers={},this.update(U,[])}update(U,$){for(const me of U)this._layerConfigs[me.id]=me,(this._layers[me.id]=a.createStyleLayer(me)).compileFilter(),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of $)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const ae=function(me,xe){const Ie={};for(let ve=0;ve<me.length;ve++){const Le=xe&&xe[me[ve].id]||O(me[ve]);xe&&(xe[me[ve].id]=Le);let it=Ie[Le];it||(it=Ie[Le]=[]),it.push(me[ve])}const Se=[];for(const ve in Ie)Se.push(Ie[ve]);return Se}(a.values(this._layerConfigs),this.keyCache);for(const me of ae){const xe=me.map(st=>this._layers[st.id]),Ie=xe[0];if(Ie.visibility==="none")continue;const Se=Ie.source||"";let ve=this.familiesBySource[Se];ve||(ve=this.familiesBySource[Se]={});const Le=Ie.sourceLayer||"_geojsonTileLayer";let it=ve[Le];it||(it=ve[Le]=[]),it.push(xe)}}}class G{loadTile(U,$){const{uid:ae,encoding:me,rawImageData:xe,padding:Ie,buildQuadTree:Se}=U,ve=a.window.ImageBitmap&&xe instanceof a.window.ImageBitmap?this.getImageData(xe,Ie):xe;$(null,new a.DEMData(ae,ve,me,Ie<1,Se))}getImageData(U,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const ae=this.offscreenCanvasContext.getImageData(-$,-$,U.width+2*$,U.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ae}}function X(he,U){if(he.length!==0){oe(he[0],U);for(var $=1;$<he.length;$++)oe(he[$],!U)}}function oe(he,U){for(var $=0,ae=0,me=0,xe=he.length,Ie=xe-1;me<xe;Ie=me++){var Se=(he[me][0]-he[Ie][0])*(he[Ie][1]+he[me][1]),ve=$+Se;ae+=Math.abs($)>=Math.abs(Se)?$-ve+Se:Se-ve+$,$=ve}$+ae>=0!=!!U&&he.reverse()}var le=a.getDefaultExportFromCjs(function he(U,$){var ae,me=U&&U.type;if(me==="FeatureCollection")for(ae=0;ae<U.features.length;ae++)he(U.features[ae],$);else if(me==="GeometryCollection")for(ae=0;ae<U.geometries.length;ae++)he(U.geometries[ae],$);else if(me==="Feature")he(U.geometry,$);else if(me==="Polygon")X(U.coordinates,$);else if(me==="MultiPolygon")for(ae=0;ae<U.coordinates.length;ae++)X(U.coordinates[ae],$);return U});const we=a.VectorTileFeature.prototype.toGeoJSON;var te={exports:{}},J=a.pointGeometry,ce=a.vectorTile.VectorTileFeature,Te=Ne;function Ne(he,U){this.options=U||{},this.features=he,this.length=he.length}function Ge(he,U){this.id=typeof he.id=="number"?he.id:void 0,this.type=he.type,this.rawGeometry=he.type===1?[he.geometry]:he.geometry,this.properties=he.tags,this.extent=U||4096}Ne.prototype.feature=function(he){return new Ge(this.features[he],this.options.extent)},Ge.prototype.loadGeometry=function(){var he=this.rawGeometry;this.geometry=[];for(var U=0;U<he.length;U++){for(var $=he[U],ae=[],me=0;me<$.length;me++)ae.push(new J($[me][0],$[me][1]));this.geometry.push(ae)}return this.geometry},Ge.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var he=this.geometry,U=1/0,$=-1/0,ae=1/0,me=-1/0,xe=0;xe<he.length;xe++)for(var Ie=he[xe],Se=0;Se<Ie.length;Se++){var ve=Ie[Se];U=Math.min(U,ve.x),$=Math.max($,ve.x),ae=Math.min(ae,ve.y),me=Math.max(me,ve.y)}return[U,ae,$,me]},Ge.prototype.toGeoJSON=ce.prototype.toGeoJSON;var Xe=a.pbf,qe=Te;function vt(he){var U=new Xe;return function($,ae){for(var me in $.layers)ae.writeMessage(3,ze,$.layers[me])}(he,U),U.finish()}function ze(he,U){var $;U.writeVarintField(15,he.version||1),U.writeStringField(1,he.name||""),U.writeVarintField(5,he.extent||4096);var ae={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<he.length;$++)ae.feature=he.feature($),U.writeMessage(2,Ct,ae);var me=ae.keys;for($=0;$<me.length;$++)U.writeStringField(3,me[$]);var xe=ae.values;for($=0;$<xe.length;$++)U.writeMessage(4,Dn,xe[$])}function Ct(he,U){var $=he.feature;$.id!==void 0&&U.writeVarintField(1,$.id),U.writeMessage(2,Ut,he),U.writeVarintField(3,$.type),U.writeMessage(4,Hn,$)}function Ut(he,U){var $=he.feature,ae=he.keys,me=he.values,xe=he.keycache,Ie=he.valuecache;for(var Se in $.properties){var ve=$.properties[Se],Le=xe[Se];if(ve!==null){Le===void 0&&(ae.push(Se),xe[Se]=Le=ae.length-1),U.writeVarint(Le);var it=typeof ve;it!=="string"&&it!=="boolean"&&it!=="number"&&(ve=JSON.stringify(ve));var st=it+":"+ve,tt=Ie[st];tt===void 0&&(me.push(ve),Ie[st]=tt=me.length-1),U.writeVarint(tt)}}}function pt(he,U){return(U<<3)+(7&he)}function Zt(he){return he<<1^he>>31}function Hn(he,U){for(var $=he.loadGeometry(),ae=he.type,me=0,xe=0,Ie=$.length,Se=0;Se<Ie;Se++){var ve=$[Se],Le=1;ae===1&&(Le=ve.length),U.writeVarint(pt(1,Le));for(var it=ae===3?ve.length-1:ve.length,st=0;st<it;st++){st===1&&ae!==1&&U.writeVarint(pt(2,it-1));var tt=ve[st].x-me,Dt=ve[st].y-xe;U.writeVarint(Zt(tt)),U.writeVarint(Zt(Dt)),me+=tt,xe+=Dt}ae===3&&U.writeVarint(pt(7,1))}}function Dn(he,U){var $=typeof he;$==="string"?U.writeStringField(1,he):$==="boolean"?U.writeBooleanField(7,he):$==="number"&&(he%1!=0?U.writeDoubleField(3,he):he<0?U.writeSVarintField(6,he):U.writeVarintField(5,he))}te.exports=vt,te.exports.fromVectorTileJs=vt,te.exports.fromGeojsonVt=function(he,U){U=U||{};var $={};for(var ae in he)$[ae]=new qe(he[ae].features,U),$[ae].name=ae,$[ae].version=U.version,$[ae].extent=U.extent;return vt({layers:$})},te.exports.GeoJSONWrapper=qe;var Fn=a.getDefaultExportFromCjs(te.exports);const _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:he=>he},ot=Math.fround||(Tt=new Float32Array(1),he=>(Tt[0]=+he,Tt[0]));var Tt;const Rt=3,Vt=5,yr=6;class Yt{constructor(U){this.options=Object.assign(Object.create(_t),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:$,minZoom:ae,maxZoom:me}=this.options;$&&console.time("total time");const xe=`prepare ${U.length} points`;$&&console.time(xe),this.points=U;const Ie=[];for(let ve=0;ve<U.length;ve++){const Le=U[ve];if(!Le.geometry)continue;const[it,st]=Le.geometry.coordinates,tt=ot(vr(it)),Dt=ot(Ar(st));Ie.push(tt,Dt,1/0,ve,-1,1),this.options.reduce&&Ie.push(0)}let Se=this.trees[me+1]=this._createTree(Ie);$&&console.timeEnd(xe);for(let ve=me;ve>=ae;ve--){const Le=+Date.now();Se=this.trees[ve]=this._createTree(this._cluster(Se,ve)),$&&console.log("z%d: %d clusters in %dms",ve,Se.numItems,+Date.now()-Le)}return $&&console.timeEnd("total time"),this}getClusters(U,$){let ae=((U[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,U[1]));let xe=U[2]===180?180:((U[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)ae=-180,xe=180;else if(ae>xe){const st=this.getClusters([ae,me,180,Ie],$),tt=this.getClusters([-180,me,xe,Ie],$);return st.concat(tt)}const Se=this.trees[this._limitZoom($)],ve=Se.range(vr(ae),Ar(Ie),vr(xe),Ar(me)),Le=Se.data,it=[];for(const st of ve){const tt=this.stride*st;it.push(Le[tt+Vt]>1?Zn(Le,tt,this.clusterProps):this.points[Le[tt+Rt]])}return it}getChildren(U){const $=this._getOriginId(U),ae=this._getOriginZoom(U),me="No cluster with the specified id.",xe=this.trees[ae];if(!xe)throw new Error(me);const Ie=xe.data;if($*this.stride>=Ie.length)throw new Error(me);const Se=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),ve=xe.within(Ie[$*this.stride],Ie[$*this.stride+1],Se),Le=[];for(const it of ve){const st=it*this.stride;Ie[st+4]===U&&Le.push(Ie[st+Vt]>1?Zn(Ie,st,this.clusterProps):this.points[Ie[st+Rt]])}if(Le.length===0)throw new Error(me);return Le}getLeaves(U,$,ae){const me=[];return this._appendLeaves(me,U,$=$||10,ae=ae||0,0),me}getTile(U,$,ae){const me=this.trees[this._limitZoom(U)],xe=Math.pow(2,U),{extent:Ie,radius:Se}=this.options,ve=Se/Ie,Le=(ae-ve)/xe,it=(ae+1+ve)/xe,st={features:[]};return this._addTileFeatures(me.range(($-ve)/xe,Le,($+1+ve)/xe,it),me.data,$,ae,xe,st),$===0&&this._addTileFeatures(me.range(1-ve/xe,Le,1,it),me.data,xe,ae,xe,st),$===xe-1&&this._addTileFeatures(me.range(0,Le,ve/xe,it),me.data,-1,ae,xe,st),st.features.length?st:null}getClusterExpansionZoom(U){let $=this._getOriginZoom(U)-1;for(;$<=this.options.maxZoom;){const ae=this.getChildren(U);if($++,ae.length!==1)break;U=ae[0].properties.cluster_id}return $}_appendLeaves(U,$,ae,me,xe){const Ie=this.getChildren($);for(const Se of Ie){const ve=Se.properties;if(ve&&ve.cluster?xe+ve.point_count<=me?xe+=ve.point_count:xe=this._appendLeaves(U,ve.cluster_id,ae,me,xe):xe<me?xe++:U.push(Se),U.length===ae)break}return xe}_createTree(U){const $=new a.KDBush(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ae=0;ae<U.length;ae+=this.stride)$.add(U[ae],U[ae+1]);return $.finish(),$.data=U,$}_addTileFeatures(U,$,ae,me,xe,Ie){for(const Se of U){const ve=Se*this.stride,Le=$[ve+Vt]>1;let it,st,tt;if(Le)it=cr($,ve,this.clusterProps),st=$[ve],tt=$[ve+1];else{const Lt=this.points[$[ve+Rt]];it=Lt.properties;const[Ft,Xt]=Lt.geometry.coordinates;st=vr(Ft),tt=Ar(Xt)}const Dt={type:1,geometry:[[Math.round(this.options.extent*(st*xe-ae)),Math.round(this.options.extent*(tt*xe-me))]],tags:it};let Bt;Bt=Le||this.options.generateId?$[ve+Rt]:this.points[$[ve+Rt]].id,Bt!==void 0&&(Dt.id=Bt),Ie.features.push(Dt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,$){const{radius:ae,extent:me,reduce:xe,minPoints:Ie}=this.options,Se=ae/(me*Math.pow(2,$)),ve=U.data,Le=[],it=this.stride;for(let st=0;st<ve.length;st+=it){if(ve[st+2]<=$)continue;ve[st+2]=$;const tt=ve[st],Dt=ve[st+1],Bt=U.within(ve[st],ve[st+1],Se),Lt=ve[st+Vt];let Ft=Lt;for(const Xt of Bt){const Ln=Xt*it;ve[Ln+2]>$&&(Ft+=ve[Ln+Vt])}if(Ft>Lt&&Ft>=Ie){let Xt,Ln=tt*Lt,Kn=Dt*Lt,Or=-1;const ur=((st/it|0)<<5)+($+1)+this.points.length;for(const uo of Bt){const xr=uo*it;if(ve[xr+2]<=$)continue;ve[xr+2]=$;const Hr=ve[xr+Vt];Ln+=ve[xr]*Hr,Kn+=ve[xr+1]*Hr,ve[xr+4]=ur,xe&&(Xt||(Xt=this._map(ve,st,!0),Or=this.clusterProps.length,this.clusterProps.push(Xt)),xe(Xt,this._map(ve,xr)))}ve[st+4]=ur,Le.push(Ln/Ft,Kn/Ft,1/0,ur,-1,Ft),xe&&Le.push(Or)}else{for(let Xt=0;Xt<it;Xt++)Le.push(ve[st+Xt]);if(Ft>1)for(const Xt of Bt){const Ln=Xt*it;if(!(ve[Ln+2]<=$)){ve[Ln+2]=$;for(let Kn=0;Kn<it;Kn++)Le.push(ve[Ln+Kn])}}}}return Le}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,$,ae){if(U[$+Vt]>1){const Ie=this.clusterProps[U[$+yr]];return ae?Object.assign({},Ie):Ie}const me=this.points[U[$+Rt]].properties,xe=this.options.map(me);return ae&&xe===me?Object.assign({},xe):xe}}function Zn(he,U,$){return{type:"Feature",id:he[U+Rt],properties:cr(he,U,$),geometry:{type:"Point",coordinates:[(ae=he[U],360*(ae-.5)),ds(he[U+1])]}};var ae}function cr(he,U,$){const ae=he[U+Vt],me=ae>=1e4?`${Math.round(ae/1e3)}k`:ae>=1e3?Math.round(ae/100)/10+"k":ae,xe=he[U+yr],Ie=xe===-1?{}:Object.assign({},$[xe]);return Object.assign(Ie,{cluster:!0,cluster_id:he[U+Rt],point_count:ae,point_count_abbreviated:me})}function vr(he){return he/360+.5}function Ar(he){const U=Math.sin(he*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function ds(he){const U=(180-360*he)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Ro(he,U,$,ae){for(var me,xe=ae,Ie=$-U>>1,Se=$-U,ve=he[U],Le=he[U+1],it=he[$],st=he[$+1],tt=U+3;tt<$;tt+=3){var Dt=lo(he[tt],he[tt+1],ve,Le,it,st);if(Dt>xe)me=tt,xe=Dt;else if(Dt===xe){var Bt=Math.abs(tt-Ie);Bt<Se&&(me=tt,Se=Bt)}}xe>ae&&(me-U>3&&Ro(he,U,me,ae),he[me+2]=xe,$-me>3&&Ro(he,me,$,ae))}function lo(he,U,$,ae,me,xe){var Ie=me-$,Se=xe-ae;if(Ie!==0||Se!==0){var ve=((he-$)*Ie+(U-ae)*Se)/(Ie*Ie+Se*Se);ve>1?($=me,ae=xe):ve>0&&($+=Ie*ve,ae+=Se*ve)}return(Ie=he-$)*Ie+(Se=U-ae)*Se}function qt(he,U,$,ae){var me={id:he===void 0?null:he,type:U,geometry:$,tags:ae,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(xe){var Ie=xe.geometry,Se=xe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Do(xe,Ie);else if(Se==="Polygon"||Se==="MultiLineString")for(var ve=0;ve<Ie.length;ve++)Do(xe,Ie[ve]);else if(Se==="MultiPolygon")for(ve=0;ve<Ie.length;ve++)for(var Le=0;Le<Ie[ve].length;Le++)Do(xe,Ie[ve][Le])}(me),me}function Do(he,U){for(var $=0;$<U.length;$+=3)he.minX=Math.min(he.minX,U[$]),he.minY=Math.min(he.minY,U[$+1]),he.maxX=Math.max(he.maxX,U[$]),he.maxY=Math.max(he.maxY,U[$+1])}function Gr(he,U,$,ae){if(U.geometry){var me=U.geometry.coordinates,xe=U.geometry.type,Ie=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),Se=[],ve=U.id;if($.promoteId?ve=U.properties[$.promoteId]:$.generateId&&(ve=ae||0),xe==="Point")js(me,Se);else if(xe==="MultiPoint")for(var Le=0;Le<me.length;Le++)js(me[Le],Se);else if(xe==="LineString")In(me,Se,Ie,!1);else if(xe==="MultiLineString"){if($.lineMetrics){for(Le=0;Le<me.length;Le++)In(me[Le],Se=[],Ie,!1),he.push(qt(ve,"LineString",Se,U.properties));return}Wr(me,Se,Ie,!1)}else if(xe==="Polygon")Wr(me,Se,Ie,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(Le=0;Le<U.geometry.geometries.length;Le++)Gr(he,{id:ve,geometry:U.geometry.geometries[Le],properties:U.properties},$,ae);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<me.length;Le++){var it=[];Wr(me[Le],it,Ie,!0),Se.push(it)}}he.push(qt(ve,xe,Se,U.properties))}}function js(he,U){U.push(Oa(he[0])),U.push(Vi(he[1])),U.push(0)}function In(he,U,$,ae){for(var me,xe,Ie=0,Se=0;Se<he.length;Se++){var ve=Oa(he[Se][0]),Le=Vi(he[Se][1]);U.push(ve),U.push(Le),U.push(0),Se>0&&(Ie+=ae?(me*Le-ve*xe)/2:Math.sqrt(Math.pow(ve-me,2)+Math.pow(Le-xe,2))),me=ve,xe=Le}var it=U.length-3;U[2]=1,Ro(U,0,it,$),U[it+2]=1,U.size=Math.abs(Ie),U.start=0,U.end=U.size}function Wr(he,U,$,ae){for(var me=0;me<he.length;me++){var xe=[];In(he[me],xe,$,ae),U.push(xe)}}function Oa(he){return he/360+.5}function Vi(he){var U=Math.sin(he*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function Xn(he,U,$,ae,me,xe,Ie,Se){if(ae/=U,xe>=($/=U)&&Ie<ae)return he;if(Ie<$||xe>=ae)return null;for(var ve=[],Le=0;Le<he.length;Le++){var it=he[Le],st=it.geometry,tt=it.type,Dt=me===0?it.minX:it.minY,Bt=me===0?it.maxX:it.maxY;if(Dt>=$&&Bt<ae)ve.push(it);else if(!(Bt<$||Dt>=ae)){var Lt=[];if(tt==="Point"||tt==="MultiPoint")co(st,Lt,$,ae,me);else if(tt==="LineString")Lo(st,Lt,$,ae,me,!1,Se.lineMetrics);else if(tt==="MultiLineString")Ei(st,Lt,$,ae,me,!1);else if(tt==="Polygon")Ei(st,Lt,$,ae,me,!0);else if(tt==="MultiPolygon")for(var Ft=0;Ft<st.length;Ft++){var Xt=[];Ei(st[Ft],Xt,$,ae,me,!0),Xt.length&&Lt.push(Xt)}if(Lt.length){if(Se.lineMetrics&&tt==="LineString"){for(Ft=0;Ft<Lt.length;Ft++)ve.push(qt(it.id,tt,Lt[Ft],it.tags));continue}tt!=="LineString"&&tt!=="MultiLineString"||(Lt.length===1?(tt="LineString",Lt=Lt[0]):tt="MultiLineString"),tt!=="Point"&&tt!=="MultiPoint"||(tt=Lt.length===3?"Point":"MultiPoint"),ve.push(qt(it.id,tt,Lt,it.tags))}}}return ve.length?ve:null}function co(he,U,$,ae,me){for(var xe=0;xe<he.length;xe+=3){var Ie=he[xe+me];Ie>=$&&Ie<=ae&&(U.push(he[xe]),U.push(he[xe+1]),U.push(he[xe+2]))}}function Lo(he,U,$,ae,me,xe,Ie){for(var Se,ve,Le=fs(he),it=me===0?Us:Vs,st=he.start,tt=0;tt<he.length-3;tt+=3){var Dt=he[tt],Bt=he[tt+1],Lt=he[tt+2],Ft=he[tt+3],Xt=he[tt+4],Ln=me===0?Dt:Bt,Kn=me===0?Ft:Xt,Or=!1;Ie&&(Se=Math.sqrt(Math.pow(Dt-Ft,2)+Math.pow(Bt-Xt,2))),Ln<$?Kn>$&&(ve=it(Le,Dt,Bt,Ft,Xt,$),Ie&&(Le.start=st+Se*ve)):Ln>ae?Kn<ae&&(ve=it(Le,Dt,Bt,Ft,Xt,ae),Ie&&(Le.start=st+Se*ve)):zo(Le,Dt,Bt,Lt),Kn<$&&Ln>=$&&(ve=it(Le,Dt,Bt,Ft,Xt,$),Or=!0),Kn>ae&&Ln<=ae&&(ve=it(Le,Dt,Bt,Ft,Xt,ae),Or=!0),!xe&&Or&&(Ie&&(Le.end=st+Se*ve),U.push(Le),Le=fs(he)),Ie&&(st+=Se)}var ur=he.length-3;Dt=he[ur],Bt=he[ur+1],Lt=he[ur+2],(Ln=me===0?Dt:Bt)>=$&&Ln<=ae&&zo(Le,Dt,Bt,Lt),ur=Le.length-3,xe&&ur>=3&&(Le[ur]!==Le[0]||Le[ur+1]!==Le[1])&&zo(Le,Le[0],Le[1],Le[2]),Le.length&&U.push(Le)}function fs(he){var U=[];return U.size=he.size,U.start=he.start,U.end=he.end,U}function Ei(he,U,$,ae,me,xe){for(var Ie=0;Ie<he.length;Ie++)Lo(he[Ie],U,$,ae,me,xe,!1)}function zo(he,U,$,ae){he.push(U),he.push($),he.push(ae)}function Us(he,U,$,ae,me,xe){var Ie=(xe-U)/(ae-U);return he.push(xe),he.push($+(me-$)*Ie),he.push(1),Ie}function Vs(he,U,$,ae,me,xe){var Ie=(xe-$)/(me-$);return he.push(U+(ae-U)*Ie),he.push(xe),he.push(1),Ie}function qr(he,U){for(var $=[],ae=0;ae<he.length;ae++){var me,xe=he[ae],Ie=xe.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")me=ps(xe.geometry,U);else if(Ie==="MultiLineString"||Ie==="Polygon"){me=[];for(var Se=0;Se<xe.geometry.length;Se++)me.push(ps(xe.geometry[Se],U))}else if(Ie==="MultiPolygon")for(me=[],Se=0;Se<xe.geometry.length;Se++){for(var ve=[],Le=0;Le<xe.geometry[Se].length;Le++)ve.push(ps(xe.geometry[Se][Le],U));me.push(ve)}$.push(qt(xe.id,Ie,me,xe.tags))}return $}function ps(he,U){var $=[];$.size=he.size,he.start!==void 0&&($.start=he.start,$.end=he.end);for(var ae=0;ae<he.length;ae+=3)$.push(he[ae]+U,he[ae+1],he[ae+2]);return $}function ec(he,U){if(he.transformed)return he;var $,ae,me,xe=1<<he.z,Ie=he.x,Se=he.y;for($=0;$<he.features.length;$++){var ve=he.features[$],Le=ve.geometry,it=ve.type;if(ve.geometry=[],it===1)for(ae=0;ae<Le.length;ae+=2)ve.geometry.push($s(Le[ae],Le[ae+1],U,xe,Ie,Se));else for(ae=0;ae<Le.length;ae++){var st=[];for(me=0;me<Le[ae].length;me+=2)st.push($s(Le[ae][me],Le[ae][me+1],U,xe,Ie,Se));ve.geometry.push(st)}}return he.transformed=!0,he}function $s(he,U,$,ae,me,xe){return[Math.round($*(he*ae-me)),Math.round($*(U*ae-xe))]}function Ba(he,U,$,ae,me){for(var xe=U===me.maxZoom?0:me.tolerance/((1<<U)*me.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ae,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<he.length;Se++){Ie.numFeatures++,tc(Ie,he[Se],xe,me);var ve=he[Se].minX,Le=he[Se].minY,it=he[Se].maxX,st=he[Se].maxY;ve<Ie.minX&&(Ie.minX=ve),Le<Ie.minY&&(Ie.minY=Le),it>Ie.maxX&&(Ie.maxX=it),st>Ie.maxY&&(Ie.maxY=st)}return Ie}function tc(he,U,$,ae){var me=U.geometry,xe=U.type,Ie=[];if(xe==="Point"||xe==="MultiPoint")for(var Se=0;Se<me.length;Se+=3)Ie.push(me[Se]),Ie.push(me[Se+1]),he.numPoints++,he.numSimplified++;else if(xe==="LineString")Gs(Ie,me,he,$,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(Se=0;Se<me.length;Se++)Gs(Ie,me[Se],he,$,xe==="Polygon",Se===0);else if(xe==="MultiPolygon")for(var ve=0;ve<me.length;ve++){var Le=me[ve];for(Se=0;Se<Le.length;Se++)Gs(Ie,Le[Se],he,$,!0,Se===0)}if(Ie.length){var it=U.tags||null;if(xe==="LineString"&&ae.lineMetrics){for(var st in it={},U.tags)it[st]=U.tags[st];it.mapbox_clip_start=me.start/me.size,it.mapbox_clip_end=me.end/me.size}var tt={geometry:Ie,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:it};U.id!==null&&(tt.id=U.id),he.features.push(tt)}}function Gs(he,U,$,ae,me,xe){var Ie=ae*ae;if(ae>0&&U.size<(me?Ie:ae))$.numPoints+=U.length/3;else{for(var Se=[],ve=0;ve<U.length;ve+=3)(ae===0||U[ve+2]>Ie)&&($.numSimplified++,Se.push(U[ve]),Se.push(U[ve+1])),$.numPoints++;me&&function(Le,it){for(var st=0,tt=0,Dt=Le.length,Bt=Dt-2;tt<Dt;Bt=tt,tt+=2)st+=(Le[tt]-Le[Bt])*(Le[tt+1]+Le[Bt+1]);if(st>0===it)for(tt=0,Dt=Le.length;tt<Dt/2;tt+=2){var Lt=Le[tt],Ft=Le[tt+1];Le[tt]=Le[Dt-2-tt],Le[tt+1]=Le[Dt-1-tt],Le[Dt-2-tt]=Lt,Le[Dt-1-tt]=Ft}}(Se,xe),he.push(Se)}}function ms(he,U){var $=(U=this.options=function(me,xe){for(var Ie in xe)me[Ie]=xe[Ie];return me}(Object.create(this.options),U)).debug;if($&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var ae=function(me,xe){var Ie=[];if(me.type==="FeatureCollection")for(var Se=0;Se<me.features.length;Se++)Gr(Ie,me.features[Se],xe,Se);else Gr(Ie,me.type==="Feature"?me:{geometry:me},xe);return Ie}(he,U);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ae=function(me,xe){var Ie=xe.buffer/xe.extent,Se=me,ve=Xn(me,1,-1-Ie,Ie,0,-1,2,xe),Le=Xn(me,1,1-Ie,2+Ie,0,-1,2,xe);return(ve||Le)&&(Se=Xn(me,1,-Ie,1+Ie,0,-1,2,xe)||[],ve&&(Se=qr(ve,1).concat(Se)),Le&&(Se=Se.concat(qr(Le,-1)))),Se}(ae,U),ae.length&&this.splitTile(ae,0,0,0),$&&(ae.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ws(he,U,$){return 32*((1<<he)*$+U)+he}function qs(he,U){const $=he.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);const ae=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ae)return U(null,null);const me=new class{constructor(Ie){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=a.EXTENT,this.length=Ie.length,this._features=Ie}feature(Ie){return new class{constructor(Se){this._feature=Se,this.extent=a.EXTENT,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const ve of this._feature.geometry)Se.push([new a.Point(ve[0],ve[1])]);return Se}{const Se=[];for(const ve of this._feature.geometry){const Le=[];for(const it of ve)Le.push(new a.Point(it[0],it[1]));Se.push(Le)}return Se}}toGeoJSON(Se,ve,Le){return we.call(this,Se,ve,Le)}}(this._features[Ie])}}(ae.features);let xe=Fn(me);xe.byteOffset===0&&xe.byteLength===xe.buffer.byteLength||(xe=new Uint8Array(xe)),U(null,{vectorTile:me,rawData:xe.buffer})}ms.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ms.prototype.splitTile=function(he,U,$,ae,me,xe,Ie){for(var Se=[he,U,$,ae],ve=this.options,Le=ve.debug;Se.length;){ae=Se.pop(),$=Se.pop(),U=Se.pop(),he=Se.pop();var it=1<<U,st=Ws(U,$,ae),tt=this.tiles[st];if(!tt&&(Le>1&&console.time("creation"),tt=this.tiles[st]=Ba(he,U,$,ae,ve),this.tileCoords.push({z:U,x:$,y:ae}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,$,ae,tt.numFeatures,tt.numPoints,tt.numSimplified),console.timeEnd("creation"));var Dt="z"+U;this.stats[Dt]=(this.stats[Dt]||0)+1,this.total++}if(tt.source=he,me){if(U===ve.maxZoom||U===me)continue;var Bt=1<<me-U;if($!==Math.floor(xe/Bt)||ae!==Math.floor(Ie/Bt))continue}else if(U===ve.indexMaxZoom||tt.numPoints<=ve.indexMaxPoints)continue;if(tt.source=null,he.length!==0){Le>1&&console.time("clipping");var Lt,Ft,Xt,Ln,Kn,Or,ur=.5*ve.buffer/ve.extent,uo=.5-ur,xr=.5+ur,Hr=1+ur;Lt=Ft=Xt=Ln=null,Kn=Xn(he,it,$-ur,$+xr,0,tt.minX,tt.maxX,ve),Or=Xn(he,it,$+uo,$+Hr,0,tt.minX,tt.maxX,ve),he=null,Kn&&(Lt=Xn(Kn,it,ae-ur,ae+xr,1,tt.minY,tt.maxY,ve),Ft=Xn(Kn,it,ae+uo,ae+Hr,1,tt.minY,tt.maxY,ve),Kn=null),Or&&(Xt=Xn(Or,it,ae-ur,ae+xr,1,tt.minY,tt.maxY,ve),Ln=Xn(Or,it,ae+uo,ae+Hr,1,tt.minY,tt.maxY,ve),Or=null),Le>1&&console.timeEnd("clipping"),Se.push(Lt||[],U+1,2*$,2*ae),Se.push(Ft||[],U+1,2*$,2*ae+1),Se.push(Xt||[],U+1,2*$+1,2*ae),Se.push(Ln||[],U+1,2*$+1,2*ae+1)}}},ms.prototype.getTile=function(he,U,$){var ae=this.options,me=ae.extent,xe=ae.debug;if(he<0||he>24)return null;var Ie=1<<he,Se=Ws(he,U=(U%Ie+Ie)%Ie,$);if(this.tiles[Se])return ec(this.tiles[Se],me);xe>1&&console.log("drilling down to z%d-%d-%d",he,U,$);for(var ve,Le=he,it=U,st=$;!ve&&Le>0;)Le--,it=Math.floor(it/2),st=Math.floor(st/2),ve=this.tiles[Ws(Le,it,st)];return ve&&ve.source?(xe>1&&console.log("found parent tile z%d-%d-%d",Le,it,st),xe>1&&console.time("drilling down"),this.splitTile(ve.source,Le,it,st,he,U,$),xe>1&&console.timeEnd("drilling down"),this.tiles[Se]?ec(this.tiles[Se],me):null):null};class Fa extends a.VectorTileWorkerSource{constructor(U,$,ae,me,xe){super(U,$,ae,me,qs),xe&&(this.loadGeoJSON=xe)}loadData(U,$){const ae=U&&U.request,me=ae&&ae.collectResourceTiming;this.loadGeoJSON(U,(xe,Ie)=>{if(xe||!Ie)return $(xe);if(typeof Ie!="object")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{le(Ie,!0);try{if(U.filter){const ve=a.createExpression(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ve.result==="error")throw new Error(ve.value.map(it=>`${it.key}: ${it.message}`).join(", "));Ie={type:"FeatureCollection",features:Ie.features.filter(it=>ve.value.evaluate({zoom:0},it))}}this._geoJSONIndex=U.cluster?new Yt(function({superclusterOptions:ve,clusterProperties:Le}){if(!Le||!ve)return ve;const it={},st={},tt={accumulated:null,zoom:0},Dt={properties:null},Bt=Object.keys(Le);for(const Lt of Bt){const[Ft,Xt]=Le[Lt],Ln=a.createExpression(Xt),Kn=a.createExpression(typeof Ft=="string"?[Ft,["accumulated"],["get",Lt]]:Ft);it[Lt]=Ln.value,st[Lt]=Kn.value}return ve.map=Lt=>{Dt.properties=Lt;const Ft={};for(const Xt of Bt)Ft[Xt]=it[Xt].evaluate(tt,Dt);return Ft},ve.reduce=(Lt,Ft)=>{Dt.properties=Ft;for(const Xt of Bt)tt.accumulated=Lt[Xt],Lt[Xt]=st[Xt].evaluate(tt,Dt)},ve}(U)).load(Ie.features):function(ve,Le){return new ms(ve,Le)}(Ie,U.geojsonVtOptions)}catch(ve){return $(ve)}this.loaded={};const Se={};if(me){const ve=a.getPerformanceMeasurement(ae);ve&&(Se.resourceTiming={},Se.resourceTiming[U.source]=JSON.parse(JSON.stringify(ve)))}$(null,Se)}})}reloadTile(U,$){const ae=this.loaded;return ae&&ae[U.uid]?super.reloadTile(U,$):this.loadTile(U,$)}loadGeoJSON(U,$){if(U.request)a.getJSON(U.request,$);else{if(typeof U.data!="string")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(U.data))}catch{return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(U,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(ae){$(ae)}}getClusterChildren(U,$){try{$(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(ae){$(ae)}}getClusterLeaves(U,$){try{$(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(ae){$(ae)}}}class _u{constructor(U){this.self=U,this.actor=new a.Actor(U,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=a.getProjection({name:"mercator"}),this.workerSourceTypes={vector:a.VectorTileWorkerSource,geojson:Fa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,ae)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=ae},this.self.registerRTLTextPlugin=$=>{if(a.plugin.isParsed())throw new Error("RTL text plugin already registered.");a.plugin.applyArabicShaping=$.applyArabicShaping,a.plugin.processBidirectionalText=$.processBidirectionalText,a.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(U,$,ae){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U],ae()}checkIfReady(U,$,ae){ae()}setReferrer(U,$){this.referrer=$}spriteLoaded(U,$){this.isSpriteLoaded[U]=$;for(const ae in this.workerSources[U]){const me=this.workerSources[U][ae];for(const xe in me)me[xe]instanceof a.VectorTileWorkerSource&&(me[xe].isSpriteLoaded=$,me[xe].fire(new a.Event("isSpriteLoaded")))}}setImages(U,$,ae){this.availableImages[U]=$;for(const me in this.workerSources[U]){const xe=this.workerSources[U][me];for(const Ie in xe)xe[Ie].availableImages=$}ae()}enableTerrain(U,$,ae){this.terrain=$,ae()}setProjection(U,$){this.projections[U]=a.getProjection($)}setLayers(U,$,ae){this.getLayerIndex(U).replace($),ae()}updateLayers(U,$,ae){this.getLayerIndex(U).update($.layers,$.removedIds),ae()}loadTile(U,$,ae){const me=this.enableTerrain?a.extend({enableTerrain:this.terrain},$):$;me.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source).loadTile(me,ae)}loadDEMTile(U,$,ae){const me=this.enableTerrain?a.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(U,$.source).loadTile(me,ae)}reloadTile(U,$,ae){const me=this.enableTerrain?a.extend({enableTerrain:this.terrain},$):$;me.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source).reloadTile(me,ae)}abortTile(U,$,ae){this.getWorkerSource(U,$.type,$.source).abortTile($,ae)}removeTile(U,$,ae){this.getWorkerSource(U,$.type,$.source).removeTile($,ae)}removeSource(U,$,ae){if(!this.workerSources[U]||!this.workerSources[U][$.type]||!this.workerSources[U][$.type][$.source])return;const me=this.workerSources[U][$.type][$.source];delete this.workerSources[U][$.type][$.source],me.removeSource!==void 0?me.removeSource($,ae):ae()}loadWorkerSource(U,$,ae){try{this.self.importScripts($.url),ae()}catch(me){ae(me.toString())}}syncRTLPluginState(U,$,ae){try{a.plugin.setState($);const me=a.plugin.getPluginURL();if(a.plugin.isLoaded()&&!a.plugin.isParsed()&&me!=null){this.self.importScripts(me);const xe=a.plugin.isParsed();ae(xe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${me}`),xe)}}catch(me){ae(me.toString())}}getAvailableImages(U){let $=this.availableImages[U];return $||($=[]),$}getLayerIndex(U){let $=this.layerIndexes[U];return $||($=this.layerIndexes[U]=new V),$}getWorkerSource(U,$,ae){if(this.workerSources[U]||(this.workerSources[U]={}),this.workerSources[U][$]||(this.workerSources[U][$]={}),!this.workerSources[U][$][ae]){const me={send:(xe,Ie,Se,ve,Le,it)=>{this.actor.send(xe,Ie,Se,U,Le,it)},scheduler:this.actor.scheduler};this.workerSources[U][$][ae]=new this.workerSourceTypes[$](me,this.getLayerIndex(U),this.getAvailableImages(U),this.isSpriteLoaded[U])}return this.workerSources[U][$][ae]}getDEMWorkerSource(U,$){return this.demWorkerSources[U]||(this.demWorkerSources[U]={}),this.demWorkerSources[U][$]||(this.demWorkerSources[U][$]=new G),this.demWorkerSources[U][$]}enforceCacheSizeLimit(U,$){a.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(U,$,ae){ae(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new _u(self)),_u}),w(["./shared"],function(a){function k(f,s){if(Array.isArray(f)){if(!Array.isArray(s)||f.length!==s.length)return!1;for(let u=0;u<f.length;u++)if(!k(f[u],s[u]))return!1;return!0}if(typeof f=="object"&&f!==null&&s!==null){if(typeof s!="object"||Object.keys(f).length!==Object.keys(s).length)return!1;for(const u in f)if(!k(f[u],s[u]))return!1;return!0}return f===s}var O=V;function V(f){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,y,x=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(x);try{y=new Worker(T),m=!0}catch{m=!1}return y&&y.terminate(),URL.revokeObjectURL(T),m}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var m=document.createElement("canvas");m.width=m.height=1;var y=m.getContext("2d");if(!y)return!1;var x=y.getImageData(0,0,1,1);return x&&x.width===m.width}()?(G[u=s&&s.failIfMajorPerformanceCaveat]===void 0&&(G[u]=function(m){var y,x=function(T){var S=document.createElement("canvas"),A=Object.create(V.webGLContextAttributes);return A.failIfMajorPerformanceCaveat=T,S.getContext("webgl",A)||S.getContext("experimental-webgl",A)}(m);if(!x)return!1;try{y=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!y||x.isContextLost())&&(x.shaderSource(y,"void main() {}"),x.compileShader(y),x.getShaderParameter(y,x.COMPILE_STATUS)===!0)}(u)),G[u]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var u}(f)}var G={};function X(f,s,u){const m=a.window.document.createElement(f);return s!==void 0&&(m.className=s),u&&u.appendChild(m),m}function oe(f,s,u){const m=a.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const y of Object.keys(s))m.setAttributeNS(null,y,s[y]);return u&&u.appendChild(m),m}V.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const le=a.window.document&&a.window.document.documentElement.style,we=le&&le.userSelect!==void 0?"userSelect":"WebkitUserSelect";let te;function J(){le&&we&&(te=le[we],le[we]="none")}function ce(){le&&we&&(le[we]=te)}function Te(f){f.preventDefault(),f.stopPropagation(),a.window.removeEventListener("click",Te,!0)}function Ne(){a.window.addEventListener("click",Te,!0),a.window.setTimeout(()=>{a.window.removeEventListener("click",Te,!0)},0)}function Ge(f,s){const u=f.getBoundingClientRect();return vt(f,u,s)}function Xe(f,s){const u=f.getBoundingClientRect(),m=[];for(let y=0;y<s.length;y++)m.push(vt(f,u,s[y]));return m}function qe(f){return a.window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&a.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function vt(f,s,u){const m=f.offsetWidth===s.width?1:f.offsetWidth/s.width;return new a.Point((u.clientX-s.left)*m,(u.clientY-s.top)*m)}function ze(f,s){var u=s[0],m=s[1],y=s[2],x=s[3],T=u*x-y*m;return T?(f[0]=x*(T=1/T),f[1]=-m*T,f[2]=-y*T,f[3]=u*T,f):null}function Ct(f){const{userImage:s}=f;return!!(s&&s.render&&s.render())&&(f.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ut extends a.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:u,callback:m}of this.requestors)this._notify(u,m);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,u){this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let m=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(u.content,u)||(this.fire(new a.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,u){if(!s)return!0;let m=0;for(const y of s){if(y[0]<m||y[1]<y[0]||u<y[1])return!1;m=y[1]}return!0}_validateContent(s,u){return!(s&&(s.length!==4||s[0]<0||u.data.width<s[0]||s[1]<0||u.data.height<s[1]||s[2]<0||u.data.width<s[2]||s[3]<0||u.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,u){u.version=this.images[s].version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){const u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,u){let m=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(m=!1);this.isLoaded()||m?this._notify(s,u):this.requestors.push({ids:s,callback:u})}_notify(s,u){const m={};for(const y of s){this.images[y]||this.fire(new a.Event("styleimagemissing",{id:y}));const x=this.images[y];x?m[y]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:a.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,m)}getPixelSize(){const{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){const u=this.patterns[s],m=this.getImage(s);if(!m)return null;if(u&&u.position.version===m.version)return u.position;if(u)u.position.version=m.version;else{const y={w:m.data.width+2,h:m.data.height+2,x:0,y:0},x=new a.ImagePosition(y,m);this.patterns[s]={bin:y,position:x}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new a.Texture(s,this.atlasImage,u.RGBA),this.atlasTexture&&this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const x in this.patterns)s.push(this.patterns[x].bin);const{w:u,h:m}=a.potpack(s),y=this.atlasImage;y.resize({width:u||1,height:m||1});for(const x in this.patterns){const{bin:T}=this.patterns[x],S=T.x+1,A=T.y+1,D=this.images[x].data,R=D.width,B=D.height;a.RGBAImage.copy(D,y,{x:0,y:0},{x:S,y:A},{width:R,height:B}),a.RGBAImage.copy(D,y,{x:0,y:B-1},{x:S,y:A-1},{width:R,height:1}),a.RGBAImage.copy(D,y,{x:0,y:0},{x:S,y:A+B},{width:R,height:1}),a.RGBAImage.copy(D,y,{x:R-1,y:0},{x:S-1,y:A},{width:1,height:B}),a.RGBAImage.copy(D,y,{x:0,y:0},{x:S+R,y:A},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const m=this.images[u];Ct(m)&&this.updateImage(u,m)}}}const pt=new a.Properties({anchor:new a.DataConstantProperty(a.spec.light.anchor),position:new class{constructor(){this.specification=a.spec.light.position}possiblyEvaluate(f,s){return function([u,m,y]){const x=a.degToRad(m+90),T=a.degToRad(y);return{x:u*Math.cos(x)*Math.sin(T),y:u*Math.sin(x)*Math.sin(T),z:u*Math.cos(T),azimuthal:m,polar:y}}(f.expression.evaluate(s))}interpolate(f,s,u){return{x:a.number(f.x,s.x,u),y:a.number(f.y,s.y,u),z:a.number(f.z,s.z,u),azimuthal:a.number(f.azimuthal,s.azimuthal,u),polar:a.number(f.polar,s.polar,u)}}},color:new a.DataConstantProperty(a.spec.light.color),intensity:new a.DataConstantProperty(a.spec.light.intensity)});class Zt extends a.Evented{constructor(s){super(),this._transitionable=new a.Transitionable(pt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u={}){if(!this._validate(a.validateLight,s,u))for(const m in s){const y=s[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}const Hn=new a.Properties({source:new a.DataConstantProperty(a.spec.terrain.source),exaggeration:new a.DataConstantProperty(a.spec.terrain.exaggeration)});let Dn=class extends a.Evented{constructor(f,s){super(),this._transitionable=new a.Transitionable(Hn),this.set(f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(f){for(const s in f){const u=f[s];a.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),u):this._transitionable.setValue(s,u)}}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}};function Fn(f,s,u,m){const y=a.smoothstep(45,65,u),[x,T]=_t(f,m),S=a.length(s);let A=1-Math.min(1,Math.exp((S-x)/(T-x)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*y*f.alpha}function _t(f,s){const u=.5/Math.tan(.5*s);return[f.range[0]+u,f.range[1]+u]}const ot=new a.Properties({range:new a.DataConstantProperty(a.spec.fog.range),color:new a.DataConstantProperty(a.spec.fog.color),"high-color":new a.DataConstantProperty(a.spec.fog["high-color"]),"space-color":new a.DataConstantProperty(a.spec.fog["space-color"]),"horizon-blend":new a.DataConstantProperty(a.spec.fog["horizon-blend"]),"star-intensity":new a.DataConstantProperty(a.spec.fog["star-intensity"])});class Tt extends a.Evented{constructor(s,u){super(),this._transitionable=new a.Transitionable(ot),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const s=this._transform,u=s.projection.name==="globe",m=a.globeToMercatorTransition(s.zoom),y=this.properties.get("range"),x=[.5,3];return{range:u?[a.number(x[0],y[0],m),a.number(x[1],y[1],m)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,u={}){if(!this._validate(a.validateFog,s,u)){for(const m of Object.keys(a.spec.fog))s&&s[m]===void 0&&(s[m]=a.spec.fog[m].default);for(const m in s){const y=s[m];a.endsWith(m,"-transition")?this._transitionable.setTransition(m.slice(0,-11),y):this._transitionable.setValue(m,y)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:a.smoothstep(45,65,s))*u.a}getOpacityAtLatLng(s,u){return this._transform.projection.supportsFog?function(m,y,x){const T=a.MercatorCoordinate.fromLngLat(y),S=x.elevation?x.elevation.getAtPointOrZero(T):0,A=[T.x,T.y,S];return a.transformMat4(A,A,x.mercatorFogMatrix),Fn(m,A,x.pitch,x._fov)}(this.state,s,u):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?_t(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,m){return(!m||m.validate!==!1)&&a.emitValidationErrors(this,s.call(a.validateStyle,a.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:a.spec})))}}class Rt{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=a.uniqueId();const m=this.workerPool.acquire(this.id);for(let y=0;y<m.length;y++){const x=new Rt.Actor(m[y],u,this.id);x.name=`Worker ${y}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,u,m){a.asyncAll(this.actors,(y,x)=>{y.send(s,u,x)},m=m||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Vt(f,s,u){return s*(a.EXTENT/(f.tileSize*Math.pow(2,u-f.tileID.overscaledZ)))}Rt.Actor=a.Actor;class yr{constructor(s,u,m,y){this.screenBounds=s,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=m,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(s,u){let m,y;if(s instanceof a.Point||typeof s[0]=="number"){const x=a.Point.convert(s);m=[x],y=u.isPointAboveHorizon(x)}else{const x=a.Point.convert(s[0]),T=a.Point.convert(s[1]);m=[x,T],y=a.polygonizeBounds(x,T).every(S=>u.isPointAboveHorizon(S))}return new yr(m,u.getCameraPoint(),y,u)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return a.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],y=a.polygonizeBounds(u,m,0,!1);return this.cameraPoint.y>m.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<m.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=m.x?y[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(y[3]=this.cameraPoint)),a.bufferConvexPolygon(y,s)}bufferedCameraGeometryGlobe(s){const u=this.screenBounds[0],m=this.screenBounds.length===1?this.screenBounds[0].add(new a.Point(1,1)):this.screenBounds[1],y=a.polygonizeBounds(u,m,s),x=this.cameraPoint.clone();switch(3*((x.y>u.y)+(x.y>m.y))+((x.x>u.x)+(x.x>m.x))){case 0:y[0]=x,y[4]=x.clone();break;case 1:y.splice(1,0,x);break;case 2:y[1]=x;break;case 3:y.splice(4,0,x);break;case 5:y.splice(2,0,x);break;case 6:y[3]=x;break;case 7:y.splice(3,0,x);break;case 8:y[2]=x}return y}containsTile(s,u,m,y=0){const x=s.queryPadding/u._pixelsPerMercatorPixel+1,T=m?this._bufferedCameraMercator(x,u):this._bufferedScreenMercator(x,u);let S=s.tileID.wrap+(T.unwrapped?y:0);const A=T.polygon.map(Q=>a.getTilePoint(s.tileTransform,Q,S));if(!a.polygonIntersectsBox(A,0,0,a.EXTENT,a.EXTENT))return;S=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const D=this.screenGeometryMercator.polygon.map(Q=>a.getTileVec3(s.tileTransform,Q,S)),R=D.map(Q=>new a.Point(Q[0],Q[1])),B=u.getFreeCameraOptions().position||new a.MercatorCoordinate(0,0,0),W=a.getTileVec3(s.tileTransform,B,S),Z=D.map(Q=>{const F=a.sub(Q,Q,W);return a.normalize(F,F),new a.Ray(W,F)}),Y=Vt(s,1,u.zoom)*u._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:Z,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(K=a.getBounds(A),K.min.x=a.clamp(K.min.x,0,a.EXTENT),K.min.y=a.clamp(K.min.y,0,a.EXTENT),K.max.x=a.clamp(K.max.x,0,a.EXTENT),K.max.y=a.clamp(K.max.y,0,a.EXTENT),K),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:Y};var K}_bufferedScreenMercator(s,u){const m=cr(s);if(this._screenRaycastCache[m])return this._screenRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),u):{polygon:this.bufferedScreenGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._screenRaycastCache[m]=y,y}}_bufferedCameraMercator(s,u){const m=cr(s);if(this._cameraRaycastCache[m])return this._cameraRaycastCache[m];{let y;return y=u.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),u):{polygon:this.bufferedCameraGeometry(s).map(x=>u.pointCoordinate3D(x)),unwrapped:!0},this._cameraRaycastCache[m]=y,y}}_projectAndResample(s,u){const m=function(x,T){const S=a.multiply([],T.pixelMatrix,T.globeMatrix),A=[0,-a.GLOBE_RADIUS,0,1],D=[0,a.GLOBE_RADIUS,0,1],R=[0,0,0,1];a.transformMat4$1(A,A,S),a.transformMat4$1(D,D,S),a.transformMat4$1(R,R,S);const B=new a.Point(A[0]/A[3],A[1]/A[3]),W=new a.Point(D[0]/D[3],D[1]/D[3]),Z=a.polygonContainsPoint(x,B)&&A[3]<R[3],Y=a.polygonContainsPoint(x,W)&&D[3]<R[3];if(!Z&&!Y)return null;const K=function(_e,Ee,be){for(let ke=1;ke<_e.length;ke++){const Ke=Zn(Ee.pointCoordinate3D(_e[ke-1]).x),Ce=Zn(Ee.pointCoordinate3D(_e[ke]).x);if(be<0){if(Ke<Ce)return{idx:ke,t:-Ke/(Ce-1-Ke)}}else if(Ce<Ke)return{idx:ke,t:(1-Ke)/(Ce+1-Ke)}}return null}(x,T,Z?-1:1);if(!K)return null;const{idx:Q,t:F}=K;let H=Q>1?Yt(x.slice(0,Q),T):[],ie=Q<x.length?Yt(x.slice(Q),T):[];H=H.map(_e=>new a.Point(Zn(_e.x),_e.y)),ie=ie.map(_e=>new a.Point(Zn(_e.x),_e.y));const se=[...H];se.length===0&&se.push(ie[ie.length-1]);const ge=a.number(se[se.length-1].y,(ie.length===0?H[0]:ie[0]).y,F);let ye;return ye=Z?[new a.Point(0,ge),new a.Point(0,0),new a.Point(1,0),new a.Point(1,ge)]:[new a.Point(1,ge),new a.Point(1,1),new a.Point(0,1),new a.Point(0,ge)],se.push(...ye),ie.length===0?se.push(H[0]):se.push(...ie),{polygon:se.map(_e=>new a.MercatorCoordinate(_e.x,_e.y)),unwrapped:!1}}(s,u);if(m)return m;const y=function(x,T){let S=!1,A=-1/0,D=0;for(let B=0;B<x.length-1;B++)x[B].x>A&&(A=x[B].x,D=B);for(let B=0;B<x.length-1;B++){const W=(D+B)%(x.length-1),Z=x[W],Y=x[W+1];Math.abs(Z.x-Y.x)>.5&&(Z.x<Y.x?(Z.x+=1,W===0&&(x[x.length-1].x+=1)):(Y.x+=1,W+1===x.length-1&&(x[0].x+=1)),S=!0)}const R=a.mercatorXfromLng(T.center.lng);return S&&R<Math.abs(R-1)&&x.forEach(B=>{B.x-=1}),{polygon:x,unwrapped:S}}(Yt(s,u).map(x=>new a.Point(Zn(x.x),x.y)),u);return{polygon:y.polygon.map(x=>new a.MercatorCoordinate(x.x,x.y)),unwrapped:y.unwrapped}}}function Yt(f,s){return a.resample(f,u=>{const m=s.pointCoordinate3D(u);u.x=m.x,u.y=m.y},1/256)}function Zn(f){return f<0?1+f%1:f%1}function cr(f){return 100*f|0}function vr(f,s,u,m,y){const x=function(T,S){if(T)return y(T);if(S){f.url&&S.tiles&&f.tiles&&delete f.tiles;const A=a.pick(a.extend(S,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(A.vectorLayers=S.vector_layers,A.vectorLayerIds=A.vectorLayers.map(D=>D.id)),A.tiles=s.canonicalizeTileset(A,f.url),y(null,A)}};return f.url?a.getJSON(s.transformRequest(s.normalizeSourceURL(f.url,null,u,m),a.ResourceType.Source),x):a.exported.frame(()=>x(null,f))}class Ar{constructor(s,u,m){this.bounds=a.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const u=Math.pow(2,s.z),m=Math.floor(a.mercatorXfromLng(this.bounds.getWest())*u),y=Math.floor(a.mercatorYfromLat(this.bounds.getNorth())*u),x=Math.ceil(a.mercatorXfromLng(this.bounds.getEast())*u),T=Math.ceil(a.mercatorYfromLat(this.bounds.getSouth())*u);return s.x>=m&&s.x<x&&s.y>=y&&s.y<T}}class ds{constructor(s,u,m){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ro={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class lo{constructor(s,u,m,y){this.length=u.length,this.attributes=m,this.itemSize=u.bytesPerElement,this.dynamicDraw=y,this.context=s;const x=s.gl;this.buffer=x.createBuffer(),s.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let m=0;m<this.attributes.length;m++){const y=u.attributes[this.attributes[m].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,u,m){for(let y=0;y<this.attributes.length;y++){const x=this.attributes[y],T=u.attributes[x.name];T!==void 0&&s.vertexAttribPointer(T,x.components,s[Ro[x.type]],!1,this.itemSize,x.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Do extends qt{getDefault(){return a.Color.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Gr extends qt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class js extends qt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class In extends qt{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Wr extends qt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Oa extends qt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Vi extends qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Xn extends qt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class co extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class Lo extends qt{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class fs extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class Ei extends qt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class zo extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class Us extends qt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Vs extends qt{getDefault(){return a.Color.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qr extends qt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class ps extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class ec extends qt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class $s extends qt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let Ba,tc=class extends qt{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class Gs extends qt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class ms extends qt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Ws extends qt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class qs extends qt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Fa extends qt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class _u extends qt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class he extends qt{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class U extends qt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class $ extends qt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class ae extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class me extends qt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class xe extends qt{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class Ie extends xe{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Se extends xe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ve extends Se{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Le{constructor(s,u,m,y){this.context=s,this.width=u,this.height=m;const x=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Ie(s,x),y&&(this.depthAttachment=new Se(s,x))}destroy(){const s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class it{constructor(s,u=!1){if(this.gl=s,this.isWebGL2=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),u){const m=s;this.extVertexArrayObject={createVertexArrayOES:m.createVertexArray.bind(s),deleteVertexArrayOES:m.deleteVertexArray.bind(s),bindVertexArrayOES:m.bindVertexArray.bind(s)}}this.clearColor=new Do(this),this.clearDepth=new Gr(this),this.clearStencil=new js(this),this.colorMask=new In(this),this.depthMask=new Wr(this),this.stencilMask=new Oa(this),this.stencilFunc=new Vi(this),this.stencilOp=new Xn(this),this.stencilTest=new co(this),this.depthRange=new Lo(this),this.depthTest=new fs(this),this.depthFunc=new Ei(this),this.blend=new zo(this),this.blendFunc=new Us(this),this.blendColor=new Vs(this),this.blendEquation=new qr(this),this.cullFace=new ps(this),this.cullFaceSide=new ec(this),this.frontFace=new $s(this),this.program=new tc(this),this.activeTexture=new Gs(this),this.viewport=new ms(this),this.bindFramebuffer=new Ws(this),this.bindRenderbuffer=new qs(this),this.bindTexture=new Fa(this),this.bindVertexBuffer=new _u(this),this.bindElementBuffer=new he(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new U(this),this.pixelStoreUnpack=new $(this),this.pixelStoreUnpackPremultiplyAlpha=new ae(this),this.pixelStoreUnpackFlipY=new me(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),u||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(u||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=u||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new ds(this,s,u)}createVertexBuffer(s,u,m){return new lo(this,s,u,m)}createRenderbuffer(s,u,m){const y=this.gl,x=y.createRenderbuffer();return this.bindRenderbuffer.set(x),y.renderbufferStorage(y.RENDERBUFFER,s,u,m),this.bindRenderbuffer.set(null),x}createFramebuffer(s,u,m){return new Le(this,s,u,m)}clear({color:s,depth:u,stencil:m}){const y=this.gl;let x=0;s&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),m!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),y.clear(x)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){k(s.blendFunction,a.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class st extends a.Evented{constructor(s,u,m,y){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.extend(this,a.pick(u,["url","scheme","tileSize","promoteId"])),this._options=a.extend({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new a.DedupedRequest}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"}));const u=Array.isArray(this.map._language)?this.map._language.join():this.map._language,m=this.map._worldview;this._tileJSONRequest=vr(this._options,this.map._requestManager,u,m,(y,x)=>{this._tileJSONRequest=null,this._loaded=!0,y?(u&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${u}`),m&&m.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${m}`),this.fire(new a.ErrorEvent(y))):x&&(a.extend(this,x),x.bounds&&(this.tileBounds=new Ar(x.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(x.tiles,this.map._requestManager._customAccessToken),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(y)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}loadTile(s,u){const m=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(m,a.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=u:s.request=s.actor.send("reloadTile",y,x.bind(this));else if(s.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",y,x.bind(this),void 0,!0);else{const T=a.loadVectorTile.call({deduped:this._deduped},y,(S,A)=>{S||!A?x.call(this,S):(y.data={cacheControl:A.cacheControl,expires:A.expires,rawData:A.rawData.slice(0)},s.actor&&s.actor.send("loadTile",y,x.bind(this),void 0,!0))},!0);s.request={cancel:T}}function x(T,S){return delete s.request,s.aborted?u(null):T&&T.status!==404?u(T):(S&&S.resourceTiming&&(s.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&s.setExpiryData(S),s.loadVectorData(S,this.map.painter),a.cacheEntryPossiblyAdded(this.dispatcher),u(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class tt extends a.Evented{constructor(s,u,m,y){super(),this.id=s,this.dispatcher=m,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.extend({type:"raster"},u),a.extend(this,a.pick(u,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=vr(this._options,this.map._requestManager,null,null,(u,m)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new a.ErrorEvent(u)):m&&(a.extend(this,m),m.bounds&&(this.tileBounds=new Ar(m.bounds,this.minzoom,this.maxzoom)),a.postTurnstileEvent(m.tiles),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(u)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return a.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,u){const m=a.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),m,this.tileSize);s.request=a.getImage(this.map._requestManager.transformRequest(y,a.ResourceType.Tile),(x,T,S,A)=>(delete s.request,s.aborted?(s.state="unloaded",u(null)):x?(s.state="errored",u(x)):T?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:A}),s.setTexture(T,this.map.painter),s.state="loaded",a.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(s,u,m){s.setTexture(u,m)}static unloadTileData(s,u){s.texture&&u.saveTileTexture(s.texture)}abortTile(s,u){s.request&&(s.request.cancel(),delete s.request),u()}unloadTile(s,u){s.texture&&this.map.painter.saveTileTexture(s.texture),u()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Dt(f,s,u,m,y,x,T,S){const A=[f,u,y,s,m,x,1,1,1],D=[T,S,1],R=a.adjoint([],A),[B,W,Z]=a.transformMat3(D,D,a.transpose(R,R));return a.multiply$1(A,[B,0,0,0,W,0,0,0,Z],A)}class Bt extends a.Evented{constructor(s,u,m,y){super(),this.id=s,this.dispatcher=m,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=u,this._dirty=!1}load(s,u){this._loaded=u||!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=a.getImage(this.map._requestManager.transformRequest(this.url,a.ResourceType.Image),(m,y)=>{if(this._imageRequest=null,this._loaded=!0,m)this.fire(new a.ErrorEvent(m));else if(y){const{HTMLImageElement:x}=a.window;this.image=y instanceof x?a.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const u=s.map(a.MercatorCoordinate.fromLngLat);return this.tileID=function(m){let y=1/0,x=1/0,T=-1/0,S=-1/0;for(const B of m)y=Math.min(y,B.x),x=Math.min(x,B.y),T=Math.max(T,B.x),S=Math.max(S,B.y);const A=Math.max(T-y,S-x),D=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,D);return new a.CanonicalTileID(D,Math.floor((y+T)/2*R),Math.floor((x+S)/2*R))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const A in this.tiles){const D=this.tiles[A];D.state!=="loaded"&&(D.state="loaded",D.texture=this.texture)}if(this._boundsArray)return;const u=a.tileTransform(this.tileID,this.map.transform.projection),[m,y,x,T]=this.coordinates.map(A=>{const D=u.projection.project(A[0],A[1]);return a.getTilePoint(u,D)._round()});this.perspectiveTransform=function(A,D,R,B,W,Z,Y,K,Q,F){const H=Dt(0,0,A,0,0,D,A,D),ie=Dt(R,B,W,Z,Y,K,Q,F);return a.multiply$1(ie,a.adjoint(H,H),ie),[ie[6]/ie[8]*A/a.EXTENT,ie[7]/ie[8]*D/a.EXTENT]}(this.width,this.height,m.x,m.y,y.x,y.y,T.x,T.y,x.x,x.y);const S=this._boundsArray=new a.StructArrayLayout4i8;S.emplaceBack(m.x,m.y,0,0),S.emplaceBack(y.x,y.y,a.EXTENT,0),S.emplaceBack(T.x,T.y,0,a.EXTENT),S.emplaceBack(x.x,x.y,a.EXTENT,a.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(S,a.boundsAttributes.members),this.boundsSegments=a.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,u=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new a.Texture(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,u){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},u(null)):(s.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Lt={vector:st,raster:tt,"raster-dem":class extends tt{constructor(f,s,u,m){super(f,s,u,m),this.type="raster-dem",this.maxzoom=22,this._options=a.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(f,s){const u=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function m(y,x){y&&(f.state="errored",s(y)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",s(null))}f.request=a.getImage(this.map._requestManager.transformRequest(u,a.ResourceType.Tile),(function(y,x,T,S){if(delete f.request,f.aborted)f.state="unloaded",s(null);else if(y)f.state="errored",s(y);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:T,expires:S});const A=a.window.ImageBitmap&&x instanceof a.window.ImageBitmap&&(Ba==null&&(Ba=a.window.OffscreenCanvas&&new a.window.OffscreenCanvas(1,1).getContext("2d")&&typeof a.window.createImageBitmap=="function"),Ba),D=1-(x.width-a.prevPowerOfTwo(x.width))/2;D<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const R=A?x:a.exported.getImageData(x,D),B={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:R,encoding:this.encoding,padding:D};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",B,m.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){const s=f.canonical,u=Math.pow(2,s.z),m=(s.x-1+u)%u,y=s.x===0?f.wrap-1:f.wrap,x=(s.x+1+u)%u,T=s.x+1===u?f.wrap+1:f.wrap,S={};return S[new a.OverscaledTileID(f.overscaledZ,y,s.z,m,s.y).key]={backfilled:!1},S[new a.OverscaledTileID(f.overscaledZ,T,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(S[new a.OverscaledTileID(f.overscaledZ,y,s.z,m,s.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new a.OverscaledTileID(f.overscaledZ,T,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<u&&(S[new a.OverscaledTileID(f.overscaledZ,y,s.z,m,s.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(f.overscaledZ,f.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new a.OverscaledTileID(f.overscaledZ,T,s.z,x,s.y+1).key]={backfilled:!1}),S}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends a.Evented{constructor(f,s,u,m){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(m),this._data=s.data,this._options=a.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const y=a.EXTENT/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*y,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*y,extent:a.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:a.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},s),this}getClusterChildren(f,s){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},s),this}getClusterLeaves(f,s,u,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:s,offset:u},m),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new a.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=a.extend({},this.workerOptions),s=this._data;typeof s=="string"?(f.request=this.map._requestManager.transformRequest(a.exported.resolveURL(s),a.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(u,m)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new a.ErrorEvent(u));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(y.resourceTiming=m.resourceTiming[this.id]),this.fire(new a.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,s){const u=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(u,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:a.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(m,y)=>(delete f.request,f.unloadVectorData(),f.aborted?s(null):m?s(m):(f.loadVectorData(y,this.map.painter,u==="reloadTile"),s(null))),void 0,u==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return a.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Bt{constructor(f,s,u,m){super(f,s,u,m),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const s of f.urls)this.urls.push(this.map._requestManager.transformRequest(s,a.ResourceType.Source).url);a.getVideo(this.urls,(s,u)=>{this._loaded=!0,s?this.fire(new a.ErrorEvent(s)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const s=this.video.seekable;f<s.start(0)||f>s.end(0)?this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const f=this.map.painter.context,s=f.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new a.Texture(f,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Bt,canvas:class extends Bt{constructor(f,s,u,m){super(f,s,u,m),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(x=>typeof x!="number"))||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof a.window.HTMLCanvasElement||this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.ErrorEvent(new a.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof a.window.HTMLCanvasElement?this.options.canvas:a.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new a.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends a.Evented{constructor(f,s,u,m){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=s,this.setEventedParent(m),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new a.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new a.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ar(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),a.extend(this,a.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return a.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new a.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new a.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){const{x:s,y:u,z:m}=f.canonical;return this._implementation.hasTile({x:s,y:u,z:m})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,s){const{x:u,y:m,z:y}=f.tileID.canonical,x=new a.window.AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:u,y:m,z:y},{signal:x.signal})).then((function(T){return delete f.request,f.aborted?(f.state="unloaded",s(null)):T===void 0?(f.state="errored",s(null)):T===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",s(null)):function(S){return S instanceof a.window.ImageData||S instanceof a.window.HTMLCanvasElement||S instanceof a.window.ImageBitmap||S instanceof a.window.HTMLImageElement}(T)?(this.loadTileData(f,T),f.state="loaded",void s(null)):(f.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(T=>{T.code!==20&&(f.state="errored",s(T))}),f.request.cancel=()=>x.abort()}loadTileData(f,s){tt.loadTileData(f,s,this._map.painter)}unloadTileData(f){tt.unloadTileData(f,this._map.painter)}unloadTile(f,s){if(this.unloadTileData(f),this._implementation.unloadTile){const{x:u,y:m,z:y}=f.tileID.canonical;this._implementation.unloadTile({x:u,y:m,z:y})}s()}abortTile(f,s){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new a.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ft=function(f,s,u,m){const y=new Lt[s.type](f,s,u,m);if(y.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${y.id}`);return a.bindAll(["load","abort","unload","serialize","prepare"],y),y};function Xt(f,s){const u=a.identity([]);return a.scale(u,u,[.5*f.width,.5*-f.height,1]),a.translate(u,u,[1,-1,0]),a.multiply(u,u,f.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(u)}function Ln(f,s,u,m,y,x,T,S=!1){const A=f.tilesIn(m,T,S);A.sort(Or);const D=[];for(const B of A)D.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(s,u,f._state,B,y,x,Xt(f.transform,B.tile.tileID),S)});const R=function(B){const W={},Z={};for(const Y of B){const K=Y.queryResults,Q=Y.wrappedTileID,F=Z[Q]=Z[Q]||{};for(const H in K){const ie=K[H],se=F[H]=F[H]||{},ge=W[H]=W[H]||[];for(const ye of ie)se[ye.featureIndex]||(se[ye.featureIndex]=!0,ge.push(ye))}}return W}(D);for(const B in R)R[B].forEach(W=>{const Z=W.feature,Y=Z.layer;Y&&Y.type!=="background"&&Y.type!=="sky"&&(Z.source=Y.source,Y["source-layer"]&&(Z.sourceLayer=Y["source-layer"]),Z.state=Z.id!==void 0?f.getFeatureState(Y["source-layer"],Z.id):{})});return R}function Kn(f,s){const u=f.getRenderableIds().map(x=>f.getTileByID(x)),m=[],y={};for(let x=0;x<u.length;x++){const T=u[x],S=T.tileID.canonical.key;y[S]||(y[S]=!0,T.querySourceFeatures(m,s))}return m}function Or(f,s){const u=f.tileID,m=s.tileID;return u.overscaledZ-m.overscaledZ||u.canonical.y-m.canonical.y||u.wrap-m.wrap||u.canonical.x-m.canonical.x}function ur(){return rl.workerClass!=null?new rl.workerClass:new a.window.Worker(rl.workerUrl)}const uo="mapboxgl_preloaded_worker_pool";class xr{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<xr.workerCount;)this.workers.push(new ur);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[uo]}numActive(){return Object.keys(this.active).length}}let Hr;function Na(){return Hr||(Hr=new xr),Hr}function xv(f,s){const u={};for(const m in f)m!=="ref"&&(u[m]=f[m]);return a.refProperties.forEach(m=>{m in s&&(u[m]=s[m])}),u}function Cm(f){f=f.slice();const s=Object.create(null);for(let u=0;u<f.length;u++)s[f[u].id]=f[u];for(let u=0;u<f.length;u++)"ref"in f[u]&&(f[u]=xv(f[u],s[f[u].ref]));return f}xr.workerCount=2;const on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function xd(f,s,u){u.push({command:on.addSource,args:[f,s[f]]})}function nc(f,s,u){s.push({command:on.removeSource,args:[f]}),u[f]=!0}function wd(f,s,u,m){nc(f,u,m),xd(f,s,u)}function yu(f,s,u){let m;for(m in f[u])if(f[u].hasOwnProperty(m)&&m!=="data"&&!k(f[u][m],s[u][m]))return!1;for(m in s[u])if(s[u].hasOwnProperty(m)&&m!=="data"&&!k(f[u][m],s[u][m]))return!1;return!0}function ho(f,s,u,m,y,x){let T;for(T in s=s||{},f=f||{})f.hasOwnProperty(T)&&(k(f[T],s[T])||u.push({command:x,args:[m,T,s[T],y]}));for(T in s)s.hasOwnProperty(T)&&!f.hasOwnProperty(T)&&(k(f[T],s[T])||u.push({command:x,args:[m,T,s[T],y]}))}function Oo(f){return f.id}function bd(f,s){return f[s.id]=s,f}class Ed{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.clamp(s,0,1);let u=1,m=this._distances[u];const y=s*this.paddedLength+this.padding;for(;m<y&&u<this._distances.length;)m=this._distances[++u];const x=u-1,T=this._distances[x],S=m-T,A=S>0?(y-T)/S:0;return this.points[x].mult(1-A).add(this.points[u].mult(A))}}class Hs{constructor(s,u,m){const y=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(u/m);for(let T=0;T<this.xCellCount*this.yCellCount;T++)y.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,m,y,x){this._forEachCell(u,m,y,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(m),this.bboxes.push(y),this.bboxes.push(x)}insertCircle(s,u,m,y){this._forEachCell(u-y,m-y,u+y,m+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(m),this.circles.push(y)}_insertBoxCell(s,u,m,y,x,T){this.boxCells[x].push(T)}_insertCircleCell(s,u,m,y,x,T){this.circleCells[x].push(T)}_query(s,u,m,y,x,T){if(m<0||s>this.width||y<0||u>this.height)return!x&&[];const S=[];if(s<=0&&u<=0&&this.width<=m&&this.height<=y){if(x)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const D=this.circles[3*A],R=this.circles[3*A+1],B=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:D-B,y1:R-B,x2:D+B,y2:R+B})}return T?S.filter(T):S}return this._forEachCell(s,u,m,y,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},T),x?S.length>0:S}_queryCircle(s,u,m,y,x){const T=s-m,S=s+m,A=u-m,D=u+m;if(S<0||T>this.width||D<0||A>this.height)return!y&&[];const R=[];return this._forEachCell(T,A,S,D,this._queryCellCircle,R,{hitTest:y,circle:{x:s,y:u,radius:m},seenUids:{box:{},circle:{}}},x),y?R.length>0:R}query(s,u,m,y,x){return this._query(s,u,m,y,!1,x)}hitTest(s,u,m,y,x){return this._query(s,u,m,y,!0,x)}hitTestCircle(s,u,m,y){return this._queryCircle(s,u,m,!0,y)}_queryCell(s,u,m,y,x,T,S,A){const D=S.seenUids,R=this.boxCells[x];if(R!==null){const W=this.bboxes;for(const Z of R)if(!D.box[Z]){D.box[Z]=!0;const Y=4*Z;if(s<=W[Y+2]&&u<=W[Y+3]&&m>=W[Y+0]&&y>=W[Y+1]&&(!A||A(this.boxKeys[Z]))){if(S.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[Z],x1:W[Y],y1:W[Y+1],x2:W[Y+2],y2:W[Y+3]})}}}const B=this.circleCells[x];if(B!==null){const W=this.circles;for(const Z of B)if(!D.circle[Z]){D.circle[Z]=!0;const Y=3*Z;if(this._circleAndRectCollide(W[Y],W[Y+1],W[Y+2],s,u,m,y)&&(!A||A(this.circleKeys[Z]))){if(S.hitTest)return T.push(!0),!0;{const K=W[Y],Q=W[Y+1],F=W[Y+2];T.push({key:this.circleKeys[Z],x1:K-F,y1:Q-F,x2:K+F,y2:Q+F})}}}}}_queryCellCircle(s,u,m,y,x,T,S,A){const D=S.circle,R=S.seenUids,B=this.boxCells[x];if(B!==null){const Z=this.bboxes;for(const Y of B)if(!R.box[Y]){R.box[Y]=!0;const K=4*Y;if(this._circleAndRectCollide(D.x,D.y,D.radius,Z[K+0],Z[K+1],Z[K+2],Z[K+3])&&(!A||A(this.boxKeys[Y])))return T.push(!0),!0}}const W=this.circleCells[x];if(W!==null){const Z=this.circles;for(const Y of W)if(!R.circle[Y]){R.circle[Y]=!0;const K=3*Y;if(this._circlesCollide(Z[K],Z[K+1],Z[K+2],D.x,D.y,D.radius)&&(!A||A(this.circleKeys[Y])))return T.push(!0),!0}}}_forEachCell(s,u,m,y,x,T,S,A){const D=this._convertToXCellCoord(s),R=this._convertToYCellCoord(u),B=this._convertToXCellCoord(m),W=this._convertToYCellCoord(y);for(let Z=D;Z<=B;Z++)for(let Y=R;Y<=W;Y++)if(x.call(this,s,u,m,y,this.xCellCount*Y+Z,T,S,A))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,m,y,x,T){const S=y-s,A=x-u,D=m+T;return D*D>S*S+A*A}_circleAndRectCollide(s,u,m,y,x,T,S){const A=(T-y)/2,D=Math.abs(s-(y+A));if(D>A+m)return!1;const R=(S-x)/2,B=Math.abs(u-(x+R));if(B>R+m)return!1;if(D<=A||B<=R)return!0;const W=D-A,Z=B-R;return W*W+Z*Z<=m*m}}const Bo={unknown:0,flipRequired:1,flipNotRequired:2},rc=Math.tan(85*Math.PI/180);function Be(f,s,u,m,y,x,T){const S=a.create();if(u)if(x.name==="globe"){const A=a.calculateGlobeLabelMatrix(y,s);a.multiply(S,S,A)}else{const A=ze([],T);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],m||a.rotateZ(S,S,y.angle)}else a.multiply(S,y.labelPlaneMatrix,f);return S}function Fo(f,s,u,m,y,x,T){const S=Be(f,s,u,m,y,x,T);return x.name==="globe"&&u||(S[2]=S[6]=S[10]=S[14]=0),S}function Jn(f,s,u,m,y,x,T){if(u){if(x.name==="globe"){const S=Be(f,s,u,m,y,x,T);return a.invert(S,S),a.multiply(S,f,S),S}{const S=a.clone(f),A=a.identity([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],a.multiply(S,S,A),m||a.rotateZ(S,S,-y.angle),S}}return y.glCoordMatrix}function wr(f,s,u,m){const y=[f,s,u,1];u?a.transformMat4$1(y,y,m):Gt(y,y,m);const x=y[3];return y[0]/=x,y[1]/=x,y[2]/=x,y}function Am(f,s){return Math.min(.5+f/s*.5,1.5)}function fo(f,s){const u=f[0]/f[3],m=f[1]/f[3];return u>=-s[0]&&u<=s[0]&&m>=-s[1]&&m<=s[1]}function Td(f,s,u,m,y,x,T,S,A,D){const R=u.transform,B=m?f.textSizeData:f.iconSizeData,W=a.evaluateSizeForZoom(B,u.transform.zoom),Z=R.projection.name==="globe",Y=[256/u.width*2+1,256/u.height*2+1],K=m?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;K.clear();let Q=null;Z&&(Q=m?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);const F=f.lineVertexArray,H=m?f.text.placedSymbolArray:f.icon.placedSymbolArray,ie=u.transform.width/u.transform.height;let se,ge=!1;for(let ye=0;ye<H.length;ye++){const _e=H.get(ye),{numGlyphs:Ee,writingMode:be}=_e;if(be!==a.WritingMode.vertical||ge||se===a.WritingMode.horizontal||(ge=!0),se=be,(_e.hidden||be===a.WritingMode.vertical)&&!ge){$i(Ee,K);continue}ge=!1;const ke=new a.Point(_e.tileAnchorX,_e.tileAnchorY);let{x:Ke,y:Ce,z:Ue}=R.projection.projectTilePoint(ke.x,ke.y,D.canonical);if(A){const[At,mt,St]=A(ke);Ke+=At,Ce+=mt,Ue+=St}const Re=[Ke,Ce,Ue,1];if(a.transformMat4$1(Re,Re,s),!fo(Re,Y)){$i(Ee,K);continue}const Ze=Am(u.transform.cameraToCenterDistance,Re[3]),Pe=a.evaluateSizeForFeature(B,W,_e),je=T?Pe/Ze:Pe*Ze,Ye=wr(Ke,Ce,Ue,y);if(Ye[3]<=0){$i(Ee,K);continue}let We={};const et=T?null:A,xt=ht(_e,je,!1,S,s,y,x,f.glyphOffsetArray,F,K,Q,Ye,ke,We,ie,et,R.projection,D,T);ge=xt.useVertical,et&&xt.needsFlipping&&(We={}),(xt.notEnoughRoom||ge||xt.needsFlipping&&ht(_e,je,!0,S,s,y,x,f.glyphOffsetArray,F,K,Q,Ye,ke,We,ie,et,R.projection,D,T).notEnoughRoom)&&$i(Ee,K)}m?(f.text.dynamicLayoutVertexBuffer.updateData(K),Q&&f.text.globeExtVertexBuffer.updateData(Q)):(f.icon.dynamicLayoutVertexBuffer.updateData(K),Q&&f.icon.globeExtVertexBuffer.updateData(Q))}function Pm(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K){const{lineStartIndex:Q,glyphStartIndex:F,segment:H}=S,ie=F+S.numGlyphs,se=Q+S.lineLength,ge=s.getoffsetX(F),ye=s.getoffsetX(ie-1),_e=mi(f*ge,u,m,y,x,T,H,Q,se,A,D,R,B,W,!0,Z,Y,K);if(!_e)return null;const Ee=mi(f*ye,u,m,y,x,T,H,Q,se,A,D,R,B,W,!0,Z,Y,K);return Ee?{first:_e,last:Ee}:null}function ja(f,s,u,m){return f===a.WritingMode.horizontal&&Math.abs(m)>Math.abs(u)?{useVertical:!0}:f===a.WritingMode.vertical?m>0?{needsFlipping:!0}:null:s!==Bo.unknown&&function(y,x){return y===0||Math.abs(x/y)>rc}(u,m)?s===Bo.flipRequired?{needsFlipping:!0}:null:u<0?{needsFlipping:!0}:null}function ht(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K,Q,F,H){const ie=s/24,se=f.lineOffsetX*ie,ge=f.lineOffsetY*ie,{lineStartIndex:ye,glyphStartIndex:_e,numGlyphs:Ee,segment:be,writingMode:ke,flipState:Ke}=f,Ce=ye+f.lineLength,Ue=Re=>{if(R){const[Ye,We,et]=Re.up,xt=D.length;a.updateGlobeVertexNormal(R,xt+0,Ye,We,et),a.updateGlobeVertexNormal(R,xt+1,Ye,We,et),a.updateGlobeVertexNormal(R,xt+2,Ye,We,et),a.updateGlobeVertexNormal(R,xt+3,Ye,We,et)}const[Ze,Pe,je]=Re.point;a.addDynamicAttributes(D,Ze,Pe,je,Re.angle)};if(Ee>1){const Re=Pm(ie,S,se,ge,u,B,W,f,A,x,Z,K,!1,Q,F,H);if(!Re)return{notEnoughRoom:!0};if(m&&!u){let[Ze,Pe,je]=Re.first.point,[Ye,We,et]=Re.last.point;[Ze,Pe]=wr(Ze,Pe,je,T),[Ye,We]=wr(Ye,We,et,T);const xt=ja(ke,Ke,(Ye-Ze)*Y,We-Pe);if(f.flipState=xt&&xt.needsFlipping?Bo.flipRequired:Bo.flipNotRequired,xt)return xt}Ue(Re.first);for(let Ze=_e+1;Ze<_e+Ee-1;Ze++){const Pe=mi(ie*S.getoffsetX(Ze),se,ge,u,B,W,be,ye,Ce,A,x,Z,K,!1,!1,Q,F,H);if(!Pe)return D.length-=4*(Ze-_e),{notEnoughRoom:!0};Ue(Pe)}Ue(Re.last)}else{if(m&&!u){const Ze=wr(W.x,W.y,0,y),Pe=ye+be+1,je=new a.Point(A.getx(Pe),A.gety(Pe)),Ye=wr(je.x,je.y,0,y),We=Ye[3]>0?Ye:$t(W,je,Ze,1,y,void 0,Q,F.canonical),et=ja(ke,Ke,(We[0]-Ze[0])*Y,We[1]-Ze[1]);if(f.flipState=et&&et.needsFlipping?Bo.flipRequired:Bo.flipNotRequired,et)return et}const Re=mi(ie*S.getoffsetX(_e),se,ge,u,B,W,be,ye,Ce,A,x,Z,K,!1,!1,Q,F,H);if(!Re)return{notEnoughRoom:!0};Ue(Re)}return{}}function Ht(f,s,u,m,y){const{x,y:T,z:S}=m.projectTilePoint(f.x,f.y,s);if(!y)return wr(x,T,S,u);const[A,D,R]=y(f);return wr(x+A,T+D,S+R,u)}function $t(f,s,u,m,y,x,T,S){const A=Ht(f.sub(s)._unit()._add(f),S,y,T,x);return a.sub(A,u,A),a.normalize(A,A),a.scaleAndAdd(A,u,A,m)}function mi(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K,Q,F){const H=m?f-s:f+s;let ie=H>0?1:-1,se=0;m&&(ie*=-1,se=Math.PI),ie<0&&(se+=Math.PI);let ge=S+T+(ie>0?0:1)|0,ye=y,_e=y,Ee=0,be=0;const ke=Math.abs(H),Ke=[],Ce=[];let Ue=x,Re=Ue;const Ze=()=>$t(Re,Ue,_e,ke-Ee+1,R,W,K,Q.canonical);for(;Ee+be<=ke;){if(ge+=ie,ge<S||ge>=A)return null;if(_e=ye,Re=Ue,Ke.push(_e),Z&&Ce.push(Re),Ue=new a.Point(D.getx(ge),D.gety(ge)),ye=B[ge],!ye){const St=Ht(Ue,Q.canonical,R,K,W);ye=St[3]>0?B[ge]=St:Ze()}Ee+=be,be=a.distance(_e,ye)}Y&&W&&(B[ge]&&(ye=Ze(),be=a.distance(_e,ye)),B[ge]=ye);const Pe=(ke-Ee)/be,je=Ue.sub(Re)._mult(Pe)._add(Re),Ye=a.sub([],ye,_e),We=a.scaleAndAdd([],_e,Ye,Pe);let et=[0,0,1],xt=Ye[0],At=Ye[1];if(F&&(et=K.upVector(Q.canonical,je.x,je.y),et[0]!==0||et[1]!==0||et[2]!==1)){const St=[et[2],0,-et[0]],Wt=a.cross([],et,St);a.normalize(St,St),a.normalize(Wt,Wt),xt=a.dot(Ye,St),At=a.dot(Ye,Wt)}if(u){const St=a.cross([],et,Ye);a.normalize(St,St),a.scaleAndAdd(We,We,St,u*ie)}const mt=se+Math.atan2(At,xt);return Ke.push(We),Z&&Ce.push(je),{point:We,angle:mt,path:Ke,tilePath:Ce,up:et}}function $i(f,s){const u=s.length,m=u+4*f;s.resize(m),s.float32.fill(-1/0,4*u,4*m)}function Gt(f,s,u){const m=s[0],y=s[1];return f[0]=u[0]*m+u[4]*y+u[12],f[1]=u[1]*m+u[5]*y+u[13],f[3]=u[3]*m+u[7]*y+u[15],f}const gi=100;class ic{constructor(s,u,m=new Hs(s.width+200,s.height+200,25),y=new Hs(s.width+200,s.height+200,25)){this.transform=s,this.grid=m,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+gi,this.screenBottomBoundary=s.height+gi,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=u}placeCollisionBox(s,u,m,y,x,T,S,A){let D=m.projectedAnchorX,R=m.projectedAnchorY,B=m.projectedAnchorZ;const W=m.elevation,Z=m.tileID,Y=s.getProjection();if(W&&Z){const[ye,_e,Ee]=Y.upVector(Z.canonical,m.tileAnchorX,m.tileAnchorY),be=Y.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=ye*W*be,R+=_e*W*be,B+=Ee*W*be}const K=this.projectAndGetPerspectiveRatio(S,D,R,B,m.tileID,Y.name==="globe"||!!W||this.transform.pitch>0,Y),Q=T*K.perspectiveRatio,F=(m.x1*u+y.x-m.padding)*Q+K.point.x,H=(m.y1*u+y.y-m.padding)*Q+K.point.y,ie=(m.x2*u+y.x+m.padding)*Q+K.point.x,se=(m.y2*u+y.y+m.padding)*Q+K.point.y,ge=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(F,H,ie,se)||!x&&this.grid.hitTest(F,H,ie,se,A)||ge?{box:[],offscreen:!1,occluded:K.occluded}:{box:[F,H,ie,se],offscreen:this.isOffscreen(F,H,ie,se),occluded:!1}}placeCollisionCircles(s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K){const Q=[],F=this.transform.elevation,H=s.getProjection(),ie=F?F.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,H):null,se=new a.Point(m.tileAnchorX,m.tileAnchorY);let{x:ge,y:ye,z:_e}=H.projectTilePoint(se.x,se.y,K.canonical);if(ie){const[je,Ye,We]=ie(se);ge+=je,ye+=Ye,_e+=We}const Ee=H.name==="globe",be=this.projectAndGetPerspectiveRatio(S,ge,ye,_e,K,Ee||!!F||this.transform.pitch>0,H),{perspectiveRatio:ke}=be,Ke=(B?T/ke:T*ke)/a.ONE_EM,Ce=wr(ge,ye,_e,A),Ue=be.signedDistanceFromCamera>0?Pm(Ke,x,m.lineOffsetX*Ke,m.lineOffsetY*Ke,!1,Ce,se,m,y,A,{},F&&!B?ie:null,B&&!!F,H,K,B):null;let Re=!1,Ze=!1,Pe=!0;if(Ue&&!be.occluded){const je=.5*Z*ke+Y,Ye=new a.Point(-100,-100),We=new a.Point(this.screenRightBoundary,this.screenBottomBoundary),et=new Ed,{first:xt,last:At}=Ue,mt=xt.path.length;let St=[];for(let yt=mt-1;yt>=1;yt--)St.push(xt.path[yt]);for(let yt=1;yt<At.path.length;yt++)St.push(At.path[yt]);const Wt=2.5*je;D&&(St=St.map(([yt,ln,fn],pn)=>(ie&&!Ee&&(fn=ie(pn<mt-1?xt.tilePath[mt-1-pn]:At.tilePath[pn-mt+2])[2]),wr(yt,ln,fn,D))),St.some(yt=>yt[3]<=0)&&(St=[]));let Nt=[];if(St.length>0){let yt=1/0,ln=-1/0,fn=1/0,pn=-1/0;for(const mn of St)yt=Math.min(yt,mn[0]),fn=Math.min(fn,mn[1]),ln=Math.max(ln,mn[0]),pn=Math.max(pn,mn[1]);ln>=Ye.x&&yt<=We.x&&pn>=Ye.y&&fn<=We.y&&(Nt=[St.map(mn=>new a.Point(mn[0],mn[1]))],(yt<Ye.x||ln>We.x||fn<Ye.y||pn>We.y)&&(Nt=a.clipLine(Nt,Ye.x,Ye.y,We.x,We.y)))}for(const yt of Nt){et.reset(yt,.25*je);let ln=0;ln=et.length<=.5*je?1:Math.ceil(et.paddedLength/Wt)+1;for(let fn=0;fn<ln;fn++){const pn=fn/Math.max(ln-1,1),mn=et.lerp(pn),Fr=mn.x+gi,Er=mn.y+gi;Q.push(Fr,Er,je,0);const Ai=Fr-je,_o=Er-je,Rn=Fr+je,gn=Er+je;if(Pe=Pe&&this.isOffscreen(Ai,_o,Rn,gn),Ze=Ze||this.isInsideGrid(Ai,_o,Rn,gn),!u&&this.grid.hitTestCircle(Fr,Er,je,W)&&(Re=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Re,occluded:!1}}}}return{circles:!R&&Re||!Ze?[]:Q,offscreen:Pe,collisionDetected:Re,occluded:be.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let m=1/0,y=1/0,x=-1/0,T=-1/0;for(const R of s){const B=new a.Point(R.x+gi,R.y+gi);m=Math.min(m,B.x),y=Math.min(y,B.y),x=Math.max(x,B.x),T=Math.max(T,B.y),u.push(B)}const S=this.grid.query(m,y,x,T).concat(this.ignoredGrid.query(m,y,x,T)),A={},D={};for(const R of S){const B=R.key;if(A[B.bucketInstanceId]===void 0&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const W=[new a.Point(R.x1,R.y1),new a.Point(R.x2,R.y1),new a.Point(R.x2,R.y2),new a.Point(R.x1,R.y2)];a.polygonIntersectsPolygon(u,W)&&(A[B.bucketInstanceId][B.featureIndex]=!0,D[B.bucketInstanceId]===void 0&&(D[B.bucketInstanceId]=[]),D[B.bucketInstanceId].push(B.featureIndex))}return D}insertCollisionBox(s,u,m,y,x){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:x},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,m,y,x){const T=u?this.ignoredGrid:this.grid,S={bucketInstanceId:m,featureIndex:y,collisionGroupID:x};for(let A=0;A<s.length;A+=4)T.insertCircle(S,s[A],s[A+1],s[A+2])}projectAndGetPerspectiveRatio(s,u,m,y,x,T,S){const A=[u,m,y,1];let D=!1;y||this.transform.pitch>0?(a.transformMat4$1(A,A,s),this.fogState&&x&&S.name!=="globe"&&(D=function(W,Z,Y,K,Q,F){const H=F.calculateFogTileMatrix(Q),ie=[Z,Y,K];return a.transformMat4(ie,ie,H),Fn(W,ie,F.pitch,F._fov)}(this.fogState,u,m,y,x.toUnwrapped(),this.transform)>.9)):Gt(A,A,s);const R=A[3];return{point:new a.Point((A[0]/R+1)/2*this.transform.width+gi,(-A[1]/R+1)/2*this.transform.height+gi),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/R*.5,1.5),signedDistanceFromCamera:R,occluded:T&&A[2]>R||D}}isOffscreen(s,u,m,y){return m<gi||s>=this.screenRightBoundary||y<gi||u>this.screenBottomBoundary}isInsideGrid(s,u,m,y){return m>=0&&s<this.gridRightBoundary&&y>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=a.identity([]);return a.translate(s,s,[-100,-100,0]),s}}function Zs(f,s,u){const m=s.createTileMatrix(f,f.worldSize,u.toUnwrapped());return a.multiply(new Float32Array(16),f.projMatrix,m)}function Ti(f,s,u){if(s.projection.name===u.projection.name)return f.projMatrix;const m=u.clone();return m.setProjection(s.projection),Zs(m,s.getProjection(),f)}function Mn(f,s,u){return s.name===u.projection.name?f.projMatrix:Zs(u,s,f)}class km{constructor(s,u,m,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):y&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class No{constructor(s,u,m,y,x,T=!1){this.text=new km(s?s.text:null,u,m,x),this.icon=new km(s?s.icon:null,u,y,x),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oc{constructor(s,u,m,y=!1){this.text=s,this.icon=u,this.skipFade=m,this.clipped=y}}class sc{constructor(){this.invProjMatrix=a.create(),this.viewportMatrix=a.create(),this.circles=[]}}class Sd{constructor(s,u,m,y,x){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=m,this.bucketIndex=y,this.tileID=x}}class Mm{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:m=>m.collisionGroupID===u}}return this.collisionGroups[s]}}function ac(f,s,u,m,y){const{horizontalAlign:x,verticalAlign:T}=a.getAnchorAlignment(f),S=-(x-.5)*s,A=-(T-.5)*u,D=a.evaluateVariableOffset(f,m);return new a.Point(S+D[0]*y,A+D[1]*y)}function lc(f,s,u,m,y){const x=new a.Point(f,s);return u&&x._rotate(m?y:-y),x}class vu{constructor(s,u,m,y,x){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new ic(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Mm(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,m,y){const x=m.getBucket(u),T=m.latestFeatureIndex;if(!x||!T||u.id!==x.layerIds[0])return;const S=x.layers[0].layout,A=m.collisionBoxArray,D=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),R=m.tileSize/a.EXTENT,B=m.tileID.toUnwrapped();this.transform.setProjection(x.projection);const W=(Z=m.tileID,Y=x.getProjection(),K=this.transform,Y.name===this.projection?K.calculateProjMatrix(Z.toUnwrapped()):Zs(K,Y,Z));var Z,Y,K;const Q=S.get("text-pitch-alignment")==="map",F=S.get("text-rotation-alignment")==="map";u.compileFilter();const H=u.dynamicFilter(),ie=u.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(m),ge=Fo(W,m.tileID.canonical,Q,F,this.transform,x.getProjection(),se);let ye=null;if(Q){const be=Jn(W,m.tileID.canonical,Q,F,this.transform,x.getProjection(),se);ye=a.multiply([],this.transform.labelPlaneMatrix,be)}let _e=null;H&&m.latestFeatureIndex&&(_e={unwrappedTileID:B,dynamicFilter:H,dynamicFilterNeedsFeature:ie,featureIndex:m.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Sd(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,m.tileID);const Ee={bucket:x,layout:S,posMatrix:W,textLabelPlaneMatrix:ge,labelToScreenMatrix:ye,clippingData:_e,scale:D,textPixelRatio:R,holdingForFade:m.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:a.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(y)for(const be of x.sortKeyRanges){const{sortKey:ke,symbolInstanceStart:Ke,symbolInstanceEnd:Ce}=be;s.push({sortKey:ke,symbolInstanceStart:Ke,symbolInstanceEnd:Ce,parameters:Ee})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Ee})}attemptAnchorPlacement(s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K,Q,F,H){const{textOffset0:ie,textOffset1:se,crossTileID:ge}=W,ye=[ie,se],_e=ac(s,m,y,ye,x),Ee=this.collisionIndex.placeCollisionBox(Y,x,u,lc(_e.x,_e.y,T,S,this.transform.angle),B,A,D,R.predicate);if(Q){const be=Y.getSymbolInstanceIconSize(H,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,be,Q,lc(_e.x,_e.y,T,S,this.transform.angle),B,A,D,R.predicate).box.length===0)return}if(Ee.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(be=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:ye,width:m,height:y,anchor:s,textScale:x,prevAnchor:be},this.markUsedJustification(Y,s,W,K),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,K,W),this.placedOrientations[ge]=K),{shift:_e,placedGlyphBoxes:Ee}}}placeLayerBucketPart(s,u,m,y){const{bucket:x,layout:T,posMatrix:S,textLabelPlaneMatrix:A,labelToScreenMatrix:D,clippingData:R,textPixelRatio:B,holdingForFade:W,collisionBoxArray:Z,partiallyEvaluatedTextSize:Y,partiallyEvaluatedIconSize:K,collisionGroup:Q}=s.parameters,F=T.get("text-optional"),H=T.get("icon-optional"),ie=T.get("text-allow-overlap"),se=T.get("icon-allow-overlap"),ge=T.get("text-rotation-alignment")==="map",ye=T.get("text-pitch-alignment")==="map",_e=T.get("icon-text-fit")!=="none",Ee=T.get("symbol-z-order")==="viewport-y";this.transform.setProjection(x.projection);let be=ie&&(se||!x.hasIconData()||H),ke=se&&(ie||!x.hasTextData()||F);!x.collisionArrays&&Z&&x.deserializeCollisionBoxes(Z),m&&y&&x.updateCollisionDebugBuffers(this.transform.zoom,Z);const Ke=(Ce,Ue,Re)=>{const{crossTileID:Ze,numVerticalGlyphVertices:Pe}=Ce;if(R){const Rn={zoom:this.transform.zoom,pitch:this.transform.pitch};let gn=null;if(R.dynamicFilterNeedsFeature){const tn=this.retainedQueryData[x.bucketInstanceId];gn=R.featureIndex.loadFeature({featureIndex:Ce.featureIndex,bucketIndex:tn.bucketIndex,sourceLayerIndex:tn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(Rn,gn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new a.Point(Ce.tileAnchorX,Ce.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[Ze]=new oc(!1,!1,!1,!0),void u.add(Ze)}if(u.has(Ze))return;if(W)return void(this.placements[Ze]=new oc(!1,!1,!1));let je=!1,Ye=!1,We=!0,et=!1,xt=!1,At=null,mt={box:null,offscreen:null,occluded:null},St={box:null,offscreen:null,occluded:null},Wt=null,Nt=null,yt=null,ln=0,fn=0,pn=0;Re.textFeatureIndex?ln=Re.textFeatureIndex:Ce.useRuntimeCollisionCircles&&(ln=Ce.featureIndex),Re.verticalTextFeatureIndex&&(fn=Re.verticalTextFeatureIndex);const mn=Rn=>{Rn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const gn=this.transform.elevation;(gn||Rn.elevation)&&(Rn.elevation=gn?gn.getAtTileOffset(Rn.tileID,Rn.tileAnchorX,Rn.tileAnchorY):0)},Fr=Re.textBox;if(Fr){mn(Fr);const Rn=tn=>{let Yn=a.WritingMode.horizontal;if(x.allowVerticalPlacement&&!tn&&this.prevPlacement){const Zr=this.prevPlacement.placedOrientations[Ze];Zr&&(this.placedOrientations[Ze]=Zr,Yn=Zr,this.markUsedOrientation(x,Yn,Ce))}return Yn},gn=(tn,Yn)=>{if(x.allowVerticalPlacement&&Pe>0&&Re.verticalTextBox){for(const Zr of x.writingModes)if(Zr===a.WritingMode.vertical?(mt=Yn(),St=mt):mt=tn(),mt&&mt.box&&mt.box.length)break}else mt=tn()};if(T.get("text-variable-anchor")){let tn=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ze]){const Pn=this.prevPlacement.variableOffsets[Ze];tn.indexOf(Pn.anchor)>0&&(tn=tn.filter(ti=>ti!==Pn.anchor),tn.unshift(Pn.anchor))}const Yn=(Pn,ti,qu)=>{const na=x.getSymbolInstanceTextSize(Y,Ce,this.transform.zoom,Ue),Ac=(Pn.x2-Pn.x1)*na+2*Pn.padding,qo=(Pn.y2-Pn.y1)*na+2*Pn.padding,ys=_e&&!se?ti:null;ys&&mn(ys);let ra={box:[],offscreen:!1,occluded:!1};const Hu=ie?2*tn.length:tn.length;for(let Pc=0;Pc<Hu;++Pc){const gf=this.attemptAnchorPlacement(tn[Pc%tn.length],Pn,Ac,qo,na,ge,ye,B,S,Q,Pc>=tn.length,Ce,Ue,x,qu,ys,Y,K);if(gf&&(ra=gf.placedGlyphBoxes,ra&&ra.box&&ra.box.length)){je=!0,At=gf.shift;break}}return ra};gn(()=>Yn(Fr,Re.iconBox,a.WritingMode.horizontal),()=>{const Pn=Re.verticalTextBox;return Pn&&mn(Pn),x.allowVerticalPlacement&&!(mt&&mt.box&&mt.box.length)&&Pe>0&&Pn?Yn(Pn,Re.verticalIconBox,a.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),mt&&(je=mt.box,We=mt.offscreen,et=mt.occluded);const Zr=Rn(!(!mt||!mt.box));if(!je&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[Ze];Pn&&(this.variableOffsets[Ze]=Pn,this.markUsedJustification(x,Pn.anchor,Ce,Zr))}}else{const tn=(Yn,Zr)=>{const Pn=x.getSymbolInstanceTextSize(Y,Ce,this.transform.zoom,Ue),ti=this.collisionIndex.placeCollisionBox(x,Pn,Yn,new a.Point(0,0),ie,B,S,Q.predicate);return ti&&ti.box&&ti.box.length&&(this.markUsedOrientation(x,Zr,Ce),this.placedOrientations[Ze]=Zr),ti};gn(()=>tn(Fr,a.WritingMode.horizontal),()=>{const Yn=Re.verticalTextBox;return x.allowVerticalPlacement&&Pe>0&&Yn?(mn(Yn),tn(Yn,a.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Rn(!!(mt&&mt.box&&mt.box.length))}}if(Wt=mt,je=Wt&&Wt.box&&Wt.box.length>0,We=Wt&&Wt.offscreen,et=Wt&&Wt.occluded,Ce.useRuntimeCollisionCircles){const Rn=x.text.placedSymbolArray.get(Ce.centerJustifiedTextSymbolIndex>=0?Ce.centerJustifiedTextSymbolIndex:Ce.verticalPlacedTextSymbolIndex),gn=a.evaluateSizeForFeature(x.textSizeData,Y,Rn),tn=T.get("text-padding");Nt=this.collisionIndex.placeCollisionCircles(x,ie,Rn,x.lineVertexArray,x.glyphOffsetArray,gn,S,A,D,m,ye,Q.predicate,Ce.collisionCircleDiameter*gn/a.ONE_EM,tn,this.retainedQueryData[x.bucketInstanceId].tileID),je=ie||Nt.circles.length>0&&!Nt.collisionDetected,We=We&&Nt.offscreen,et=Nt.occluded}if(Re.iconFeatureIndex&&(pn=Re.iconFeatureIndex),Re.iconBox){const Rn=gn=>{mn(gn);const tn=_e&&At?lc(At.x,At.y,ge,ye,this.transform.angle):new a.Point(0,0),Yn=x.getSymbolInstanceIconSize(K,this.transform.zoom,Ce.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Yn,gn,tn,se,B,S,Q.predicate)};St&&St.box&&St.box.length&&Re.verticalIconBox?(yt=Rn(Re.verticalIconBox),Ye=yt.box.length>0):(yt=Rn(Re.iconBox),Ye=yt.box.length>0),We=We&&yt.offscreen,xt=yt.occluded}const Er=F||Ce.numHorizontalGlyphVertices===0&&Pe===0,Ai=H||Ce.numIconVertices===0;if(Er||Ai?Ai?Er||(Ye=Ye&&je):je=Ye&&je:Ye=je=Ye&&je,je&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,T.get("text-ignore-placement"),x.bucketInstanceId,St&&St.box&&fn?fn:ln,Q.ID),Ye&&yt&&this.collisionIndex.insertCollisionBox(yt.box,T.get("icon-ignore-placement"),x.bucketInstanceId,pn,Q.ID),Nt&&(je&&this.collisionIndex.insertCollisionCircles(Nt.circles,T.get("text-ignore-placement"),x.bucketInstanceId,ln,Q.ID),m)){const Rn=x.bucketInstanceId;let gn=this.collisionCircleArrays[Rn];gn===void 0&&(gn=this.collisionCircleArrays[Rn]=new sc);for(let tn=0;tn<Nt.circles.length;tn+=4)gn.circles.push(Nt.circles[tn+0]),gn.circles.push(Nt.circles[tn+1]),gn.circles.push(Nt.circles[tn+2]),gn.circles.push(Nt.collisionDetected?1:0)}const _o=x.projection.name!=="globe";be=be&&(_o||!et),ke=ke&&(_o||!xt),this.placements[Ze]=new oc(je||be,Ye||ke,We||x.justReloaded),u.add(Ze)};if(Ee){const Ce=x.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Ce.length-1;Ue>=0;--Ue){const Re=Ce[Ue];Ke(x.symbolInstances.get(Re),Re,x.collisionArrays[Re])}}else for(let Ce=s.symbolInstanceStart;Ce<s.symbolInstanceEnd;Ce++)Ke(x.symbolInstances.get(Ce),Ce,x.collisionArrays[Ce]);if(m&&x.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[x.bucketInstanceId];a.invert(Ce.invProjMatrix,S),Ce.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(s,u,m,y){const{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:D}=m,R=a.getAnchorJustification(u),B=y===a.WritingMode.vertical?A:R==="left"?x:R==="center"?T:R==="right"?S:-1;x>=0&&(s.text.placedSymbolArray.get(x).crossTileID=B>=0&&x!==B?0:D),T>=0&&(s.text.placedSymbolArray.get(T).crossTileID=B>=0&&T!==B?0:D),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=B>=0&&S!==B?0:D),A>=0&&(s.text.placedSymbolArray.get(A).crossTileID=B>=0&&A!==B?0:D)}markUsedOrientation(s,u,m){const y=u===a.WritingMode.horizontal||u===a.WritingMode.horizontalOnly?u:0,x=u===a.WritingMode.vertical?u:0,{leftJustifiedTextSymbolIndex:T,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:D}=m,R=s.text.placedSymbolArray;T>=0&&(R.get(T).placedOrientation=y),S>=0&&(R.get(S).placedOrientation=y),A>=0&&(R.get(A).placedOrientation=y),D>=0&&(R.get(D).placedOrientation=x)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let m=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const y=u?u.symbolFadeChange(s):1,x=u?u.opacities:{},T=u?u.variableOffsets:{},S=u?u.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],R=x[A];R?(this.opacities[A]=new No(R,y,D.text,D.icon,null,D.clipped),m=m||D.text!==R.text.placed||D.icon!==R.icon.placed):(this.opacities[A]=new No(null,y,D.text,D.icon,D.skipFade,D.clipped),m=m||D.text||D.icon)}for(const A in x){const D=x[A];if(!this.opacities[A]){const R=new No(D,y,!1,!1);R.isHidden()||(this.opacities[A]=R,m=m||D.text.placed||D.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){const m=new Set;for(const y of u){const x=y.getBucket(s);x&&y.latestFeatureIndex&&s.id===x.layerIds[0]&&this.updateBucketOpacities(x,m,y.collisionBoxArray)}}updateBucketOpacities(s,u,m){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,x=!!s.layers[0].dynamicFilter(),T=new No(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),D=y.get("text-variable-anchor"),R=y.get("text-rotation-alignment")==="map",B=y.get("text-pitch-alignment")==="map",W=y.get("icon-text-fit")!=="none",Z=new No(null,0,S&&(A||!s.hasIconData()||y.get("icon-optional")),A&&(S||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const Y=(Q,F,H)=>{for(let ie=0;ie<F/4;ie++)Q.opacityVertexArray.emplaceBack(H)};let K=0;for(let Q=0;Q<s.symbolInstances.length;Q++){const F=s.symbolInstances.get(Q),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:ie,crossTileID:se,numIconVertices:ge}=F,ye=u.has(se);let _e=this.opacities[se];ye?_e=T:_e||(_e=Z,this.opacities[se]=_e),u.add(se);const Ee=H>0||ie>0,be=ge>0,ke=this.placedOrientations[se],Ke=ke===a.WritingMode.vertical,Ce=ke===a.WritingMode.horizontal||ke===a.WritingMode.horizontalOnly;if(!Ee&&!be||_e.isHidden()||K++,Ee){const Ue=cc(_e.text);Y(s.text,H,Ke?Nn:Ue),Y(s.text,ie,Ce?Nn:Ue);const Re=_e.text.isHidden(),{leftJustifiedTextSymbolIndex:Ze,centerJustifiedTextSymbolIndex:Pe,rightJustifiedTextSymbolIndex:je,verticalPlacedTextSymbolIndex:Ye}=F,We=s.text.placedSymbolArray,et=Re||Ke?1:0;Ze>=0&&(We.get(Ze).hidden=et),Pe>=0&&(We.get(Pe).hidden=et),je>=0&&(We.get(je).hidden=et),Ye>=0&&(We.get(Ye).hidden=Re||Ce?1:0);const xt=this.variableOffsets[se];xt&&this.markUsedJustification(s,xt.anchor,F,ke);const At=this.placedOrientations[se];At&&(this.markUsedJustification(s,"left",F,At),this.markUsedOrientation(s,At,F))}if(be){const Ue=cc(_e.icon),{placedIconSymbolIndex:Re,verticalPlacedIconSymbolIndex:Ze}=F,Pe=s.icon.placedSymbolArray,je=_e.icon.isHidden()?1:0;Re>=0&&(Y(s.icon,ge,Ke?Nn:Ue),Pe.get(Re).hidden=je),Ze>=0&&(Y(s.icon,F.numVerticalIconVertices,Ce?Nn:Ue),Pe.get(Ze).hidden=je)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Ue=s.collisionArrays[Q];if(Ue){let Re=new a.Point(0,0),Ze=!0;if(Ue.textBox||Ue.verticalTextBox){if(D){const je=this.variableOffsets[se];je?(Re=ac(je.anchor,je.width,je.height,je.textOffset,je.textScale),R&&Re._rotate(B?this.transform.angle:-this.transform.angle)):Ze=!1}x&&(Ze=!_e.clipped),Ue.textBox&&Ua(s.textCollisionBox.collisionVertexArray,_e.text.placed,!Ze||Ke,Re.x,Re.y),Ue.verticalTextBox&&Ua(s.textCollisionBox.collisionVertexArray,_e.text.placed,!Ze||Ce,Re.x,Re.y)}const Pe=Ze&&!!(!Ce&&Ue.verticalIconBox);Ue.iconBox&&Ua(s.iconCollisionBox.collisionVertexArray,_e.icon.placed,Pe,W?Re.x:0,W?Re.y:0),Ue.verticalIconBox&&Ua(s.iconCollisionBox.collisionVertexArray,_e.icon.placed,!Pe,W?Re.x:0,W?Re.y:0)}}}if(s.fullyClipped=K===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Q.invProjMatrix,s.placementViewportMatrix=Q.viewportMatrix,s.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const m=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function Ua(f,s,u,m,y){f.emplaceBack(s?1:0,u?1:0,m||0,y||0),f.emplaceBack(s?1:0,u?1:0,m||0,y||0),f.emplaceBack(s?1:0,u?1:0,m||0,y||0),f.emplaceBack(s?1:0,u?1:0,m||0,y||0)}const Qr=Math.pow(2,25),$n=Math.pow(2,24),Id=Math.pow(2,17),Cd=Math.pow(2,16),ei=Math.pow(2,9),Si=Math.pow(2,8),Rm=Math.pow(2,1);function cc(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const s=f.placed?1:0,u=Math.floor(127*f.opacity);return u*Qr+s*$n+u*Id+s*Cd+u*ei+s*Si+u*Rm+s}const Nn=0;class uc{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,u,m,y,x){const T=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(T,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((S,A)=>S.sortKey-A.sortKey));this._currentPartIndex<T.length;){const S=T[this._currentPartIndex];if(u.placeLayerBucketPart(S,this._seenCrossTileIDs,m,S.symbolInstanceStart===0),this._currentPartIndex++,x())return!0}return!1}}class Ad{constructor(s,u,m,y,x,T,S,A){this.placement=new vu(s,x,T,S,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,u,m){const y=a.exported.now(),x=()=>{const T=a.exported.now()-y;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=u[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new uc(T)),this._inProgressLayer.continuePlacement(m[T.source],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Xs=512/a.EXTENT/2;class Pr{constructor(s,u,m){this.tileID=s,this.bucketInstanceId=m,this.index=new a.KDBush(u.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=s.canonical.x*a.EXTENT,x=s.canonical.y*a.EXTENT;for(let T=0;T<u.length;T++){const{key:S,crossTileID:A,tileAnchorX:D,tileAnchorY:R}=u.get(T),B=Math.floor((y+D)*Xs),W=Math.floor((x+R)*Xs);this.index.add(B,W),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(s,u,m){const y=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),x=Xs/Math.pow(2,u.canonical.z-this.tileID.canonical.z),T=u.canonical.x*a.EXTENT,S=u.canonical.y*a.EXTENT;for(let A=0;A<s.length;A++){const D=s.get(A);if(D.crossTileID)continue;const{key:R,tileAnchorX:B,tileAnchorY:W}=D,Z=Math.floor((T+B)*x),Y=Math.floor((S+W)*x),K=this.index.range(Z-y,Y-y,Z+y,Y+y);for(const Q of K){const F=this.crossTileIDs[Q];if(this.keys[Q]===R&&!m.has(F)){m.add(F),D.crossTileID=F;break}}}}}class Pd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class kd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const m in this.indexes){const y=this.indexes[m],x={};for(const T in y){const S=y[T];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+u),x[S.tileID.key]=S}this.indexes[m]=x}this.lng=s}addBucket(s,u,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let x=0;x<u.symbolInstances.length;x++)u.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const y=this.usedCrossTileIDs[s.overscaledZ];for(const x in this.indexes){const T=this.indexes[x];if(Number(x)>s.overscaledZ)for(const S in T){const A=T[S];A.tileID.isChildOf(s)&&A.findMatches(u.symbolInstances,s,y)}else{const S=T[s.scaledTo(Number(x)).key];S&&S.findMatches(u.symbolInstances,s,y)}}for(let x=0;x<u.symbolInstances.length;x++){const T=u.symbolInstances.get(x);T.crossTileID||(T.crossTileID=m.generate(),y.add(T.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Pr(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const m of u.crossTileIDs)this.usedCrossTileIDs[s].delete(m)}removeStaleBuckets(s){let u=!1;for(const m in this.indexes){const y=this.indexes[m];for(const x in y)s[y[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,y[x]),delete y[x],u=!0)}return u}}class jo{constructor(){this.layerIndexes={},this.crossTileIDs=new Pd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,m,y){let x=this.layerIndexes[s.id];x===void 0&&(x=this.layerIndexes[s.id]=new kd);let T=!1;const S={};y.name!=="globe"&&x.handleWrapJump(m);for(const A of u){const D=A.getBucket(s);D&&s.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(A.tileID,D,this.crossTileIDs)&&(T=!0),S[D.bucketInstanceId]=!0)}return x.removeStaleBuckets(S)&&(T=!0),T}pruneUnusedLayers(s){const u={};s.forEach(m=>{u[m]=!0});for(const m in this.layerIndexes)u[m]||delete this.layerIndexes[m]}}const gs=(f,s)=>a.emitValidationErrors(f,s&&s.filter(u=>u.identifier!=="source.canvas")),xu=a.pick(on,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),wv=a.pick(on,["setCenter","setZoom","setBearing","setPitch"]),Md={version:8,layers:[],sources:{}},Va={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class po extends a.Evented{constructor(s,u={}){super(),this.map=s,this.dispatcher=new Rt(Na(),this),this.imageManager=new Ut,this.imageManager.setEventedParent(this),this.glyphManager=new a.GlyphManager(s._requestManager,u.localFontFamily?a.LocalGlyphMode.all:u.localIdeographFontFamily?a.LocalGlyphMode.ideographs:a.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.crossTileSymbolIndex=new jo,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",a.getReferrer());const m=this;this._rtlTextPluginCallback=po.registerForPluginStateChange(y=>{m.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(x,T)=>{if(a.triggerPluginCompletionEvent(x),T&&T.every(S=>S))for(const S in m._sourceCaches){const A=m._sourceCaches[S],D=A.getSource().type;D!=="vector"&&D!=="geojson"||A.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const x=this.getSource(y.sourceId);if(x&&x.vectorLayerIds)for(const T in this._layers){const S=this._layers[T];S.source===x.id&&this._validateLayer(S)}})}loadURL(s,u={}){this.fire(new a.Event("dataloading",{dataType:"style"}));const m=typeof u.validate=="boolean"?u.validate:!a.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,u.accessToken);const y=this.map._requestManager.transformRequest(s,a.ResourceType.Style);this._request=a.getJSON(y,(x,T)=>{this._request=null,x?this.fire(new a.ErrorEvent(x)):T&&this._load(T,m)})}loadJSON(s,u={}){this.fire(new a.Event("dataloading",{dataType:"style"})),this._request=a.exported.frame(()=>{this._request=null,this._load(s,u.validate!==!1)})}loadEmpty(){this.fire(new a.Event("dataloading",{dataType:"style"})),this._load(Md,!1)}_updateLayerCount(s,u){const m=u?1:-1;s.is3D()&&(this._num3DLayers+=m),s.type==="circle"&&(this._numCircleLayers+=m),s.type==="symbol"&&(this._numSymbolLayers+=m)}_load(s,u){if(u&&gs(this,a.validateStyle(s)))return;this._loaded=!0,this.stylesheet=a.clone$1(s),this._updateMapProjection();for(const y in s.sources)this.addSource(y,s.sources[y],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const m=Cm(this.stylesheet.layers);this._order=m.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of m){const x=a.createStyleLayer(y);x.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=x,this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Zt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new a.Event("data",{dataType:"style"})),this.fire(new a.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(u,m,y){let x,T,S;const A=a.exported.devicePixelRatio>1?"@2x":"";let D=a.getJSON(m.transformRequest(m.normalizeSpriteURL(u,A,".json"),a.ResourceType.SpriteJSON),(W,Z)=>{D=null,S||(S=W,x=Z,B())}),R=a.getImage(m.transformRequest(m.normalizeSpriteURL(u,A,".png"),a.ResourceType.SpriteImage),(W,Z)=>{R=null,S||(S=W,T=Z,B())});function B(){if(S)y(S);else if(x&&T){const W=a.exported.getImageData(T),Z={};for(const Y in x){const{width:K,height:Q,x:F,y:H,sdf:ie,pixelRatio:se,stretchX:ge,stretchY:ye,content:_e}=x[Y],Ee=new a.RGBAImage({width:K,height:Q});a.RGBAImage.copy(W,Ee,{x:F,y:H},{x:0,y:0},{width:K,height:Q}),Z[Y]={data:Ee,pixelRatio:se,sdf:ie,stretchX:ge,stretchY:ye,content:_e}}y(null,Z)}}return{cancel(){D&&(D.cancel(),D=null),R&&(R.cancel(),R=null)}}}(s,this.map._requestManager,(u,m)=>{if(this._spriteRequest=null,u)this.fire(new a.ErrorEvent(u));else if(m)for(const y in m)this.imageManager.addImage(y,m[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new a.Event("data",{dataType:"style"}))})}_validateLayer(s){const u=this.getSource(s.source);if(!u)return;const m=s.sourceLayer;m&&(u.type==="geojson"||u.vectorLayerIds&&u.vectorLayerIds.indexOf(m)===-1)&&this.fire(new a.ErrorEvent(new Error(`Source layer "${m}" does not exist on source "${u.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const u=[];for(const m of s){const y=this._layers[m];y.type!=="custom"&&u.push(y.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():Va[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const u=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(y.length||x.length)&&this._updateWorkerLayers(y,x);for(const T in this._updatedSources){const S=this._updatedSources[T];S==="reload"?this._reloadSource(T):S==="clear"&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const m={};for(const y in this._sourceCaches){const x=this._sourceCaches[y];m[y]=x.used,x.used=!1}for(const y of this._order){const x=this._layers[y];if(x.recalculate(s,this._availableImages),!x.isHidden(s.zoom)){const S=this._getLayerSourceCache(x);S&&(S.used=!0)}const T=this.map.painter;if(T){const S=x.getProgramIds();if(!S)continue;const A=x.getProgramConfiguration(s.zoom);for(const D of S)T.useProgram(D,A)}}for(const y in m){const x=this._sourceCaches[y];m[y]!==x.used&&x.getSource().fire(new a.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new a.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),gs(this,a.validateStyle(s)))return!1;(s=a.clone$1(s)).layers=Cm(s.layers);const u=function(y,x){if(!y)return[{command:on.setStyle,args:[x]}];let T=[];try{if(!k(y.version,x.version))return[{command:on.setStyle,args:[x]}];k(y.center,x.center)||T.push({command:on.setCenter,args:[x.center]}),k(y.zoom,x.zoom)||T.push({command:on.setZoom,args:[x.zoom]}),k(y.bearing,x.bearing)||T.push({command:on.setBearing,args:[x.bearing]}),k(y.pitch,x.pitch)||T.push({command:on.setPitch,args:[x.pitch]}),k(y.sprite,x.sprite)||T.push({command:on.setSprite,args:[x.sprite]}),k(y.glyphs,x.glyphs)||T.push({command:on.setGlyphs,args:[x.glyphs]}),k(y.transition,x.transition)||T.push({command:on.setTransition,args:[x.transition]}),k(y.light,x.light)||T.push({command:on.setLight,args:[x.light]}),k(y.fog,x.fog)||T.push({command:on.setFog,args:[x.fog]}),k(y.projection,x.projection)||T.push({command:on.setProjection,args:[x.projection]});const S={},A=[];(function(B,W,Z,Y){let K;for(K in W=W||{},B=B||{})B.hasOwnProperty(K)&&(W.hasOwnProperty(K)||nc(K,Z,Y));for(K in W){if(!W.hasOwnProperty(K))continue;const Q=W[K];B.hasOwnProperty(K)?k(B[K],Q)||(B[K].type==="geojson"&&Q.type==="geojson"&&yu(B,W,K)?Z.push({command:on.setGeoJSONSourceData,args:[K,Q.data]}):wd(K,W,Z,Y)):xd(K,W,Z)}})(y.sources,x.sources,A,S);const D=[];y.layers&&y.layers.forEach(B=>{B.source&&S[B.source]?T.push({command:on.removeLayer,args:[B.id]}):D.push(B)});let R=y.terrain;R&&S[R.source]&&(T.push({command:on.setTerrain,args:[void 0]}),R=void 0),T=T.concat(A),k(R,x.terrain)||T.push({command:on.setTerrain,args:[x.terrain]}),function(B,W,Z){W=W||[];const Y=(B=B||[]).map(Oo),K=W.map(Oo),Q=B.reduce(bd,{}),F=W.reduce(bd,{}),H=Y.slice(),ie=Object.create(null);let se,ge,ye,_e,Ee,be,ke;for(se=0,ge=0;se<Y.length;se++)ye=Y[se],F.hasOwnProperty(ye)?ge++:(Z.push({command:on.removeLayer,args:[ye]}),H.splice(H.indexOf(ye,ge),1));for(se=0,ge=0;se<K.length;se++)ye=K[K.length-1-se],H[H.length-1-se]!==ye&&(Q.hasOwnProperty(ye)?(Z.push({command:on.removeLayer,args:[ye]}),H.splice(H.lastIndexOf(ye,H.length-ge),1)):ge++,be=H[H.length-se],Z.push({command:on.addLayer,args:[F[ye],be]}),H.splice(H.length-se,0,ye),ie[ye]=!0);for(se=0;se<K.length;se++)if(ye=K[se],_e=Q[ye],Ee=F[ye],!ie[ye]&&!k(_e,Ee))if(k(_e.source,Ee.source)&&k(_e["source-layer"],Ee["source-layer"])&&k(_e.type,Ee.type)){for(ke in ho(_e.layout,Ee.layout,Z,ye,null,on.setLayoutProperty),ho(_e.paint,Ee.paint,Z,ye,null,on.setPaintProperty),k(_e.filter,Ee.filter)||Z.push({command:on.setFilter,args:[ye,Ee.filter]}),k(_e.minzoom,Ee.minzoom)&&k(_e.maxzoom,Ee.maxzoom)||Z.push({command:on.setLayerZoomRange,args:[ye,Ee.minzoom,Ee.maxzoom]}),_e)_e.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ho(_e[ke],Ee[ke],Z,ye,ke.slice(6),on.setPaintProperty):k(_e[ke],Ee[ke])||Z.push({command:on.setLayerProperty,args:[ye,ke,Ee[ke]]}));for(ke in Ee)Ee.hasOwnProperty(ke)&&!_e.hasOwnProperty(ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ho(_e[ke],Ee[ke],Z,ye,ke.slice(6),on.setPaintProperty):k(_e[ke],Ee[ke])||Z.push({command:on.setLayerProperty,args:[ye,ke,Ee[ke]]}))}else Z.push({command:on.removeLayer,args:[ye]}),be=H[H.lastIndexOf(ye)+1],Z.push({command:on.addLayer,args:[Ee,be]})}(D,x.layers,T)}catch(S){console.warn("Unable to compute style diff:",S),T=[{command:on.setStyle,args:[x]}]}return T}(this.serialize(),s).filter(y=>!(y.command in wv));if(u.length===0)return!1;const m=u.filter(y=>!(y.command in xu));if(m.length>0)throw new Error(`Unimplemented: ${m.map(y=>y.command).join(", ")}.`);return u.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,u){return this.getImage(s)?this.fire(new a.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,u),this._afterImageUpdated(s),this)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new a.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new a.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,u,m={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(a.validateSource,`sources.${s}`,u,null,m))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const y=Ft(s,u,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:y.serialize(),sourceId:s}));const x=T=>{const S=(T?"symbol:":"other:")+s,A=this._sourceCaches[S]=new a.SourceCache(S,y,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[s]=A,A.style=this,A.onAdd(this.map)};x(!1),u.type!=="vector"&&u.type!=="geojson"||x(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const u=this.getSource(s);if(!u)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new a.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const m=this._getSourceCaches(s);for(const y of m)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new a.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,u){this._checkLoaded(),this.getSource(s).setData(u),this._changed=!0}getSource(s){const u=this._getSourceCache(s);return u&&u.getSource()}_getSources(){const s=[];for(const u in this._otherSourceCaches){const m=this._getSourceCache(u);m&&s.push(m.getSource())}return s}addLayer(s,u,m={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let x;if(s.type==="custom"){if(gs(this,a.validateCustomStyleLayer(s)))return;x=a.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(y,s.source),s=a.clone$1(s),s=a.extend(s,{source:y})),this._validate(a.validateLayer,`layers.${y}`,s,{arrayIndex:-1},m))return;x=a.createStyleLayer(s),this._validateLayer(x),x.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const T=u?this._order.indexOf(u):this._order.length;if(u&&T===-1)return void this.fire(new a.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(T,0,y),this._layerOrderChanged=!0,this._layers[y]=x;const S=this._getLayerSourceCache(x);if(this._removedLayers[y]&&x.source&&S&&x.type!=="custom"){const A=this._removedLayers[y];delete this._removedLayers[y],A.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;const m=this._order.indexOf(s);this._order.splice(m,1);const y=u?this._order.indexOf(u):this._order.length;u&&y===-1?this.fire(new a.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const u=this._layers[s];if(!u)return void this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const u in this._layers)if(this._layers[u].type===s)return!0;return!1}setLayerZoomRange(s,u,m){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===u&&y.maxzoom===m||(u!=null&&(y.minzoom=u),m!=null&&(y.maxzoom=m),this._updateLayer(y)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,u,m={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!k(y.filter,u))return u==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.validateFilter,`layers.${y.id}.filter`,u,{layerType:y.type},m)||(y.filter=a.clone$1(u),this._updateLayer(y)))}else this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const u=this.getLayer(s);return u&&a.clone$1(u.filter)}setLayoutProperty(s,u,m,y={}){this._checkLoaded();const x=this.getLayer(s);x?k(x.getLayoutProperty(u),m)||(x.setLayoutProperty(u,m,y),this._updateLayer(x)):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,u){const m=this.getLayer(s);if(m)return m.getLayoutProperty(u);this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,u,m,y={}){this._checkLoaded();const x=this.getLayer(s);x?k(x.getPaintProperty(u),m)||(x.setPaintProperty(u,m,y)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new a.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,u){const m=this.getLayer(s);return m&&m.getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();const m=s.source,y=s.sourceLayer,x=this.getSource(m);if(!x)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const T=x.type;if(T==="geojson"&&y)return void this.fire(new a.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(T==="vector"&&!y)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(m);for(const A of S)A.setFeatureState(y,s.id,u)}removeFeatureState(s,u){this._checkLoaded();const m=s.source,y=this.getSource(m);if(!y)return void this.fire(new a.ErrorEvent(new Error(`The source '${m}' does not exist in the map's style.`)));const x=y.type,T=x==="vector"?s.sourceLayer:void 0;if(x==="vector"&&!T)return void this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new a.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(m);for(const A of S)A.removeFeatureState(T,s.id,u)}getFeatureState(s){this._checkLoaded();const u=s.source,m=s.sourceLayer,y=this.getSource(u);if(y){if(y.type!=="vector"||m)return s.id===void 0&&this.fire(new a.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(m,s.id);this.fire(new a.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new a.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return a.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const u in this._sourceCaches){const m=this._sourceCaches[u].getSource();s[m.id]||(s[m.id]=m.serialize())}return a.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const u=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&u&&u.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",u.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const u=T=>this._layers[T].type==="fill-extrusion",m={},y=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(u(S)){m[S]=T;for(const A of s){const D=A[S];if(D)for(const R of D)y.push(R)}}}y.sort((T,S)=>S.intersectionZ-T.intersectionZ);const x=[];for(let T=this._order.length-1;T>=0;T--){const S=this._order[T];if(u(S))for(let A=y.length-1;A>=0;A--){const D=y[A].feature;if(m[D.layer.id]<T)break;x.push(D),y.pop()}else for(const A of s){const D=A[S];if(D)for(const R of D)x.push(R.feature)}}return x}queryRenderedFeatures(s,u,m){u&&u.filter&&this._validate(a.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const y={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new a.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of u.layers){const D=this._layers[A];if(!D)return this.fire(new a.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];y[D.source]=!0}}const x=[];u.availableImages=this._availableImages;const T=u&&u.layers?u.layers.some(A=>{const D=this.getLayer(A);return D&&D.is3D()}):this.has3DLayers(),S=yr.createFromScreenPoints(s,m);for(const A in this._sourceCaches){const D=this._sourceCaches[A].getSource().id;u.layers&&!y[D]||x.push(Ln(this._sourceCaches[A],this._layers,this._serializedLayers,S,u,m,T,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(A,D,R,B,W,Z,Y){const K={},Q=Z.queryRenderedSymbols(B),F=[];for(const H of Object.keys(Q).map(Number))F.push(Y[H]);F.sort(Or);for(const H of F){const ie=H.featureIndex.lookupSymbolFeatures(Q[H.bucketInstanceId],D,H.bucketIndex,H.sourceLayerIndex,W.filter,W.layers,W.availableImages,A);for(const se in ie){const ge=K[se]=K[se]||[],ye=ie[se];ye.sort((_e,Ee)=>{const be=H.featureSortOrder;if(be){const ke=be.indexOf(_e.featureIndex);return be.indexOf(Ee.featureIndex)-ke}return Ee.featureIndex-_e.featureIndex});for(const _e of ye)ge.push(_e)}}for(const H in K)K[H].forEach(ie=>{const se=ie.feature,ge=R(A[H]);if(!ge)return;const ye=ge.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=ye});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(s,u){u&&u.filter&&this._validate(a.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const m=this._getSourceCaches(s);let y=[];for(const x of m)y=y.concat(Kn(x,u));return y}addSourceType(s,u,m){return po.getSourceType(s)?m(new Error(`A source type called "${s}" already exists.`)):(po.setSourceType(s,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:u.workerSourceURL},m):m(null,null))}getLight(){return this.light.getLight()}setLight(s,u={}){this._checkLoaded();const m=this.light.getLight();let y=!1;for(const T in s)if(!k(s[T],m[T])){y=!0;break}if(!y)return;const x=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,u),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,u=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let m=s;if(u===1){if(typeof m.source=="object"){const y="terrain-dem-src";this.addSource(y,m.source),m=a.clone$1(m),m=a.extend(m,{source:y})}if(this._validate(a.validateTerrain,"terrain",m))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode){if(!m)return;this._createTerrain(m,u)}else{const y=this.terrain,x=y.get();for(const T of Object.keys(a.spec.terrain))!m.hasOwnProperty(T)&&a.spec.terrain[T].default&&(m[T]=a.spec.terrain[T].default);for(const T in m)if(!k(m[T],x[T])){y.set(m),this.stylesheet.terrain=m;const S=this._setTransitionParameters({duration:0});y.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const u=this.fog=new Tt(s,this.map.transform);this.stylesheet.fog=s;const m=this._setTransitionParameters({duration:0});u.updateTransitions(m)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,m=u.get();Object.keys(s).length===0&&u.set(s);for(const y in s)if(!k(s[y],m[y])){u.set(s),this.stylesheet.fog=s;const x=this._setTransitionParameters({duration:0});u.updateTransitions(x);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:a.exported.now(),transition:a.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(m=>this.isLayerDraped(this._layers[m])),u=this._order.filter(m=>!this.isLayerDraped(this._layers[m]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...u)}_createTerrain(s,u){const m=this.terrain=new Dn(s,u);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});m.updateTransitions(y)}_force3DLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="fill-extrusion"&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const u=this._layers[s];u.type==="symbol"&&this._updateLayer(u)}}_validate(s,u,m,y,x={}){return(!x||x.validate!==!1)&&gs(this,s.call(a.validateStyle,a.extend({key:u,style:this.serialize(),value:m,styleSpec:a.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),a.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const u=this._getSourceCaches(s);for(const m of u)m.clearTiles()}_reloadSource(s){const u=this._getSourceCaches(s);for(const m of u)m.resume(),m.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const u in this._sourceCaches)this._sourceCaches[u].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const u=this._sourceCaches[s];u.resume(),u.reload()}}_updatePlacement(s,u,m,y,x=!1){let T=!1,S=!1;const A={};for(const D of this._order){const R=this._layers[D];if(R.type!=="symbol")continue;if(!A[R.source]){const W=this._getLayerSourceCache(R);if(!W)continue;A[R.source]=W.getRenderableIds(!0).map(Z=>W.getTileByID(Z)).sort((Z,Y)=>Y.tileID.overscaledZ-Z.tileID.overscaledZ||(Z.tileID.isLessThan(Y.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(R,A[R.source],s.center.lng,s.projection);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new a.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(a.exported.now(),s.zoom))&&(this.pauseablePlacement=new Ad(s,this._order,x,u,m,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(a.exported.now()),S=!0),T&&this.pauseablePlacement.placement.setStale()),S||T)for(const D of this._order){const R=this._layers[D];R.type==="symbol"&&this.placement.updateLayerOpacities(R,A[R.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(a.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,u,m){this.imageManager.getImages(u.icons,m),this._updateTilesForChangedImages();const y=x=>{x&&x.setDependencies(u.tileID.key,u.type,u.icons)};y(this._otherSourceCaches[u.source]),y(this._symbolSourceCaches[u.source])}getGlyphs(s,u,m){this.glyphManager.getGlyphs(u.stacks,m)}getResource(s,u,m){return a.makeRequest(u,m)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const u=[];return this._otherSourceCaches[s]&&u.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&u.push(this._symbolSourceCaches[s]),u}_isSourceCacheLoaded(s){const u=this._getSourceCaches(s);return u.length===0?(this.fire(new a.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):u.every(m=>m.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}po.getSourceType=function(f){return Lt[f]},po.setSourceType=function(f,s){Lt[f]=s},po.registerForPluginStateChange=a.registerForPluginStateChange;var Rd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,Ks="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Uo=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,hc=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Vo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let wu={},$a={};const dc=[];Ga(Rd,dc),Ga(Uo,dc),Ga(hc,dc),Ga(Vo,dc),wu=sn("",Uo),$a=sn(Vo,hc);const Dm=sn(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),bu=Rd,Dd=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var Ld={background:sn(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:sn(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:sn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:sn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:sn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:sn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:sn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:sn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:sn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:sn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:sn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:sn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:sn(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:sn(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:sn(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:sn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:sn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:sn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:sn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:sn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:sn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:sn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:sn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:sn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:sn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:sn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ks),skyboxGradient:sn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,Ks),skyboxCapture:sn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:sn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:sn(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Ga(f,s){const u=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let m of u)if(m=m.trim(),m[0]==="#"&&m.includes("if")&&!m.includes("endif")){m=m.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=m.split(" ");for(const x of y)s.includes(x)||s.push(x)}}function sn(f,s){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},x=[...dc];return Ga(f,x),Ga(s,x),{fragmentSource:f=f.replace(u,(T,S,A,D,R)=>(y[R]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${A} ${D} ${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = u_${R};
#endif
`)),vertexSource:s=s.replace(u,(T,S,A,D,R)=>{const B=D==="float"?"vec2":"vec4",W=R.match(/color/)?"color":B;return y[R]?S==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${B} a_${R};
varying ${A} ${D} ${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${W}(a_${R}, u_${R}_t);
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${B} a_${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:W==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = a_${R};
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = unpack_mix_${W}(a_${R}, u_${R}_t);
#else
    ${A} ${D} ${R} = u_${R};
#endif
`}),staticAttributes:m,usedDefines:x}}class bv{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,u,m,y,x,T,S){this.context=s;let A=this.boundPaintVertexBuffers.length!==y.length;for(let R=0;!A&&R<y.length;R++)this.boundPaintVertexBuffers[R]!==y[R]&&(A=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let R=0;!D&&R<S.length;R++)this.boundDynamicVertexBuffers[R]!==S[R]&&(D=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==m||A||D||this.boundIndexBuffer!==x||this.boundVertexOffset!==T)this.freshBind(u,m,y,x,T,S);else{s.bindVertexArrayOES.set(this.vao);for(const R of S)R&&R.bind();x&&x.dynamicDraw&&x.bind()}}freshBind(s,u,m,y,x,T){let S;const A=s.numAttributes,D=this.context,R=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=y,this.boundVertexOffset=x,this.boundDynamicVertexBuffers=T;else{S=D.currentNumAttributes||0;for(let B=A;B<S;B++)R.disableVertexAttribArray(B)}u.enableAttributes(R,s),u.bind(),u.setVertexAttribPointers(R,s,x);for(const B of m)B.enableAttributes(R,s),B.bind(),B.setVertexAttribPointers(R,s,x);for(const B of T)B&&(B.enableAttributes(R,s),B.bind(),B.setVertexAttribPointers(R,s,x));y&&y.bind(),D.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function zd(f,s){const u=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new a.MercatorCoordinate(0,m/u).toLngLat().lat,new a.MercatorCoordinate(0,(m+1)/u).toLngLat().lat]}function Lm(f,s,u,m,y,x,T){const S=f.context,A=S.gl,D=u.fbo;if(!D)return;f.prepareDrawTile();const R=f.useProgram("hillshade");S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get());const B=((K,Q,F,H)=>{const ie=F.paint.get("hillshade-shadow-color"),se=F.paint.get("hillshade-highlight-color"),ge=F.paint.get("hillshade-accent-color");let ye=F.paint.get("hillshade-illumination-direction")*(Math.PI/180);F.paint.get("hillshade-illumination-anchor")==="viewport"&&(ye-=K.transform.angle);const _e=!K.options.moving;return{u_matrix:H||K.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),_e),u_image:0,u_latrange:zd(0,Q.tileID),u_light:[F.paint.get("hillshade-exaggeration"),ye],u_shadow:ie,u_highlight:se,u_accent:ge}})(f,u,m,f.terrain?s.projMatrix:null);f.prepareDrawProgram(S,R,s.toUnwrapped());const{tileBoundsBuffer:W,tileBoundsIndexBuffer:Z,tileBoundsSegments:Y}=f.getTileBoundsBuffers(u);R.draw(S,A.TRIANGLES,y,x,T,a.CullFaceMode.disabled,B,m.id,W,Z,Y)}function Od(f,s,u){if(!s.needsDEMTextureUpload)return;const m=f.context,y=m.gl;m.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||f.getTileTexture(u.stride);const x=u.getPixels();s.demTexture?s.demTexture.update(x,{premultiply:!1}):s.demTexture=new a.Texture(m,x,y.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function zm(f,s,u,m,y,x){const T=f.context,S=T.gl;if(!s.dem)return;const A=s.dem;if(T.activeTexture.set(S.TEXTURE1),Od(f,s,A),!s.demTexture)return;s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const D=A.dim;T.activeTexture.set(S.TEXTURE0);let R=s.fbo;if(!R){const Y=new a.Texture(T,{width:D,height:D,data:null},S.RGBA);Y.bind(S.LINEAR,S.CLAMP_TO_EDGE),R=s.fbo=T.createFramebuffer(D,D,!0),R.colorAttachment.set(Y.texture)}T.bindFramebuffer.set(R.framebuffer),T.viewport.set([0,0,D,D]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:W,tileBoundsSegments:Z}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(T,S.TRIANGLES,m,y,x,a.CullFaceMode.disabled,((Y,K)=>{const Q=K.stride,F=a.create();return a.ortho(F,0,a.EXTENT,-a.EXTENT,0,0,1),a.translate(F,F,[0,-a.EXTENT,0]),{u_matrix:F,u_image:1,u_dimension:[Q,Q],u_zoom:Y.overscaledZ,u_unpack:K.unpackVector}})(s.tileID,A),u.id,B,W,Z),s.needsHillshadePrepare=!1}const Bd=f=>({u_matrix:new a.UniformMatrix4f(f),u_image0:new a.Uniform1i(f),u_skirt_height:new a.Uniform1f(f)}),Wa=(f,s)=>({u_matrix:f,u_image0:0,u_skirt_height:s}),Eu=(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(m),u_merc_matrix:u,u_zoom_transition:y,u_merc_center:x,u_image0:0,u_frustum_tl:T,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:D,u_globe_pos:R,u_globe_radius:B,u_viewport:W,u_grid_matrix:Y?Float32Array.from(Y):new Float32Array(9),u_skirt_height:Z});function qa(f,s){return f!=null&&s!=null&&!(!f.hasData()||!s.hasData())&&f.demTexture!=null&&s.demTexture!=null&&f.tileID.key!==s.tileID.key}const $o=new class{constructor(){this.operations={}}newMorphing(f,s,u,m,y){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==u.tileID.key&&(x.queued=u)}else this.operations[f]={startTime:m,phase:0,duration:y,from:s,to:u,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const s=this.operations[f];return{from:s.from,to:s.to,phase:s.phase}}update(f){for(const s in this.operations){const u=this.operations[s];for(u.phase=(f-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,f)){delete this.operations[s];break}}}_nextOp(f,s){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=s,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},Js={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Tu(f){return 6*Math.pow(1.5,22-f)}function Om(f,s){const u=1<<f.z;return!s&&(f.x===0||f.x===u-1)||f.y===0||f.y===u-1}const fc=f=>({u_matrix:f});function Fd(f,s,u,m,y){if(y>0){const x=a.exported.now(),T=(x-f.timeAdded)/y,S=s?(x-s.timeAdded)/y:-1,A=u.getSource(),D=m.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),R=!s||Math.abs(s.tileID.overscaledZ-D)>Math.abs(f.tileID.overscaledZ-D),B=R&&f.refreshedUponExpiration?1:a.clamp(R?T:1-S,0,1);return f.refreshedUponExpiration&&T>=1&&(f.refreshedUponExpiration=!1),s?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class Nd extends a.SourceCache{constructor(s){const u={type:"raster-dem",maxzoom:s.transform.maxZoom},m=new Rt(Na(),null),y=Ft("mock-dem",u,m,s.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,u){s.state="loaded",u(null)}}class Su extends a.SourceCache{constructor(s){const u=Ft("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new Rt(Na(),null),s.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,u,m){if(s.freezeTileCoverage)return;this.transform=s;const y=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,T)=>{if(x[T.key]="",!this._tiles[T.key]){const S=new a.Tile(T,this._source.tileSize*T.overscaleFactor(),s.tileZoom);S.state="loaded",this._tiles[T.key]=S}return x},{});for(const x in this._tiles)x in y||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(s){const u=this.proxyCachedFBO[s];if(u!==void 0){const m=Object.values(u);this.renderCachePool.push(...m),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Iu extends a.OverscaledTileID{constructor(s,u,m){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=u,this.projMatrix=m}}class jd extends a.Elevation{constructor(s,u){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[m,y,x]=function(A){const D=new a.StructArrayLayout2i4,R=new a.StructArrayLayout3ui6,B=131;D.reserve(17161),R.reserve(33800);const W=a.EXTENT/128,Z=a.EXTENT+W/2,Y=Z+W;for(let Q=-W;Q<Y;Q+=W)for(let F=-W;F<Y;F+=W){const H=F<0||F>Z||Q<0||Q>Z?24575:0,ie=a.clamp(Math.round(F),0,a.EXTENT),se=a.clamp(Math.round(Q),0,a.EXTENT);D.emplaceBack(ie+H,se)}const K=(Q,F)=>{const H=F*B+Q;R.emplaceBack(H+1,H,H+B),R.emplaceBack(H+B,H+B+1,H+1)};for(let Q=1;Q<129;Q++)for(let F=1;F<129;F++)K(F,Q);return[0,129].forEach(Q=>{for(let F=0;F<130;F++)K(F,Q),K(Q,F)}),[D,R,32768]}(),T=s.context;this.gridBuffer=T.createVertexBuffer(m,a.posAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(y),this.gridSegments=a.SegmentVector.simpleSegment(0,0,m.length,y.length),this.gridNoSkirtSegments=a.SegmentVector.simpleSegment(0,0,m.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Su(u.map),this.orthoMatrix=a.create(),a.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,a.EXTENT,0,a.EXTENT,0,1);const S=T.gl;this._overlapStencilMode=new a.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Nd(u.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,u,m){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const y=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const x=()=>{this.sourceCache.used&&a.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(u,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),u.updateElevation(!0,m),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&a.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,m=this.painter.transform;this._initializing&&(this._initializing=m._centerAltitude===0&&this.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(m.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=u.getIds().map(A=>{const D=u.getTileByID(A).tileID;return D.projMatrix=m.calculateProjMatrix(D.toUnwrapped()),D});(function(A,D){const R=D.transform.pointCoordinate(D.transform.getCameraPoint()),B=new a.Point(R.x,R.y);A.sort((W,Z)=>{if(Z.overscaledZ-W.overscaledZ)return Z.overscaledZ-W.overscaledZ;const Y=new a.Point(W.canonical.x+(1<<W.canonical.z)*W.wrap,W.canonical.y),K=new a.Point(Z.canonical.x+(1<<Z.canonical.z)*Z.wrap,Z.canonical.y),Q=B.mult(1<<W.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(Y)-Q.distSqr(K)})})(y,this.painter),this._previousZoom=m.zoom;const x=this.proxyToSource||{};this.proxyToSource={},y.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const A in T){const D=T[A];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,s[A],x),D.usedForTerrain))continue;const R=s[A];D.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[u.id]=y.map(A=>new Iu(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=a.exported.now();const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const D=this.terrainTileForTile[A.key];if(!D)continue;const R=D.tileID.key;R in S||(this._visibleDemTiles.push(D),S[R]=R)}}_assignTerrainTiles(s){this._initializing||s.forEach(u=>{if(this.terrainTileForTile[u.key])return;const m=this._findTileCoveringTileID(u,this.sourceCache);m&&(this.terrainTileForTile[u.key]=m)})}_prepareDEMTextures(){const s=this.painter.context,u=s.gl;for(const m in this.terrainTileForTile){const y=this.terrainTileForTile[m],x=y.dem;!x||y.demTexture&&!y.needsDEMTextureUpload||(s.activeTexture.set(u.TEXTURE1),Od(this.painter,y,x))}}_prepareDemTileUniforms(s,u,m,y){if(!u||u.demTexture==null)return!1;const x=s.tileID.canonical,T=Math.pow(2,u.tileID.canonical.z-x.z),S=y||"";return m[`u_dem_tl${S}`]=[x.x*T%1,x.y*T%1],m[`u_dem_scale${S}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,u=s.gl;if(!this._emptyDepthBufferTexture){const m=new a.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new a.Texture(s,m,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const u=this._visibleDemTiles.reduce((m,y)=>{if(!y.dem)return m;const x=y.dem.tree.minimums[0];return x>0&&s++,m+x},0);return s?u/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,u=s.gl;s.activeTexture.set(u.TEXTURE2);const m=this._getLoadedAreaMinimum(),y=new a.RGBAImage({width:1,height:1},new Uint8Array(a.DEMData.pack(m,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(y,{premultiply:!1}):x=this._emptyDEMTexture=new a.Texture(s,y,u.RGBA,{premultiply:!1}),x}setupElevationDraw(s,u,m){const y=this.painter.context,x=y.gl,T=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:a.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();let A=null,D=null,R=1;if(m&&m.morphing&&this._useVertexMorphing){const B=m.morphing.srcDemTile,W=m.morphing.dstDemTile;R=m.morphing.phase,B&&W&&(this._prepareDemTileUniforms(s,B,T,"_prev")&&(D=B),this._prepareDemTileUniforms(s,W,T)&&(A=W))}if(D&&A?(y.activeTexture.set(x.TEXTURE2),A.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),y.activeTexture.set(x.TEXTURE4),D.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),T.u_dem_lerp=R):(A=this.terrainTileForTile[s.tileID.key],y.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(s,A,T)?A.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),y.activeTexture.set(x.TEXTURE3),m&&m.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),m&&m.useMeterToDem&&A){const B=(1<<A.tileID.canonical.z)*a.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=B}if(m&&m.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=m.labelPlaneMatrixInv),u.setTerrainUniformValues(y,T),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,s.tileID.canonical,m&&m.useDenormalizedUpVectorScale);u.setGlobeUniformValues(y,B)}}globeUniformValues(s,u,m){const y=s.projection;return{u_tile_tl_up:y.upVector(u,0,0),u_tile_tr_up:y.upVector(u,a.EXTENT,0),u_tile_br_up:y.upVector(u,a.EXTENT,a.EXTENT),u_tile_bl_up:y.upVector(u,0,a.EXTENT),u_tile_up_scale:m?a.globeMetersToEcef(1):y.upVectorScale(u,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const u=this.painter,m=this.painter.context;s.length!==0&&(m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,x,T,S,A){if(y.transform.projection.name==="globe")(function(D,R,B,W,Z){const Y=D.context,K=Y.gl;let Q,F;const H=D.options.showTerrainWireframe?2:0,ie=D.transform,se=a.globeUseCustomAntiAliasing(D,Y,ie),ge=(Ze,Pe)=>{if(F===Ze)return;const je=[Js[Ze],"PROJECTION_GLOBE_VIEW"];se&&je.push("CUSTOM_ANTIALIASING"),Pe&&je.push(Js[H]),Q=D.useProgram("globeRaster",null,je),F=Ze},ye=D.colorModeForRenderPass(),_e=new a.DepthMode(K.LEQUAL,a.DepthMode.ReadWrite,D.depthRangeFor3D);$o.update(Z);const Ee=a.calculateGlobeMercatorMatrix(ie),be=[a.mercatorXfromLng(ie.center.lng),a.mercatorYfromLat(ie.center.lat)],ke=H?[!1,!0]:[!1],Ke=D.globeSharedBuffers,Ce=[ie.width*a.exported.devicePixelRatio,ie.height*a.exported.devicePixelRatio],Ue=Float32Array.from(ie.globeMatrix),Re={useDenormalizedUpVectorScale:!0};if(ke.forEach(Ze=>{const Pe=D.transform,je=Tu(Pe.zoom)*R.exaggeration();F=-1;const Ye=Ze?K.LINES:K.TRIANGLES;for(const We of W){const et=B.getTile(We),xt=a.StencilMode.disabled,At=R.prevTerrainTileForTile[We.key],mt=R.terrainTileForTile[We.key];qa(At,mt)&&$o.newMorphing(We.key,At,mt,Z,250),Y.activeTexture.set(K.TEXTURE0),et.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const St=$o.getMorphValuesForProxy(We.key),Wt=St?1:0;St&&a.extend$1(Re,{morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:a.easeCubicInOut(St.phase)}});const Nt=a.tileCornersToBounds(We.canonical),yt=a.getLatitudinalLod(Nt.getCenter().lat),ln=a.getGridMatrix(We.canonical,Nt,yt,Pe.worldSize/Pe._pixelsPerMercatorPixel),fn=a.globeNormalizeECEF(a.globeTileBounds(We.canonical)),pn=Eu(Pe.projMatrix,Ue,Ee,fn,a.globeToMercatorTransition(Pe.zoom),be,Pe.frustumCorners.TL,Pe.frustumCorners.TR,Pe.frustumCorners.BR,Pe.frustumCorners.BL,Pe.globeCenterInViewSpace,Pe.globeRadius,Ce,je,ln);if(ge(Wt,Ze),R.setupElevationDraw(et,Q,Re),D.prepareDrawProgram(Y,Q,We.toUnwrapped()),Ke){const[mn,Fr,Er]=Ze?Ke.getWirefameBuffers(D.context,yt):Ke.getGridBuffers(yt,je!==0);Q.draw(Y,Ye,_e,xt,ye,a.CullFaceMode.backCCW,pn,"globe_raster",mn,Fr,Er)}}}),Ke){const Ze=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&Ze.push("CUSTOM_ANTIALIASING"),Q=D.useProgram("globeRaster",null,Ze);for(const Pe of W){const{x:je,y:Ye,z:We}=Pe.canonical,et=Ye===0,xt=Ye===(1<<We)-1,[At,mt,St,Wt]=Ke.getPoleBuffers(We);if(Wt&&(et||xt)){const Nt=B.getTile(Pe);Y.activeTexture.set(K.TEXTURE0),Nt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let yt=a.globePoleMatrixForTile(We,je,ie);const ln=a.globeNormalizeECEF(a.globeTileBounds(Pe.canonical)),fn=(pn,mn)=>pn.draw(Y,K.TRIANGLES,_e,a.StencilMode.disabled,ye,a.CullFaceMode.disabled,Eu(ie.projMatrix,yt,yt,ln,0,be,ie.frustumCorners.TL,ie.frustumCorners.TR,ie.frustumCorners.BR,ie.frustumCorners.BL,ie.globeCenterInViewSpace,ie.globeRadius,Ce,0),"globe_pole_raster",mn,St,Wt);R.setupElevationDraw(Nt,Q,Re),D.prepareDrawProgram(Y,Q,Pe.toUnwrapped()),et&&fn(Q,At),xt&&(yt=a.scale(a.create(),yt,[1,-1,1]),fn(Q,mt))}}}})(y,x,T,S,A);else{const D=y.context,R=D.gl;let B,W;const Z=y.options.showTerrainWireframe?2:0,Y=(ie,se)=>{if(W===ie)return;const ge=[Js[ie]];se&&ge.push(Js[Z]),B=y.useProgram("terrainRaster",null,ge),W=ie},K=y.colorModeForRenderPass(),Q=new a.DepthMode(R.LEQUAL,a.DepthMode.ReadWrite,y.depthRangeFor3D);$o.update(A);const F=y.transform,H=Tu(F.zoom)*x.exaggeration();(Z?[!1,!0]:[!1]).forEach(ie=>{W=-1;const se=ie?R.LINES:R.TRIANGLES,[ge,ye]=ie?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const _e of S){const Ee=T.getTile(_e),be=a.StencilMode.disabled,ke=x.prevTerrainTileForTile[_e.key],Ke=x.terrainTileForTile[_e.key];qa(ke,Ke)&&$o.newMorphing(_e.key,ke,Ke,A,250),D.activeTexture.set(R.TEXTURE0),Ee.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE,R.LINEAR_MIPMAP_NEAREST);const Ce=$o.getMorphValuesForProxy(_e.key),Ue=Ce?1:0;let Re;Ce&&(Re={morphing:{srcDemTile:Ce.from,dstDemTile:Ce.to,phase:a.easeCubicInOut(Ce.phase)}});const Ze=Wa(_e.projMatrix,Om(_e.canonical,F.renderWorldCopies)?H/10:H);Y(Ue,ie),x.setupElevationDraw(Ee,B,Re),y.prepareDrawProgram(D,B,_e.toUnwrapped()),B.draw(D,se,Q,be,K,a.CullFaceMode.backCCW,Ze,"terrain_raster",x.gridBuffer,ge,ye)}})}}(u,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const u=this.painter,m=this.painter.context,y=this.proxySourceCache,x=this.proxiedCoords[y.id],T=this._drapedRenderBatches.shift(),S=[],A=u.style.order;let D=0;for(const R of x){const B=y.getTileByID(R.proxyTileKey),W=y.proxyCachedFBO[R.key]?y.proxyCachedFBO[R.key][s]:void 0,Z=W!==void 0?y.renderCache[W]:this.pool[D++],Y=W!==void 0;if(B.texture=Z.tex,Y&&!Z.dirty){S.push(B.tileID);continue}let K;m.bindFramebuffer.set(Z.fb.framebuffer),this.renderedToTile=!1,Z.dirty&&(m.clear({color:a.Color.transparent,stencil:0}),Z.dirty=!1);for(let Q=T.start;Q<=T.end;++Q){const F=u.style._layers[A[Q]];if(F.isHidden(u.transform.zoom))continue;const H=u.style._getLayerSourceCache(F),ie=H?this.proxyToSource[R.key][H.id]:[R];if(!ie)continue;const se=ie;m.viewport.set([0,0,Z.fb.width,Z.fb.height]),K!==(H?H.id:null)&&(this._setupStencil(Z,ie,F,H),K=H?H.id:null),u.renderLayer(u,H,F,se)}this.renderedToTile?(Z.dirty=!0,S.push(B.tileID)):Y||--D,D===5&&(D=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,m.bindFramebuffer.set(null),m.viewport.set([0,0,u.width,u.height]),T.end+1}postRender(){}renderCacheEfficiency(s){const u=s.order.length;if(u===0)return{efficiency:100};let m,y=0,x=0,T=!1;for(let S=0;S<u;++S){const A=s._layers[s.order[S]];this._style.isLayerDraped(A)?(T&&++y,++x):T||(T=!0,m=A.id)}return x===0?{efficiency:100}:{efficiency:100*(1-y/x),firstUndrapedLayer:m}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{s=Math.min(s,u.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,u,m){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const T=x.tileID,S=1<<T.overscaledZ,{x:A,y:D}=T.canonical,R=A/S,B=(A+1)/S,W=D/S,Z=(D+1)/S;return{minx:R,miny:W,maxx:B,maxy:Z,t:x.dem.tree.raycastRoot(R,W,B,Z,s,u,m),tile:x}});y.sort((x,T)=>(x.t!==null?x.t:Number.MAX_VALUE)-(T.t!==null?T.t:Number.MAX_VALUE));for(const x of y){if(x.t==null)return null;const T=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,s,u,m);if(T!=null)return T}return null}_createFBO(){const s=this.painter.context,u=s.gl,m=this.drapeBufferSize;s.activeTexture.set(u.TEXTURE0);const y=new a.Texture(s,{width:m[0],height:m[1],data:null},u.RGBA);y.bind(u.LINEAR,u.CLAMP_TO_EDGE);const x=s.createFramebuffer(m[0],m[1],!1);return x.colorAttachment.set(y.texture),x.depthAttachment=new ve(s,x.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,m[0],m[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:x,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const u=this._style._layers[s],m=u.isHidden(this.painter.transform.zoom);return u.type==="custom"?!m&&u.shouldRedrape():!m&&u.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const m of this._style._getSources())if(m instanceof st){s=!0;break}if(!s)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(x&&!u[x.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof a.ZoomDependentExpression){u[x.id]=!0;for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][x.id];if(S)for(const A of S)this._clearRenderCacheForTile(x.id,A)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const m in this._style._sourceCaches)if(this._style._sourceCaches[m]._source instanceof tt){s=!0;break}if(!s)return;const u={};for(let m=0;m<this._style.order.length;++m){const y=this._style._layers[this._style.order[m]],x=this._style._getLayerSourceCache(y);if(!x||u[x.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const T=y.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][x.id];if(A)for(const D of A){const R=Fd(x.getTile(D),x.findLoadedParent(D,0),x,this.painter.transform,T);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(x.id,D)}}}}_setupDrapedRenderBatches(){const s=this._style.order,u=s.length;if(u===0)return;const m=[];let y,x=0,T=this._style._layers[s[x]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++x<u;)T=this._style._layers[s[x]];for(;x<u;++x){const S=this._style._layers[s[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?y===void 0&&(y=x):y!==void 0&&(m.push({start:y,end:x-1}),y=void 0))}y!==void 0&&m.push({start:y,end:x-1}),this._drapedRenderBatches=m}_setupRenderCache(s){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const T=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let S=0;S<T.length;++S){const A=Object.values(T[S]);u.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const m=this.proxyCoords,y=this._tilesDirty;for(let T=m.length-1;T>=0;T--){const S=m[T];if(u.getTileByID(S.key),u.proxyCachedFBO[S.key]!==void 0){const A=s[S.key],D=this.proxyToSource[S.key];let R=0;for(const B in D){const W=D[B],Z=A[B];if(!Z||Z.length!==W.length||W.some((Y,K)=>Y!==Z[K]||y[B]&&y[B].hasOwnProperty(Y.key))){R=-1;break}++R}for(const B in u.proxyCachedFBO[S.key])u.renderCache[u.proxyCachedFBO[S.key][B]].dirty=R<0||R!==Object.values(A).length}}const x=[...this._drapedRenderBatches];x.sort((T,S)=>S.end-S.start-(T.end-T.start));for(const T of x)for(const S of m){if(u.proxyCachedFBO[S.key])continue;let A=u.renderCachePool.pop();A===void 0&&u.renderCache.length<50&&(A=u.renderCache.length,u.renderCache.push(this._createFBO())),A!==void 0&&(u.proxyCachedFBO[S.key]={},u.proxyCachedFBO[S.key][T.start]=A,u.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(s,u,m,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,T=x.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let S;if(m.isTileClipped())S=u.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,m.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):a.StencilMode.disabled}_renderTileClippingMasks(s,u){const m=this.painter,y=this.painter.context,x=y.gl;m._tileClippingMaskIDs={},y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const T=m.useProgram("clippingMask");for(const S of s){const A=m._tileClippingMaskIDs[S.key]=--u;T.draw(y,x.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:x.ALWAYS,mask:0},A,255,x.KEEP,x.KEEP,x.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,fc(S.projMatrix),"$clipping",m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}}pointCoordinate(s){const u=this.painter.transform;if(s.x<0||s.x>u.width||s.y<0||s.y>u.height)return null;const m=[s.x,s.y,1,1];a.transformMat4$1(m,m,u.pixelMatrixInverse),a.scale$1(m,m,1/m[3]),m[0]/=u.worldSize,m[1]/=u.worldSize;const y=u._camera.position,x=a.mercatorZfromAltitude(1,u.center.lat),T=[y[0],y[1],y[2]/x,0],S=a.subtract([],m.slice(0,3),T);a.normalize(S,S);const A=this.raycast(T,S,this._exaggeration);return A!==null&&A?(a.scaleAndAdd(T,T,S,A),T[3]=T[2],T[2]*=x,T):null}drawDepth(){const s=this.painter,u=s.context,m=this.proxySourceCache,y=Math.ceil(s.width),x=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===x||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=u.gl,S=u.createFramebuffer(y,x,!0);u.activeTexture.set(T.TEXTURE0);const A=new a.Texture(u,{width:y,height:x,data:null},T.RGBA);A.bind(T.NEAREST,T.CLAMP_TO_EDGE),S.colorAttachment.set(A.texture);const D=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,y,x);S.depthAttachment.set(D),this._depthFBO=S,this._depthTexture=A}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,y,x]),function(T,S,A,D){if(T.transform.projection.name==="globe")return;const R=T.context,B=R.gl;R.clear({depth:1});const W=T.useProgram("terrainDepth"),Z=new a.DepthMode(B.LESS,a.DepthMode.ReadWrite,T.depthRangeFor3D);for(const Y of D){const K=A.getTile(Y),Q=Wa(Y.projMatrix,0);S.setupElevationDraw(K,W),W.draw(R,B.TRIANGLES,Z,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.backCCW,Q,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(s,this,m,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,u,m){if(s.getSource()instanceof Bt)return this._setupProxiedCoordsForImageSource(s,u,m);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const A=x[S],D=this._findTileCoveringTileID(A,s);if(D){const R=this._createProxiedId(A,D,m[A.key]&&m[A.key][s.id]);y.push(R),this.proxyToSource[A.key][s.id]=[R]}}let T=!1;for(let S=0;S<u.length;S++){const A=s.getTile(u[S]);if(!A||!A.hasData())continue;const D=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==A.tileID.canonical.z){const R=this.proxyToSource[D.tileID.key][s.id],B=this._createProxiedId(D.tileID,A,m[D.tileID.key]&&m[D.tileID.key][s.id]);R?R.splice(R.length-1,0,B):this.proxyToSource[D.tileID.key][s.id]=[B],y.push(B),T=!0}}this._sourceTilesOverlap[s.id]=T}_setupProxiedCoordsForImageSource(s,u,m){if(!s.getSource().loaded())return;const y=this.proxiedCoords[s.id]=[],x=this.proxyCoords,T=s.getSource(),S=new a.Point(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),A=T.coordinates.map(a.MercatorCoordinate.fromLngLat).reduce((R,B)=>(R.min.x=Math.min(R.min.x,B.x-S.x),R.min.y=Math.min(R.min.y,B.y-S.y),R.max.x=Math.max(R.max.x,B.x-S.x),R.max.y=Math.max(R.max.y,B.y-S.y),R),{min:new a.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new a.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(R,B)=>{const W=R.wrap+R.canonical.x/(1<<R.canonical.z),Z=R.canonical.y/(1<<R.canonical.z),Y=a.EXTENT/(1<<R.canonical.z),K=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return W+Y<K+A.min.x||W>K+A.max.x||Z+Y<Q+A.min.y||Z>Q+A.max.y};for(let R=0;R<x.length;R++){const B=x[R];for(let W=0;W<u.length;W++){const Z=s.getTile(u[W]);if(!Z||!Z.hasData()||D(B,Z.tileID))continue;const Y=this._createProxiedId(B,Z,m[B.key]&&m[B.key][s.id]),K=this.proxyToSource[B.key][s.id];K?K.push(Y):this.proxyToSource[B.key][s.id]=[Y],y.push(Y)}}}_createProxiedId(s,u,m){let y=this.orthoMatrix;if(m){const x=m.find(T=>T.key===u.tileID.key);if(x)return x}if(u.tileID.key!==s.key){const x=s.canonical.z-u.tileID.canonical.z;let T,S,A;y=a.create();const D=u.tileID.wrap-s.wrap<<s.overscaledZ;x>0?(T=a.EXTENT>>x,S=T*((u.tileID.canonical.x<<x)-s.canonical.x+D),A=T*((u.tileID.canonical.y<<x)-s.canonical.y)):(T=a.EXTENT<<-x,S=a.EXTENT*(u.tileID.canonical.x-(s.canonical.x+D<<-x)),A=a.EXTENT*(u.tileID.canonical.y-(s.canonical.y<<-x))),a.ortho(y,0,T,0,T,0,1),a.translate(y,y,[S,A,0])}return new Iu(u.tileID,s.key,y)}_findTileCoveringTileID(s,u){let m=u.getTile(s);if(m&&m.hasData())return m;const y=this._findCoveringTileCache[u.id],x=y[s.key];if(m=x?u.getTileByID(x):null,m&&m.hasData()||x===null)return m;let T=m?m.tileID:s,S=T.overscaledZ;const A=u.getSource().minzoom,D=[];if(!x){const B=u.getSource().maxzoom;if(s.canonical.z>=B){const W=s.canonical.z-B;u.getSource().reparseOverscaled?(S=Math.max(s.canonical.z+2,u.transform.tileZoom),T=new a.OverscaledTileID(S,s.wrap,B,s.canonical.x>>W,s.canonical.y>>W)):W!==0&&(S=B,T=new a.OverscaledTileID(S,s.wrap,B,s.canonical.x>>W,s.canonical.y>>W))}T.key!==s.key&&(D.push(T.key),m=u.getTile(T))}const R=B=>{D.forEach(W=>{y[W]=B}),D.length=0};for(S-=1;S>=A&&(!m||!m.hasData());S--){m&&R(m.tileID.key);const B=T.calculateScaledKey(S);if(m=u.getTileByID(B),m&&m.hasData())break;const W=y[B];if(W===null)break;W===void 0?D.push(B):m=u.getTileByID(W)}return R(m?m.tileID.key:null),m&&m.hasData()?m:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,u){let m=this._tilesDirty[s];m||(m=this._tilesDirty[s]={}),m[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(u){let m=0;const y=new a.StructArrayLayout2ui4,x=131;for(let T=1;T<129;T++){for(let S=1;S<129;S++)m=T*x+S,y.emplaceBack(m,m+1),y.emplaceBack(m,m+x),y.emplaceBack(m+1,m+x),T===128&&y.emplaceBack(m+x,m+x+1);y.emplaceBack(m+1,m+1+x)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=a.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Jt{static cacheKey(s,u,m,y){let x=`${u}${y?y.cacheKey:""}`;for(const T of m)s.usedDefines.includes(T)&&(x+=`/${T}`);return x}constructor(s,u,m,y,x,T){const S=s.gl;this.program=S.createProgram();const A=function(F){const H=[];for(let ie=0;ie<F.length;ie++){if(F[ie]===null)continue;const se=F[ie].split(" ");H.push(se.pop())}return H}(m.staticAttributes),D=y?y.getBinderAttributes():[],R=A.concat(D);let B=y?y.defines():[];B=B.concat(T.map(F=>`#define ${F}`));const W=s.isWebGL2?`#version 300 es
`:"",Z=W+B.concat(s.extStandardDerivatives&&W.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(Dd):Dd,Dd,bu,Dm.fragmentSource,$a.fragmentSource,m.fragmentSource).join(`
`),Y=W+B.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,bu,Dm.vertexSource,$a.vertexSource,wu.vertexSource,m.vertexSource).join(`
`),K=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(K,Z),S.compileShader(K),S.attachShader(this.program,K);const Q=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Q,Y),S.compileShader(Q),S.attachShader(this.program,Q),this.attributes={},this.numAttributes=R.length;for(let F=0;F<this.numAttributes;F++)R[F]&&(S.bindAttribLocation(this.program,F,R[F]),this.attributes[R[F]]=F);S.linkProgram(this.program),S.deleteShader(Q),S.deleteShader(K),this.fixedUniforms=x(s),this.binderUniforms=y?y.getUniforms(s):[],T.includes("TERRAIN")&&(this.terrainUniforms=(F=>({u_dem:new a.Uniform1i(F),u_dem_prev:new a.Uniform1i(F),u_dem_unpack:new a.Uniform4f(F),u_dem_tl:new a.Uniform2f(F),u_dem_scale:new a.Uniform1f(F),u_dem_tl_prev:new a.Uniform2f(F),u_dem_scale_prev:new a.Uniform1f(F),u_dem_size:new a.Uniform1f(F),u_dem_lerp:new a.Uniform1f(F),u_exaggeration:new a.Uniform1f(F),u_depth:new a.Uniform1i(F),u_depth_size_inv:new a.Uniform2f(F),u_meter_to_dem:new a.Uniform1f(F),u_label_plane_matrix_inv:new a.UniformMatrix4f(F)}))(s)),T.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new a.Uniform3f(F),u_tile_tr_up:new a.Uniform3f(F),u_tile_br_up:new a.Uniform3f(F),u_tile_bl_up:new a.Uniform3f(F),u_tile_up_scale:new a.Uniform1f(F)}))(s)),T.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new a.UniformMatrix4f(F),u_fog_range:new a.Uniform2f(F),u_fog_color:new a.Uniform4f(F),u_fog_horizon_blend:new a.Uniform1f(F),u_fog_temporal_offset:new a.Uniform1f(F),u_frustum_tl:new a.Uniform3f(F),u_frustum_tr:new a.Uniform3f(F),u_frustum_br:new a.Uniform3f(F),u_frustum_bl:new a.Uniform3f(F),u_globe_pos:new a.Uniform3f(F),u_globe_radius:new a.Uniform1f(F),u_globe_transition:new a.Uniform1f(F),u_is_globe:new a.Uniform1i(F),u_viewport:new a.Uniform2f(F)}))(s))}}setTerrainUniformValues(s,u){if(!this.terrainUniforms)return;const m=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setGlobeUniformValues(s,u){if(!this.globeUniforms)return;const m=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in u)m[y]&&m[y].set(this.program,y,u[y])}}setFogUniformValues(s,u){if(!this.fogUniforms)return;const m=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in u)m[y].set(this.program,y,u[y])}}draw(s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K){const Q=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(y),s.setColorMode(x),s.setCullFace(T);for(const H of Object.keys(this.fixedUniforms))this.fixedUniforms[H].set(this.program,H,S[H]);Y&&Y.setUniforms(this.program,s,this.binderUniforms,W,{zoom:Z});const F={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[u];for(const H of B.get()){const ie=H.vaos||(H.vaos={});(ie[A]||(ie[A]=new bv)).bind(s,this,D,Y?Y.getPaintVertexBuffers():[],R,H.vertexOffset,K||[]),Q.drawElements(u,H.primitiveLength*F,Q.UNSIGNED_SHORT,H.primitiveOffset*F*2)}}}function pc(f,s){const u=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,f.transform.tileZoom)/u,y=m*(s.tileID.canonical.x+s.tileID.wrap*u),x=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/Vt(s,1,f.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x]}}const Bm=a.create(),Ud=(f,s,u,m,y,x,T,S,A,D,R)=>{const B=s.style.light,W=B.properties.get("position"),Z=[W.x,W.y,W.z],Y=a.create$1();B.properties.get("anchor")==="viewport"&&(a.fromRotation(Y,-s.transform.angle),a.transformMat3(Z,Z,Y));const K=B.properties.get("color"),Q=s.transform,F={u_matrix:f,u_lightpos:Z,u_lightintensity:B.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+u,u_opacity:m,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:x};return Q.projection.name==="globe"&&(F.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],F.u_zoom_transition=A,F.u_inv_rot_matrix=R,F.u_merc_center=D,F.u_up_dir=Q.projection.upVector(new a.CanonicalTileID(0,0,0),D[0]*a.EXTENT,D[1]*a.EXTENT),F.u_height_lift=S),F},Fm=(f,s,u,m,y,x,T,S,A,D,R,B)=>{const W=Ud(f,s,u,m,y,x,T,A,D,R,B),Z={u_height_factor:-Math.pow(2,T.overscaledZ)/S.tileSize/8};return a.extend(W,pc(s,S),Z)},Ys=f=>({u_matrix:f}),Vd=(f,s,u)=>a.extend(Ys(f),pc(s,u)),Ev=(f,s)=>({u_matrix:f,u_world:s}),Tv=(f,s,u,m)=>a.extend(Vd(f,s,u),{u_world:m}),Sv=a.create(),$d=(f,s,u,m,y,x)=>{const T=f.transform,S=T.projection.name==="globe";let A;if(x.paint.get("circle-pitch-alignment")==="map")if(S){const R=a.globePixelsToTileUnits(T.zoom,s.canonical)*T._pixelsPerMercatorPixel;A=Float32Array.from([R,0,0,R])}else A=T.calculatePixelsToTileUnitsMatrix(u);else A=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const D={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:f.translatePosMatrix(s.projMatrix,u,x.paint.get("circle-translate"),x.paint.get("circle-translate-anchor")),u_device_pixel_ratio:a.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:Sv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){D.u_inv_rot_matrix=m,D.u_merc_center=y,D.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],D.u_zoom_transition=a.globeToMercatorTransition(T.zoom);const R=y[0]*a.EXTENT,B=y[1]*a.EXTENT;D.u_up_dir=T.projection.upVector(new a.CanonicalTileID(0,0,0),R,B)}return D},Gd=f=>{const s=[];return f.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),f.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},Wd=(f,s,u,m)=>{const y=a.EXTENT/u.tileSize;return{u_matrix:f,u_camera_to_center_distance:s.getCameraToCenterDistance(m),u_extrude_scale:[s.pixelsToGLUnits[0]/y,s.pixelsToGLUnits[1]/y]}},Cu=(f,s,u=1)=>({u_matrix:f,u_color:s,u_overlay:0,u_overlay_scale:u}),Nm=a.create(),jm=(f,s,u,m,y,x,T)=>{const S=f.transform,A=S.projection.name==="globe",D=A?a.globePixelsToTileUnits(S.zoom,s.canonical)*S._pixelsPerMercatorPixel:Vt(u,1,x),R={u_matrix:s.projMatrix,u_extrude_scale:D,u_intensity:T,u_inv_rot_matrix:Nm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){R.u_inv_rot_matrix=m,R.u_merc_center=y,R.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],R.u_zoom_transition=a.globeToMercatorTransition(S.zoom);const B=y[0]*a.EXTENT,W=y[1]*a.EXTENT;R.u_up_dir=S.projection.upVector(new a.CanonicalTileID(0,0,0),B,W)}return R},Iv=(f,s,u,m,y,x,T)=>{const S=f.transform,A=S.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:qd(f,s,u,m),u_pixels_to_tile_units:A,u_device_pixel_ratio:x,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:gc(u)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ha(s,f.transform),u_alpha_discard_threshold:0,u_trim_offset:T}},mc=(f,s,u,m,y)=>{const x=f.transform;return{u_matrix:qd(f,s,u,m),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:Ha(s,x),u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ha(f,s){return 1/Vt(f,1,s.tileZoom)}function qd(f,s,u,m){return f.translatePosMatrix(m||s.tileID.projMatrix,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function gc(f){const s=f.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const Hd=(f,s,u,m,y,x)=>{return{u_matrix:f,u_tl_parent:s,u_scale_parent:u,u_fade_t:m.mix,u_opacity:m.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(T=y.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:mo(y.paint.get("raster-hue-rotate")),u_perspective_transform:x};var T,S};function mo(f){f*=Math.PI/180;const s=Math.sin(f),u=Math.cos(f);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const Au=a.create(),Zd=(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K)=>{const Q=y.transform,F={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:Q.width/Q.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:T,u_coord_matrix:S,u_is_text:+A,u_pitch_with_map:+m,u_texsize:D,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Au,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Au,u_up_vector:[0,-1,0]};return K.name==="globe"&&(F.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],F.u_zoom_transition=B,F.u_inv_rot_matrix=Z,F.u_merc_center=W,F.u_camera_forward=Q._camera.forward(),F.u_ecef_origin=a.globeECEFOrigin(Q.globeMatrix,R.toUnwrapped()),F.u_tile_matrix=Float32Array.from(Q.globeMatrix),F.u_up_vector=Y),F},Pu=(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K,Q)=>a.extend(Zd(f,s,u,m,y,x,T,S,A,D,B,W,Z,Y,K,Q),{u_gamma_scale:m?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:a.exported.devicePixelRatio,u_is_halo:+R}),Um=(f,s,u,m,y,x,T,S,A,D,R,B,W,Z,Y,K)=>a.extend(Pu(f,s,u,m,y,x,T,S,!0,A,!0,R,B,W,Z,Y,K),{u_texsize_icon:D,u_texture_icon:1}),Xd=(f,s,u)=>({u_matrix:f,u_opacity:s,u_color:u}),Cv=(f,s,u,m,y)=>a.extend(function(x,T,S){const A=T.imageManager.getPattern(x.toString()),{width:D,height:R}=T.imageManager.getPixelSize(),B=Math.pow(2,S.tileID.overscaledZ),W=S.tileSize*Math.pow(2,T.transform.tileZoom)/B,Z=W*(S.tileID.canonical.x+S.tileID.wrap*B),Y=W*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:A.tl,u_pattern_br:A.br,u_texsize:[D,R],u_pattern_size:A.displaySize,u_tile_units_to_pixels:1/Vt(S,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,Y>>16],u_pixel_coord_lower:[65535&Z,65535&Y]}}(m,u,y),{u_matrix:f,u_opacity:s}),Kd={fillExtrusion:f=>({u_matrix:new a.UniformMatrix4f(f),u_lightpos:new a.Uniform3f(f),u_lightintensity:new a.Uniform1f(f),u_lightcolor:new a.Uniform3f(f),u_vertical_gradient:new a.Uniform1f(f),u_opacity:new a.Uniform1f(f),u_edge_radius:new a.Uniform1f(f),u_ao:new a.Uniform2f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_up_dir:new a.Uniform3f(f),u_height_lift:new a.Uniform1f(f)}),fillExtrusionPattern:f=>({u_matrix:new a.UniformMatrix4f(f),u_lightpos:new a.Uniform3f(f),u_lightintensity:new a.Uniform1f(f),u_lightcolor:new a.Uniform3f(f),u_vertical_gradient:new a.Uniform1f(f),u_height_factor:new a.Uniform1f(f),u_edge_radius:new a.Uniform1f(f),u_ao:new a.Uniform2f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_up_dir:new a.Uniform3f(f),u_height_lift:new a.Uniform1f(f),u_image:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_pixel_coord_upper:new a.Uniform2f(f),u_pixel_coord_lower:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f),u_opacity:new a.Uniform1f(f)}),fill:f=>({u_matrix:new a.UniformMatrix4f(f)}),fillPattern:f=>({u_matrix:new a.UniformMatrix4f(f),u_image:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_pixel_coord_upper:new a.Uniform2f(f),u_pixel_coord_lower:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f)}),fillOutline:f=>({u_matrix:new a.UniformMatrix4f(f),u_world:new a.Uniform2f(f)}),fillOutlinePattern:f=>({u_matrix:new a.UniformMatrix4f(f),u_world:new a.Uniform2f(f),u_image:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_pixel_coord_upper:new a.Uniform2f(f),u_pixel_coord_lower:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f)}),circle:f=>({u_camera_to_center_distance:new a.Uniform1f(f),u_extrude_scale:new a.UniformMatrix2f(f),u_device_pixel_ratio:new a.Uniform1f(f),u_matrix:new a.UniformMatrix4f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_up_dir:new a.Uniform3f(f)}),collisionBox:f=>({u_matrix:new a.UniformMatrix4f(f),u_camera_to_center_distance:new a.Uniform1f(f),u_extrude_scale:new a.Uniform2f(f)}),collisionCircle:f=>({u_matrix:new a.UniformMatrix4f(f),u_inv_matrix:new a.UniformMatrix4f(f),u_camera_to_center_distance:new a.Uniform1f(f),u_viewport_size:new a.Uniform2f(f)}),debug:f=>({u_color:new a.UniformColor(f),u_matrix:new a.UniformMatrix4f(f),u_overlay:new a.Uniform1i(f),u_overlay_scale:new a.Uniform1f(f)}),clippingMask:f=>({u_matrix:new a.UniformMatrix4f(f)}),heatmap:f=>({u_extrude_scale:new a.Uniform1f(f),u_intensity:new a.Uniform1f(f),u_matrix:new a.UniformMatrix4f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_up_dir:new a.Uniform3f(f)}),heatmapTexture:f=>({u_image:new a.Uniform1i(f),u_color_ramp:new a.Uniform1i(f),u_opacity:new a.Uniform1f(f)}),hillshade:f=>({u_matrix:new a.UniformMatrix4f(f),u_image:new a.Uniform1i(f),u_latrange:new a.Uniform2f(f),u_light:new a.Uniform2f(f),u_shadow:new a.UniformColor(f),u_highlight:new a.UniformColor(f),u_accent:new a.UniformColor(f)}),hillshadePrepare:f=>({u_matrix:new a.UniformMatrix4f(f),u_image:new a.Uniform1i(f),u_dimension:new a.Uniform2f(f),u_zoom:new a.Uniform1f(f),u_unpack:new a.Uniform4f(f)}),line:f=>({u_matrix:new a.UniformMatrix4f(f),u_pixels_to_tile_units:new a.UniformMatrix2f(f),u_device_pixel_ratio:new a.Uniform1f(f),u_units_to_pixels:new a.Uniform2f(f),u_dash_image:new a.Uniform1i(f),u_gradient_image:new a.Uniform1i(f),u_image_height:new a.Uniform1f(f),u_texsize:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f),u_alpha_discard_threshold:new a.Uniform1f(f),u_trim_offset:new a.Uniform2f(f)}),linePattern:f=>({u_matrix:new a.UniformMatrix4f(f),u_texsize:new a.Uniform2f(f),u_pixels_to_tile_units:new a.UniformMatrix2f(f),u_device_pixel_ratio:new a.Uniform1f(f),u_image:new a.Uniform1i(f),u_units_to_pixels:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f),u_alpha_discard_threshold:new a.Uniform1f(f)}),raster:f=>({u_matrix:new a.UniformMatrix4f(f),u_tl_parent:new a.Uniform2f(f),u_scale_parent:new a.Uniform1f(f),u_fade_t:new a.Uniform1f(f),u_opacity:new a.Uniform1f(f),u_image0:new a.Uniform1i(f),u_image1:new a.Uniform1i(f),u_brightness_low:new a.Uniform1f(f),u_brightness_high:new a.Uniform1f(f),u_saturation_factor:new a.Uniform1f(f),u_contrast_factor:new a.Uniform1f(f),u_spin_weights:new a.Uniform3f(f),u_perspective_transform:new a.Uniform2f(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new a.Uniform1i(f),u_is_size_feature_constant:new a.Uniform1i(f),u_size_t:new a.Uniform1f(f),u_size:new a.Uniform1f(f),u_camera_to_center_distance:new a.Uniform1f(f),u_rotate_symbol:new a.Uniform1i(f),u_aspect_ratio:new a.Uniform1f(f),u_fade_change:new a.Uniform1f(f),u_matrix:new a.UniformMatrix4f(f),u_label_plane_matrix:new a.UniformMatrix4f(f),u_coord_matrix:new a.UniformMatrix4f(f),u_is_text:new a.Uniform1i(f),u_pitch_with_map:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_camera_forward:new a.Uniform3f(f),u_tile_matrix:new a.UniformMatrix4f(f),u_up_vector:new a.Uniform3f(f),u_ecef_origin:new a.Uniform3f(f),u_texture:new a.Uniform1i(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new a.Uniform1i(f),u_is_size_feature_constant:new a.Uniform1i(f),u_size_t:new a.Uniform1f(f),u_size:new a.Uniform1f(f),u_camera_to_center_distance:new a.Uniform1f(f),u_rotate_symbol:new a.Uniform1i(f),u_aspect_ratio:new a.Uniform1f(f),u_fade_change:new a.Uniform1f(f),u_matrix:new a.UniformMatrix4f(f),u_label_plane_matrix:new a.UniformMatrix4f(f),u_coord_matrix:new a.UniformMatrix4f(f),u_is_text:new a.Uniform1i(f),u_pitch_with_map:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_texture:new a.Uniform1i(f),u_gamma_scale:new a.Uniform1f(f),u_device_pixel_ratio:new a.Uniform1f(f),u_tile_id:new a.Uniform3f(f),u_zoom_transition:new a.Uniform1f(f),u_inv_rot_matrix:new a.UniformMatrix4f(f),u_merc_center:new a.Uniform2f(f),u_camera_forward:new a.Uniform3f(f),u_tile_matrix:new a.UniformMatrix4f(f),u_up_vector:new a.Uniform3f(f),u_ecef_origin:new a.Uniform3f(f),u_is_halo:new a.Uniform1i(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new a.Uniform1i(f),u_is_size_feature_constant:new a.Uniform1i(f),u_size_t:new a.Uniform1f(f),u_size:new a.Uniform1f(f),u_camera_to_center_distance:new a.Uniform1f(f),u_rotate_symbol:new a.Uniform1i(f),u_aspect_ratio:new a.Uniform1f(f),u_fade_change:new a.Uniform1f(f),u_matrix:new a.UniformMatrix4f(f),u_label_plane_matrix:new a.UniformMatrix4f(f),u_coord_matrix:new a.UniformMatrix4f(f),u_is_text:new a.Uniform1i(f),u_pitch_with_map:new a.Uniform1i(f),u_texsize:new a.Uniform2f(f),u_texsize_icon:new a.Uniform2f(f),u_texture:new a.Uniform1i(f),u_texture_icon:new a.Uniform1i(f),u_gamma_scale:new a.Uniform1f(f),u_device_pixel_ratio:new a.Uniform1f(f),u_is_halo:new a.Uniform1i(f)}),background:f=>({u_matrix:new a.UniformMatrix4f(f),u_opacity:new a.Uniform1f(f),u_color:new a.UniformColor(f)}),backgroundPattern:f=>({u_matrix:new a.UniformMatrix4f(f),u_opacity:new a.Uniform1f(f),u_image:new a.Uniform1i(f),u_pattern_tl:new a.Uniform2f(f),u_pattern_br:new a.Uniform2f(f),u_texsize:new a.Uniform2f(f),u_pattern_size:new a.Uniform2f(f),u_pixel_coord_upper:new a.Uniform2f(f),u_pixel_coord_lower:new a.Uniform2f(f),u_tile_units_to_pixels:new a.Uniform1f(f)}),terrainRaster:Bd,terrainDepth:Bd,skybox:f=>({u_matrix:new a.UniformMatrix4f(f),u_sun_direction:new a.Uniform3f(f),u_cubemap:new a.Uniform1i(f),u_opacity:new a.Uniform1f(f),u_temporal_offset:new a.Uniform1f(f)}),skyboxGradient:f=>({u_matrix:new a.UniformMatrix4f(f),u_color_ramp:new a.Uniform1i(f),u_center_direction:new a.Uniform3f(f),u_radius:new a.Uniform1f(f),u_opacity:new a.Uniform1f(f),u_temporal_offset:new a.Uniform1f(f)}),skyboxCapture:f=>({u_matrix_3f:new a.UniformMatrix3f(f),u_sun_direction:new a.Uniform3f(f),u_sun_intensity:new a.Uniform1f(f),u_color_tint_r:new a.Uniform4f(f),u_color_tint_m:new a.Uniform4f(f),u_luminance:new a.Uniform1f(f)}),globeRaster:f=>({u_proj_matrix:new a.UniformMatrix4f(f),u_globe_matrix:new a.UniformMatrix4f(f),u_normalize_matrix:new a.UniformMatrix4f(f),u_merc_matrix:new a.UniformMatrix4f(f),u_zoom_transition:new a.Uniform1f(f),u_merc_center:new a.Uniform2f(f),u_image0:new a.Uniform1i(f),u_grid_matrix:new a.UniformMatrix3f(f),u_skirt_height:new a.Uniform1f(f),u_frustum_tl:new a.Uniform3f(f),u_frustum_tr:new a.Uniform3f(f),u_frustum_br:new a.Uniform3f(f),u_frustum_bl:new a.Uniform3f(f),u_globe_pos:new a.Uniform3f(f),u_globe_radius:new a.Uniform1f(f),u_viewport:new a.Uniform2f(f)}),globeAtmosphere:f=>({u_frustum_tl:new a.Uniform3f(f),u_frustum_tr:new a.Uniform3f(f),u_frustum_br:new a.Uniform3f(f),u_frustum_bl:new a.Uniform3f(f),u_horizon:new a.Uniform1f(f),u_transition:new a.Uniform1f(f),u_fadeout_range:new a.Uniform1f(f),u_color:new a.Uniform4f(f),u_high_color:new a.Uniform4f(f),u_space_color:new a.Uniform4f(f),u_star_intensity:new a.Uniform1f(f),u_star_density:new a.Uniform1f(f),u_star_size:new a.Uniform1f(f),u_temporal_offset:new a.Uniform1f(f),u_horizon_angle:new a.Uniform1f(f),u_rotation_matrix:new a.UniformMatrix4f(f)})};let ku;function _c(f,s,u,m,y,x,T){const S=f.context,A=S.gl,D=f.transform,R=f.useProgram("collisionBox"),B=[];let W=0,Z=0;for(let se=0;se<m.length;se++){const ge=m[se],ye=s.getTile(ge),_e=ye.getBucket(u);if(!_e)continue;const Ee=Ti(ge,_e,D);let be=Ee;y[0]===0&&y[1]===0||(be=f.translatePosMatrix(Ee,ye,y,x));const ke=T?_e.textCollisionBox:_e.iconCollisionBox,Ke=_e.collisionCircleArray;if(Ke.length>0){const Ce=a.create(),Ue=be;a.mul(Ce,_e.placementInvProjMatrix,D.glCoordMatrix),a.mul(Ce,Ce,_e.placementViewportMatrix),B.push({circleArray:Ke,circleOffset:Z,transform:Ue,invTransform:Ce,projection:_e.getProjection()}),W+=Ke.length/4,Z=W}ke&&(f.terrain&&f.terrain.setupElevationDraw(ye,R),R.draw(S,A.LINES,a.DepthMode.disabled,a.StencilMode.disabled,f.colorModeForRenderPass(),a.CullFaceMode.disabled,Wd(be,D,ye,_e.getProjection()),u.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,null,D.zoom,null,[ke.collisionVertexBuffer,ke.collisionVertexBufferExt]))}if(!T||!B.length)return;const Y=f.useProgram("collisionCircle"),K=new a.StructArrayLayout2f1f2i16;K.resize(4*W),K._trim();let Q=0;for(const se of B)for(let ge=0;ge<se.circleArray.length/4;ge++){const ye=4*ge,_e=se.circleArray[ye+0],Ee=se.circleArray[ye+1],be=se.circleArray[ye+2],ke=se.circleArray[ye+3];K.emplace(Q++,_e,Ee,be,ke,0),K.emplace(Q++,_e,Ee,be,ke,1),K.emplace(Q++,_e,Ee,be,ke,2),K.emplace(Q++,_e,Ee,be,ke,3)}(!ku||ku.length<2*W)&&(ku=function(se){const ge=2*se,ye=new a.StructArrayLayout3ui6;ye.resize(ge),ye._trim();for(let _e=0;_e<ge;_e++){const Ee=6*_e;ye.uint16[Ee+0]=4*_e+0,ye.uint16[Ee+1]=4*_e+1,ye.uint16[Ee+2]=4*_e+2,ye.uint16[Ee+3]=4*_e+2,ye.uint16[Ee+4]=4*_e+3,ye.uint16[Ee+5]=4*_e+0}return ye}(W));const F=S.createIndexBuffer(ku,!0),H=S.createVertexBuffer(K,a.collisionCircleLayout.members,!0);for(const se of B){const ge={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ie=D).getCameraToCenterDistance(se.projection),u_viewport_size:[ie.width,ie.height]};Y.draw(S,A.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,f.colorModeForRenderPass(),a.CullFaceMode.disabled,ge,u.id,H,F,a.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,D.zoom)}var ie;H.destroy(),F.destroy()}const Vm=a.create();function Jd({width:f,height:s,anchor:u,textOffset:m,textScale:y},x){const{horizontalAlign:T,verticalAlign:S}=a.getAnchorAlignment(u),A=-(T-.5)*f,D=-(S-.5)*s,R=a.evaluateVariableOffset(u,m);return new a.Point((A/y+R[0])*x,(D/y+R[1])*x)}function Av(f,s,u,m,y,x,T,S,A,D,R){const B=f.text.placedSymbolArray,W=f.text.dynamicLayoutVertexArray,Z=f.icon.dynamicLayoutVertexArray,Y={},K=f.getProjection(),Q=Mn(S,K,x),F=x.elevation,H=K.upVectorScale(S.canonical,x.center.lat,x.worldSize).metersToTile;W.clear();for(let ie=0;ie<B.length;ie++){const se=B.get(ie),{tileAnchorX:ge,tileAnchorY:ye,numGlyphs:_e}=se,Ee=se.hidden||!se.crossTileID||f.allowVerticalPlacement&&!se.placedOrientation?null:m[se.crossTileID];if(Ee){let be=0,ke=0,Ke=0;if(F){const et=F?F.getAtTileOffset(S,ge,ye):0,[xt,At,mt]=K.upVector(S.canonical,ge,ye);be=et*xt*H,ke=et*At*H,Ke=et*mt*H}let[Ce,Ue,Re,Ze]=wr(se.projectedAnchorX+be,se.projectedAnchorY+ke,se.projectedAnchorZ+Ke,u?Q:T);const Pe=Am(x.getCameraToCenterDistance(K),Ze);let je=y.evaluateSizeForFeature(f.textSizeData,D,se)*Pe/a.ONE_EM;u&&(je*=f.tilePixelRatio/A);const Ye=Jd(Ee,je);u?({x:Ce,y:Ue,z:Re}=K.projectTilePoint(ge+Ye.x,ye+Ye.y,S.canonical),[Ce,Ue,Re]=wr(Ce+be,Ue+ke,Re+Ke,T)):(s&&Ye._rotate(-x.angle),Ce+=Ye.x,Ue+=Ye.y,Re=0);const We=f.allowVerticalPlacement&&se.placedOrientation===a.WritingMode.vertical?Math.PI/2:0;for(let et=0;et<_e;et++)a.addDynamicAttributes(W,Ce,Ue,Re,We);R&&se.associatedIconIndex>=0&&(Y[se.associatedIconIndex]={x:Ce,y:Ue,z:Re,angle:We})}else $i(_e,W)}if(R){Z.clear();const ie=f.icon.placedSymbolArray;for(let se=0;se<ie.length;se++){const ge=ie.get(se),{numGlyphs:ye}=ge,_e=Y[se];if(ge.hidden||!_e)$i(ye,Z);else{const{x:Ee,y:be,z:ke,angle:Ke}=_e;for(let Ce=0;Ce<ye;Ce++)a.addDynamicAttributes(Z,Ee,be,ke,Ke)}}f.icon.dynamicLayoutVertexBuffer.updateData(Z)}f.text.dynamicLayoutVertexBuffer.updateData(W)}function Yd(f,s,u){return u.iconsInText&&s?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function $m(f,s,u,m,y,x,T,S,A,D,R,B){const W=f.context,Z=W.gl,Y=f.transform,K=S==="map",Q=A==="map",F=K&&u.layout.get("symbol-placement")!=="point",H=K&&!Q&&!F,ie=u.layout.get("symbol-sort-key").constantOr(1)!==void 0;let se=!1;const ge=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),ye=[a.mercatorXfromLng(Y.center.lng),a.mercatorYfromLat(Y.center.lat)],_e=u.layout.get("text-variable-anchor"),Ee=Y.projection.name==="globe",be=[],ke=[0,-1,0];let Ke=ke;!Ee&&!Y.mercatorFromTransition||K||(Ke=function(Ce){const Ue=Ce._camera.getWorldToCamera(Ce.worldSize,1),Re=a.multiply([],Ue,Ce.globeMatrix);a.invert(Re,Re);const Ze=[0,0,0],Pe=[0,1,0,0];return a.transformMat4$1(Pe,Pe,Re),Ze[0]=Pe[0],Ze[1]=Pe[1],Ze[2]=Pe[2],a.normalize(Ze,Ze),Ze}(Y));for(const Ce of m){const Ue=s.getTile(Ce),Re=Ue.getBucket(u);if(!Re||Re.projection.name==="mercator"&&Ee)continue;const Ze=y?Re.text:Re.icon;if(!Ze||Re.fullyClipped||!Ze.segments.get().length)continue;const Pe=Ze.programConfigurations.get(u.id),je=y||Re.sdfIcons,Ye=y?Re.textSizeData:Re.iconSizeData,We=Q||Y.pitch!==0,et=a.evaluateSizeForZoom(Ye,Y.zoom);let xt,At,mt,St,Wt=[0,0],Nt=null;if(y)At=Ue.glyphAtlasTexture,mt=Z.LINEAR,xt=Ue.glyphAtlasTexture.size,Re.iconsInText&&(Wt=Ue.imageAtlasTexture.size,Nt=Ue.imageAtlasTexture,St=We||f.options.rotating||f.options.zooming||Ye.kind==="composite"||Ye.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const qo=u.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear;At=Ue.imageAtlasTexture,mt=je||f.options.rotating||f.options.zooming||qo||We?Z.LINEAR:Z.NEAREST,xt=Ue.imageAtlasTexture.size}const yt=Re.projection.name==="globe",ln=yt?Ke:ke,fn=yt?a.globeToMercatorTransition(Y.zoom):0,pn=Mn(Ce,Re.getProjection(),Y),mn=Y.calculatePixelsToTileUnitsMatrix(Ue),Fr=Be(pn,Ue.tileID.canonical,Q,K,Y,Re.getProjection(),mn),Er=f.terrain&&Q&&F?a.invert(a.create(),Fr):Vm,Ai=Jn(pn,Ue.tileID.canonical,Q,K,Y,Re.getProjection(),mn),_o=_e&&Re.hasTextData(),Rn=u.layout.get("icon-text-fit")!=="none"&&_o&&Re.hasIconData();if(F){const qo=Y.elevation,ys=qo?qo.getAtTileOffsetFunc(Ce,Y.center.lat,Y.worldSize,Re.getProjection()):null,ra=Fo(pn,Ue.tileID.canonical,Q,K,Y,Re.getProjection(),mn);Td(Re,pn,f,y,ra,Ai,Q,D,ys,Ce)}const gn=F||y&&_e||Rn,tn=f.translatePosMatrix(pn,Ue,x,T),Yn=gn?Vm:Fr,Zr=f.translatePosMatrix(Ai,Ue,x,T,!0),Pn=Re.getProjection().createInversionMatrix(Y,Ce.canonical),ti=[];f.terrainRenderModeElevated()&&Q&&ti.push("PITCH_WITH_MAP_TERRAIN"),yt&&ti.push("PROJECTION_GLOBE_VIEW"),gn&&ti.push("PROJECTED_POS_ON_VIEWPORT");const qu=je&&u.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let na;na=je?Re.iconsInText?Um(Ye.kind,et,H,Q,f,tn,Yn,Zr,xt,Wt,Ce,fn,ye,Pn,ln,Re.getProjection()):Pu(Ye.kind,et,H,Q,f,tn,Yn,Zr,y,xt,!0,Ce,fn,ye,Pn,ln,Re.getProjection()):Zd(Ye.kind,et,H,Q,f,tn,Yn,Zr,y,xt,Ce,fn,ye,Pn,ln,Re.getProjection());const Ac={program:f.useProgram(Yd(je,y,Re),Pe,ti),buffers:Ze,uniformValues:na,atlasTexture:At,atlasTextureIcon:Nt,atlasInterpolation:mt,atlasInterpolationIcon:St,isSDF:je,hasHalo:qu,tile:Ue,labelPlaneMatrixInv:Er};if(ie&&Re.canOverlap){se=!0;const qo=Ze.segments.get();for(const ys of qo)be.push({segments:new a.SegmentVector([ys]),sortKey:ys.sortKey,state:Ac})}else be.push({segments:Ze.segments,sortKey:0,state:Ac})}se&&be.sort((Ce,Ue)=>Ce.sortKey-Ue.sortKey);for(const Ce of be){const Ue=Ce.state;if(f.terrain&&f.terrain.setupElevationDraw(Ue.tile,Ue.program,{useDepthForOcclusion:!Ee,labelPlaneMatrixInv:Ue.labelPlaneMatrixInv}),W.activeTexture.set(Z.TEXTURE0),Ue.atlasTexture.bind(Ue.atlasInterpolation,Z.CLAMP_TO_EDGE),Ue.atlasTextureIcon&&(W.activeTexture.set(Z.TEXTURE1),Ue.atlasTextureIcon&&Ue.atlasTextureIcon.bind(Ue.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Ue.isSDF){const Re=Ue.uniformValues;Ue.hasHalo&&(Re.u_is_halo=1,yc(Ue.buffers,Ce.segments,u,f,Ue.program,ge,R,B,Re)),Re.u_is_halo=0}yc(Ue.buffers,Ce.segments,u,f,Ue.program,ge,R,B,Ue.uniformValues)}}function yc(f,s,u,m,y,x,T,S,A){const D=m.context,R=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.globeExtVertexBuffer];y.draw(D,D.gl.TRIANGLES,x,T,S,a.CullFaceMode.disabled,A,u.id,f.layoutVertexBuffer,f.indexBuffer,s,u.paint,m.transform.zoom,f.programConfigurations.get(u.id),R)}function Gm(f,s,u,m,y,x,T){const S=f.context.gl,A=u.paint.get("fill-pattern"),D=A&&A.constantOr(1);let R,B,W,Z,Y;T?(B=D&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=S.LINES):(B=D?"fillPattern":"fill",R=S.TRIANGLES);for(const K of m){const Q=s.getTile(K);if(D&&!Q.patternsLoaded())continue;const F=Q.getBucket(u);if(!F)continue;f.prepareDrawTile();const H=F.programConfigurations.get(u.id),ie=f.useProgram(B,H);D&&(f.context.activeTexture.set(S.TEXTURE0),Q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),H.updatePaintBuffers());const se=A.constantOr(null);if(se&&Q.imageAtlas){const ye=Q.imageAtlas.patternPositions[se.toString()];ye&&H.setConstantPatternPositions(ye)}const ge=f.translatePosMatrix(K.projMatrix,Q,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(T){Z=F.indexBuffer2,Y=F.segments2;const ye=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];W=B==="fillOutlinePattern"&&D?Tv(ge,f,Q,ye):Ev(ge,ye)}else Z=F.indexBuffer,Y=F.segments,W=D?Vd(ge,f,Q):Ys(ge);f.prepareDrawProgram(f.context,ie,K.toUnwrapped()),ie.draw(f.context,R,y,f.stencilModeForClipping(K),x,a.CullFaceMode.disabled,W,u.id,F.layoutVertexBuffer,Z,Y,u.paint,f.transform.zoom,H)}}function Mu(f,s,u,m,y,x,T){const S=f.context,A=S.gl,D=f.transform,R=u.paint.get("fill-extrusion-pattern"),B=R.constantOr(1),W=u.paint.get("fill-extrusion-opacity"),Z=[u.paint.get("fill-extrusion-ambient-occlusion-intensity"),u.paint.get("fill-extrusion-ambient-occlusion-radius")],Y=u.layout.get("fill-extrusion-edge-radius"),K=Y>0&&!u.paint.get("fill-extrusion-rounded-roof"),Q=K?0:Y,F=D.projection.name==="globe"?a.fillExtrusionHeightLift():0,H=D.projection.name==="globe",ie=H?a.globeToMercatorTransition(D.zoom):0,se=[a.mercatorXfromLng(D.center.lng),a.mercatorYfromLat(D.center.lat)],ge=[];H&&ge.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&ge.push("FAUX_AO"),K&&ge.push("ZERO_ROOF_RADIUS");for(const ye of m){const _e=s.getTile(ye),Ee=_e.getBucket(u);if(!Ee||Ee.projection.name!==D.projection.name)continue;const be=Ee.programConfigurations.get(u.id),ke=f.useProgram(B?"fillExtrusionPattern":"fillExtrusion",be,ge);if(f.terrain){const je=f.terrain;if(f.style.terrainSetForDrapingOnly())je.setupElevationDraw(_e,ke,{useMeterToDem:!0});else{if(!Ee.enableTerrain)continue;if(je.setupElevationDraw(_e,ke,{useMeterToDem:!0}),Wm(S,s,ye,Ee,u,je),!Ee.centroidVertexBuffer){const Ye=ke.attributes.a_centroid_pos;Ye!==void 0&&A.vertexAttrib2f(Ye,0,0)}}}B&&(f.context.activeTexture.set(A.TEXTURE0),_e.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),be.updatePaintBuffers());const Ke=R.constantOr(null);if(Ke&&_e.imageAtlas){const je=_e.imageAtlas.patternPositions[Ke.toString()];je&&be.setConstantPatternPositions(je)}const Ce=f.translatePosMatrix(ye.projMatrix,_e,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),Ue=D.projection.createInversionMatrix(D,ye.canonical),Re=u.paint.get("fill-extrusion-vertical-gradient"),Ze=B?Fm(Ce,f,Re,W,Z,Q,ye,_e,F,ie,se,Ue):Ud(Ce,f,Re,W,Z,Q,ye,F,ie,se,Ue);f.prepareDrawProgram(S,ke,ye.toUnwrapped());const Pe=[];f.terrain&&Pe.push(Ee.centroidVertexBuffer),H&&Pe.push(Ee.layoutVertexExtBuffer),ke.draw(S,S.gl.TRIANGLES,y,x,T,a.CullFaceMode.backCCW,Ze,u.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,u.paint,f.transform.zoom,be,Pe)}}function Wm(f,s,u,m,y,x){const T=[F=>{let H=F.canonical.x-1,ie=F.wrap;return H<0&&(H=(1<<F.canonical.z)-1,ie--),new a.OverscaledTileID(F.overscaledZ,ie,F.canonical.z,H,F.canonical.y)},F=>{let H=F.canonical.x+1,ie=F.wrap;return H===1<<F.canonical.z&&(H=0,ie++),new a.OverscaledTileID(F.overscaledZ,ie,F.canonical.z,H,F.canonical.y)},F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,(F.canonical.y===0?1<<F.canonical.z:F.canonical.y)-1),F=>new a.OverscaledTileID(F.overscaledZ,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y===(1<<F.canonical.z)-1?0:F.canonical.y+1)],S=F=>{const H=s.getSource().minzoom,ie=ge=>{const ye=s.getTileByID(ge);if(ye&&ye.hasData())return ye.getBucket(y)},se=[0,-1,1];for(const ge of se){if(F.overscaledZ+ge<H)continue;const ye=ie(F.calculateScaledKey(F.overscaledZ+ge));if(ye)return ye}},A=[0,0,0],D=(F,H)=>(A[0]=Math.min(F.min.y,H.min.y),A[1]=Math.max(F.max.y,H.max.y),A[2]=a.EXTENT-H.min.x>F.max.x?H.min.x-a.EXTENT:F.max.x,A),R=(F,H)=>(A[0]=Math.min(F.min.x,H.min.x),A[1]=Math.max(F.max.x,H.max.x),A[2]=a.EXTENT-H.min.y>F.max.y?H.min.y-a.EXTENT:F.max.y,A),B=[(F,H)=>D(F,H),(F,H)=>D(H,F),(F,H)=>R(F,H),(F,H)=>R(H,F)],W=new a.Point(0,0);let Z,Y,K;const Q=(F,H,ie,se,ge)=>{const ye=[[se?ie:F,se?F:ie,0],[se?ie:H,se?H:ie,0]],_e=ge<0?a.EXTENT+ge:ge,Ee=[se?_e:(F+H)/2,se?(F+H)/2:_e,0];return ie===0&&ge<0||ie!==0&&ge>0?x.getForTilePoints(K,[Ee],!0,Y):ye.push(Ee),x.getForTilePoints(u,ye,!0,Z),Math.max(ye[0][2],ye[1][2],Ee[2])/x.exaggeration()};for(let F=0;F<4;F++){const H=(F<2?1:5)-F,ie=m.borders[F];if(ie.length===0)continue;const se=K=T[F](u),ge=S(se);if(!(ge&&ge instanceof a.FillExtrusionBucket&&ge.enableTerrain)||m.borderDoneWithNeighborZ[F]===ge.canonical.z&&ge.borderDoneWithNeighborZ[H]===m.canonical.z||(Y=x.findDEMTileFor(se),!Y||!Y.dem))continue;if(!Z){const be=x.findDEMTileFor(u);if(!be||!be.dem)return;Z=be}const ye=ge.borders[H];let _e=0;const Ee=ge.borderDoneWithNeighborZ[H]!==m.canonical.z;if(m.canonical.z===ge.canonical.z){for(let be=0;be<ie.length;be++){const ke=m.featuresOnBorder[ie[be]],Ke=ke.borders[F];let Ce;for(;_e<ye.length&&(Ce=ge.featuresOnBorder[ye[_e]],!(Ce.borders[H][1]>Ke[0]+3));)Ee&&ge.encodeCentroid(void 0,Ce,!1),_e++;if(Ce&&_e<ye.length){const Ue=_e;let Re=0;for(;!(Ce.borders[H][0]>Ke[1]-3)&&(Re++,++_e!==ye.length);)Ce=ge.featuresOnBorder[ye[_e]];if(Ce=ge.featuresOnBorder[ye[Ue]],ke.intersectsCount()>1||Ce.intersectsCount()>1||Re!==1){Re!==1&&(_e=Ue),m.encodeCentroid(void 0,ke,!1),Ee&&ge.encodeCentroid(void 0,Ce,!1);continue}const Ze=B[F](ke,Ce),Pe=F%2?a.EXTENT-1:0;W.x=Q(Ze[0],Math.min(a.EXTENT-1,Ze[1]),Pe,F<2,Ze[2]),W.y=0,m.encodeCentroid(W,ke,!1),Ee&&ge.encodeCentroid(W,Ce,!1)}else m.encodeCentroid(void 0,ke,!1)}m.borderDoneWithNeighborZ[F]=ge.canonical.z,m.needsCentroidUpdate=!0,Ee&&(ge.borderDoneWithNeighborZ[H]=m.canonical.z,ge.needsCentroidUpdate=!0)}else{for(const be of ie)m.encodeCentroid(void 0,m.featuresOnBorder[be],!1);if(Ee){for(const be of ye)ge.encodeCentroid(void 0,ge.featuresOnBorder[be],!1);ge.borderDoneWithNeighborZ[H]=m.canonical.z,ge.needsCentroidUpdate=!0}m.borderDoneWithNeighborZ[F]=ge.canonical.z,m.needsCentroidUpdate=!0}}(m.needsCentroidUpdate||!m.centroidVertexBuffer&&m.centroidVertexArray.length!==0)&&m.uploadCentroid(f)}const Za=new a.Color(1,0,0,1),Pv=new a.Color(0,1,0,1),kv=new a.Color(0,0,1,1),Mv=new a.Color(1,0,1,1),Rv=new a.Color(0,1,1,1);function Dv(f,s,u){const m=f.context,y=f.transform,x=m.gl,T=y.projection.name==="globe",S=T?["PROJECTION_GLOBE_VIEW"]:null;let A=u.projMatrix;if(T&&a.globeToMercatorTransition(y.zoom)>0){const ke=a.transitionTileAABBinECEF(u.canonical,y),Ke=a.globeDenormalizeECEF(ke);A=a.multiply(new Float32Array(16),y.globeMatrix,Ke),a.multiply(A,y.projMatrix,A)}const D=f.useProgram("debug",null,S),R=s.getTileByID(u.key);f.terrain&&f.terrain.setupElevationDraw(R,D);const B=a.DepthMode.disabled,W=a.StencilMode.disabled,Z=f.colorModeForRenderPass(),Y="$debug";m.activeTexture.set(x.TEXTURE0),f.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),T?R._makeGlobeTileDebugBuffers(f.context,y):R._makeDebugTileBoundsBuffers(f.context,y.projection);const K=R._tileDebugBuffer||f.debugBuffer,Q=R._tileDebugIndexBuffer||f.debugIndexBuffer,F=R._tileDebugSegments||f.debugSegments;D.draw(m,x.LINE_STRIP,B,W,Z,a.CullFaceMode.disabled,Cu(A,a.Color.red),Y,K,Q,F,null,null,null,[R._globeTileDebugBorderBuffer]);const H=R.latestRawTileData,ie=Math.floor((H&&H.byteLength||0)/1024),se=s.getTile(u).tileSize,ge=512/Math.min(se,512)*(u.overscaledZ/y.zoom)*.5;let ye=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(ye+=` => ${u.overscaledZ}`),ye+=` ${ie}kb`,function(ke,Ke){ke.initDebugOverlayCanvas();const Ce=ke.debugOverlayCanvas,Ue=ke.context.gl,Re=ke.debugOverlayCanvas.getContext("2d");Re.clearRect(0,0,Ce.width,Ce.height),Re.shadowColor="white",Re.shadowBlur=2,Re.lineWidth=1.5,Re.strokeStyle="white",Re.textBaseline="top",Re.font="bold 36px Open Sans, sans-serif",Re.fillText(Ke,5,5),Re.strokeText(Ke,5,5),ke.debugOverlayTexture.update(Ce),ke.debugOverlayTexture.bind(Ue.LINEAR,Ue.CLAMP_TO_EDGE)}(f,ye);const _e=R._tileDebugTextBuffer||f.debugBuffer,Ee=R._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,be=R._tileDebugTextSegments||f.debugSegments;D.draw(m,x.TRIANGLES,B,W,a.ColorMode.alphaBlended,a.CullFaceMode.disabled,Cu(A,a.Color.transparent,ge),Y,_e,Ee,be,null,null,null,[R._globeTileDebugTextBuffer])}function qm(f,s,u,m){Xa(f,0,s+u/2,f.transform.width,u,m)}function Ru(f,s,u,m){Xa(f,s-u/2,0,u,f.transform.height,m)}function Xa(f,s,u,m,y,x){const T=f.context,S=T.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*a.exported.devicePixelRatio,u*a.exported.devicePixelRatio,m*a.exported.devicePixelRatio,y*a.exported.devicePixelRatio),T.clear({color:x}),S.disable(S.SCISSOR_TEST)}const Hm=a.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Zm}=Hm;function Go(f,s,u,m){f.emplaceBack(s,u,m)}class Du{constructor(s){this.vertexArray=new a.StructArrayLayout3f12,this.indices=new a.StructArrayLayout3ui6,Go(this.vertexArray,-1,-1,1),Go(this.vertexArray,1,-1,1),Go(this.vertexArray,-1,1,1),Go(this.vertexArray,1,1,1),Go(this.vertexArray,-1,-1,-1),Go(this.vertexArray,1,-1,-1),Go(this.vertexArray,-1,1,-1),Go(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Zm),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=a.SegmentVector.simpleSegment(0,0,36,12)}}function Ii(f,s,u,m,y,x){const T=f.gl,S=s.paint.get("sky-atmosphere-color"),A=s.paint.get("sky-atmosphere-halo-color"),D=s.paint.get("sky-atmosphere-sun-intensity"),R=((B,W,Z,Y,K)=>({u_matrix_3f:B,u_sun_direction:W,u_sun_intensity:Z,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(a.fromMat4(a.create$1(),m),y,D,S,A);T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+x,s.skyboxTexture,0),u.draw(f,T.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,a.ColorMode.unblended,a.CullFaceMode.frontCW,R,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const vc=a.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xm{constructor(s){const u=new a.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const m=new a.StructArrayLayout3ui6;m.emplaceBack(0,1,2),m.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(u,vc.members),this.indexBuffer=s.createIndexBuffer(m),this.segments=a.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Qs={symbol:function(f,s,u,m,y){if(f.renderPass!=="translucent")return;const x=a.StencilMode.disabled,T=f.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(S,A,D,R,B,W,Z){const Y=A.transform,K=B==="map",Q=W==="map";for(const F of S){const H=R.getTile(F),ie=H.getBucket(D);if(!ie||!ie.text||!ie.text.segments.get().length)continue;const se=a.evaluateSizeForZoom(ie.textSizeData,Y.zoom),ge=Mn(F,ie.getProjection(),Y),ye=Y.calculatePixelsToTileUnitsMatrix(H),_e=Be(ge,H.tileID.canonical,Q,K,Y,ie.getProjection(),ye),Ee=D.layout.get("icon-text-fit")!=="none"&&ie.hasIconData();if(se){const be=Math.pow(2,Y.zoom-H.tileID.overscaledZ);Av(ie,K,Q,Z,a.symbolSize,Y,_e,F,be,se,Ee)}}}(m,f,u,s,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),y),u.paint.get("icon-opacity").constantOr(1)!==0&&$m(f,s,u,m,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),x,T),u.paint.get("text-opacity").constantOr(1)!==0&&$m(f,s,u,m,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),x,T),s.map.showCollisionBoxes&&(_c(f,s,u,m,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),_c(f,s,u,m,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(f,s,u,m){if(f.renderPass!=="translucent")return;const y=u.paint.get("circle-opacity"),x=u.paint.get("circle-stroke-width"),T=u.paint.get("circle-stroke-opacity"),S=u.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(x.constantOr(1)===0||T.constantOr(1)===0))return;const A=f.context,D=A.gl,R=f.transform,B=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),W=a.StencilMode.disabled,Z=f.colorModeForRenderPass(),Y=R.projection.name==="globe",K=[a.mercatorXfromLng(R.center.lng),a.mercatorYfromLat(R.center.lat)],Q=[];for(let H=0;H<m.length;H++){const ie=m[H],se=s.getTile(ie),ge=se.getBucket(u);if(!ge||ge.projection.name!==R.projection.name)continue;const ye=ge.programConfigurations.get(u.id),_e=Gd(u);Y&&_e.push("PROJECTION_GLOBE_VIEW");const Ee=f.useProgram("circle",ye,_e),be=ge.layoutVertexBuffer,ke=ge.globeExtVertexBuffer,Ke=ge.indexBuffer,Ce=R.projection.createInversionMatrix(R,ie.canonical),Ue={programConfiguration:ye,program:Ee,layoutVertexBuffer:be,globeExtVertexBuffer:ke,indexBuffer:Ke,uniformValues:$d(f,ie,se,Ce,K,u),tile:se};if(S){const Re=ge.segments.get();for(const Ze of Re)Q.push({segments:new a.SegmentVector([Ze]),sortKey:Ze.sortKey,state:Ue})}else Q.push({segments:ge.segments,sortKey:0,state:Ue})}S&&Q.sort((H,ie)=>H.sortKey-ie.sortKey);const F={useDepthForOcclusion:!Y};for(const H of Q){const{programConfiguration:ie,program:se,layoutVertexBuffer:ge,globeExtVertexBuffer:ye,indexBuffer:_e,uniformValues:Ee,tile:be}=H.state,ke=H.segments;f.terrain&&f.terrain.setupElevationDraw(be,se,F),f.prepareDrawProgram(A,se,be.tileID.toUnwrapped()),se.draw(A,D.TRIANGLES,B,W,Z,a.CullFaceMode.disabled,Ee,u.id,ge,_e,ke,u.paint,R.zoom,ie,[ye])}},heatmap:function(f,s,u,m){if(u.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){const y=f.context,x=y.gl,T=a.StencilMode.disabled,S=new a.ColorMode([x.ONE,x.ONE],a.Color.transparent,[!0,!0,!0,!0]);(function(Z,Y,K,Q){const F=Z.gl,H=Y.width*Q,ie=Y.height*Q;Z.activeTexture.set(F.TEXTURE1),Z.viewport.set([0,0,H,ie]);let se=K.heatmapFbo;if(!se||se&&(se.width!==H||se.height!==ie)){se&&se.destroy();const ge=F.createTexture();F.bindTexture(F.TEXTURE_2D,ge),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_2D,F.TEXTURE_MAG_FILTER,F.LINEAR),se=K.heatmapFbo=Z.createFramebuffer(H,ie,!1),function(ye,_e,Ee,be,ke,Ke){const Ce=ye.gl;Ce.texImage2D(Ce.TEXTURE_2D,0,ye.isWebGL2&&ye.extRenderToTextureHalfFloat?Ce.RGBA16F:Ce.RGBA,ke,Ke,0,Ce.RGBA,ye.extRenderToTextureHalfFloat?ye.isWebGL2?Ce.HALF_FLOAT:ye.extTextureHalfFloat.HALF_FLOAT_OES:Ce.UNSIGNED_BYTE,null),be.colorAttachment.set(Ee)}(Z,0,ge,se,H,ie)}else F.bindTexture(F.TEXTURE_2D,se.colorAttachment.get()),Z.bindFramebuffer.set(se.framebuffer)})(y,f,u,f.transform.projection.name==="globe"?.5:.25),y.clear({color:a.Color.transparent});const A=f.transform,D=A.projection.name==="globe",R=D?["PROJECTION_GLOBE_VIEW"]:null,B=D?a.CullFaceMode.frontCCW:a.CullFaceMode.disabled,W=[a.mercatorXfromLng(A.center.lng),a.mercatorYfromLat(A.center.lat)];for(let Z=0;Z<m.length;Z++){const Y=m[Z];if(s.hasRenderableParent(Y))continue;const K=s.getTile(Y),Q=K.getBucket(u);if(!Q||Q.projection.name!==A.projection.name)continue;const F=Q.programConfigurations.get(u.id),H=f.useProgram("heatmap",F,R),{zoom:ie}=f.transform;f.terrain&&f.terrain.setupElevationDraw(K,H),f.prepareDrawProgram(y,H,Y.toUnwrapped());const se=A.projection.createInversionMatrix(A,Y.canonical);H.draw(y,x.TRIANGLES,a.DepthMode.disabled,T,S,B,jm(f,Y,K,se,W,ie,u.paint.get("heatmap-intensity")),u.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,u.paint,f.transform.zoom,F,D?[Q.globeExtVertexBuffer]:null)}y.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(y,x){const T=y.context,S=T.gl,A=x.heatmapFbo;if(!A)return;T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(S.TEXTURE1);let D=x.colorRampTexture;D||(D=x.colorRampTexture=new a.Texture(T,x.colorRamp,S.RGBA)),D.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(T,S.TRIANGLES,a.DepthMode.disabled,a.StencilMode.disabled,y.colorModeForRenderPass(),a.CullFaceMode.disabled,((R,B,W,Z)=>({u_image:0,u_color_ramp:1,u_opacity:B.paint.get("heatmap-opacity")}))(0,x),x.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,x.paint,y.transform.zoom)}(f,u))},line:function(f,s,u,m){if(f.renderPass!=="translucent")return;const y=u.paint.get("line-opacity"),x=u.paint.get("line-width");if(y.constantOr(1)===0||x.constantOr(1)===0)return;const T=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),S=f.colorModeForRenderPass(),A=f.terrain&&f.terrain.renderingToTexture?1:a.exported.devicePixelRatio,D=u.paint.get("line-dasharray"),R=D.constantOr(1),B=u.layout.get("line-cap"),W=u.paint.get("line-pattern"),Z=W.constantOr(1),Y=u.paint.get("line-gradient"),K=Z?"linePattern":"line",Q=f.context,F=Q.gl,H=(se=>{const ge=[];gc(se)&&ge.push("RENDER_LINE_DASH"),se.paint.get("line-gradient")&&ge.push("RENDER_LINE_GRADIENT");const ye=se.paint.get("line-trim-offset");ye[0]===0&&ye[1]===0||ge.push("RENDER_LINE_TRIM_OFFSET");const _e=se.paint.get("line-pattern").constantOr(1),Ee=se.paint.get("line-opacity").constantOr(1)!==1;return!_e&&Ee&&ge.push("RENDER_LINE_ALPHA_DISCARD"),ge})(u);let ie=H.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(ie=!1);for(const se of m){const ge=s.getTile(se);if(Z&&!ge.patternsLoaded())continue;const ye=ge.getBucket(u);if(!ye)continue;f.prepareDrawTile();const _e=ye.programConfigurations.get(u.id),Ee=f.useProgram(K,_e,H),be=W.constantOr(null);if(be&&ge.imageAtlas){const je=ge.imageAtlas.patternPositions[be.toString()];je&&_e.setConstantPatternPositions(je)}const ke=D.constantOr(null),Ke=B.constantOr(null);if(!Z&&ke&&Ke&&ge.lineAtlas){const je=ge.lineAtlas.getDash(ke,Ke);je&&_e.setConstantPatternPositions(je)}let[Ce,Ue]=u.paint.get("line-trim-offset");(Ke==="round"||Ke==="square")&&Ce!==Ue&&(Ce===0&&(Ce-=1),Ue===1&&(Ue+=1));const Re=f.terrain?se.projMatrix:null,Ze=Z?mc(f,ge,u,Re,A):Iv(f,ge,u,Re,ye.lineClipsArray.length,A,[Ce,Ue]);if(Y){const je=ye.gradients[u.id];let Ye=je.texture;if(u.gradientVersion!==je.version){let We=256;if(u.stepInterpolant){const et=s.getSource().maxzoom,xt=se.canonical.z===et?Math.ceil(1<<f.transform.maxZoom-se.canonical.z):1;We=a.clamp(a.nextPowerOfTwo(ye.maxLineLength/a.EXTENT*1024*xt),256,Q.maxTextureSize)}je.gradient=a.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:je.gradient||void 0,clips:ye.lineClipsArray}),je.texture?je.texture.update(je.gradient):je.texture=new a.Texture(Q,je.gradient,F.RGBA),je.version=u.gradientVersion,Ye=je.texture}Q.activeTexture.set(F.TEXTURE1),Ye.bind(u.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}R&&(Q.activeTexture.set(F.TEXTURE0),ge.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),_e.updatePaintBuffers()),Z&&(Q.activeTexture.set(F.TEXTURE0),ge.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),_e.updatePaintBuffers()),f.prepareDrawProgram(Q,Ee,se.toUnwrapped());const Pe=je=>{Ee.draw(Q,F.TRIANGLES,T,je,S,a.CullFaceMode.disabled,Ze,u.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,u.paint,f.transform.zoom,_e,[ye.layoutVertexBuffer2])};if(ie){const je=f.stencilModeForClipping(se).ref;je===0&&f.terrain&&Q.clear({stencil:0});const Ye={func:F.EQUAL,mask:255};Ze.u_alpha_discard_threshold=.8,Pe(new a.StencilMode(Ye,je,255,F.KEEP,F.KEEP,F.INVERT)),Ze.u_alpha_discard_threshold=0,Pe(new a.StencilMode(Ye,je,255,F.KEEP,F.KEEP,F.KEEP))}else Pe(f.stencilModeForClipping(se))}ie&&(f.resetStencilClippingMasks(),f.terrain&&Q.clear({stencil:0}))},fill:function(f,s,u,m){const y=u.paint.get("fill-color"),x=u.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const T=f.colorModeForRenderPass(),S=u.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!S.constantOr(1)&&y.constantOr(a.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){const D=f.depthModeForSublayer(1,f.renderPass==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly);Gm(f,s,u,m,D,T,!1)}if(f.renderPass==="translucent"&&u.paint.get("fill-antialias")){const D=f.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,a.DepthMode.ReadOnly);Gm(f,s,u,m,D,T,!0)}},"fill-extrusion":function(f,s,u,m){const y=u.paint.get("fill-extrusion-opacity");if(y!==0&&f.renderPass==="translucent"){const x=new a.DepthMode(f.context.gl.LEQUAL,a.DepthMode.ReadWrite,f.depthRangeFor3D);if(y!==1||u.paint.get("fill-extrusion-pattern").constantOr(1))Mu(f,s,u,m,x,a.StencilMode.disabled,a.ColorMode.disabled),Mu(f,s,u,m,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const T=f.colorModeForRenderPass();Mu(f,s,u,m,x,a.StencilMode.disabled,T)}}},hillshade:function(f,s,u,m){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent")return;const y=f.context,x=f.depthModeForSublayer(0,a.DepthMode.ReadOnly),T=f.colorModeForRenderPass(),S=f.terrain&&f.terrain.renderingToTexture,[A,D]=f.renderPass!=="translucent"||S?[{},m]:f.stencilConfigForOverlap(m);for(const R of D){const B=s.getTile(R);if(B.needsHillshadePrepare&&f.renderPass==="offscreen")zm(f,B,u,x,a.StencilMode.disabled,T);else if(f.renderPass==="translucent"){const W=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(R):A[R.overscaledZ];Lm(f,R,B,u,x,W,T)}}y.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,s,u,m,y,x){if(f.renderPass!=="translucent"||u.paint.get("raster-opacity")===0||!m.length)return;const T=f.context,S=T.gl,A=s.getSource(),D=f.useProgram("raster"),R=f.colorModeForRenderPass(),B=f.terrain&&f.terrain.renderingToTexture,[W,Z]=A instanceof Bt||B?[{},m]:f.stencilConfigForOverlap(m),Y=Z[Z.length-1].overscaledZ,K=!f.options.moving;for(const Q of Z){const F=B?a.DepthMode.disabled:f.depthModeForSublayer(Q.overscaledZ-Y,u.paint.get("raster-opacity")===1?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly,S.LESS),H=Q.toUnwrapped(),ie=s.getTile(Q);if(B&&(!ie||!ie.hasData()))continue;const se=B?Q.projMatrix:f.transform.calculateProjMatrix(H,K),ge=f.terrain&&B?f.terrain.stencilModeForRTTOverlap(Q):W[Q.overscaledZ],ye=x?0:u.paint.get("raster-fade-duration");ie.registerFadeDuration(ye);const _e=s.findLoadedParent(Q,0),Ee=Fd(ie,_e,s,f.transform,ye);let be,ke;f.terrain&&f.terrain.prepareDrawTile();const Ke=u.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;T.activeTexture.set(S.TEXTURE0),ie.texture.bind(Ke,S.CLAMP_TO_EDGE),T.activeTexture.set(S.TEXTURE1),_e?(_e.texture.bind(Ke,S.CLAMP_TO_EDGE),be=Math.pow(2,_e.tileID.overscaledZ-ie.tileID.overscaledZ),ke=[ie.tileID.canonical.x*be%1,ie.tileID.canonical.y*be%1]):ie.texture.bind(Ke,S.CLAMP_TO_EDGE),ie.texture.useMipmap&&T.extTextureFilterAnisotropic&&f.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,T.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,T.extTextureFilterAnisotropicMax);const Ce=Hd(se,ke||[0,0],be||1,Ee,u,A instanceof Bt?A.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(T,D,H),A instanceof Bt)A.boundsBuffer&&A.boundsSegments&&D.draw(T,S.TRIANGLES,F,a.StencilMode.disabled,R,a.CullFaceMode.disabled,Ce,u.id,A.boundsBuffer,f.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:Re,tileBoundsSegments:Ze}=f.getTileBoundsBuffers(ie);D.draw(T,S.TRIANGLES,F,ge,R,a.CullFaceMode.disabled,Ce,u.id,Ue,Re,Ze)}}f.resetStencilClippingMasks()},background:function(f,s,u,m){const y=u.paint.get("background-color"),x=u.paint.get("background-opacity");if(x===0)return;const T=f.context,S=T.gl,A=f.transform,D=A.tileSize,R=u.paint.get("background-pattern");if(f.isPatternMissing(R))return;const B=!R&&y.a===1&&x===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==B)return;const W=a.StencilMode.disabled,Z=f.depthModeForSublayer(0,B==="opaque"?a.DepthMode.ReadWrite:a.DepthMode.ReadOnly),Y=f.colorModeForRenderPass(),K=f.useProgram(R?"backgroundPattern":"background");let Q,F=m;F||(Q=f.getBackgroundTiles(),F=Object.values(Q).map(H=>H.tileID)),R&&(T.activeTexture.set(S.TEXTURE0),f.imageManager.bind(f.context));for(const H of F){const ie=H.toUnwrapped(),se=m?H.projMatrix:f.transform.calculateProjMatrix(ie);f.prepareDrawTile();const ge=s?s.getTile(H):Q?Q[H.key]:new a.Tile(H,D,A.zoom,f),ye=R?Cv(se,x,f,R,{tileID:H,tileSize:D}):Xd(se,x,y);f.prepareDrawProgram(T,K,ie);const{tileBoundsBuffer:_e,tileBoundsIndexBuffer:Ee,tileBoundsSegments:be}=f.getTileBoundsBuffers(ge);K.draw(T,S.TRIANGLES,Z,W,Y,a.CullFaceMode.disabled,ye,u.id,_e,Ee,be)}},sky:function(f,s,u){const m=f.transform,y=m.projection.name==="mercator"||m.projection.name==="globe"?1:a.smoothstep(7,8,m.zoom),x=u.paint.get("sky-opacity")*y;if(x===0)return;const T=f.context,S=u.paint.get("sky-type"),A=new a.DepthMode(T.gl.LEQUAL,a.DepthMode.ReadOnly,[0,1]),D=f.frameCounter/1e3%1;S==="atmosphere"?f.renderPass==="offscreen"?u.needsSkyboxCapture(f)&&(function(R,B,W,Z){const Y=R.context,K=Y.gl;let Q=B.skyboxFbo;if(!Q){Q=B.skyboxFbo=Y.createFramebuffer(32,32,!1),B.skyboxGeometry=new Du(Y),B.skyboxTexture=Y.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,B.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let se=0;se<6;++se)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}Y.bindFramebuffer.set(Q.framebuffer),Y.viewport.set([0,0,32,32]);const F=B.getCenter(R,!0),H=R.useProgram("skyboxCapture"),ie=new Float64Array(16);a.identity(ie),a.rotateY(ie,ie,.5*-Math.PI),Ii(Y,B,H,ie,F,0),a.identity(ie),a.rotateY(ie,ie,.5*Math.PI),Ii(Y,B,H,ie,F,1),a.identity(ie),a.rotateX(ie,ie,.5*-Math.PI),Ii(Y,B,H,ie,F,2),a.identity(ie),a.rotateX(ie,ie,.5*Math.PI),Ii(Y,B,H,ie,F,3),a.identity(ie),Ii(Y,B,H,ie,F,4),a.identity(ie),a.rotateY(ie,ie,Math.PI),Ii(Y,B,H,ie,F,5),Y.viewport.set([0,0,R.width,R.height])}(f,u),u.markSkyboxValid(f)):f.renderPass==="sky"&&function(R,B,W,Z,Y){const K=R.context,Q=K.gl,F=R.transform,H=R.useProgram("skybox");K.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,B.skyboxTexture);const ie=((se,ge,ye,_e,Ee)=>({u_matrix:se,u_sun_direction:ge,u_cubemap:0,u_opacity:_e,u_temporal_offset:Ee}))(F.skyboxMatrix,B.getCenter(R,!1),0,Z,Y);R.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,W,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,ie,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,A,x,D):S==="gradient"&&f.renderPass==="sky"&&function(R,B,W,Z,Y){const K=R.context,Q=K.gl,F=R.transform,H=R.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Du(K)),K.activeTexture.set(Q.TEXTURE0);let ie=B.colorRampTexture;ie||(ie=B.colorRampTexture=new a.Texture(K,B.colorRamp,Q.RGBA)),ie.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const se=((ge,ye,_e,Ee,be)=>({u_matrix:ge,u_color_ramp:0,u_center_direction:ye,u_radius:a.degToRad(_e),u_opacity:Ee,u_temporal_offset:be}))(F.skyboxMatrix,B.getCenter(R,!1),B.paint.get("sky-gradient-radius"),Z,Y);R.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,W,a.StencilMode.disabled,R.colorModeForRenderPass(),a.CullFaceMode.backCW,se,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(f,u,A,x,D)},debug:function(f,s,u){for(let m=0;m<u.length;m++)Dv(f,s,u[m])},custom:function(f,s,u,m){const y=f.context,x=u.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&u.isLayerDraped()){if(f.renderPass==="offscreen"){const T=x.prerender;if(T){if(f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;T.call(x,y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else T.call(x,y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){const S=x.renderToTile;if(S){const A=m[0].canonical,D=new a.MercatorCoordinate(A.x+m[0].wrap*(1<<A.z),A.y,A.z);y.setDepthMode(a.DepthMode.disabled),y.setStencilMode(a.StencilMode.disabled),y.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),S.call(x,y.gl,D),y.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),y.setColorMode(f.colorModeForRenderPass()),y.setStencilMode(a.StencilMode.disabled);const T=x.renderingMode==="3d"?new a.DepthMode(f.context.gl.LEQUAL,a.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,a.DepthMode.ReadOnly);if(y.setDepthMode(T),f.transform.projection.name==="globe"){const S=f.transform.pointMerc;x.render(y.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),a.globeToMercatorTransition(f.transform.zoom),[S.x,S.y],f.transform.pixelsPerMeterRatio)}else x.render(y.gl,f.transform.customLayerMatrix());y.setDirty(),f.setBaseState(),y.bindFramebuffer.set(null)}}else a.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class Ka{constructor(s,u,m=!1){this.context=new it(s,m),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=a.SourceCache.maxUnderzooming+a.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,u){const m=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(m||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jd(this,s));const y=this._terrain;this.transform.elevation=m?y:null,y.update(s,this.transform,u)}_updateFog(s){const u=s.fog;if(!u||this.transform.projection.name==="globe"||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[m,y]=u.getFovAdjustedRange(this.transform._fov);if(m>y)return void(this.transform.fogCullDistSq=null);const x=m+.78*(y-m);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,u){if(this.width=s*a.exported.devicePixelRatio,this.height=u*a.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style.order)this.style._layers[m].resize()}setup(){const s=this.context,u=new a.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(a.EXTENT,0),u.emplaceBack(0,a.EXTENT),u.emplaceBack(a.EXTENT,a.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(u,a.posAttributes.members),this.tileExtentSegments=a.SegmentVector.simpleSegment(0,0,4,2);const m=new a.StructArrayLayout2i4;m.emplaceBack(0,0),m.emplaceBack(a.EXTENT,0),m.emplaceBack(0,a.EXTENT),m.emplaceBack(a.EXTENT,a.EXTENT),this.debugBuffer=s.createVertexBuffer(m,a.posAttributes.members),this.debugSegments=a.SegmentVector.simpleSegment(0,0,4,5);const y=new a.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,a.posAttributes.members),this.viewportSegments=a.SegmentVector.simpleSegment(0,0,4,2);const x=new a.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(a.EXTENT,0,a.EXTENT,0),x.emplaceBack(0,a.EXTENT,0,a.EXTENT),x.emplaceBack(a.EXTENT,a.EXTENT,a.EXTENT,a.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(x,a.boundsAttributes.members),this.mercatorBoundsSegments=a.SegmentVector.simpleSegment(0,0,4,2);const T=new a.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(T);const S=new a.StructArrayLayout1ui2;for(const D of[0,1,3,2,0])S.emplaceBack(D);this.debugIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new a.Texture(s,new a.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=a.create();const A=this.context.gl;this.stencilClearMode=new a.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(a.window.performance.now()),this.atmosphereBuffer=new Xm(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,u.TRIANGLES,a.DepthMode.disabled,this.stencilClearMode,a.ColorMode.disabled,a.CullFaceMode.disabled,fc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,u,m){if(!u||this.currentStencilSource===u.id||!s.isTileClipped()||!m||m.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of m)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=u.id;const y=this.context,x=y.gl;this.nextStencilID+m.length>256&&this.clearStencil(),y.setColorMode(a.ColorMode.disabled),y.setDepthMode(a.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of m){const A=u.getTile(S),D=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:B,tileBoundsSegments:W}=this.getTileBoundsBuffers(A);T.draw(y,x.TRIANGLES,a.DepthMode.disabled,new a.StencilMode({func:x.ALWAYS,mask:0},D,255,x.KEEP,x.KEEP,x.REPLACE),a.ColorMode.disabled,a.CullFaceMode.disabled,fc(S.projMatrix),"$clipping",R,B,W)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new a.StencilMode({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const u=this.context.gl;return new a.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,m=s.sort((T,S)=>S.overscaledZ-T.overscaledZ),y=m[m.length-1].overscaledZ,x=m[0].overscaledZ-y+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const T={};for(let S=0;S<x;S++)T[S+y]=new a.StencilMode({func:u.GEQUAL,mask:255},S+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=x,[T,m]}return[{[y]:a.StencilMode.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new a.ColorMode([s.CONSTANT_COLOR,s.ONE],new a.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?a.ColorMode.unblended:a.ColorMode.alphaBlended}depthModeForSublayer(s,u,m){if(!this.opaquePassEnabledForLayer())return a.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new a.DepthMode(m||this.context.gl.LEQUAL,u,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){this.style=s,this.options=u,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(a.exported.now()),this.imageManager.beginFrame();const m=this.style.order,y=this.style._sourceCaches;for(const D in y){const R=y[D];R.used&&R.prepare(this.context)}const x={},T={},S={};for(const D in y){const R=y[D];x[D]=R.getVisibleCoordinates(),T[D]=x[D].slice().reverse(),S[D]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new a.GlobeSharedBuffers(this.context)),!a.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const D of m){const R=this.style._layers[D],B=s._getLayerSourceCache(R);if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const W=B?T[B.id]:void 0;(R.type==="custom"||R.isSky()||W&&W.length)&&this.renderLayer(this,B,R,W)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];const A=this.terrain;if(A&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&A.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?a.Color.black:a.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(D);if(D.isSky())continue;const B=R?T[R.id]:void 0;this._renderTileClippingMasks(D,R,B),this.renderLayer(this,R,D,B)}if(this.style.fog&&this.transform.projection.supportsFog&&function(D,R){const B=D.context,W=B.gl,Z=D.transform,Y=new a.DepthMode(W.LEQUAL,a.DepthMode.ReadOnly,[0,1]),K=D.useProgram("globeAtmosphere",null,Z.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=a.globeToMercatorTransition(Z.zoom),F=R.properties.get("color").toArray01(),H=R.properties.get("high-color").toArray01(),ie=R.properties.get("space-color").toArray01PremultipliedAlpha(),se=a.identity$1([]);a.rotateY$1(se,se,-a.degToRad(Z._center.lng)),a.rotateX$1(se,se,a.degToRad(Z._center.lat)),a.rotateZ$1(se,se,Z.angle),a.rotateX$1(se,se,-Z._pitch);const ge=a.fromQuat(new Float32Array(16),se),ye=a.mapValue(R.properties.get("star-intensity"),0,1,0,.25),_e=5e-4,Ee=a.mapValue(R.properties.get("horizon-blend"),0,1,_e,.25),be=a.globeUseCustomAntiAliasing(D,B,Z)&&Ee===_e?Z.worldSize/(2*Math.PI*1.025)-1:Z.globeRadius,ke=D.frameCounter/1e3%1,Ke=a.length(Z.globeCenterInViewSpace),Ce=Math.sqrt(Math.pow(Ke,2)-Math.pow(be,2)),Ue=Math.acos(Ce/Ke),Re=((Pe,je,Ye,We,et,xt,At,mt,St,Wt,Nt,yt,ln,fn)=>({u_frustum_tl:Pe,u_frustum_tr:je,u_frustum_br:Ye,u_frustum_bl:We,u_horizon:et,u_transition:xt,u_fadeout_range:At,u_color:mt,u_high_color:St,u_space_color:Wt,u_star_intensity:Nt,u_star_size:5*a.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:yt,u_horizon_angle:ln,u_rotation_matrix:fn}))(Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.frustumCorners.horizon,Q,Ee,F,H,ie,ye,ke,Ue,ge);D.prepareDrawProgram(B,K);const Ze=D.atmosphereBuffer;Ze&&K.draw(B,W.TRIANGLES,Y,a.StencilMode.disabled,a.ColorMode.alphaBlended,a.CullFaceMode.backCW,Re,"skybox",Ze.vertexBuffer,Ze.indexBuffer,Ze.segments)}(this,this.style.fog),this.renderPass="sky",(a.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(D);D.isSky()&&this.renderLayer(this,R,D,R?T[R.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;){const D=this.style._layers[m[this.currentLayer]],R=s._getLayerSourceCache(D);if(D.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(D)){if(D.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const B=R?(D.type==="symbol"?S:T)[R.id]:void 0;this._renderTileClippingMasks(D,R,R?x[R.id]:void 0),this.renderLayer(this,R,D,B),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let D=null;a.values(this.style._layers).forEach(R=>{const B=s._getLayerSourceCache(R);B&&!R.isHidden(this.transform.zoom)&&(!D||D.getSource().maxzoom<B.getSource().maxzoom)&&(D=B)}),D&&this.options.showTileBoundaries&&Qs.debug(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const R=D.transform.padding;qm(D,D.transform.height-(R.top||0),3,Za),qm(D,R.bottom||0,3,Pv),Ru(D,R.left||0,3,kv),Ru(D,D.transform.width-(R.right||0),3,Mv);const B=D.transform.centerPoint;(function(W,Z,Y,K){Xa(W,Z-1,Y-10,2,20,K),Xa(W,Z-10,Y-1,20,2,K)})(D,B.x,D.transform.height-B.y,Rv)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(a.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,u,m,y){m.isHidden(this.transform.zoom)||(m.type==="background"||m.type==="sky"||m.type==="custom"||y&&y.length)&&(this.id=m.id,this.gpuTimingStart(m),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(m.type)||s.terrain&&m.type==="custom")&&Qs[m.type](s,u,m,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let m=this.gpuTimers[s.id];m||(m=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),m.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,u=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),s.beginQueryEXT(s.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const u={};for(const m in s){const y=s[m],x=this.context.extTimerQuery,T=x.getQueryObjectEXT(y.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(y.query),u[m]=T}return u}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let m=0;for(const y of s)m+=u.getQueryObjectEXT(y,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(y);return m}translatePosMatrix(s,u,m,y,x){if(!m[0]&&!m[1])return s;const T=x?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(T){const D=Math.sin(T),R=Math.cos(T);m=[m[0]*R-m[1]*D,m[0]*D+m[1]*R]}const S=[x?m[0]:Vt(u,m[0],this.transform.zoom),x?m[1]:Vt(u,m[1],this.transform.zoom),0],A=new Float32Array(16);return a.translate(A,s,S),A}saveTileTexture(s){const u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,u=this.terrain&&this.terrain.exaggeration()===0,m=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),u&&y.push("ZERO_EXAGGERATION"),m&&!s&&m.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),s&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(s,u,m){this.cache=this.cache||{};const y=m||[],x=this.currentGlobalDefines().concat(y),T=Jt.cacheKey(Ld[s],s,x,u);return this.cache[T]||(this.cache[T]=new Jt(this.context,s,Ld[s],u,Kd[s],x)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=a.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new a.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,u,m){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const x=y.getOpacity(this.transform.pitch),T=((S,A,D,R,B,W,Z,Y,K,Q,F)=>{const H=S.transform,ie=A.properties.get("color").toArray01();ie[3]=R;const se=S.frameCounter/1e3%1;return{u_fog_matrix:D?H.calculateFogTileMatrix(D):S.identityMat,u_fog_range:A.getFovAdjustedRange(H._fov),u_fog_color:ie,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:se,u_frustum_tl:B,u_frustum_tr:W,u_frustum_br:Z,u_frustum_bl:Y,u_globe_pos:K,u_globe_radius:Q,u_viewport:F,u_globe_transition:a.globeToMercatorTransition(H.zoom),u_is_globe:+(H.projection.name==="globe")}})(this,y,m,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*a.exported.devicePixelRatio,this.transform.height*a.exported.devicePixelRatio]);u.setFogUniformValues(s,T)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,u=s.createTexture();return s.bindTexture(s.TEXTURE_2D,u),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,u=this._backgroundTiles={},m=this.transform.coveringTiles({tileSize:512});for(const y of m)u[y.key]=s[y.key]||new a.Tile(y,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Lu{constructor(s=0,u=0,m=0,y=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(m)||m<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=m,this.right=y}interpolate(s,u,m){return u.top!=null&&s.top!=null&&(this.top=a.number(s.top,u.top,m)),u.bottom!=null&&s.bottom!=null&&(this.bottom=a.number(s.bottom,u.bottom,m)),u.left!=null&&s.left!=null&&(this.left=a.number(s.left,u.left,m)),u.right!=null&&s.right!=null&&(this.right=a.number(s.right,u.right,m)),this}getCenter(s,u){const m=a.clamp((this.left+s-this.right)/2,0,s),y=a.clamp((this.top+u-this.bottom)/2,0,u);return new a.Point(m,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Lu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function zu(f,s){const u=a.getColumn(f,3);a.fromQuat(f,s),a.setColumn(f,3,u)}function Qt(f,s){const u=a.identity$1([]);return a.rotateZ$1(u,u,-s),a.rotateX$1(u,u,-f),u}function xc(f,s){const u=[f[0],f[1],0],m=[s[0],s[1],0];if(a.length(u)>=1e-15){const T=a.normalize([],u);a.scale$2(m,T,a.dot(m,T)),s[0]=m[0],s[1]=m[1]}const y=a.cross([],s,f);if(a.len(y)<1e-15)return null;const x=Math.atan2(-y[1],y[0]);return Qt(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Km{constructor(s,u){this.position=s,this.orientation=u}get position(){return this._position}set position(s){if(s){const u=s instanceof a.MercatorCoordinate?s:new a.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(u.x=a.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(s,u){if(this.orientation=null,!this.position)return;const m=this.position,y=this._elevation?this._elevation.getAtPointOrZero(a.MercatorCoordinate.fromLngLat(s)):0,x=a.MercatorCoordinate.fromLngLat(s,y),T=[x.x-m.x,x.y-m.y,x.z-m.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=xc(T,u)}setPitchBearing(s,u){this.orientation=Qt(a.degToRad(s),a.degToRad(-u))}}class Ou{constructor(s,u){this._transform=a.identity([]),this.orientation=u,this.position=s}get mercatorPosition(){const s=this.position;return new a.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=a.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var u;s&&a.setColumn(this._transform,3,[(u=s)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||a.identity$1([]),s&&zu(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,u){this._orientation=Qt(s,u),zu(this._transform,this._orientation)}forward(){const s=a.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=a.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=a.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,u){const m=new Float64Array(16);return a.invert(m,this.getWorldToCamera(s,u)),m}getWorldToCameraPosition(s,u,m){const y=this.position;a.scale$2(y,y,-s);const x=new Float64Array(16);return a.fromScaling(x,[m,m,m]),a.translate(x,x,y),x[10]*=u,x}getWorldToCamera(s,u){const m=new Float64Array(16),y=new Float64Array(4),x=this.position;return a.conjugate(y,this._orientation),a.scale$2(x,x,-s),a.fromQuat(m,y),a.translate(m,m,x),m[1]*=-1,m[5]*=-1,m[9]*=-1,m[13]*=-1,m[8]*=u,m[9]*=u,m[10]*=u,m[11]*=u,m}getCameraToClipPerspective(s,u,m,y){const x=new Float64Array(16);return a.perspective(x,s,u,m,y),x}getDistanceToElevation(s,u=!1){const m=s===0?0:a.mercatorZfromAltitude(s,u?a.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(m-this.position[2])/y[2]}clone(){return new Ou([...this.position],[...this.orientation])}}function Ja(f,s){const u=Bu(f.projection,f.zoom,f.width,f.height),m=function(x,T,S,A,D){const R=new a.LngLat(S.lng-180*Wo,S.lat),B=new a.LngLat(S.lng+180*Wo,S.lat),W=x.project(R.lng,R.lat),Z=x.project(B.lng,B.lat),Y=-Math.atan2(Z.y-W.y,Z.x-W.x),K=a.MercatorCoordinate.fromLngLat(S);K.y=a.clamp(K.y,-1+Wo,1-Wo);const Q=K.toLngLat(),F=x.project(Q.lng,Q.lat),H=a.MercatorCoordinate.fromLngLat(Q);H.x+=Wo;const ie=H.toLngLat(),se=x.project(ie.lng,ie.lat),ge=Fu(se.x-F.x,se.y-F.y,Y),ye=a.MercatorCoordinate.fromLngLat(Q);ye.y+=Wo;const _e=ye.toLngLat(),Ee=x.project(_e.lng,_e.lat),be=Fu(Ee.x-F.x,Ee.y-F.y,Y),ke=Math.abs(ge.x)/Math.abs(be.y),Ke=a.identity([]);a.rotateZ(Ke,Ke,-Y*(1-(D?0:A)));const Ce=a.identity([]);return a.scale(Ce,Ce,[1,1-(1-ke)*A,1]),Ce[4]=-be.x/be.y*A,a.rotateZ(Ce,Ce,Y),a.multiply(Ce,Ke,Ce),Ce}(f.projection,0,f.center,u,s),y=Jm(f);return a.scale(m,m,[y,y,1]),m}function Jm(f){const s=f.projection,u=Bu(f.projection,f.zoom,f.width,f.height),m=Ym(s,f.center),y=Ym(s,a.LngLat.convert(s.center));return Math.pow(2,m*u+(1-u)*y)}function Bu(f,s,u,m,y=1/0){const x=f.range;if(!x)return 0;const T=Math.min(y,Math.max(u,m)),S=Math.log(T/1024)/Math.LN2;return a.smoothstep(x[0]+S,x[1]+S,s)}const Wo=1/4e4;function Ym(f,s){const u=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=new a.LngLat(s.lng-180*Wo,u),y=new a.LngLat(s.lng+180*Wo,u),x=f.project(m.lng,u),T=f.project(y.lng,u),S=a.MercatorCoordinate.fromLngLat(m),A=a.MercatorCoordinate.fromLngLat(y),D=T.x-x.x,R=T.y-x.y,B=A.x-S.x,W=A.y-S.y,Z=Math.sqrt((B*B+W*W)/(D*D+R*R));return Math.log(Z)/Math.LN2}function Fu(f,s,u){const m=Math.cos(u),y=Math.sin(u);return{x:f*m-s*y,y:f*y+s*m}}class Ya{constructor(s,u,m,y,x,T,S){this.tileSize=512,this._renderWorldCopies=x===void 0||x,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=m??0,this._maxPitch=y??60,this.setProjection(T),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new a.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Lu,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Ou,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new Ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,u=!1){const m=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||m)&&this._updateCameraOnTerrain(),(s||m)&&this._constrainCamera(u),this._calcMatrices()}getProjection(){return a.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=a.getProjection(this.projectionOptions);const m=!k(u,this.getProjection());return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=a.getProjection({name:"mercator"});const u=s!==this.projection.name;return u&&this._calcMatrices(),u}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return a.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.Point(this.width,this.height)}get bearing(){return a.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const u=-s*Math.PI/180;var m;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(m=new a.ARRAY_TYPE(4),a.ARRAY_TYPE!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m),function(y,x,T){var S=x[0],A=x[1],D=x[2],R=x[3],B=Math.sin(T),W=Math.cos(T);y[0]=S*W+D*B,y[1]=A*W+R*B,y[2]=S*-B+D*W,y[3]=A*-B+R*W}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=a.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=a.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],m=this.horizonLineFromTop();let y=0,x=0;for(let T=0;T<u.length;T++){const S=new a.Point(u[T][0]*this.width,m+u[T][1]*(this.height-m)),A=s.pointCoordinate(S);if(!A)continue;const D=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);y+=A[3]*D,x+=D}return x===0?NaN:y/x}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),m=this.pixelsPerMeter/this.worldSize*u,y=this._mercatorZfromZoom(s),x=this._mercatorZfromZoom(this._maxZoom),T=Math.max(y-m,x);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let m;m=s.z<this._camera.position[2]?[u.x,u.y,u.z]:[s.x,s.y,s.z];const y=a.length(a.sub([],this._camera.position,m));return a.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let u=!1;if(s.orientation&&!a.exactEquals(s.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(s.orientation)),s.position){const m=[s.position.x,s.position.y,s.position.z];a.exactEquals$1(m,this._camera.position)||(this._setCameraPosition(m),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,u=new Km;return u.position=new a.MercatorCoordinate(s[0],s[1],s[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(s){if(!a.length$1(s))return!1;a.normalize$1(s,s);const u=a.transformQuat([],[0,0,-1],s),m=a.transformQuat([],[0,-1,0],s);if(m[2]<0)return!1;const y=xc(u,m);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(s){const u=this.zoomScale(this.minZoom)*this.tileSize,m=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;s[2]=a.clamp(s[2],y/m,y/u),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,m){this._unmodified=!1,this._edgeInsets.interpolate(s,u,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new a.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const m=this.pointCoordinate(new a.Point(0,0)),y=this.pointCoordinate(new a.Point(this.width,0)),x=this.pointCoordinate(new a.Point(this.width,this.height)),T=this.pointCoordinate(new a.Point(0,this.height)),S=Math.floor(Math.min(m.x,y.x,x.x,T.x)),A=Math.floor(Math.max(m.x,y.x,x.x,T.x)),D=1;for(let R=S-D;R<=A+D;R++)R!==0&&u.push(new a.UnwrappedTileID(R,s))}return u}coveringTiles(s){let u=this.coveringZoomLevel(s);const m=u,y=this.elevation&&!s.isTerrainDEM,x=this.projection.name==="mercator";if(s.minzoom!==void 0&&u<s.minzoom)return[];s.maxzoom!==void 0&&u>s.maxzoom&&(u=s.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,A=1<<u,D=[A*T.x,A*T.y,0],R=this.projection.name==="globe",B=!R,W=a.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),Z=R?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Y=A*a.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/a.mercatorZfromAltitude(1,this.center.lat),Q=[A*Z.x,A*Z.y,K*(B?1:Y)],F=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),H=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,ie=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,se=s.isTerrainDEM?-ie:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?Jm(this):1,ye=Pe=>{const Ye=new a.MercatorCoordinate(Pe.x+25e-6,Pe.y,Pe.z),We=new a.MercatorCoordinate(Pe.x,Pe.y+25e-6,Pe.z),et=Pe.toLngLat(),xt=Ye.toLngLat(),At=We.toLngLat(),mt=this.locationCoordinate(et),St=this.locationCoordinate(xt),Wt=this.locationCoordinate(At),Nt=Math.hypot(St.x-mt.x,St.y-mt.y),yt=Math.hypot(Wt.x-mt.x,Wt.y-mt.y);return Math.sqrt(Nt*yt)*ge/25e-6},_e=Pe=>{const je=ie,Ye=se;return{aabb:a.tileAABB(this,A,0,0,0,Pe,Ye,je,this.projection),zoom:0,x:0,y:0,minZ:Ye,maxZ:je,wrap:Pe,fullyVisible:!1}},Ee=[];let be=[];const ke=u,Ke=s.reparseOverscaled?m:u,Ce=Pe=>Pe*Pe,Ue=Ce((K-this._centerAltitude)*Y),Re=Pe=>{if(!this._elevation||!Pe.tileID||!x)return;const je=this._elevation.getMinMaxForTile(Pe.tileID),Ye=Pe.aabb;je?(Ye.min[2]=je.min,Ye.max[2]=je.max,Ye.center[2]=(Ye.min[2]+Ye.max[2])/2):(Pe.shouldSplit=Ze(Pe),Pe.shouldSplit||(Ye.min[2]=Ye.max[2]=Ye.center[2]=this._centerAltitude))},Ze=Pe=>{if(Pe.zoom<H)return!0;if(Pe.zoom===ke)return!1;if(Pe.shouldSplit!=null)return Pe.shouldSplit;const je=Pe.aabb.distanceX(Q),Ye=Pe.aabb.distanceY(Q);let We=Ue,et=1;if(R){We=Ce(Pe.aabb.distanceZ(Q));const mt=Math.pow(2,Pe.zoom),St=a.latFromMercatorY((Pe.y+1)/mt),Wt=a.latFromMercatorY(Pe.y/mt),Nt=Math.min(Math.max(S,St),Wt),yt=a.circumferenceAtLatitude(Nt)/a.circumferenceAtLatitude(S);if(et=Nt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,yt/this._mercatorScaleRatio),this.zoom<=a.GLOBE_ZOOM_THRESHOLD_MIN&&Pe.zoom===ke-1&&yt>=.9)return!0}else if(y&&(We=Ce(Pe.aabb.distanceZ(Q)*Y)),this.projection.isReprojectedInTileSpace&&m<=5){const mt=Math.pow(2,Pe.zoom),St=ye(new a.MercatorCoordinate((Pe.x+.5)/mt,(Pe.y+.5)/mt));et=St>.85?1:St}const xt=je*je+Ye*Ye+We,At=Ce((1<<ke-Pe.zoom)*F*et*((mt,St)=>{if(St*Ce(.707)<mt)return 1;const Wt=Math.sqrt(St/mt);return Wt/(1.4144271570014144+(Math.pow(1.1,Wt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(We,Ue),xt));return xt<At};if(this.renderWorldCopies)for(let Pe=1;Pe<=3;Pe++)Ee.push(_e(-Pe)),Ee.push(_e(Pe));for(Ee.push(_e(0));Ee.length>0;){const Pe=Ee.pop(),je=Pe.x,Ye=Pe.y;let We=Pe.fullyVisible;if(!We){const et=Pe.aabb.intersects(W);if(et===0)continue;We=et===2}if(Pe.zoom!==ke&&Ze(Pe))for(let et=0;et<4;et++){const xt=(je<<1)+et%2,At=(Ye<<1)+(et>>1),mt={aabb:x?Pe.aabb.quadrant(et):a.tileAABB(this,A,Pe.zoom+1,xt,At,Pe.wrap,Pe.minZ,Pe.maxZ,this.projection),zoom:Pe.zoom+1,x:xt,y:At,wrap:Pe.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:Pe.minZ,maxZ:Pe.maxZ};y&&!R&&(mt.tileID=new a.OverscaledTileID(Pe.zoom+1===ke?Ke:Pe.zoom+1,Pe.wrap,Pe.zoom+1,xt,At),Re(mt)),Ee.push(mt)}else{const et=Pe.zoom===ke?Ke:Pe.zoom;if(s.minzoom&&s.minzoom>et)continue;const xt=D[0]-(.5+je+(Pe.wrap<<Pe.zoom))*(1<<u-Pe.zoom),At=D[1]-.5-Ye,mt=Pe.tileID?Pe.tileID:new a.OverscaledTileID(et,Pe.wrap,Pe.zoom,je,Ye);be.push({tileID:mt,distanceSq:xt*xt+At*At})}}if(this.fogCullDistSq){const Pe=this.fogCullDistSq,je=this.horizonLineFromTop();be=be.filter(Ye=>{const We=[0,0,0,1],et=[a.EXTENT,a.EXTENT,0,1],xt=this.calculateFogTileMatrix(Ye.tileID.toUnwrapped());a.transformMat4$1(We,We,xt),a.transformMat4$1(et,et,xt);const At=a.getAABBPointSquareDist(We,et);if(At===0)return!0;let mt=!1;const St=this._elevation;if(St&&At>Pe&&je!==0){const Wt=this.calculateProjMatrix(Ye.tileID.toUnwrapped());let Nt;s.isTerrainDEM||(Nt=St.getMinMaxForTile(Ye.tileID)),Nt||(Nt={min:se,max:ie});const yt=a.furthestTileCorner(this.rotation),ln=[yt[0]*a.EXTENT,yt[1]*a.EXTENT,Nt.max];a.transformMat4(ln,ln,Wt),mt=(1-ln[1])*this.height*.5<je}return At<Pe||mt})}return be.sort((Pe,je)=>Pe.distanceSq-je.distanceSq).map(Pe=>Pe.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=a.clamp(s.lat,-a.MAX_MERCATOR_LATITUDE,a.MAX_MERCATOR_LATITUDE),m=this.projection.project(s.lng,u);return new a.Point(m.x*this.worldSize,m.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/a.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,u){let m,y;const x=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;m=(u.x-x.x)/S,y=(u.y-x.y)/S}else{const S=this.pointCoordinate(u),A=this.pointCoordinate(x);m=S.x-A.x,y=S.y-A.y}const T=this.locationCoordinate(s);this.setLocation(new a.MercatorCoordinate(T.x-m,T.y-y))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,u){const m=u?a.mercatorZfromAltitude(u,s.lat):void 0,y=this.projection.project(s.lng,s.lat);return new a.MercatorCoordinate(y.x,y.y,m)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,u){const m=u??this._centerAltitude,y=[s.x,s.y,0,1],x=[s.x,s.y,1,1];a.transformMat4$1(y,y,this.pixelMatrixInverse),a.transformMat4$1(x,x,this.pixelMatrixInverse);const T=x[3];a.scale$1(y,y,1/y[3]),a.scale$1(x,x,1/T);const S=y[2],A=x[2];return{p0:y,p1:x,t:S===A?0:(m-S)/(A-S)}}screenPointToMercatorRay(s){const u=[s.x,s.y,0,1],m=[s.x,s.y,1,1];return a.transformMat4$1(u,u,this.pixelMatrixInverse),a.transformMat4$1(m,m,this.pixelMatrixInverse),a.scale$1(u,u,1/u[3]),a.scale$1(m,m,1/m[3]),u[2]=a.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,m[2]=a.mercatorZfromAltitude(m[2],this._center.lat)*this.worldSize,a.scale$1(u,u,1/this.worldSize),a.scale$1(m,m,1/this.worldSize),new a.Ray([u[0],u[1],u[2]],a.normalize([],a.sub([],m,u)))}rayIntersectionCoordinate(s){const{p0:u,p1:m,t:y}=s,x=a.mercatorZfromAltitude(u[2],this._center.lat),T=a.mercatorZfromAltitude(m[2],this._center.lat);return new a.MercatorCoordinate(a.number(u[0],m[0],y)/this.worldSize,a.number(u[1],m[1],y)/this.worldSize,a.number(x,T,y))}pointCoordinate(s,u=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,u)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let u=this.projection.pointCoordinate3D(this,s.x,s.y);if(u)return new a.MercatorCoordinate(u[0],u[1],u[2]);let m=0,y=this.horizonLineFromTop();if(s.y>y)return this.pointCoordinate(s);const x=.02*y,T=s.clone();for(let S=0;S<10&&y-m>x;S++){T.y=a.number(m,y,.66);const A=this.projection.pointCoordinate3D(this,T.x,T.y);A?(y=T.y,u=A):m=T.y}return u?new a.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);const u=this.pointCoordinate(s);return u.y>=0&&u.y<=1}_coordinatePoint(s,u){const m=u&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,y=[s.x*this.worldSize,s.y*this.worldSize,m+s.toAltitude(),1];return a.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new a.Point(y[0]/y[3],y[1]/y[3]):new a.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:u}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=this.pointLocation3D(new a.Point(u,s)),T=this.pointLocation3D(new a.Point(y,s)),S=this.pointLocation3D(new a.Point(y,m)),A=this.pointLocation3D(new a.Point(u,m));let D=Math.min(x.lng,T.lng,S.lng,A.lng),R=Math.max(x.lng,T.lng,S.lng,A.lng),B=Math.min(x.lat,T.lat,S.lat,A.lat),W=Math.max(x.lat,T.lat,S.lat,A.lat);const Z=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,K=(Q,F,H,ie,se)=>{const ge=(Q+H)/2,ye=(F+ie)/2,_e=new a.Point(ge,ye),{lng:Ee,lat:be}=this.pointLocation3D(_e),ke=Math.max(0,D-Ee,B-be,Ee-R,be-W);D=Math.min(D,Ee),R=Math.max(R,Ee),B=Math.min(B,be),W=Math.max(W,be),(se<Y||ke>Z)&&(K(Q,F,ge,ye,se+1),K(ge,ye,H,ie,se+1))};if(K(u,s,y,s,1),K(y,s,y,m,1),K(y,m,u,m,1),K(u,m,u,s,1),this.projection.name==="globe"){const[Q,F]=a.polesInViewport(this);Q?(W=90,R=180,D=-180):F&&(B=-90,R=180,D=-180)}return new a.LngLatBounds(new a.LngLat(D,B),new a.LngLat(R,W))}_getBoundsRectangular(s,u){const{top:m,left:y}=this._edgeInsets,x=this.height-this._edgeInsets.bottom,T=this.width-this._edgeInsets.right,S=new a.Point(y,m),A=new a.Point(T,m),D=new a.Point(T,x),R=new a.Point(y,x);let B=this.pointCoordinate(S,s),W=this.pointCoordinate(A,s);const Z=this.pointCoordinate(D,u),Y=this.pointCoordinate(R,u),K=(Q,F)=>(F.y-Q.y)/(F.x-Q.x);return B.y>1&&W.y>=0?B=new a.MercatorCoordinate((1-Y.y)/K(Y,B)+Y.x,1):B.y<0&&W.y<=1&&(B=new a.MercatorCoordinate(-Y.y/K(Y,B)+Y.x,0)),W.y>1&&B.y>=0?W=new a.MercatorCoordinate((1-Z.y)/K(Z,W)+Z.x,1):W.y<0&&B.y<=1&&(W=new a.MercatorCoordinate(-Z.y/K(Z,W)+Z.x,0)),new a.LngLatBounds().extend(this.coordinateLocation(B)).extend(this.coordinateLocation(W)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(Z))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const u=s.visibleDemTiles.reduce((m,y)=>{if(y.dem){const x=y.dem.tree;m.min=Math.min(m.min,x.minimums[0]),m.max=Math.max(m.max,x.maximums[0])}return m},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(u.min*s.exaggeration(),u.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,m=this.height/2-u*(1-this._horizonShift);return s?Math.max(0,m):m}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-a.MAX_MERCATOR_LATITUDE,this.maxLat=a.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=a.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=a.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=a.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=a.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,u){return this.projection.createTileMatrix(this,u,s)}calculateDistanceTileData(s){const u=s.key,m=this._distanceTileDataCache;if(m[u])return m[u];const y=s.canonical,x=1/this.height,T=this.cameraWorldSize,S=T/this.zoomScale(y.z),A=(y.x+Math.pow(2,y.z)*s.wrap)*S,D=y.y*S,R=this.point;R.x*=T/this.worldSize,R.y*=T/this.worldSize;const B=this.angle,W=Math.sin(-B),Z=-Math.cos(-B);return m[u]={bearing:[W,Z],center:[(R.x-A)*x,(R.y-D)*x],scale:S/a.EXTENT*x},m[u]}calculateFogTileMatrix(s){const u=s.key,m=this._fogTileMatrixCache;if(m[u])return m[u];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return a.multiply(y,this.worldToFogMatrix,y),m[u]=new Float32Array(y),m[u]}calculateProjMatrix(s,u=!1){const m=s.key,y=u?this._alignedProjMatrixCache:this._projMatrixCache;if(y[m])return y[m];const x=this.calculatePosMatrix(s,this.worldSize);return a.multiply(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,x),y[m]=new Float32Array(x),y[m]}calculatePixelsToTileUnitsMatrix(s){const u=s.tileID.key,m=this._pixelsToTileUnitsCache;if(m[u])return m[u];const y=function(x,T){const{scale:S}=x.tileTransform,A=S*a.EXTENT/(x.tileSize*Math.pow(2,T.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return D=new Float32Array(4),W=(R=T.inverseAdjustmentMatrix)[1],Z=R[2],Y=R[3],Q=(B=[A,A])[1],D[0]=R[0]*(K=B[0]),D[1]=W*K,D[2]=Z*Q,D[3]=Y*Q,D;var D,R,B,W,Z,Y,K,Q}(s,this);return m[u]=y,m[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,u=a.fromScaling([],[s,s,s]);return a.multiply(u,u,this.globeMatrix),u}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const u=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(u),y=this._camera.forward(),x=a.mercatorZfromAltitude(1,this._center.lat);m[2]/=x,y[2]/=x,a.normalize(y,y);const T=s.raycast(m,y,s.exaggeration());if(T){const S=a.scaleAndAdd([],m,y,T),A=new a.MercatorCoordinate(S[0],S[1],a.mercatorZfromAltitude(S[2],a.latFromMercatorY(S[1]))),D=(A.z+a.length([A.x-m[0],A.y-m[1],A.z-m[2]*x]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const u=this._elevation,m=a.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(m),x=u.getAtPointOrZero(new a.MercatorCoordinate(...y)),T=this.pixelsPerMeter/this.worldSize*x,S=this._minimumHeightOverTerrain(),A=y[2]-T;if(A<=S)if(A<0||s){const D=this.locationCoordinate(this._center,this._centerAltitude),R=[y[0],y[1],D.z-y[2]],B=a.length(R);R[2]-=(S-A)/this._pixelsPerMercatorPixel;const W=a.length(R);if(W===0)return;a.scale$2(R,R,B/W*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],D.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const W=this.center;return W.lat=a.clamp(W.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(W.lng=a.clamp(W.lng,this.minLng,this.maxLng)),this.center=W,void(this._constraining=!1)}const u=this._unmodified,{x:m,y}=this.point;let x=0,T=m,S=y;const A=this.width/2,D=this.height/2,R=this.worldMinY*this.scale,B=this.worldMaxY*this.scale;if(y-D<R&&(S=R+D),y+D>B&&(S=B-D),B-R<this.height&&(x=Math.max(x,this.height/(B-R)),S=(B+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const W=this.worldMinX*this.scale,Z=this.worldMaxX*this.scale,Y=this.worldSize/2-(W+Z)/2;T=(m+Y+this.worldSize)%this.worldSize-Y,T-A<W&&(T=W+A),T+A>Z&&(T=Z-A),Z-W<this.width&&(x=Math.max(x,this.width/(Z-W)),T=(Z+W)/2)}T===m&&S===y||(this.center=this.unproject(new a.Point(T,S))),x&&(this.zoom+=this.scaleZoom(x)),this._constrainCamera(),this._unmodified=u,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=a.mercatorZfromAltitude(1,this.center.lat)/a.mercatorZfromAltitude(1,a.GLOBE_SCALE_MATCH_LATITUDE));const m=Bu(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?u:1,x=this._camera.getWorldToCamera(this.worldSize,y),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-s.x/this.width,T[9]=2*s.y/this.height;let S=a.mul([],T,x);if(this.projection.isReprojectedInTileSpace){const ye=this.locationCoordinate(this.center),_e=a.identity([]);a.translate(_e,_e,[ye.x*this.worldSize,ye.y*this.worldSize,0]),a.multiply(_e,_e,Ja(this)),a.translate(_e,_e,[-ye.x*this.worldSize,-ye.y*this.worldSize,0]),a.multiply(S,S,_e),this.inverseAdjustmentMatrix=function(Ee){const be=Ja(Ee,!0);return ze([],[be[0],be[1],be[4],be[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=a.scale([],S,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=S,this.invProjMatrix=a.invert(new Float64Array(16),this.projMatrix);const A=a.invert([],T);this.frustumCorners=a.FrustumCorners.fromInvProjectionMatrix(A,this.horizonLineFromTop(),this.height);const D=new Float32Array(16);a.identity(D),a.scale(D,D,[1,-1,1]),a.rotateX(D,D,this._pitch),a.rotateZ(D,D,this.angle);const R=a.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),B=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;R[8]=2*-s.x/this.width,R[9]=2*(s.y+B)/this.height,this.skyboxMatrix=a.multiply(D,R,D);const W=this.point,Z=W.x,Y=W.y,K=this.width%2/2,Q=this.height%2/2,F=Math.cos(this.angle),H=Math.sin(this.angle),ie=Z-Math.round(Z)+F*K+H*Q,se=Y-Math.round(Y)+F*Q+H*K,ge=new Float64Array(S);if(a.translate(ge,ge,[ie>.5?ie-1:ie,se>.5?se-1:se,0]),this.alignedProjMatrix=ge,S=a.create(),a.scale(S,S,[this.width/2,-this.height/2,1]),a.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=a.create(),a.scale(S,S,[1,-1,1]),a.translate(S,S,[-1,-1,0]),a.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=a.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=a.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=a.calculateGlobeMatrix(this);const ye=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=a.transformMat4(ye,ye,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,u=this.cameraPixelsPerMeter,m=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,x=[s,s,u];a.scale$2(x,x,y),a.scale$2(m,m,-1),a.multiply$2(m,m,x);const T=a.create();a.translate(T,T,m),a.scale(T,T,x),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,u,y)}_computeCameraPosition(s){const u=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,m=this._camera.forward(),y=this.point,x=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-s/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-m[0]*x,y.y/this.worldSize-m[1]*x,s/this.worldSize*this._centerAltitude-m[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),m=this._camera.position[2],y=s[2];let x=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(x=Math.min((u-m)/y,1)),this._camera.position=a.scaleAndAdd([],this._camera.position,s,x),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,u=this._camera.forward(),{pitch:m,bearing:y}=this._camera.getPitchBearing(),x=a.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(a.degToRad(this._maxPitch)),S=Math.max((s[2]-x)/Math.cos(m),T),A=this._zoomFromMercatorZ(S);a.scaleAndAdd(s,s,u,S),this._pitch=a.clamp(m,a.degToRad(this.minPitch),a.degToRad(this.maxPitch)),this.angle=a.wrap(y,-Math.PI,Math.PI),this._setZoom(a.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new a.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let u=0,m=a.GLOBE_ZOOM_THRESHOLD_MAX,y=0,x=1/0;for(;m-u>1e-6&&m>u;){const T=u+.5*(m-u),S=this.tileSize*Math.pow(2,T),A=this.getCameraToCenterDistance(this.projection,T,S),D=this.scaleZoom(A/(s*this.tileSize)),R=Math.abs(T-D);R<x&&(x=R,y=T),T<D?u=T:m=T}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(a.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,u){const m=Math.min(s.x,u.x),y=Math.max(s.x,u.x),x=Math.min(s.y,u.y),T=Math.max(s.y,u.y);if(x<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new a.Point(m,x),new a.Point(y,T),new a.Point(m,T),new a.Point(y,x)],A=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const R of S){const B=this.pointRayIntersection(R);if(B.t<0)return!0;const W=this.rayIntersectionCoordinate(B);if(W.x<A||W.y<0||W.x>D||W.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+a.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new a.Point(0,0),new a.Point(this.width,this.height))}zoomDeltaToMovement(s,u){const m=a.length(a.sub([],this._camera.position,s)),y=this._zoomFromMercatorZ(m)+u;return m-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([u,m,y],x){const T=[u,m,y,1];a.transformMat4$1(T,T,x);const S=T[3]=Math.max(T[3],1e-6);return T[0]/=S,T[1]/=S,T[2]/=S,T}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new a.Point(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.Point(0,s))}}getCameraToCenterDistance(s,u=this.zoom,m=this.worldSize){const y=Bu(s,u,this.width,this.height,1024),x=s.pixelSpaceConversion(this.center.lat,m,y);return .5/Math.tan(.5*this._fov)*this.height*x}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&a.multiply(s,s,this.globeMatrix),s}}function Qa(f,s){let u=!1,m=null;const y=()=>{m=null,u&&(f(),m=setTimeout(y,s),u=!1)};return()=>(u=!0,m||y(),m)}class Qd{constructor(s){this._hashName=s&&encodeURIComponent(s),a.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qa(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,a.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),a.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const u=wc(s);if(this._hashName){const m=this._hashName;let y=!1;const x=a.window.location.hash.slice(1).split("&").map(T=>{const S=T.split("=")[0];return S===m?(y=!0,`${S}=${u}`):T}).filter(T=>T);return y||x.push(`${m}=${u}`),`#${x.join("&")}`}return`#${u}`}_getCurrentHash(){const s=a.window.location.hash.replace("#","");if(this._hashName){let u;return s.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(u=m)}),(u&&u[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(m=>isNaN(m))){const m=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(u[3]||0):s.getBearing();return s.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:m,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=a.window.location.href.replace(/(#.+)?$/,this.getHashString());a.window.history.replaceState(a.window.history.state,null,s)}}function wc(f,s){const u=f.getCenter(),m=Math.round(100*f.getZoom())/100,y=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,y),T=Math.round(u.lng*x)/x,S=Math.round(u.lat*x)/x,A=f.getBearing(),D=f.getPitch();let R=s?`/${T}/${S}/${m}`:`${m}/${S}/${T}`;return(A||D)&&(R+="/"+Math.round(10*A)/10),D&&(R+=`/${Math.round(D)}`),R}const bc={linearity:.3,easing:a.bezier(0,0,.3,1)},Nu=a.extend({deceleration:2500,maxSpeed:1400},bc),ju=a.extend({deceleration:20,maxSpeed:1400},bc),dt=a.extend({deceleration:1e3,maxSpeed:360},bc),Gi=a.extend({deceleration:1e3,maxSpeed:90},bc);class Qm{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:a.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=a.exported.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const u={zoom:0,bearing:0,pitch:0,pan:new a.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)u.zoom+=x.zoomDelta||0,u.bearing+=x.bearingDelta||0,u.pitch+=x.pitchDelta||0,x.panDelta&&u.pan._add(x.panDelta),x.around&&(u.around=x.around),x.pinchAround&&(u.pinchAround=x.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(u.pan.mag()){const x=Tc(u.pan.mag(),m,a.extend({},Nu,s||{}));y.offset=u.pan.mult(x.amount/u.pan.mag()),y.center=this._map.transform.center,Ec(y,x)}if(u.zoom){const x=Tc(u.zoom,m,ju);y.zoom=this._map.transform.zoom+x.amount,Ec(y,x)}if(u.bearing){const x=Tc(u.bearing,m,dt);y.bearing=this._map.transform.bearing+a.clamp(x.amount,-179,179),Ec(y,x)}if(u.pitch){const x=Tc(u.pitch,m,Gi);y.pitch=this._map.transform.pitch+x.amount,Ec(y,x)}if(y.zoom||y.bearing){const x=u.pinchAround===void 0?u.around:u.pinchAround;y.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Ec(f,s){(!f.duration||f.duration<s.duration)&&(f.duration=s.duration,f.easing=s.easing)}function Tc(f,s,u){const{maxSpeed:m,linearity:y,deceleration:x}=u,T=a.clamp(f*y/(s/1e3),-m,m),S=Math.abs(T)/(x*y);return{easing:u.easing,duration:1e3*S,amount:T*(S/2)}}class br extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,m,y={}){const x=Ge(u.getCanvasContainer(),m),T=u.unproject(x);super(s,a.extend({point:x,lngLat:T,originalEvent:m},y)),this._defaultPrevented=!1,this.target=u}}class Sc extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,m){const y=s==="touchend"?m.changedTouches:m.touches,x=Xe(u.getCanvasContainer(),y),T=x.map(A=>u.unproject(A)),S=x.reduce((A,D,R,B)=>A.add(D.div(B.length)),new a.Point(0,0));super(s,{points:x,point:S,lngLats:T,lngLat:u.unproject(S),originalEvent:m}),this._defaultPrevented=!1}}class Uu extends a.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class ef{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new Uu(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new br(s.type,this._map,s))}mouseup(s){this._map.fire(new br(s.type,this._map,s))}preclick(s){const u=a.extend({},s);u.type="preclick",this._map.fire(new br(u.type,this._map,u))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(s),this._map.fire(new br(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new br(s.type,this._map,s))}mouseover(s){this._map.fire(new br(s.type,this._map,s))}mouseout(s){this._map.fire(new br(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Sc(s.type,this._map,s))}touchmove(s){this._map.fire(new Sc(s.type,this._map,s))}touchend(s){this._map.fire(new Sc(s.type,this._map,s))}touchcancel(s){this._map.fire(new Sc(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vu{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new br(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new br("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new br(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class eg{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(J(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const m=u,y=this._startPos,x=this._lastPos;if(!y||!x||x.equals(m)||!this._box&&m.dist(y)<this._clickTolerance)return;this._lastPos=m,this._box||(this._box=X("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const T=Math.min(y.x,m.x),S=Math.max(y.x,m.x),A=Math.min(y.y,m.y),D=Math.max(y.y,m.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${A}px)`,this._box.style.width=S-T+"px",this._box.style.height=D-A+"px")})}mouseupWindow(s,u){if(!this._active)return;const m=this._startPos,y=u;if(m&&s.button===0){if(this.reset(),Ne(),m.x!==y.x||m.y!==y.y)return this._map.fire(new a.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:x=>x.fitScreenCoordinates(m,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ce(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new a.Event(s,{originalEvent:u}))}}function $u(f,s){const u={};for(let m=0;m<f.length;m++)u[f[m].identifier]=s[m];return u}class el{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,u,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(y){const x=new a.Point(0,0);for(const T of y)x._add(T);return x.div(y.length)}(u),this.touches=$u(m,u)))}touchmove(s,u,m){if(this.aborted||!this.centroid)return;const y=$u(m,u);for(const x in this.touches){const T=y[x];(!T||T.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(s,u,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class tf{constructor(s){this.singleTap=new el(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,u,m){this.singleTap.touchstart(s,u,m)}touchmove(s,u,m){this.singleTap.touchmove(s,u,m)}touchend(s,u,m){const y=this.singleTap.touchend(s,u,m);if(y){const x=s.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(y)<30;if(x&&T||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Lv{constructor(){this._zoomIn=new tf({numTouches:1,numTaps:2}),this._zoomOut=new tf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,m){this._zoomIn.touchstart(s,u,m),this._zoomOut.touchstart(s,u,m)}touchmove(s,u,m){this._zoomIn.touchmove(s,u,m),this._zoomOut.touchmove(s,u,m)}touchend(s,u,m){const y=this._zoomIn.touchend(s,u,m),x=this._zoomOut.touchend(s,u,m);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:s})}):x?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(x)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const tg={0:1,2:2};class tl{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,u){return!1}_move(s,u){return{}}mousedown(s,u){if(this._lastPoint)return;const m=qe(s);this._correctButton(s,m)&&(this._lastPoint=u,this._eventButton=m)}mousemoveWindow(s,u){const m=this._lastPoint;if(m){if(s.preventDefault(),this._eventButton!=null&&function(y,x){const T=tg[x];return y.buttons===void 0||(y.buttons&T)!==T}(s,this._eventButton))this.reset();else if(this._moved||!(u.dist(m)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(m,u)}}mouseupWindow(s){this._lastPoint&&qe(s)===this._eventButton&&(this._moved&&Ne(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nf extends tl{mousedown(s,u){super.mousedown(s,u),this._lastPoint&&(this._active=!0)}_correctButton(s,u){return u===0&&!s.ctrlKey}_move(s,u){return{around:u,panDelta:u.sub(s)}}}class rf extends tl{_correctButton(s,u){return u===0&&s.ctrlKey||u===2}_move(s,u){const m=.8*(u.x-s.x);if(m)return this._active=!0,{bearingDelta:m}}contextmenu(s){s.preventDefault()}}class of extends tl{_correctButton(s,u){return u===0&&s.ctrlKey||u===2}_move(s,u){const m=-.5*(u.y-s.y);if(m)return this._active=!0,{pitchDelta:m}}contextmenu(s){s.preventDefault()}}class Gu{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),a.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new a.Point(0,0)}touchstart(s,u,m){return this._calculateTransform(s,u,m)}touchmove(s,u,m){if(this._active&&!(m.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(m.length===1&&!a.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,u,m)}}touchend(s,u,m){this._calculateTransform(s,u,m),this._active&&m.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,m){m.length>0&&(this._active=!0);const y=$u(m,u),x=new a.Point(0,0),T=new a.Point(0,0);let S=0;for(const D in y){const R=y[D],B=this._touches[D];B&&(x._add(R),T._add(R.sub(B)),S++,y[D]=R)}if(this._touches=y,S<this._minTouches||!T.mag())return;const A=T.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=X("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ic{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,u,m){return{}}touchstart(s,u,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,m){const y=this._firstTwoTouches;if(!y)return;s.preventDefault();const[x,T]=y,S=Cc(m,u,x),A=Cc(m,u,T);if(!S||!A)return;const D=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],D,s)}touchend(s,u,m){if(!this._firstTwoTouches)return;const[y,x]=this._firstTwoTouches,T=Cc(m,u,y),S=Cc(m,u,x);T&&S||(this._active&&Ne(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Cc(f,s,u){for(let m=0;m<f.length;m++)if(f[m].identifier===u)return s[m]}function sf(f,s){return Math.log(f/s)/Math.LN2}class ng extends Ic{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(sf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:sf(this._distance,m),pinchAround:u}}}function af(f,s){return 180*f.angleWith(s)/Math.PI}class rg extends Ic{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u){const m=this._vector;if(this._vector=s[0].sub(s[1]),m&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:af(this._vector,m),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,m=this._startVector;if(!m)return!1;const y=af(s,m);return Math.abs(y)<u}}function _s(f){return Math.abs(f.y)>Math.abs(f.x)}class ig extends Ic{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,_s(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,m){const y=this._lastPoints;if(!y)return;const x=s[0].sub(y[0]),T=s[1].sub(y[1]);return this._map._cooperativeGestures&&!a.isFullscreen()&&m.touches.length<3||(this._valid=this.gestureBeginsVertically(x,T,m.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(x.y+T.y)/2*-.5})}gestureBeginsVertically(s,u,m){if(this._valid!==void 0)return this._valid;const y=s.mag()>=2,x=u.mag()>=2;if(!y&&!x)return;if(!y||!x)return this._firstMove==null&&(this._firstMove=m),m-this._firstMove<100&&void 0;const T=s.y>0==u.y>0;return _s(s)&&_s(u)&&T}}const og={panStep:100,bearingStep:15,pitchStep:10};class zv{constructor(){const s=og;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,m=0,y=0,x=0,T=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),x=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),x=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),T=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(m=0,y=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:sg,zoom:u?Math.round(A)+u*(s.shiftKey?2:1):A,bearing:S.getBearing()+m*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-x*this._panStep,-T*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function sg(f){return f*(2-f)}const lf=4.000244140625;class ag{constructor(s,u){this._map=s,this._el=s.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,a.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||a.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=s.deltaMode===a.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=a.exported.now(),y=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,u!==0&&u%lf==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Ge(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const u=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>lf?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&D!==0&&(D=1/D);const R=u(),B=Math.pow(2,R),W=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(W*D))),this._type==="wheel"&&(this._startZoom=R,this._easing=this._smoothOutEasing(200)),this._delta=0}const m=typeof this._targetZoom=="number"?this._targetZoom:u(),y=this._startZoom,x=this._easing;let T,S=!1;if(this._type==="wheel"&&y&&x){const A=Math.min((a.exported.now()-this._lastWheelEventTime)/200,1),D=x(A);T=a.number(y,m,D),A<1?this._frameId||(this._frameId=!0):S=!0}else T=m,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:T-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=a.ease;if(this._prevEase){const m=this._prevEase,y=(a.exported.now()-m.start)/m.duration,x=m.easing(y+.01)-m.easing(y),T=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-T*T);u=a.bezier(T,S,.25,1)}return this._prevEase={start:a.exported.now(),duration:s,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=X("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(a.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class lg{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Br{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,u){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:m.getZoom()+(s.shiftKey?-1:1),around:m.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ov{constructor(){this._tap=new tf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,u,m){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?m.length>0&&(this._swipePoint=u[0],this._swipeTouch=m[0].identifier):this._tap.touchstart(s,u,m))}touchmove(s,u,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const y=u[0],x=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(s,u,m)}touchend(s,u,m){this._tapTime?this._swipePoint&&m.length===0&&this.reset():this._tap.touchend(s,u,m)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cg{constructor(s,u,m){this._el=s,this._mousePan=u,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bv{constructor(s,u,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Fv{constructor(s,u,m,y){this._el=s,this._touchZoom=u,this._touchRotate=m,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ci=f=>f.zoom||f.drag||f.pitch||f.rotate;class ug extends a.Event{}class Nv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,u){const m=a.sub([],u,s);this.radius=a.length(m[2]<0?a.div([],m,this.constants):[m[0],m[1],0])}projectRay(s){a.div(s,s,this.constants),a.normalize(s,s),a.mul$1(s,s,this.constants);const u=a.scale$2([],s,this.radius);if(u[2]>0){const m=a.scale$2([],[0,0,1],a.dot(u,[0,0,1])),y=a.scale$2([],a.normalize([],[u[0],u[1],0]),this.radius),x=a.add([],u,a.scale$2([],a.sub([],a.add([],y,m),u),2));u[0]=x[0],u[1]=x[1]}return u}}function Wi(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class go{constructor(s,u){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qm(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Nv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),a.bindAll(["handleEvent","handleWindowEvent"],this);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[a.window.document,"mousemove",{capture:!0}],[a.window.document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[a.window,"blur",void 0]];for(const[y,x,T]of this._listeners)y.addEventListener(x,y===a.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[s,u,m]of this._listeners)s.removeEventListener(u,s===a.window.document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const u=this._map,m=u.getCanvasContainer();this._add("mapEvent",new ef(u,s));const y=u.boxZoom=new eg(u,s);this._add("boxZoom",y);const x=new Lv,T=new Br;u.doubleClickZoom=new lg(T,x),this._add("tapZoom",x),this._add("clickZoom",T);const S=new Ov;this._add("tapDragZoom",S);const A=u.touchPitch=new ig(u);this._add("touchPitch",A);const D=new rf(s),R=new of(s);u.dragRotate=new Bv(s,D,R),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);const B=new nf(s),W=new Gu(u,s);u.dragPan=new cg(m,B,W),this._add("mousePan",B),this._add("touchPan",W,["touchZoom","touchRotate"]);const Z=new rg,Y=new ng;u.touchZoomRotate=new Fv(m,Y,Z,S),this._add("touchRotate",Z,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Vu(u));const K=u.scrollZoom=new ag(u,this);this._add("scrollZoom",K,["mousePan"]);const Q=u.keyboard=new zv;this._add("keyboard",Q);for(const F of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[F]&&u[F].enable(s[F])}_add(s,u,m){this._handlers.push({handlerName:s,handler:u,allowed:m}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ci(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,u,m){for(const y in s)if(y!==m&&(!u||u.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const u=[];for(const m of s)this._el.contains(m.target)&&u.push(m);return u}handleEvent(s,u){this._updatingCamera=!0;const m=s.type==="renderFrame",y=m?void 0:s,x={needsRenderFrame:!1},T={},S={},A=s.touches?this._getMapTouches(s.touches):void 0,D=A?Xe(this._el,A):m?void 0:Ge(this._el,s);for(const{handlerName:W,handler:Z,allowed:Y}of this._handlers){if(!Z.isEnabled())continue;let K;this._blockedByActive(S,Y,W)?Z.reset():Z[u||s.type]&&(K=Z[u||s.type](s,D,A),this.mergeHandlerResult(x,T,K,W,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||Z.isActive())&&(S[W]=Z)}const R={};for(const W in this._previousActiveHandlers)S[W]||(R[W]=y);this._previousActiveHandlers=S,(Object.keys(R).length||Wi(x))&&(this._changes.push([x,T,R]),this._triggerRenderFrame()),(Object.keys(S).length||Wi(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=x;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(s,u,m,y,x){if(!m)return;a.extend(s,m);const T={handlerName:y,originalEvent:m.originalEvent||x};m.zoomDelta!==void 0&&(u.zoom=T),m.panDelta!==void 0&&(u.drag=T),m.pitchDelta!==void 0&&(u.pitch=T),m.bearingDelta!==void 0&&(u.rotate=T)}_applyChanges(){const s={},u={},m={};for(const[y,x,T]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new a.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.aroundCoord!==void 0&&(s.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),a.extend(u,x),a.extend(m,T);this._updateMapTransform(s,u,m),this._changes=[]}_updateMapTransform(s,u,m){const y=this._map,x=y.transform,T=H=>[H.x,H.y,H.z];if((H=>{const ie=this._eventsInProgress.drag;return ie&&!this._handlersById[ie.handlerName].isActive()})()&&!Wi(s)){const H=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",H!==x.zoom&&this._map._update(!0)}if(x._isCameraConstrained&&y._stop(!0),!Wi(s))return void this._fireEvents(u,m,!0);let{panDelta:S,zoomDelta:A,bearingDelta:D,pitchDelta:R,around:B,aroundCoord:W,pinchAround:Z}=s;x._isCameraConstrained&&(A>0&&(A=0),x._isCameraConstrained=!1),Z!==void 0&&(B=Z),(A||(H=>u[H]&&!this._eventsInProgress[H])("drag"))&&B&&(this._dragOrigin=T(x.pointCoordinate3D(B)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",y._stop(!0),B=B||y.transform.centerPoint,D&&(x.bearing+=D),R&&(x.pitch+=R),x._updateCameraState();const Y=[0,0,0];if(S)if(x.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B).dir),ie=this._trackingEllipsoid.projectRay(x.screenPointToMercatorRay(B.sub(S)).dir);Y[0]=ie[0]-H[0],Y[1]=ie[1]-H[1]}else{const H=x.pointCoordinate(B);if(x.projection.name==="globe"){S=S.rotate(-x.angle);const ie=x._pixelsPerMercatorPixel/x.worldSize;Y[0]=-S.x*a.mercatorScale(a.latFromMercatorY(H.y))*ie,Y[1]=-S.y*a.mercatorScale(x.center.lat)*ie}else{const ie=x.pointCoordinate(B.sub(S));H&&ie&&(Y[0]=ie.x-H.x,Y[1]=ie.y-H.y)}}const K=x.zoom,Q=[0,0,0];if(A){const H=T(W||x.pointCoordinate3D(B)),ie={dir:a.normalize([],a.sub([],H,x._camera.position))};if(ie.dir[2]<0){const se=x.zoomDeltaToMovement(H,A);a.scale$2(Q,ie.dir,se)}}const F=a.add(Y,Y,Q);x._translateCameraConstrained(F),A&&Math.abs(x.zoom-K)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,m,!0)}_fireEvents(s,u,m){const y=Ci(this._eventsInProgress),x=Ci(s),T={};for(const R in s){const{originalEvent:B}=s[R];this._eventsInProgress[R]||(T[`${R}start`]=B),this._eventsInProgress[R]=s[R]}!y&&x&&this._fireEvent("movestart",x.originalEvent);for(const R in T)this._fireEvent(R,T[R]);x&&this._fireEvent("move",x.originalEvent);for(const R in s){const{originalEvent:B}=s[R];this._fireEvent(R,B)}const S={};let A;for(const R in this._eventsInProgress){const{handlerName:B,originalEvent:W}=this._eventsInProgress[R];this._handlersById[B].isActive()||(delete this._eventsInProgress[R],A=u[B]||W,S[`${R}end`]=A)}for(const R in S)this._fireEvent(R,S[R]);const D=Ci(this._eventsInProgress);if(m&&(y||x)&&!D){this._updatingCamera=!0;const R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=W=>W!==0&&-this._bearingSnap<W&&W<this._bearingSnap;R?(B(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:A})):(this._map.fire(new a.Event("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new a.Event(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new ug("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ea="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Wu extends a.Evented{constructor(s,u){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this._respectPrefersReducedMotion=u.respectPrefersReducedMotion!==!1,a.bindAll(["_renderFrameCallback"],this)}getCenter(){return new a.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,m){return s=a.Point.convert(s).mult(-1),this.panTo(this.transform.center,a.extend({offset:s},u),m)}panTo(s,u,m){return this.easeTo(a.extend({center:s},u),m)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,m){return this.easeTo(a.extend({zoom:s},u),m)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,m){return this.easeTo(a.extend({bearing:s},u),m)}resetNorth(s,u){return this.rotateTo(0,a.extend({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(a.extend({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=a.LngLatBounds.convert(s);const m=u&&u.bearing||0,y=u&&u.pitch||0,x=s.getNorthWest(),T=s.getSouthEast();return this._cameraForBounds(this.transform,x,T,m,y,u)}_extendCameraOptions(s){const u={top:0,bottom:0,right:0,left:0};if(typeof(s=a.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const m=s.padding;s.padding={top:m,bottom:m,right:m,left:m}}return s.padding=a.extend(u,s.padding),s}_minimumAABBFrustumDistance(s,u){const m=u.max[0]-u.min[0],y=u.max[1]-u.min[1];return m/y>s.aspect?m/(2*Math.tan(.5*s.fovX)*s.aspect):y/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,u,m,y,x,T){const S=s.clone(),A=this._extendCameraOptions(T);S.bearing=y,S.pitch=x;const D=a.LngLat.convert(u),R=a.LngLat.convert(m),B=.5*(D.lat+R.lat),W=.5*(D.lng+R.lng),Z=a.latLngToECEF(B,W),Y=a.normalize([],Z),K=a.normalize([],a.cross([],Y,[0,1,0])),Q=a.cross([],K,Y),F=[K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],H=[Z,a.latLngToECEF(D.lat,D.lng),a.latLngToECEF(R.lat,D.lng),a.latLngToECEF(R.lat,R.lng),a.latLngToECEF(D.lat,R.lng),a.latLngToECEF(B,D.lng),a.latLngToECEF(B,R.lng),a.latLngToECEF(D.lat,W),a.latLngToECEF(R.lat,W)];let ie=a.Aabb.fromPoints(H.map(We=>[a.dot(K,We),a.dot(Q,We),a.dot(Y,We)]));const se=a.transformMat4([],ie.center,F);a.squaredLength(se)===0&&a.set(se,0,0,1),a.normalize(se,se),a.scale$2(se,se,a.GLOBE_RADIUS),S.center=a.ecefToLatLng(se);const ge=S.getWorldToCameraMatrix(),ye=a.invert(new Float64Array(16),ge);ie=a.Aabb.applyTransform(ie,a.multiply([],ge,F)),a.transformMat4(se,se,ge);const _e=.5*(ie.max[2]-ie.min[2]),Ee=this._minimumAABBFrustumDistance(S,ie),be=a.scale$2([],[0,0,1],_e),ke=a.add(be,se,be),Ke=Ee+(S.pitch===0?0:a.distance(se,ke)),Ce=S.globeCenterInViewSpace,Ue=a.sub([],se,[Ce[0],Ce[1],Ce[2]]);a.normalize(Ue,Ue),a.scale$2(Ue,Ue,Ke);const Re=a.add([],se,Ue);a.transformMat4(Re,Re,ye);const Ze=a.earthRadius/a.GLOBE_RADIUS,Pe=a.length(Re),je=a.mercatorZfromAltitude(Math.max(Pe*Ze-a.earthRadius,Number.EPSILON),0),Ye=Math.min(S.zoomFromMercatorZAdjusted(je),A.maxZoom);return Ye>.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=Ye,this._cameraForBounds(S,u,m,y,x,T)):{center:S.center,zoom:Ye,bearing:y,pitch:x}}queryTerrainElevation(s,u){const m=this.transform.elevation;return m?(u=a.extend({},{exaggerated:!0},u),m.getAtPoint(a.MercatorCoordinate.fromLngLat(s),null,u.exaggerated)):null}_cameraForBounds(s,u,m,y,x,T){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,u,m,y,x,T);const S=s.clone(),A=this._extendCameraOptions(T),D=S.padding;S.bearing=y,S.pitch=x;const R=a.LngLat.convert(u),B=a.LngLat.convert(m),W=new a.LngLat(R.lng,B.lat),Z=new a.LngLat(B.lng,R.lat),Y=S.project(R),K=S.project(B),Q=this.queryTerrainElevation(R),F=this.queryTerrainElevation(B),H=this.queryTerrainElevation(W),ie=this.queryTerrainElevation(Z),se=[[Y.x,Y.y,Math.min(Q||0,F||0,H||0,ie||0)],[K.x,K.y,Math.max(Q||0,F||0,H||0,ie||0)]];let ge=a.Aabb.fromPoints(se);const ye=S.getWorldToCameraMatrix(),_e=a.invert(new Float64Array(16),ye);ge=a.Aabb.applyTransform(ge,ye);const Ee=a.sub([],ge.max,ge.min),be=D.left||0,ke=D.right||0,Ke=D.bottom||0,Ce=D.top||0,{left:Ue,right:Re,top:Ze,bottom:Pe}=A.padding,je=.5*(be+ke),Ye=.5*(Ce+Ke),We=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(be+ke+Ue+Re))/Ee[0],(S.height-(Ke+Ce+Pe+Ze))/Ee[1])),A.maxZoom),et=S.scale/S.zoomScale(We);ge=new a.Aabb([ge.min[0]-(Ue+je)*et,ge.min[1]-(Pe+Ye)*et,ge.min[2]],[ge.max[0]+(Re+je)*et,ge.max[1]+(Ze+Ye)*et,ge.max[2]]);const xt=.5*Ee[2],At=this._minimumAABBFrustumDistance(S,ge),mt=[0,0,1,0];a.transformMat4$1(mt,mt,ye),a.normalize$2(mt,mt);const St=a.scale$2([],mt,At+xt),Wt=a.add([],ge.center,St),Nt=(typeof A.offset.x=="number"&&typeof A.offset.y=="number"?new a.Point(A.offset.x,A.offset.y):a.Point.convert(A.offset)).rotate(-a.degToRad(y));ge.center[0]-=Nt.x*et,ge.center[1]+=Nt.y*et,a.transformMat4(ge.center,ge.center,_e),a.transformMat4(Wt,Wt,_e);const yt=[ge.center[0],ge.center[1],Wt[2]*S.pixelsPerMeter];a.scale$2(yt,yt,1/S.worldSize);const ln=a.lngFromMercatorX(yt[0]),fn=a.latFromMercatorY(yt[1]),pn=Math.min(S._zoomFromMercatorZ(yt[2]),A.maxZoom),mn=new a.LngLat(ln,fn);return S.mercatorFromTransition&&pn<.5*(a.GLOBE_ZOOM_THRESHOLD_MIN+a.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=pn,this._cameraForBounds(S,u,m,y,x,T)):{center:mn,zoom:pn,bearing:y,pitch:x}}fitBounds(s,u,m){const y=this.cameraForBounds(s,u);return this._fitInternal(y,u,m)}fitScreenCoordinates(s,u,m,y,x){const T=a.Point.convert(s),S=a.Point.convert(u),A=new a.Point(Math.min(T.x,S.x),Math.min(T.y,S.y)),D=new a.Point(Math.max(T.x,S.x),Math.max(T.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(T,S))return this;const R=this.transform.pointLocation3D(A),B=this.transform.pointLocation3D(D),W=this.transform.pointLocation3D(new a.Point(A.x,D.y)),Z=this.transform.pointLocation3D(new a.Point(D.x,A.y)),Y=[Math.min(R.lng,B.lng,W.lng,Z.lng),Math.min(R.lat,B.lat,W.lat,Z.lat)],K=[Math.max(R.lng,B.lng,W.lng,Z.lng),Math.max(R.lat,B.lat,W.lat,Z.lat)],Q=y&&y.pitch?y.pitch:this.getPitch(),F=this._cameraForBounds(this.transform,Y,K,m,Q,y);return this._fitInternal(F,y,x)}_fitInternal(s,u,m){return s?(delete(u=a.extend(s,u)).padding,u.linear?this.easeTo(u,m):this.flyTo(u,m)):this}jumpTo(s,u){this.stop();const m=s.preloadOnly?this.transform.clone():this.transform;let y=!1,x=!1,T=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(y=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=a.LngLat.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(x=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(T=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),s.preloadOnly?(this._preloadTiles(m),this):(this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),y&&this.fire(new a.Event("zoomstart",u)).fire(new a.Event("zoom",u)).fire(new a.Event("zoomend",u)),x&&this.fire(new a.Event("rotatestart",u)).fire(new a.Event("rotate",u)).fire(new a.Event("rotateend",u)),T&&this.fire(new a.Event("pitchstart",u)).fire(new a.Event("pitch",u)).fire(new a.Event("pitchend",u)),this.fire(new a.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||a.warnOnce(ea),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,u){const m=this.transform;if(!m.projection.supportsFreeCamera)return a.warnOnce(ea),this;this.stop();const y=m.zoom,x=m.pitch,T=m.bearing;m.setFreeCameraOptions(s);const S=y!==m.zoom,A=x!==m.pitch,D=T!==m.bearing;return this.fire(new a.Event("movestart",u)).fire(new a.Event("move",u)),S&&this.fire(new a.Event("zoomstart",u)).fire(new a.Event("zoom",u)).fire(new a.Event("zoomend",u)),D&&this.fire(new a.Event("rotatestart",u)).fire(new a.Event("rotate",u)).fire(new a.Event("rotateend",u)),A&&this.fire(new a.Event("pitchstart",u)).fire(new a.Event("pitch",u)).fire(new a.Event("pitchend",u)),this.fire(new a.Event("moveend",u)),this}easeTo(s,u){this._stop(!1,s.easeId),((s=a.extend({offset:[0,0],duration:500,easing:a.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const m=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in s?+s.zoom:y,D="bearing"in s?this._normalizeBearing(s.bearing,x):x,R="pitch"in s?+s.pitch:T,B="padding"in s?s.padding:m.padding,W=a.Point.convert(s.offset);let Z,Y,K;if(m.projection.name==="globe"){const be=a.MercatorCoordinate.fromLngLat(m.center),ke=W.rotate(-m.angle);be.x+=ke.x/m.worldSize,be.y+=ke.y/m.worldSize;const Ke=be.toLngLat(),Ce=a.LngLat.convert(s.center||Ke);this._normalizeCenter(Ce),Z=m.centerPoint.add(ke),Y=new a.Point(be.x,be.y).mult(m.worldSize),K=new a.Point(a.mercatorXfromLng(Ce.lng),a.mercatorYfromLat(Ce.lat)).mult(m.worldSize).sub(Y)}else{Z=m.centerPoint.add(W);const be=m.pointLocation(Z),ke=a.LngLat.convert(s.center||be);this._normalizeCenter(ke),Y=m.project(be),K=m.project(ke).sub(Y)}const Q=m.zoomScale(A-y);let F,H;s.around&&(F=a.LngLat.convert(s.around),H=m.locationPoint(F));const ie=this._zooming||A!==y,se=this._rotating||x!==D,ge=this._pitching||R!==T,ye=!m.isPaddingEqual(B),_e=be=>ke=>{if(ie&&(be.zoom=a.number(y,A,ke)),se&&(be.bearing=a.number(x,D,ke)),ge&&(be.pitch=a.number(T,R,ke)),ye&&(be.interpolatePadding(S,B,ke),Z=be.centerPoint.add(W)),F)be.setLocationAtPoint(F,H);else{const Ke=be.zoomScale(be.zoom-y),Ce=A>y?Math.min(2,Q):Math.max(.5,Q),Ue=Math.pow(Ce,1-ke),Re=be.unproject(Y.add(K.mult(ke*Ue)).mult(Ke));be.setLocationAtPoint(be.renderWorldCopies?Re.wrap():Re,Z)}return s.preloadOnly||this._fireMoveEvents(u),be};if(s.preloadOnly){const be=this._emulate(_e,s.duration,m);return this._preloadTiles(be),this}const Ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ie,this._rotating=se,this._pitching=ge,this._padding=ye,this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,Ee),this._ease(_e(m),be=>{m.recenterOnTerrain(),this._afterEase(u,be)},s),this}_prepareEase(s,u,m={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||m.moving||this.fire(new a.Event("movestart",s)),this._zooming&&!m.zooming&&this.fire(new a.Event("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new a.Event("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new a.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new a.Event("move",s)),this._zooming&&this.fire(new a.Event("zoom",s)),this._rotating&&this.fire(new a.Event("rotate",s)),this._pitching&&this.fire(new a.Event("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const m=this._zooming,y=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new a.Event("zoomend",s)),y&&this.fire(new a.Event("rotateend",s)),x&&this.fire(new a.Event("pitchend",s)),this.fire(new a.Event("moveend",s))}flyTo(s,u){if(this._prefersReducedMotion(s)){const We=a.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(We,u)}this.stop(),s=a.extend({offset:[0,0],speed:1.2,curve:1.42,easing:a.ease},s);const m=this.transform,y=this.getZoom(),x=this.getBearing(),T=this.getPitch(),S=this.getPadding(),A="zoom"in s?a.clamp(+s.zoom,m.minZoom,m.maxZoom):y,D="bearing"in s?this._normalizeBearing(s.bearing,x):x,R="pitch"in s?+s.pitch:T,B="padding"in s?s.padding:m.padding,W=m.zoomScale(A-y),Z=a.Point.convert(s.offset);let Y=m.centerPoint.add(Z);const K=m.pointLocation(Y),Q=a.LngLat.convert(s.center||K);this._normalizeCenter(Q);const F=m.project(K),H=m.project(Q).sub(F);let ie=s.curve;const se=Math.max(m.width,m.height),ge=se/W,ye=H.mag();if("minZoom"in s){const We=a.clamp(Math.min(s.minZoom,y,A),m.minZoom,m.maxZoom),et=se/m.zoomScale(We-y);ie=Math.sqrt(et/ye*2)}const _e=ie*ie;function Ee(We){const et=(ge*ge-se*se+(We?-1:1)*_e*_e*ye*ye)/(2*(We?ge:se)*_e*ye);return Math.log(Math.sqrt(et*et+1)-et)}function be(We){return(Math.exp(We)-Math.exp(-We))/2}function ke(We){return(Math.exp(We)+Math.exp(-We))/2}const Ke=Ee(0);let Ce=function(We){return ke(Ke)/ke(Ke+ie*We)},Ue=function(We){return se*((ke(Ke)*(be(et=Ke+ie*We)/ke(et))-be(Ke))/_e)/ye;var et},Re=(Ee(1)-Ke)/ie;if(Math.abs(ye)<1e-6||!isFinite(Re)){if(Math.abs(se-ge)<1e-6)return this.easeTo(s,u);const We=ge<se?-1:1;Re=Math.abs(Math.log(ge/se))/ie,Ue=function(){return 0},Ce=function(et){return Math.exp(We*ie*et)}}s.duration="duration"in s?+s.duration:1e3*Re/("screenSpeed"in s?+s.screenSpeed/ie:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const Ze=x!==D,Pe=R!==T,je=!m.isPaddingEqual(B),Ye=We=>et=>{const xt=et*Re,At=1/Ce(xt);We.zoom=et===1?A:y+We.scaleZoom(At),Ze&&(We.bearing=a.number(x,D,et)),Pe&&(We.pitch=a.number(T,R,et)),je&&(We.interpolatePadding(S,B,et),Y=We.centerPoint.add(Z));const mt=et===1?Q:We.unproject(F.add(H.mult(Ue(xt))).mult(At));return We.setLocationAtPoint(We.renderWorldCopies?mt.wrap():mt,Y),We._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(u),We};if(s.preloadOnly){const We=this._emulate(Ye,s.duration,m);return this._preloadTiles(We),this}return this._zooming=!0,this._rotating=Ze,this._pitching=Pe,this._padding=je,this._prepareEase(u,!1),this._ease(Ye(m),()=>this._afterEase(u),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const m=this._onEaseEnd;this._onEaseEnd=void 0,m.call(this,u)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,u,m){m.animate===!1||m.duration===0?(s(1),u()):(this._easeStart=a.exported.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((a.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,u){s=a.wrap(s,-180,180);const m=Math.abs(s-u);return Math.abs(s-360-u)<m&&(s-=360),Math.abs(s+360-u)<m&&(s+=360),s}_normalizeCenter(s){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const m=s.lng-u.center.lng;s.lng+=m>180?-360:m<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&a.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,u,m){const y=Math.ceil(15*u/1e3),x=[],T=s(m.clone());for(let S=0;S<=y;S++){const A=T(S/y);x.push(A.clone())}return x}}class ft{constructor(s={}){this.options=s,a.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const u=this.options&&this.options.compact;return this._map=s,this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=X("button","mapboxgl-ctrl-attrib-button",this._container),X("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=X("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,u){const m=this._map._getUIString(`AttributionControl.${u}`);s.setAttribute("aria-label",m),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",m)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||a.config.ACCESS_TOKEN}];if(s){const m=u.reduce((y,x,T)=>(x.value&&(y+=`${x.key}=${x.value}${T<u.length-1?"&":""}`),y),"?");s.href=`${a.config.FEEDBACK_URL}/${m}#${wc(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const u=this._map.style._sourceCaches;for(const y in u){const x=u[y];if(x.used){const T=x.getSource();T.attribution&&s.indexOf(T.attribution)<0&&s.push(T.attribution)}}s.sort((y,x)=>y.length-x.length),s=s.filter((y,x)=>{for(let T=x+1;T<s.length;T++)if(s[T].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class cf{constructor(){a.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=X("div","mapboxgl-ctrl");const u=X("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const u in s){const m=s[u].getSource();if(m.hasOwnProperty("mapbox_logo")&&!m.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const u=s[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class uf{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,m=u?this._queue.concat(u):this._queue;for(const y of m)if(y.id===s)return void(y.cancelled=!0)}run(s=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const m of u)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function nl(f,s,u){if(f=new a.LngLat(f.lng,f.lat),s){const m=new a.LngLat(f.lng-360,f.lat),y=new a.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-u.center.lng)/360),T=u.locationPoint(f).distSqr(s),S=s.x<0||s.y<0||s.x>u.width||s.y>u.height;u.locationPoint(m).distSqr(s)<T&&(S||Math.abs(m.lng-u.center.lng)<x)?f=m:u.locationPoint(y).distSqr(s)<T&&(S||Math.abs(y.lng-u.center.lng)<x)&&(f=y)}for(;Math.abs(f.lng-u.center.lng)>180;){const m=u.locationPoint(f);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;f.lng>u.center.lng?f.lng-=360:f.lng+=360}return f}const ta={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ut extends a.Evented{constructor(s,u){if(super(),(s instanceof a.window.HTMLElement||u)&&(s=a.extend({element:s},u)),a.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=a.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=X("div");const y=41,x=27,T=oe("svg",{display:"block",height:y*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${y}`},this._element),S=oe("radialGradient",{id:"shadowGradient"},oe("defs",{},T));oe("stop",{offset:"10%","stop-opacity":.4},S),oe("stop",{offset:"100%","stop-opacity":.05},S),oe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),oe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),oe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),oe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=a.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const m=this._element.classList;for(const y in ta)m.remove(`mapboxgl-marker-anchor-${y}`);m.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const u=s.code,m=s.charCode||s.keyCode;u!=="Space"&&u!=="Enter"&&m!==32&&m!==13||this.togglePopup()}_onMapClick(s){const u=s.originalEvent.target,m=this._element;this._popup&&(u===m||m.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,u=this._pos;if(!s||!u)return!1;const m=s.unproject(u),y=s.getFreeCameraOptions();if(!y.position)return!1;const x=y.position.toLngLat();return x.distanceTo(m)<.9*x.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const u=this._pos;if(!u||u.x<0||u.x>s.transform.width||u.y<0||u.y>s.transform.height)return void this._clearFadeTimer();const m=s.unproject(u);let y;s._showingGlobe()&&a.isLngLatBehindGlobe(s.transform,this._lngLat)?y=0:(y=1-s._queryFogOpacity(m),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const u=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${ta[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${u.x}px,${u.y}px)
        `}_calculateXYTransform(){const s=this._pos,u=this._map,m=this.getPitchAlignment();if(!u||!s||m!=="map")return"";if(!u._showingGlobe()){const A=u.getPitch();return A?`rotateX(${A}deg)`:""}const y=a.radToDeg(a.globeTiltAtLngLat(u.transform,this._lngLat)),x=s.sub(a.globeCenterToScreenPoint(u.transform)),T=Math.abs(x.x)+Math.abs(x.y);if(T===0)return"";const S=y/T;return`rotateX(${-x.y*S}deg) rotateY(${x.x*S}deg)`}_calculateZTransform(){const s=this._pos,u=this._map;if(!u||!s)return"";let m=0;const y=this.getRotationAlignment();if(y==="map")if(u._showingGlobe()){const x=u.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),T=u.project(new a.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(x);m=a.radToDeg(Math.atan2(T.y,T.x))-90}else m=-u.getBearing();else if(y==="horizon"){const x=a.smoothstep(4,6,u.getZoom()),T=a.globeCenterToScreenPoint(u.transform);T.y+=x*u.transform.height;const S=s.sub(T),A=a.radToDeg(Math.atan2(S.y,S.x));m=(A>90?A-270:A+90)*(1-x)}return m+=this._rotation,m?`rotateZ(${m}deg)`:""}_update(s){a.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=nl(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),s===!0?this._updateFrameId=a.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._showingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=a.Point.convert(s),this._update(),this}_onMove(s){const u=this._map;if(!u)return;const m=this._pointerdownPos,y=this._positionDelta;if(m&&y){if(!this._isDragging){const x=this._clickTolerance||u._clickTolerance;if(s.point.dist(m)<x)return;this._isDragging=!0}this._pos=s.point.sub(y),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.Event("dragstart"))),this.fire(new a.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new a.Event("dragend")),this._state="inactive"}_addDragHandler(s){const u=this._map,m=this._pos;u&&m&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(m),this._pointerdownPos=s.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const u=this._map;return u&&(s?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jv=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hg(f=new a.Point(0,0),s="bottom"){if(typeof f=="number"){const u=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(s){case"top":return new a.Point(0,f);case"top-left":return new a.Point(u,u);case"top-right":return new a.Point(-u,u);case"bottom":return new a.Point(0,-f);case"bottom-left":return new a.Point(u,-u);case"bottom-right":return new a.Point(-u,-u);case"left":return new a.Point(f,0);case"right":return new a.Point(-f,0)}return new a.Point(0,0)}return f instanceof a.Point||Array.isArray(f)?a.Point.convert(f):a.Point.convert(f[s]||[0,0])}class df{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const u=a.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,u,m){this._start=this.getValue(u),this._end=s,this._startTime=u,this._endTime=u+m}}const dg={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},fg={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Uv={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vv{constructor(s,u,m=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new rf({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,m&&(this.mousePitch=new of({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),a.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(s,u){this.mouseRotate.mousedown(s,u),this.mousePitch&&this.mousePitch.mousedown(s,u),J()}move(s,u){const m=this.map,y=this.mouseRotate.mousemoveWindow(s,u),x=y&&y.bearingDelta;if(x&&m.setBearing(m.getBearing()+x),this.mousePitch){const T=this.mousePitch.mousemoveWindow(s,u),S=T&&T.pitchDelta;S&&m.setPitch(m.getPitch()+S)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ce(),a.window.removeEventListener("mousemove",this.mousemove),a.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(a.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Ge(this.element,s)),a.window.addEventListener("mousemove",this.mousemove),a.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Ge(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xe(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Xe(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ff={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},pf={maxWidth:100,unit:"metric"},mf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},rl={version:a.version,supported:O,setRTLTextPlugin:a.setRTLTextPlugin,getRTLTextPluginStatus:a.getRTLTextPluginStatus,Map:class extends Wu{constructor(f){if(a.LivePerformanceUtils.mark(a.PerformanceMarkers.create),(f=a.extend({},fg,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&a.isSafariWithAntialiasingBug(a.window)&&(f.antialias=!1,a.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ya(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._useWebGL2=f.useWebGL2,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new uf,this._domRenderTaskQueue=new uf,this._controls=[],this._markers=[],this._popups=[],this._mapId=a.uniqueId(),this._locale=a.extend({},dg,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new df(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new a.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,typeof f.container=="string"){if(this._container=a.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof a.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&a.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),a.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),a.window!==void 0&&(a.window.addEventListener("online",this._onWindowOnline,!1),a.window.addEventListener("resize",this._onWindowResize,!1),a.window.addEventListener("orientationchange",this._onWindowResize,!1),a.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new go(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Qd(typeof f.hash=="string"&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,a.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new ft({customAttribution:f.customAttribution})),this._logoControl=new cf,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new a.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new a.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(f,s){if(s===void 0&&(s=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=f.onAdd(this);this._controls.push(f);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(u,m.firstChild):m.appendChild(u),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new a.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(f);return s>-1&&this._controls.splice(s,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new a.Event("movestart",f)).fire(new a.Event("move",f)),this.fire(new a.Event("resize",f)),s&&this.fire(new a.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(a.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new a.Event("zoomstart")).fire(new a.Event("zoom")).fire(new a.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new a.Event("pitchstart")).fire(new a.Event("pitch")).fire(new a.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?a.window.navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(s=>s==="auto"?a.window.navigator.language:s):f}setLanguage(f){const s=this._parseLanguage(f);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const u of this._controls)u._setLanguage&&u._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const f=this.transform,s=f.projection.name;let u;s==="globe"&&f.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?(f.setMercatorFromTransition(),u=!0):s==="mercator"&&f.zoom<a.GLOBE_ZOOM_THRESHOLD_MAX&&(f.setProjection({name:"globe"}),u=!0),u&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,s){return this._updateProjection(f||s||{name:"mercator"})}_updateProjection(f){let s;if(s=f.name==="globe"&&this.transform.zoom>=a.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const u in this.style._sourceCaches)this.style._sourceCaches[u].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(f){return this.transform.locationPoint3D(a.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(a.Point.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,s,u){if(f==="mouseenter"||f==="mouseover"){let m=!1;const y=T=>{const S=s.filter(D=>this.getLayer(D)),A=S.length?this.queryRenderedFeatures(T.point,{layers:S}):[];A.length?m||(m=!0,u.call(this,new br(f,this,T.originalEvent,{features:A}))):m=!1},x=()=>{m=!1};return{layers:new Set(s),listener:u,delegates:{mousemove:y,mouseout:x}}}if(f==="mouseleave"||f==="mouseout"){let m=!1;const y=T=>{const S=s.filter(A=>this.getLayer(A));(S.length?this.queryRenderedFeatures(T.point,{layers:S}):[]).length?m=!0:m&&(m=!1,u.call(this,new br(f,this,T.originalEvent)))},x=T=>{m&&(m=!1,u.call(this,new br(f,this,T.originalEvent)))};return{layers:new Set(s),listener:u,delegates:{mousemove:y,mouseout:x}}}{const m=y=>{const x=s.filter(S=>this.getLayer(S)),T=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];T.length&&(y.features=T,u.call(this,y),delete y.features)};return{layers:new Set(s),listener:u,delegates:{[f]:m}}}}on(f,s,u){if(u===void 0)return super.on(f,s);Array.isArray(s)||(s=[s]);const m=this._createDelegatedListener(f,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(m);for(const y in m.delegates)this.on(y,m.delegates[y]);return this}once(f,s,u){if(u===void 0)return super.once(f,s);Array.isArray(s)||(s=[s]);const m=this._createDelegatedListener(f,s,u);for(const y in m.delegates)this.once(y,m.delegates[y]);return this}off(f,s,u){if(u===void 0)return super.off(f,s);s=new Set(Array.isArray(s)?s:[s]);const m=(x,T)=>{if(x.size!==T.size)return!1;for(const S of x)if(!T.has(S))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[f]:void 0;return y&&(x=>{for(let T=0;T<x.length;T++){const S=x[T];if(S.listener===u&&m(S.layers,s)){for(const A in S.delegates)this.off(A,S.delegates[A]);return x.splice(T,1),this}}})(y),this}queryRenderedFeatures(f,s){return this.style?(s!==void 0||f===void 0||f instanceof a.Point||Array.isArray(f)||(s=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(f,s){return this.style.querySourceFeatures(f,s)}isPointOnSurface(f){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&a.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(a.Point.convert(f))}setStyle(f,s){return(s=a.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(f,s))}_getUIString(f){const s=this._locale[f];if(s==null)throw new Error(`Missing UI string '${f}'`);return s}_updateStyle(f,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f&&(this.style=new po(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new po(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,s){if(typeof f=="string"){const u=this._requestManager.normalizeStyleURL(f),m=this._requestManager.transformRequest(u,a.ResourceType.Style);a.getJSON(m,(y,x)=>{y?this.fire(new a.ErrorEvent(y)):x&&this._updateDiff(x,s)})}else typeof f=="object"&&this._updateDiff(f,s)}_updateDiff(f,s){try{this.style.setState(f)&&this._update(!0)}catch(u){a.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(f,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(a.warnOnce("There is no style added to the map."),!1)}addSource(f,s){return this._lazyInitEmptyStyle(),this.style.addSource(f,s),this._update(!0)}isSourceLoaded(f){return!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const s in f){const u=f[s]._tiles;for(const m in u){const y=u[m];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(f,s,u){this._lazyInitEmptyStyle(),this.style.addSourceType(f,s,u)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,s,{pixelRatio:u=1,sdf:m=!1,stretchX:y,stretchY:x,content:T}={}){if(this._lazyInitEmptyStyle(),s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap){const{width:S,height:A,data:D}=a.exported.getImageData(s);this.style.addImage(f,{data:new a.RGBAImage({width:S,height:A},D),pixelRatio:u,stretchX:y,stretchY:x,content:T,sdf:m,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:A}=s,D=s;this.style.addImage(f,{data:new a.RGBAImage({width:S,height:A},new Uint8Array(D.data)),pixelRatio:u,stretchX:y,stretchY:x,content:T,sdf:m,version:0,userImage:D}),D.onAdd&&D.onAdd(this,f)}}updateImage(f,s){const u=this.style.getImage(f);if(!u)return void this.fire(new a.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap?a.exported.getImageData(s):s,{width:y,height:x}=m;y!==void 0&&x!==void 0?y===u.data.width&&x===u.data.height?(u.data.replace(m.data,!(s instanceof a.window.HTMLImageElement||a.window.ImageBitmap&&s instanceof a.window.ImageBitmap)),this.style.updateImage(f,u)):this.fire(new a.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`))):this.fire(new a.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new a.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,s){a.getImage(this._requestManager.transformRequest(f,a.ResourceType.Image),(u,m)=>{s(u,m instanceof a.window.HTMLImageElement?a.exported.getImageData(m):m)})}listImages(){return this.style.listImages()}addLayer(f,s){return this._lazyInitEmptyStyle(),this.style.addLayer(f,s),this._update(!0)}moveLayer(f,s){return this.style.moveLayer(f,s),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,s,u){return this.style.setLayerZoomRange(f,s,u),this._update(!0)}setFilter(f,s,u={}){return this.style.setFilter(f,s,u),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,s,u,m={}){return this.style.setPaintProperty(f,s,u,m),this._update(!0)}getPaintProperty(f,s){return this.style.getPaintProperty(f,s)}setLayoutProperty(f,s,u,m={}){return this.style.setLayoutProperty(f,s,u,m),this._update(!0)}getLayoutProperty(f,s){return this.style.getLayoutProperty(f,s)}setLight(f,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(a.LngLat.convert(f),this.transform):0}setFeatureState(f,s){return this.style.setFeatureState(f,s),this._update()}removeFeatureState(f,s){return this.style.removeFeatureState(f,s),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let u,m,y,x=this._container;for(;x&&(!m||!y);){const T=a.window.getComputedStyle(x).transform;T&&T!=="none"&&(u=T.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&u[0]!=="0"&&u[0]!=="1"&&(m=u[0]),u[3]&&u[3]!=="0"&&u[3]!=="1"&&(y=u[3])),x=x.parentElement}this._containerWidth=m?Math.abs(f/m):f,this._containerHeight=y?Math.abs(s/y):s}_detectMissingCSS(){a.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&a.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=X("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=X("div","mapboxgl-canvas-container",f);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=X("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=X("div","mapboxgl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=X("div",`mapboxgl-ctrl-${y}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,s){const u=a.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(f),this._canvas.height=u*Math.ceil(s),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${s}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const s=this._markers.indexOf(f);s!==-1&&this._markers.splice(s,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){const s=this._popups.indexOf(f);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const f=a.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",f),u=s||this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);u?(this._useWebGL2&&!s&&a.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),a.storeAuthState(u,!0),this.painter=new Ka(u,this.transform,!!s),this.on("data",m=>{m.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),a.exported$1.testSupport(u)):this.fire(new a.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new a.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new a.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let s;const u=this.painter.context.extTimerQuery,m=a.exported.now();if(this.listens("gpu-timing-frame")&&(s=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],a.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],a.window.performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,A=this.transform.pitch,D=a.exported.now(),R=new a.EvaluationParameters(S,{now:D,fadeDuration:y,pitch:A,transition:this.style.getTransition()});this.style.update(R)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(m),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(m),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new a.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new a.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const S=a.exported.now()-m;u.endQueryEXT(u.TIME_ELAPSED_EXT,s),setTimeout(()=>{const A=u.getQueryObjectEXT(s,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(s),this.fire(new a.Event("gpu-timing-frame",{cpuTime:S,gpuTime:A})),a.window.performance.mark("frame-gpu",{startTime:m,detail:{gpuTime:A}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const A=this.painter.queryGpuTimers(S);this.fire(new a.Event("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const A=this.painter.queryGpuTimeDeferredRender(S);this.fire(new a.Event("gpu-timing-deferred-render",{gpuTime:A}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(x=this._updateAverageElevation(m,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new a.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const A=this._calculateSpeedIndex();this.fire(new a.Event("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,a.LivePerformanceUtils.mark(a.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&a.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(const s of this._markers)f&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!f||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(f,s=!1){const u=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&u(0);if((s||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const m=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),x=!1;this.transform.elevation&&(x=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=f;const T=Math.abs(m-y);if(T>1){if(this._isInitialLoad||x)return this._averageElevation.jumpTo(y),u(y);this._averageElevation.easeTo(y,f,300)}else if(T>1e-4)return this._averageElevation.jumpTo(y),u(y)}return!!this._averageElevation.isEasing(f)&&u(this._averageElevation.getValue(f))}_authenticate(){a.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===a.AUTH_ERR_MSG||f.status===401)){const s=this.painter.context.gl;a.storeAuthState(s,!1),this._logoControl instanceof cf&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new a.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),a.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const u=this.painter.context.gl,m=u.createFramebuffer();function y(x){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,x,0);const T=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,T),T}return u.bindFramebuffer(u.FRAMEBUFFER,m),this._canvasPixelComparison(y(f),s.canvasCopies.map(y),s.timeStamps)}_canvasPixelComparison(f,s,u){let m=u[1]-u[0];const y=f.length/4;for(let x=0;x<s.length;x++){const T=s[x];let S=0;for(let A=0;A<T.length;A+=4)T[A]===f[A]&&T[A+1]===f[A+1]&&T[A+2]===f[A+2]&&T[A+3]===f[A+3]&&(S+=1);m+=(u[x+2]-u[x+1])*(1-S/y)}return m}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),a.window!==void 0&&(a.window.removeEventListener("resize",this._onWindowResize,!1),a.window.removeEventListener("orientationchange",this._onWindowResize,!1),a.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),a.window.removeEventListener("online",this._onWindowOnline,!1),a.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),a.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new a.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=a.exported.frame(s=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(s)}))}_preloadTiles(f){const s=this.style?Object.values(this.style._sourceCaches):[];return a.asyncAll(s,(u,m)=>u._preloadTiles(f,m),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){a.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,f&&this._update())}_setCacheLimits(f,s){a.setCacheLimits(f,s)}get version(){return a.version}},NavigationControl:class{constructor(f){this.options=a.extend({},Uv,f),this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(a.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),X("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),X("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(a.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:s}):u.resetNorth({},{originalEvent:s}))}),this._compassIcon=X("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const f=this._map;if(!f)return;const s=f.getZoom(),u=s===f.getMaxZoom(),m=s===f.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())}_rotateCompassArrow(){const f=this._map;if(!f)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vv(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){const f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,s){const u=X("button",f,this._container);return u.type="button",u.addEventListener("click",s),u}_setButtonTitle(f,s){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${s}`);f.setAttribute("aria-label",u),f.firstElementChild&&f.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends a.Evented{constructor(f){super(),this.options=a.extend({geolocation:a.window.navigator.geolocation},ff,f),a.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){const s=(u=!!this.options.geolocation)=>{this._supportsGeolocation=u,f(u)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):a.window.navigator.permissions!==void 0?a.window.navigator.permissions.query({name:"geolocation"}).then(u=>s(u.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(f){const s=this._map.getMaxBounds(),u=f.coords;return!!s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new a.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("geolocate",f)),this._finish()}}_updateCamera(f){const s=new a.LngLat(f.coords.longitude,f.coords.latitude),u=f.coords.accuracy,m=this._map.getBearing(),y=a.extend({bearing:m},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(u),y,{geolocateSource:!0})}_updateMarker(f){if(f){const s=new a.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map.transform,s=a.mercatorZfromAltitude(1,f._center.lat)*f.worldSize,u=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new a.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=X("button","mapboxgl-ctrl-geolocate",this._container),X("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){a.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=X("div","mapboxgl-user-location"),this._dotElement.appendChild(X("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(X("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ut({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=X("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ut({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new a.Event("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return a.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new a.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{a.window.addEventListener("ondeviceorientationabsolute"in a.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};a.window.DeviceMotionEvent!==void 0&&typeof a.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),a.window.removeEventListener("deviceorientation",this._onDeviceOrientation),a.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ft,ScaleControl:class{constructor(f){this.options=a.extend({},pf,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),a.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const f=this.options.maxWidth||100,s=this._map,u=s._containerHeight/2,m=s._containerWidth/2-f/2,y=s.unproject([m,u]),x=s.unproject([m+f,u]),T=y.distanceTo(x);if(this.options.unit==="imperial"){const S=3.2808*T;S>5280?this._setScale(f,S/5280,"mile"):this._setScale(f,S,"foot")}else this.options.unit==="nautical"?this._setScale(f,T/1852,"nautical-mile"):T>=1e3?this._setScale(f,T/1e3,"kilometer"):this._setScale(f,T,"meter")}_setScale(f,s,u){this._map._requestDomTask(()=>{const m=function(x){const T=Math.pow(10,`${Math.floor(x)}`.length-1);let S=x/T;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(S),T*S}(s),y=m/s;this._container.innerHTML=this._isNumberFormatSupported&&u!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:u}).format(m):`${m}&nbsp;${mf[u]}`,this._container.style.width=f*y+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=X("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof a.window.HTMLElement?this._container=f.container:a.warnOnce("Full screen control 'container' must be a DOM element.")),a.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in a.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in a.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=X("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",a.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,a.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!a.window.document.fullscreenEnabled&&!a.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=X("button","mapboxgl-ctrl-fullscreen",this._controlContainer);X("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),a.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(a.window.document.fullscreenElement||a.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?a.window.document.exitFullscreen?a.window.document.exitFullscreen():a.window.document.webkitCancelFullScreen&&a.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends a.Evented{constructor(f){super(),this.options=a.extend(Object.create(hf),f),a.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new a.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new a.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=a.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(a.window.document.createTextNode(f))}setHTML(f){const s=a.window.document.createDocumentFragment(),u=a.window.document.createElement("body");let m;for(u.innerHTML=f;m=u.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=X("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(f),this.options.closeButton){const u=this._closeButton=X("button","mapboxgl-popup-close-button",s);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let s;return this._classList.delete(f)?s=!1:(this._classList.add(f),s=!0),this._updateClassList(),s}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const s=this._map,u=this._container,m=this._pos;if(!s||!u||!m)return"bottom";const y=u.offsetWidth,x=u.offsetHeight,T=m.x<y/2,S=m.x>s.transform.width-y/2;if(m.y+f<x)return T?"top-left":S?"top-right":"top";if(m.y>s.transform.height-x){if(T)return"bottom-left";if(S)return"bottom-right"}return T?"left":S?"right":"bottom"}_updateClassList(){const f=this._container;if(!f)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),f.className=s.join(" ")}_update(f){const s=this._map,u=this._content;if(!s||!this._lngLat&&!this._trackPointer||!u)return;let m=this._container;if(m||(m=this._container=X("div","mapboxgl-popup",s.getContainer()),this._tip=X("div","mapboxgl-popup-tip",m),m.appendChild(u)),this.options.maxWidth&&m.style.maxWidth!==this.options.maxWidth&&(m.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=nl(this._lngLat,this._pos,s.transform)),!this._trackPointer||f){const y=this._pos=this._trackPointer&&f?f:s.project(this._lngLat),x=hg(this.options.offset),T=this._anchor=this._getAnchor(x.y),S=hg(this.options.offset,T),A=y.add(S).round();s._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${ta[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&s._showingGlobe()){const y=a.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(jv);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:ut,Style:po,LngLat:a.LngLat,LngLatBounds:a.LngLatBounds,Point:a.Point,MercatorCoordinate:a.MercatorCoordinate,FreeCameraOptions:Km,Evented:a.Evented,config:a.config,prewarm:function(){Na().acquire(uo)},clearPrewarmedResources:function(){const f=Hr;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(uo),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return a.config.ACCESS_TOKEN},set accessToken(f){a.config.ACCESS_TOKEN=f},get baseApiUrl(){return a.config.API_URL},set baseApiUrl(f){a.config.API_URL=f},get workerCount(){return xr.workerCount},set workerCount(f){xr.workerCount=f},get maxParallelImageRequests(){return a.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){a.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){a.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:a.exported.setNow,restoreNow:a.exported.restoreNow};return rl});var I=g;return I})})(VD);var $_=VD.exports;const DG=od($_);var GD={exports:{}};(function(t){var e={};function r(g){return Math.floor(Math.abs(g)+.5)*(g>=0?1:-1)}function l(g,w,I){g=r(g*I),w=r(w*I);var a=(g-w)*2;a<0&&(a=-a-1);for(var k="";a>=32;)k+=String.fromCharCode((32|a&31)+63),a/=32;return k+=String.fromCharCode((a|0)+63),k}e.decode=function(g,w){for(var I=0,a=0,k=0,O=[],V=0,G=0,X=null,oe,le,we=Math.pow(10,Number.isInteger(w)?w:5);I<g.length;){X=null,V=1,G=0;do X=g.charCodeAt(I++)-63,G+=(X&31)*V,V*=32;while(X>=32);oe=G&1?(-G-1)/2:G/2,V=1,G=0;do X=g.charCodeAt(I++)-63,G+=(X&31)*V,V*=32;while(X>=32);le=G&1?(-G-1)/2:G/2,a+=oe,k+=le,O.push([a/we,k/we])}return O},e.encode=function(g,w){if(!g.length)return"";for(var I=Math.pow(10,Number.isInteger(w)?w:5),a=l(g[0][0],0,I)+l(g[0][1],0,I),k=1;k<g.length;k++){var O=g[k],V=g[k-1];a+=l(O[0],V[0],I),a+=l(O[1],V[1],I)}return a};function d(g){for(var w=[],I=0;I<g.length;I++){var a=g[I].slice();w.push([a[1],a[0]])}return w}e.fromGeoJSON=function(g,w){if(g&&g.type==="Feature"&&(g=g.geometry),!g||g.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return e.encode(d(g.coordinates),w)},e.toGeoJSON=function(g,w){var I=e.decode(g,w);return{type:"LineString",coordinates:d(I)}},t.exports&&(t.exports=e)})(GD);var LG=GD.exports;const zG=od(LG),OG=()=>{const t=re.useContext(Ql),{from:e,to:r,pathwayTransportMean:l,pathwayType:d}=t,{loadedPathway:g,setLoadedPathway:w}=re.useContext(Sm),I=vd(),a=re.useRef(null),k=re.useRef({}),O=re.useRef([]),[V,G]=re.useState(!1);re.useEffect(()=>{a.current&&(a.current.innerHTML=""),k.current=new $_.Map({container:a.current,style:"mapbox://styles/mapbox/streets-v12",center:[-3.70379,40.416775],zoom:6}),G(!0),k.current.on("load",()=>{X(e,r).then(()=>{G(!1),w({type:Lr.UNDEFINED,start:e,end:r,codifiedPath:"",distance:t.distance,duration:t.duration,transportMean:gr.VEHICLE,favourite:!1,cost:0})})})},[]),re.useEffect(()=>{X(e,r)},[e,r,l,d]);const X=async(oe,le)=>{if(k.current&&oe&&le&&oe.lon!==le.lon&&oe.lat!==le.lat){let we;V?we=g:we=await I.calculatePathway(oe,le,l,d),t.setDistance(we.distance),t.setDuration(we.duration),t.setCodifiedPath(we.codifiedPath);const te=zG.decode(we.codifiedPath).map(J=>[J[1],J[0]]);if(k.current.isStyleLoaded()){O.current.forEach(Te=>Te.remove()),O.current=[];const J=new $_.Marker().setLngLat(te[0]).addTo(k.current);O.current.push(J),k.current.flyTo({center:te[0],zoom:10}),k.current.getLayer("route")&&(k.current.removeLayer("route"),k.current.removeSource("route")),k.current.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:te}}}),k.current.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#0632fa","line-width":8}});const ce=new $_.Marker({color:"#F00"}).setLngLat(te[te.length-1]).addTo(k.current);O.current.push(ce)}}};return j.jsx("div",{ref:a,style:{position:"fixed",height:"100vh",left:0,top:0,width:"100vw",zIndex:-1}})},BG=()=>{const t=re.useContext(zr),e=()=>{hv().logout().then(()=>{t.setUser({uid:"",displayName:"",email:""}),t.setIsLogged(!1)})},r=()=>{t.setWantDetails(!0)},l=()=>{t.setWantPreferences(!0)};return j.jsxs(zi,{children:[j.jsx(zi.Toggle,{variant:"secondary",id:"dropdown-basic",children:j.jsx("i",{className:"fas fa-user"})}),j.jsxs(zi.Menu,{children:[j.jsx(zi.Item,{onClick:r,children:"Detalles"}),j.jsx(zi.Item,{onClick:l,children:"Preferencias"}),j.jsx(zi.Item,{onClick:e,children:"Cerrar Sesin"})]})]})},FG=()=>j.jsx(j.Fragment,{children:j.jsx("nav",{className:"navbar navbar-expand-lg navbar-dark fixed-top",style:{backgroundColor:"rgb(107,116,124)",zIndex:2},children:j.jsxs("div",{className:"container-fluid justify-content-between",children:[j.jsxs("a",{className:"navbar-brand d-flex align-items-center",href:"",children:[j.jsx("img",{src:Vb,width:"30",height:"30",className:"d-inline-block align-top",alt:"Logo Route Maps",style:{marginRight:"10px"}}),"Route Maps"]}),j.jsx(BG,{})]})})}),NG=()=>{const t=pu();return j.jsxs("div",{className:"card",style:{position:"fixed",top:"55px",left:"0px",height:"calc(100% - 60px)",width:"50px",zIndex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"start"},children:[j.jsx(m_,{to:"/",className:`nav-link ${t.pathname==="/"?"active":""}`,style:{padding:"20px",textAlign:"center",color:t.pathname==="/"?"#0000FF":"#000000"},children:j.jsx("i",{className:"fas fa-map"})}),j.jsx(m_,{to:"/places",className:`nav-link ${t.pathname.startsWith("/places")?"active":""}`,style:{padding:"20px",textAlign:"center",color:t.pathname.startsWith("/places")?"#ffa600":"#000000"},children:j.jsx("i",{className:"fas fa-map-marker-alt"})}),j.jsx(m_,{to:"/vehicles",className:`nav-link ${t.pathname.startsWith("/vehicles")?"active":""}`,style:{padding:"20px",textAlign:"center",color:t.pathname.startsWith("/vehicles")?"#ff0090":"#000000"},children:j.jsx("i",{className:"fas fa-car-side"})}),j.jsx(m_,{to:"/pathways",className:`nav-link ${t.pathname.startsWith("/pathways")?"active":""}`,style:{padding:"20px",textAlign:"center",color:t.pathname.startsWith("/pathways")?"#1faf09":"#000000"},children:j.jsx("i",{className:"fas fa-route"})})]})},jG=()=>{const t=re.useContext(zr),{displayName:e,email:r}=t.user,l=()=>{t.setWantDetails(!1)},d=()=>{hv().deleteUser().then(()=>{t.setUser({uid:"",displayName:"",email:""}),t.setIsLogged(!1)})};return j.jsx("div",{className:"card",style:{width:"24rem",height:"auto",position:"absolute",top:"60px",right:"10px"},children:j.jsxs("div",{className:"card-body",children:[j.jsx("h5",{className:"card-title",children:"Detalles de la cuenta"}),j.jsx("hr",{}),j.jsxs("ul",{className:"list-group list-group-flush",children:[j.jsxs("li",{className:"list-group-item",children:[j.jsx("strong",{children:"Display name"})," - ",e]}),j.jsxs("li",{className:"list-group-item",children:[j.jsx("strong",{children:"e-mail"})," - ",r]})]}),j.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[j.jsx("button",{className:"btn btn-primary mt-3",onClick:l,children:"Cerrar"}),j.jsx("button",{className:"btn btn-outline-danger mt-3",onClick:d,children:"Eliminar cuenta"})]})]})})},za=({children:t})=>{const{wantDetails:e,wantPreferences:r}=re.useContext(zr);return j.jsxs(g$,{fluid:!0,style:{padding:0},children:[j.jsx(hA,{style:{height:"60px"},children:j.jsx(U_,{xs:12,children:j.jsx(FG,{})})}),j.jsxs(hA,{style:{marginTop:"60px"},children:[j.jsx(U_,{xs:2,style:{width:"50px"},children:j.jsx(NG,{})}),j.jsx(U_,{xs:10,style:{marginLeft:"50px"},children:t}),e&&j.jsx(jG,{}),r&&j.jsx(UD,{})]})]})},Im=ro.createContext({places:[],setPlaces:()=>{}}),UG=({children:t})=>{const[e,r]=ro.useState([]),l={places:e,setPlaces:r};return j.jsx(Im.Provider,{value:l,children:t})},WD=({showCrudOptions:t=!0})=>{const e=Ra(),{places:r,setPlaces:l}=re.useContext(Im),{user:d}=re.useContext(zr),{fieldInSelection:g,setShowSavedPlaces:w,setFrom:I,setTo:a}=re.useContext(Ql),k=Tm(),[O,V]=re.useState(!1);re.useEffect(()=>(r.length===0&&k.getPlaces(d.uid).then(we=>l([...we])),()=>{G()}),[]);const G=async()=>{await k.setPlaces(r,d.uid)},X=we=>{we.Favorito=!we.Favorito,l([...r])},oe=we=>{if(!t){g==="from"&&I({name:we.Nombre,lon:we.Longitud,lat:we.Latitud}),g==="to"&&a({name:we.Nombre,lon:we.Longitud,lat:we.Latitud}),w(!1);return}e(`/places/editPlace/${we.Nombre}`)},le=we=>{k.deletePlace(we,d.uid).then(()=>{l(r.filter(te=>te.Nombre!==we.Nombre))})};return j.jsxs(j.Fragment,{children:[j.jsx(id,{children:j.jsx(id.Check,{type:"switch",id:"custom-switch",label:"Filtrar por favoritos",checked:O,onChange:()=>V(!O)})}),r.length===0?j.jsx("p",{children:"No hay lugares guardados"}):j.jsx(j.Fragment,{children:j.jsxs(sE,{striped:!0,bordered:!0,hover:!0,children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{className:"col-10"}),t?j.jsxs(j.Fragment,{children:[j.jsx("th",{className:"col-1"}),j.jsx("th",{className:"col-1"})]}):j.jsx("th",{className:"col-2"})]})}),j.jsx("tbody",{children:r.filter(we=>!O||we.Favorito).map((we,te)=>j.jsxs("tr",{onClick:()=>oe(we),children:[j.jsx("td",{children:we.Nombre}),j.jsx("td",{className:"text-center",children:j.jsx(no,{disabled:!t,variant:we.Favorito?"warning":"outline-warning",onClick:J=>{J.stopPropagation(),X(we)},children:j.jsx("i",{className:"fas fa-star"})})}),t&&j.jsx("td",{className:"text-center",children:j.jsx(no,{variant:"outline-danger",onClick:J=>{J.stopPropagation(),le(we)},children:j.jsx("i",{className:"fas fa-trash"})})})]},te))})]})})]})},qD=({showCrudOptions:t=!0})=>{const e=Ra(),{user:r,defaultVehiclePlate:l,setDefaultVehiclePlate:d}=re.useContext(zr),{setShowVehicles:g,setVehicle:w}=re.useContext(Ql),I=gd(),[a,k]=re.useState([]),[O,V]=re.useState(!1);re.useEffect(()=>(a.length===0&&I.getVehicles(r.uid).then(te=>k([...te])),()=>{G()}),[]);const G=async()=>{await I.updateVehicles(a,r.uid)},X=te=>{I.toggleFavourite(te.plate,r.uid),te.favorite=!te.favorite,k([...a])},oe=te=>{I.setDefaultVehicle(te.plate,r.uid).then(()=>{d(te.plate)})},le=te=>{if(!t){w(te),g(!1);return}e(`/vehicles/modifyVehicle/${te.plate}`)},we=te=>{I.deleteVehicle(te,r.uid).then(()=>{k(a.filter(J=>J.plate!==te.plate))})};return j.jsxs(j.Fragment,{children:[j.jsx(id,{children:j.jsx(id.Check,{type:"switch",id:"custom-switch",label:"Filtrar por favoritos",checked:O,onChange:()=>V(!O)})}),a.length===0?j.jsx("p",{children:"No hay lugares guardados"}):j.jsx(j.Fragment,{children:j.jsxs(sE,{striped:!0,bordered:!0,hover:!0,children:[j.jsx("thead",{children:j.jsx("tr",{children:t?j.jsxs(j.Fragment,{children:[j.jsx("th",{className:"col-2",children:"Matrcula"}),j.jsx("th",{className:"col-3",children:"Nombre"}),j.jsx("th",{className:"col-2",children:"Tipo de combustible"}),j.jsx("th",{className:"col-2",children:"Consumo"}),j.jsx("th",{className:"col-1"}),j.jsx("th",{className:"col-1"}),j.jsx("th",{className:"col-1"})]}):j.jsxs(j.Fragment,{children:[j.jsx("th",{className:"col-3",children:"Matrcula"}),j.jsx("th",{className:"col-3",children:"Nombre"}),j.jsx("th",{className:"col-2",children:"Tipo de combustible"}),j.jsx("th",{className:"col-2",children:"Consumo"}),j.jsx("th",{className:"col-2"})]})})}),j.jsx("tbody",{children:a.filter(te=>!O||te.favorite).map((te,J)=>j.jsxs("tr",{onClick:()=>le(te),children:[j.jsx("td",{children:te.plate}),j.jsx("td",{children:te.name}),j.jsx("td",{children:te.propulsion}),j.jsx("td",{children:te.consumption}),j.jsx("td",{className:"text-center",children:j.jsx(no,{disabled:!t,variant:te.favorite?"warning":"outline-warning",onClick:ce=>{ce.stopPropagation(),X(te)},children:j.jsx("i",{className:"fas fa-star"})})}),t&&j.jsxs(j.Fragment,{children:[j.jsx("td",{className:"text-center",children:j.jsx(no,{variant:te.plate===l?"info":"outline-info",onClick:ce=>{ce.stopPropagation(),oe(te)},children:j.jsx("i",{className:"fas fa-check"})})}),j.jsx("td",{className:"text-center",children:j.jsx(no,{variant:"outline-danger",onClick:ce=>{ce.stopPropagation(),we(te)},children:j.jsx("i",{className:"fas fa-trash"})})})]})]},J))})]})})]})},VG=()=>{const{showSavedPlaces:t,showVehicles:e}=re.useContext(Ql);return j.jsx(j.Fragment,{children:j.jsxs(za,{children:[j.jsx(Z0,{}),j.jsx(OG,{}),t&&j.jsxs("div",{style:{display:"flex",flexDirection:"row",height:"100vh",position:"relative",zIndex:2},children:[j.jsx(Z0,{}),j.jsx(x_,{style:{width:"calc(100% - 350px)",position:"fixed",top:"55px",left:"350px",height:"calc(100% - 60px)"},children:j.jsx(x_.Body,{children:j.jsx(WD,{showCrudOptions:!1})})})]}),e&&j.jsxs("div",{style:{display:"flex",flexDirection:"row",height:"100vh",position:"relative",zIndex:2},children:[j.jsx(Z0,{}),j.jsx(x_,{style:{width:"calc(100% - 350px)",position:"fixed",top:"55px",left:"350px",height:"calc(100% - 60px)"},children:j.jsx(x_.Body,{children:j.jsx(qD,{showCrudOptions:!1})})})]})]})})},$G=()=>j.jsxs(za,{children:[j.jsx("h1",{children:"Lugares guardados"}),j.jsx("hr",{}),j.jsx(WD,{}),j.jsx(Fs,{to:"/places/addPlaceByToponym",className:"btn btn-outline-primary mt-3",children:"Aadir lugar"})]}),GG=()=>{const{user:t}=re.useContext(zr),e=re.useContext(Im),r=Tm(),[l,d]=re.useState(""),[g,w]=re.useState(!1),I=()=>{w(!g)},a=O=>{d(O.target.value)},k=()=>{try{r.addPlaceByToponym(l,g,t.uid).then(O=>{e.setPlaces([...O])})}catch{console.log("Error al aadir el lugar")}};return j.jsxs(za,{children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h1",{children:"Aadir lugar usando topnimo"}),j.jsxs("div",{children:[j.jsx(no,{variant:g?"warning":"outline-warning",onClick:I,children:j.jsx("i",{className:"fas fa-star"})}),j.jsx(Fs,{to:"/places/addPlaceByCoords",className:"btn btn-outline-info",children:j.jsx("i",{className:"fas fa-exchange-alt"})})]})]}),j.jsx("hr",{}),j.jsxs("div",{className:"form-group",children:[j.jsx("label",{htmlFor:"placeName",children:"Nombre del lugar"}),j.jsx("input",{type:"text",id:"placeName",className:"form-control",value:l,onChange:a})]}),j.jsx(Fs,{to:"/places/getPlaces",className:"btn btn-outline-primary mt-3",onClick:k,children:"Aadir lugar"})]})},WG=()=>{const{placeName:t}=zk(),e=Ra(),{user:r}=re.useContext(zr),{places:l,setPlaces:d}=re.useContext(Im),g=Tm(),[w,I]=re.useState({Nombre:"",Longitud:0,Latitud:0,Favorito:!1});re.useEffect(()=>{const X=l.find(oe=>oe.Nombre===t);X&&I(X)},[t]);const a={Nombre:w.Nombre,Longitud:w.Longitud,Latitud:w.Latitud},k=[{id:"Nombre",label:"Nombre",type:"text",placeholder:"Nombre del lugar"},{id:"Longitud",label:"Longitud",type:"number",placeholder:"Longitud del lugar"},{id:"Latitud",label:"Latitud",type:"number",placeholder:"Latitud del lugar"}],O={Nombre:X=>X?null:"El nombre es requerido",Longitud:X=>X?isNaN(Number(X))?"La longitud debe ser un nmero":Number(X)<-180||Number(X)>180?"La longitud debe estar entre -180 y 180":null:"La longitud es requerida",Latitud:X=>X?isNaN(Number(X))?"La latitud debe ser un nmero":Number(X)<-90||Number(X)>90?"La latitud debe estar entre -90 y 90":null:"La latitud es requerida"},V=async X=>{const oe={...X,Favorito:w.Favorito};d(l.map(le=>le.Nombre===t?oe:le)),await g.setPlace(oe,r.uid),e("/places")},G=()=>{I({...w,Favorito:!w.Favorito})};return j.jsxs(za,{children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h1",{children:"Editar lugar"}),j.jsx(no,{variant:w.Favorito?"warning":"outline-warning",onClick:G,children:j.jsx("i",{className:"fas fa-star"})})]}),j.jsx("hr",{}),j.jsx(mu,{formData:a,formFields:k,onSubmit:V,submitButtonLabel:"Guardar",validations:O})]})},qG=()=>{const{user:t}=re.useContext(zr),e=re.useContext(Im),r=Tm(),[l,d]=re.useState({lon:0,lat:0}),[g,w]=re.useState(!1),[I,a]=re.useState(""),[k,O]=re.useState(!1);re.useEffect(()=>{g&&r.getPlaceNameByCoords(l).then(J=>{a(J)})},[g,l]);const V={Longitud:l.lon,Latitud:l.lat},G=[{id:"Longitud",label:"Longitud",type:"number",placeholder:"Entre -180 y 180"},{id:"Latitud",label:"Latitud",type:"number",placeholder:"Entre -90 y 90"}],X={Longitud:J=>J?isNaN(Number(J))?"La longitud debe ser un nmero":Number(J)<-180||Number(J)>180?"La longitud debe estar entre -180 y 180":null:"La longitud es requerida",Latitud:J=>J?isNaN(Number(J))?"La latitud debe ser un nmero":Number(J)<-90||Number(J)>90?"La latitud debe estar entre -90 y 90":null:"La latitud es requerida"},oe=()=>{O(!k)},le=async J=>{J.Longitud===l.lon&&J.Latitud===l.lat||(d({lon:J.Longitud,lat:J.Latitud}),w(!0))},we=J=>{a(J.target.value)},te=()=>{d({lon:0,lat:0,name:I}),r.setPlace({Nombre:I,Longitud:l.lon||0,Latitud:l.lat||0,Favorito:k},t.uid).then(J=>{e.setPlaces([...J])})};return j.jsxs(za,{children:[j.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[j.jsx("h1",{children:"Aadir lugar usando coordenadas"}),j.jsxs("div",{children:[j.jsx(no,{variant:k?"warning":"outline-warning",onClick:oe,children:j.jsx("i",{className:"fas fa-star"})}),j.jsx(Fs,{to:"/places/addPlaceByToponym",className:"btn btn-outline-info",children:j.jsx("i",{className:"fas fa-exchange-alt"})})]})]}),j.jsx("hr",{}),j.jsx(mu,{formData:V,formFields:G,onSubmit:le,submitButtonLabel:"Establecer coordenadas",validations:X}),g&&j.jsxs("form",{children:[j.jsxs("div",{className:"form-group",children:[j.jsx("label",{htmlFor:"placeName",children:"Nombre del lugar"}),j.jsx("input",{type:"text",id:"placeName",className:"form-control",value:I,onChange:we})]}),j.jsx(Fs,{to:"/places/getPlaces",className:"btn btn-outline-primary mt-3",onClick:te,children:"Aadir lugar"})]})]})},HG=()=>j.jsxs(dd,{children:[j.jsx(qn,{path:"/addPlaceByToponym",element:j.jsx(GG,{})}),j.jsx(qn,{path:"/addPlaceByCoords",element:j.jsx(qG,{})}),j.jsx(qn,{path:"/getPlaces",element:j.jsx($G,{})}),j.jsx(qn,{path:"/editPlace/:placeName",element:j.jsx(WG,{})}),j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/places/getPlaces"})})]}),ZG=()=>{const{user:t}=re.useContext(zr),e=gd(),[r,l]=re.useState(""),d=Ra(),[g,w]=re.useState(!1),[I,a]=re.useState({plate:"",name:"",propulsion:vi.Gasolina,consumption:0,favorite:!1}),k=[{id:"plate",label:"Matrcula del Vehculo",type:"string",placeholder:"Matrcula del Vehculo"},{id:"name",label:"Nombre del Vehculo",type:"text",placeholder:"Nombre del Vehculo"},{id:"propulsion",label:"Propulsin",type:"select",options:Object.values(vi)},{id:"consumption",label:"Consumo",type:"number",placeholder:"Consumo"}],O={propulsion:X=>Object.values(vi).includes(X)?null:"Tipo de propulsin invlido. Tipos vlidos: "+Object.values(vi).join(", "),consumption:X=>isNaN(parseFloat(X))?"Consumo invlido":null},V=()=>{a({plate:"",name:"",propulsion:vi.Gasolina,consumption:0,favorite:!1})},G=async X=>{try{const oe={plate:X.plate,name:X.name,propulsion:X.propulsion,consumption:parseFloat(X.consumption),favorite:X.favorite};await e.addVehicle(oe,t.uid)?(l("Vehculo aadido con xito"),w(!0),V(),d("/vehicles/getVehicles")):l("Error al aadir vehculo")}catch{l("Error al procesar la solicitud")}};return j.jsx(za,{children:j.jsxs("div",{children:[j.jsx("h1",{children:"Aadir Vehculo"}),j.jsx(mu,{formData:I,formFields:k,onSubmit:G,submitButtonLabel:"Aadir Vehculo",validations:O}),r&&j.jsx("div",{className:`alert ${g?"alert-info":"alert-danger"}`,children:r}),j.jsx(Fs,{className:"btn btn-outline-primary mt-3",to:"/vehicles/getVehicles",children:"Ver vehculos"})]})})},XG=()=>j.jsxs(za,{children:[j.jsx("h1",{children:"Vehculos guardados"}),j.jsx("hr",{}),j.jsx(qD,{}),j.jsx(Fs,{className:"btn btn-outline-primary mt-3",to:"/vehicles/addVehicle",children:"Aadir vehculo"})]}),KG=()=>{const{plate:t}=zk(),e=Ra(),[r,l]=re.useState(""),{user:d}=re.useContext(zr),g=gd(),[w,I]=re.useState({plate:"",name:"",propulsion:vi.Gasolina,consumption:"0",favorite:!1});re.useEffect(()=>{if(!t){e("/vehicles/getVehicles");return}(async()=>{try{const G=await g.getVehicle(t,d.uid);I({plate:G.plate,name:G.name,propulsion:G.propulsion,consumption:G.consumption.toString(),favorite:G.favorite||!1})}catch{l("Error al obtener la matrcula del vehculo")}})()},[t]);const a=[{id:"plate",label:"Matrcula del Vehculo",type:"string",placeholder:"Matrcula del Vehculo",disabled:!0},{id:"name",label:"Nombre del Vehculo",type:"text",placeholder:"Nombre del Vehculo"},{id:"propulsion",label:"Propulsin",type:"select",options:Object.values(vi)},{id:"consumption",label:"Consumo",type:"number",placeholder:"Consumo"}],k={name:V=>!V||V.trim()===""?"Nombre requerido":null,propulsion:V=>Object.values(vi).includes(V)?null:"Tipo de propulsin invlido. Tipos vlidos: "+Object.values(vi).join(", "),consumption:V=>isNaN(parseFloat(V))?"Consumo invlido":null},O=async V=>{try{const G=await g.modifyVehicle({plate:V.plate,name:V.name,propulsion:V.propulsion,consumption:parseFloat(V.consumption),favorite:V.favorite},d.uid);l(G?"Vehculo modificado con xito":"Error al modificar vehculo"),e("/vehicles/getVehicles")}catch{l("Error al procesar la solicitud")}};return j.jsx(za,{children:j.jsxs("div",{children:[j.jsx("h1",{children:"Modificar Vehculo"}),j.jsx(mu,{formData:w,formFields:a,onSubmit:O,submitButtonLabel:"Modificar Vehculo",validations:k}),r&&j.jsx("div",{className:"alert alert-info",children:r}),j.jsx(Fs,{className:"btn btn-outline-primary mt-3",to:"/vehicles/getVehicles",children:"Ver vehculos"})]})})},JG=()=>j.jsxs(dd,{children:[j.jsx(qn,{path:"/addVehicle",element:j.jsx(ZG,{})}),j.jsx(qn,{path:"/modifyVehicle/:plate",element:j.jsx(KG,{})}),j.jsx(qn,{path:"/getVehicles",element:j.jsx(XG,{})}),j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/vehicles/getVehicles"})})]}),YG=()=>{const t=Ra(),{user:e}=re.useContext(zr),{pathways:r,setPathways:l,setLoadedPathway:d}=re.useContext(Sm),g=re.useContext(Ql),w=vd(),[I,a]=re.useState(!1);re.useEffect(()=>(r.length===0&&w.getPathways(e.uid).then(X=>{l([...X])}),()=>{k()}),[]);const k=async()=>{await w.updatePathways(r,e.uid)},O=X=>{X.favourite=!X.favourite,l([...r])},V=X=>{w.deletePathway(X,e.uid).then(()=>{l([...r.filter(oe=>!w.pathwaysAreEqual(X,oe))])})},G=X=>{g.setFrom(X.start),g.setTo(X.end),g.setPathwayType(X.type),g.setPathwayTransportMean(X.transportMean),d(X),t("/")};return j.jsxs(j.Fragment,{children:[j.jsx(id,{children:j.jsx(id.Check,{type:"switch",id:"custom-switch",label:"Filtrar por favoritos",checked:I,onChange:()=>a(!I)})}),r.length===0?j.jsx("p",{children:"No hay rutas guardadas"}):j.jsxs(sE,{striped:!0,bordered:!0,hover:!0,children:[j.jsx("thead",{children:j.jsxs("tr",{children:[j.jsx("th",{children:"Origen"}),j.jsx("th",{children:"Destino"}),j.jsx("th",{children:"Distancia"}),j.jsx("th",{children:"Duracin"}),j.jsx("th",{children:"Coste"}),j.jsx("th",{children:"Tipo transporte"}),j.jsx("th",{children:"Tipo de ruta"}),j.jsx("th",{children:"Vehculo"}),j.jsx("th",{}),j.jsx("th",{})]})}),j.jsx("tbody",{children:r.filter(X=>!I||X.favourite).map((X,oe)=>j.jsxs("tr",{onClick:()=>G(X),children:[j.jsx("td",{children:X.start.name}),j.jsx("td",{children:X.end.name}),j.jsxs("td",{children:[(X.distance/1e3).toFixed(4)," km"]}),j.jsxs("td",{children:[Math.floor(X.duration/3600)," h",Math.round(X.duration%3600/60)," min"]}),j.jsxs("td",{children:[X.cost.toFixed(2)," ",X.transportMean===gr.VEHICLE?"":"cal"]}),j.jsx("td",{children:X.transportMean}),j.jsx("td",{children:X.type}),j.jsx("td",{children:X.transportMean===gr.VEHICLE?X.vehiclePlate:"A pata"}),j.jsx("td",{className:"text-center",children:j.jsx(no,{variant:X.favourite?"warning":"outline-warning",onClick:le=>{le.stopPropagation(),O(X)},children:j.jsx("i",{className:"fas fa-star"})})}),j.jsx("td",{className:"text-center",children:j.jsx(no,{variant:"outline-danger",onClick:le=>{le.stopPropagation(),V(X)},children:j.jsx("i",{className:"fas fa-trash"})})})]},oe))})]})]})},QG=()=>j.jsxs(za,{children:[j.jsx("h1",{children:"Rutas guardadas"}),j.jsx("hr",{}),j.jsx(YG,{})]}),eW=()=>j.jsxs(dd,{children:[j.jsx(qn,{path:"/list",element:j.jsx(QG,{})}),"// Ruta parar redireccionar a la pagina PathwaysPage",j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/pathways/list"})})]}),tW=()=>j.jsxs(dd,{children:[j.jsx(qn,{path:"/account/preferences",element:j.jsx(UD,{})}),j.jsx(qn,{path:"/",element:j.jsx(VG,{})}),j.jsx(qn,{path:"/places/*",element:j.jsx(HG,{})}),j.jsx(qn,{path:"/vehicles/*",element:j.jsx(JG,{})}),j.jsx(qn,{path:"/pathways/*",element:j.jsx(eW,{})}),j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/"})})]}),nW=()=>{const{isLogged:t,setIsLogged:e,setUser:r,setDefaultPathwayType:l,setDefaultVehiclePlate:d}=re.useContext(zr);return re.useEffect(()=>{const g=localStorage.getItem("uuid")||"",w=localStorage.getItem("displayName")||"",I=localStorage.getItem("email")||"",k=localStorage.getItem("defaultPathwayType")||"undefined",O=localStorage.getItem("defaultVehiclePlate")||"";if(!g||!I||k===Lr.UNDEFINED){e(!1);return}r({uid:g,displayName:w,email:I}),l(k),d(O),e(!0)},[]),j.jsx(dd,{children:t?j.jsx(qn,{path:"/*",element:j.jsx(tW,{})}):j.jsxs(j.Fragment,{children:[j.jsx(qn,{path:"/auth/*",element:j.jsx(b6,{})}),j.jsx(qn,{path:"/*",element:j.jsx(hd,{to:"/auth"})})]})})},rW=()=>j.jsx(j.Fragment,{children:j.jsx(qF,{children:j.jsx(IG,{children:j.jsx(UG,{children:j.jsx(kG,{children:j.jsx(nW,{})})})})})}),{VITE_MAP_API_KEY:iW}=yd();DG.accessToken=iW;X0.createRoot(document.getElementById("root")).render(j.jsx(ro.StrictMode,{children:j.jsx(jF,{children:j.jsx(rW,{})})}));
